<html><head><title>Highlighted Intervals</title></head><body>
<h2>Commit: d23db47</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/Jsoup.java:</strong><br>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>        super(new StartTag(Tag.valueOf(&quot;#root&quot;), <span style="color: purple; font-weight: bold;">baseUri</span>));
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        this.tag = startTag.getTag();
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">baseUri</span>);
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">attributes</span>);
        
        childNodes = new ArrayList<Node>();
</p></li>
<p>        this.attributes = attributes;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        super(<span style="color: purple; font-weight: bold;">baseUri</span>);
        attributes.put(TEXT_KEY, text);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Parser.java:</strong><br>
<p>        Parser parser = new Parser(html, <span style="color: purple; font-weight: bold;">baseUri</span>);
        return parser.parse();
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/Jsoup.java:</strong><br>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>        super(new StartTag(Tag.valueOf("#root")));
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        this.tag = startTag.getTag();
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        childNodes = new ArrayList<Node>();
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        super();
        attributes.put(TEXT_KEY, text);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Parser.java:</strong><br>
<p>        Parser parser = new Parser(html);
        return parser.parse();
</p></li>
</li>
</ul>
<h2>Commit: 9d3ab85</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/Jsoup.java:</strong><br>
<p>        return <span style="color: purple; font-weight: bold;">Parser</span>.<span style="color: green; font-weight: bold;">parse</span>(<span style="color: purple; font-weight: bold;">html</span>);
    }
}
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: 18e9a8f</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/helper/StringUtil.java:</strong><br>
<p>
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/helper/Validate.java:</strong><br>
<p>        if (<span style="color: purple; font-weight: bold;">obj</span> == null)
            throw new <span style="color: red; font-weight: bold;">IllegalArgumentException</span>("Object must not be null");
    }

</p></li>
<p>        if (<span style="color: purple; font-weight: bold;">obj</span> == null)
            throw new <span style="color: red; font-weight: bold;">IllegalArgumentException</span>(<span style="color: purple; font-weight: bold;">msg</span>);
    }

</p></li>
<p>        if (<span style="color: purple; font-weight: bold;">string</span> == null || <span style="color: purple; font-weight: bold;">string</span>.<span style="color: green; font-weight: bold;">length</span>() == 0)
            throw new <span style="color: red; font-weight: bold;">IllegalArgumentException</span>("String must not be empty");
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        return Integer.parseInt(indexS);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        return Integer.parseInt(indexS);
</p></li>
</li>
</ul>
<h2>Commit: 8749726(BIC)</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/helper/StringUtil.java:</strong><br>
<p>        for (String <span style="color: purple; font-weight: bold;">hay</span> : <span style="color: purple; font-weight: bold;">haystack</span>) {
            if (<span style="color: purple; font-weight: bold;">hay</span>.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">needle</span>))
            return true;
        }
        return false;
    }
}
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/helper/Validate.java:</strong><br>
<p>        if (<span style="color: purple; font-weight: bold;">val</span>)
            throw new <span style="color: red; font-weight: bold;">IllegalArgumentException</span>("Must be false");
    }

</p></li>
<p>        if (<span style="color: purple; font-weight: bold;">val</span>)
            throw new <span style="color: red; font-weight: bold;">IllegalArgumentException</span>(<span style="color: purple; font-weight: bold;">msg</span>);
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>    // linked hash map to preserve insertion order.
</p></li>
<p>             <span style="color: purple; font-weight: bold;">attributes</span> = new <span style="color: red; font-weight: bold;">LinkedHashMap&lt;String, Attribute&gt;</span>(2);
        attributes.put(attribute.getKey(), attribute);
</p></li>
<p>            return;
        
        for (Map.Entry<String, Attribute> entry : attributes.entrySet()) {
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>
</p></li>
<p>        <span style="color: purple; font-weight: bold;">noQuirks</span>, <span style="color: purple; font-weight: bold;">quirks</span>, <span style="color: purple; font-weight: bold;">limitedQuirks</span>;
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/CharacterReader.java:</strong><br>
<p>    private int <span style="color: purple; font-weight: bold;">mark</span> = 0;

</p></li>
<p>        this.<span style="color: purple; font-weight: bold;">input</span> = <span style="color: purple; font-weight: bold;">input</span>;
        this.<span style="color: purple; font-weight: bold;">length</span> = <span style="color: purple; font-weight: bold;">input</span>.<span style="color: green; font-weight: bold;">length</span>();
    }

</p></li>
<p>        return <span style="color: purple; font-weight: bold;">pos</span> &gt;= <span style="color: purple; font-weight: bold;">length</span>;
    }

</p></li>
<p>        return <span style="color: green; font-weight: bold;">isEmpty</span>() ? <span style="color: purple; font-weight: bold;">EOF</span> : <span style="color: purple; font-weight: bold;">input</span>.<span style="color: green; font-weight: bold;">charAt</span>(<span style="color: purple; font-weight: bold;">pos</span>);
    }

</p></li>
<p>        return <span style="color: green; font-weight: bold;">isEmpty</span>() ? <span style="color: purple; font-weight: bold;">EOF</span> : <span style="color: purple; font-weight: bold;">input</span>.<span style="color: green; font-weight: bold;">charAt</span>(<span style="color: purple; font-weight: bold;">pos</span>++);
    }

</p></li>
<p>        <span style="color: purple; font-weight: bold;">pos</span>--;
    }

</p></li>
<p>        <span style="color: purple; font-weight: bold;">pos</span>++;
    }

</p></li>
<p>        int <span style="color: purple; font-weight: bold;">start</span> = <span style="color: purple; font-weight: bold;">pos</span>;

        <span style="color: purple; font-weight: bold;">OUTER</span>: while (!<span style="color: green; font-weight: bold;">isEmpty</span>()) {
            char <span style="color: purple; font-weight: bold;">c</span> = <span style="color: purple; font-weight: bold;">input</span>.<span style="color: green; font-weight: bold;">charAt</span>(<span style="color: purple; font-weight: bold;">pos</span>);
            for (char <span style="color: purple; font-weight: bold;">seek</span> : <span style="color: purple; font-weight: bold;">seq</span>) {
                if (<span style="color: purple; font-weight: bold;">seek</span> == <span style="color: purple; font-weight: bold;">c</span>)
                    break <span style="color: purple; font-weight: bold;">OUTER</span>;
            }
            <span style="color: purple; font-weight: bold;">pos</span>++;
        }

        return <span style="color: purple; font-weight: bold;">pos</span> &gt; <span style="color: purple; font-weight: bold;">start</span> ? <span style="color: purple; font-weight: bold;">input</span>.<span style="color: green; font-weight: bold;">substring</span>(<span style="color: purple; font-weight: bold;">start</span>, <span style="color: purple; font-weight: bold;">pos</span>) : "";
    }

</p></li>
<p>        if (<span style="color: green; font-weight: bold;">isEmpty</span>())
            return false;
        char <span style="color: purple; font-weight: bold;">c</span> = <span style="color: purple; font-weight: bold;">input</span>.<span style="color: green; font-weight: bold;">charAt</span>(<span style="color: purple; font-weight: bold;">pos</span>);
        return (<span style="color: purple; font-weight: bold;">c</span> &gt;= &#x27;A&#x27; &amp;&amp; <span style="color: purple; font-weight: bold;">c</span> &lt;= &#x27;Z&#x27;) || (<span style="color: purple; font-weight: bold;">c</span> &gt;= &#x27;a&#x27; &amp;&amp; <span style="color: purple; font-weight: bold;">c</span> <= 'z');
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilderState.java:</strong><br>
<p>    <span style="color: purple; font-weight: bold;">Initial</span> {
        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
            if (<span style="color: green; font-weight: bold;">isWhitespace</span>(<span style="color: purple; font-weight: bold;">t</span>)) {
                return true; <span style="color: blue; font-weight: bold;">// ignore whitespace</span>
            } else if (<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">isComment</span>()) {
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asComment</span>());
            } else if (<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">isDoctype</span>()) {
                <span style="color: blue; font-weight: bold;">// todo: parse error check on expected doctypes</span>
                <span style="color: blue; font-weight: bold;">// todo: quirk state check on doctype ids</span>
                Token.Doctype <span style="color: purple; font-weight: bold;">d</span> = <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asDoctype</span>();
                DocumentType <span style="color: purple; font-weight: bold;">doctype</span> = new <span style="color: red; font-weight: bold;">DocumentType</span>(<span style="color: purple; font-weight: bold;">d</span>.<span style="color: green; font-weight: bold;">getName</span>(), <span style="color: purple; font-weight: bold;">d</span>.<span style="color: green; font-weight: bold;">getPublicIdentifier</span>(), <span style="color: purple; font-weight: bold;">d</span>.<span style="color: green; font-weight: bold;">getSystemIdentifier</span>(), <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getBaseUri</span>());
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getDocument</span>().<span style="color: green; font-weight: bold;">appendChild</span>(<span style="color: purple; font-weight: bold;">doctype</span>);
                if (<span style="color: purple; font-weight: bold;">d</span>.<span style="color: green; font-weight: bold;">isForceQuirks</span>())
                    <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getDocument</span>().<span style="color: green; font-weight: bold;">quirksMode</span>(Document.QuirksMode.quirks);
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">BeforeHtml</span>);
            } else {
                <span style="color: blue; font-weight: bold;">// todo: check not iframe srcdoc</span>
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">BeforeHtml</span>);
                return <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">t</span>); <span style="color: blue; font-weight: bold;">// re-process token</span>
            }
            return true;
        }
    },
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
            if (<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">isDoctype</span>()) {
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                return false;
            } else if (<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">isComment</span>()) {
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asComment</span>());
            } else if (<span style="color: green; font-weight: bold;">isWhitespace</span>(<span style="color: purple; font-weight: bold;">t</span>)) {
                return true; <span style="color: blue; font-weight: bold;">// ignore whitespace</span>
            } else if (<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">isStartTag</span>() &amp;&amp; <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asStartTag</span>().<span style="color: green; font-weight: bold;">name</span>().<span style="color: green; font-weight: bold;">equals</span>(&quot;html&quot;)) {
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asStartTag</span>());
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">BeforeHead</span>);
            } else if (<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">isEndTag</span>() &amp;&amp; (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asEndTag</span>().<span style="color: green; font-weight: bold;">name</span>(), &quot;head&quot;, &quot;body&quot;, &quot;html&quot;, &quot;br&quot;))) {
                return <span style="color: green; font-weight: bold;">anythingElse</span>(<span style="color: purple; font-weight: bold;">t</span>, <span style="color: purple; font-weight: bold;">tb</span>);
            } else if (<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">isEndTag</span>()) {
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                return false;
            } else {
                return <span style="color: green; font-weight: bold;">anythingElse</span>(<span style="color: purple; font-weight: bold;">t</span>, <span style="color: purple; font-weight: bold;">tb</span>);
            }
            return true;
        }

</p></li>
<p>            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(&quot;html&quot;);
            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">BeforeHead</span>);
            return <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">t</span>);
        }
    },
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
            if (<span style="color: green; font-weight: bold;">isWhitespace</span>(<span style="color: purple; font-weight: bold;">t</span>)) {
                return true;
            } else if (<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">isComment</span>()) {
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asComment</span>());
            } else if (<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">isDoctype</span>()) {
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                return false;
            } else if (<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">isStartTag</span>() &amp;&amp; <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asStartTag</span>().<span style="color: green; font-weight: bold;">name</span>().<span style="color: green; font-weight: bold;">equals</span>(&quot;html&quot;)) {
                return <span style="color: purple; font-weight: bold;">InBody</span>.<span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">t</span>, <span style="color: purple; font-weight: bold;">tb</span>); <span style="color: blue; font-weight: bold;">// does not transition</span>
            } else if (<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">isStartTag</span>() &amp;&amp; <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asStartTag</span>().<span style="color: green; font-weight: bold;">name</span>().<span style="color: green; font-weight: bold;">equals</span>(&quot;head&quot;)) {
                Element <span style="color: purple; font-weight: bold;">head</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asStartTag</span>());
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">setHeadElement</span>(<span style="color: purple; font-weight: bold;">head</span>);
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">InHead</span>);
            } else if (<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">isEndTag</span>() &amp;&amp; (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asEndTag</span>().<span style="color: green; font-weight: bold;">name</span>(), &quot;head&quot;, &quot;body&quot;, &quot;html&quot;, &quot;br&quot;))) {
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.StartTag</span>(&quot;head&quot;));
                return <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">t</span>);
            } else if (<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">isEndTag</span>()) {
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                return false;
            } else {
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.StartTag</span>(&quot;head&quot;));
                return <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">t</span>);
            }
            return true;
        }
    },
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
            if (<span style="color: green; font-weight: bold;">isWhitespace</span>(<span style="color: purple; font-weight: bold;">t</span>)) {
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asCharacter</span>());
                return true;
            }
            switch (t.type) {
                case <span style="color: purple; font-weight: bold;">Comment</span>:
                    <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asComment</span>());
                    break;
                case <span style="color: purple; font-weight: bold;">Doctype</span>:
                    <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                    return false;
                case <span style="color: purple; font-weight: bold;">StartTag</span>:
                    Token.StartTag <span style="color: purple; font-weight: bold;">start</span> = <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asStartTag</span>();
                    String <span style="color: purple; font-weight: bold;">name</span> = <span style="color: purple; font-weight: bold;">start</span>.<span style="color: green; font-weight: bold;">name</span>();
                    if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;html&quot;)) {
                        return <span style="color: purple; font-weight: bold;">InBody</span>.<span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">t</span>, <span style="color: purple; font-weight: bold;">tb</span>);
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">name</span>, &quot;base&quot;, &quot;basefont&quot;, &quot;bgsound&quot;, &quot;command&quot;, &quot;link&quot;)) {
                        Element <span style="color: purple; font-weight: bold;">el</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insertEmpty</span>(<span style="color: purple; font-weight: bold;">start</span>);
                        <span style="color: blue; font-weight: bold;">// jsoup special: update base as it is seen. todo: flip to current browser behaviour of one shot</span>
                        if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;base&quot;) &amp;&amp; <span style="color: purple; font-weight: bold;">el</span>.<span style="color: green; font-weight: bold;">hasAttr</span>(&quot;href&quot;))
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">setBaseUri</span>(<span style="color: purple; font-weight: bold;">el</span>);
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;meta&quot;)) {
                        Element <span style="color: purple; font-weight: bold;">meta</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insertEmpty</span>(<span style="color: purple; font-weight: bold;">start</span>);
                        <span style="color: blue; font-weight: bold;">// todo: charset switches</span>
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;title&quot;)) {
                        <span style="color: green; font-weight: bold;">handleRcData</span>(<span style="color: purple; font-weight: bold;">start</span>, <span style="color: purple; font-weight: bold;">tb</span>);
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">name</span>, &quot;noframes&quot;, &quot;style&quot;)) {
                        <span style="color: green; font-weight: bold;">handleRawtext</span>(<span style="color: purple; font-weight: bold;">start</span>, <span style="color: purple; font-weight: bold;">tb</span>);
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;noscript&quot;)) {
                        <span style="color: blue; font-weight: bold;">// else if noscript &amp;&amp; scripting flag = true: rawtext (jsoup doesn&#x27;t run script, to handle as noscript)</span>
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">start</span>);
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">InHeadNoscript</span>);
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;script&quot;)) {
                        <span style="color: blue; font-weight: bold;">// skips some script rules as won&#x27;t execute them</span>
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">start</span>);
                        tb.tokeniser.<span style="color: green; font-weight: bold;">transition</span>(TokeniserState.ScriptData);
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">markInsertionMode</span>();
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">Text</span>);
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;head&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                        return false;
                    } else {
                        return <span style="color: green; font-weight: bold;">anythingElse</span>(<span style="color: purple; font-weight: bold;">t</span>, <span style="color: purple; font-weight: bold;">tb</span>);
                    }
                    break;
                case <span style="color: purple; font-weight: bold;">EndTag</span>:
                    Token.EndTag <span style="color: purple; font-weight: bold;">end</span> = <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asEndTag</span>();
                    <span style="color: purple; font-weight: bold;">name</span> = <span style="color: purple; font-weight: bold;">end</span>.<span style="color: green; font-weight: bold;">name</span>();
                    if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;head&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">pop</span>();
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">AfterHead</span>);
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">name</span>, &quot;body&quot;, &quot;html&quot;, &quot;br&quot;)) {
                        return <span style="color: green; font-weight: bold;">anythingElse</span>(<span style="color: purple; font-weight: bold;">t</span>, <span style="color: purple; font-weight: bold;">tb</span>);
                    } else {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                        return false;
                    }
                    break;
                default:
                    return <span style="color: green; font-weight: bold;">anythingElse</span>(<span style="color: purple; font-weight: bold;">t</span>, <span style="color: purple; font-weight: bold;">tb</span>);
            }
            return true;
        }

</p></li>
<p>            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;head&quot;));
            return <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">t</span>);
        }
    },
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
            if (<span style="color: green; font-weight: bold;">isWhitespace</span>(<span style="color: purple; font-weight: bold;">t</span>)) {
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asCharacter</span>());
            } else if (<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">isComment</span>()) {
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asComment</span>());
            } else if (<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">isDoctype</span>()) {
                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
            } else if (<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">isStartTag</span>()) {
                Token.StartTag <span style="color: purple; font-weight: bold;">startTag</span> = <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asStartTag</span>();
                String <span style="color: purple; font-weight: bold;">name</span> = <span style="color: purple; font-weight: bold;">startTag</span>.<span style="color: green; font-weight: bold;">name</span>();
                if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;html&quot;)) {
                    return <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">t</span>, <span style="color: purple; font-weight: bold;">InBody</span>);
                } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;body&quot;)) {
                    <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                    <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">framesetOk</span>(false);
                    <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">InBody</span>);
                } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;frameset&quot;)) {
                    <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                    <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">InFrameset</span>);
                } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">name</span>, &quot;base&quot;, &quot;basefont&quot;, &quot;bgsound&quot;, &quot;link&quot;, &quot;meta&quot;, &quot;noframes&quot;, &quot;script&quot;, &quot;style&quot;, &quot;title&quot;)) {
                    <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                    Element <span style="color: purple; font-weight: bold;">head</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getHeadElement</span>();
                    <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">push</span>(<span style="color: purple; font-weight: bold;">head</span>);
                    <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">t</span>, <span style="color: purple; font-weight: bold;">InHead</span>);
                    <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">removeFromStack</span>(<span style="color: purple; font-weight: bold;">head</span>);
                } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;head&quot;)) {
                    <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                    return false;
                } else {
                    <span style="color: green; font-weight: bold;">anythingElse</span>(<span style="color: purple; font-weight: bold;">t</span>, <span style="color: purple; font-weight: bold;">tb</span>);
                }
            } else if (<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">isEndTag</span>()) {
                if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asEndTag</span>().<span style="color: green; font-weight: bold;">name</span>(), &quot;body&quot;, &quot;html&quot;)) {
                    <span style="color: green; font-weight: bold;">anythingElse</span>(<span style="color: purple; font-weight: bold;">t</span>, <span style="color: purple; font-weight: bold;">tb</span>);
                } else {
                    <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                    return false;
                }
            } else {
                <span style="color: green; font-weight: bold;">anythingElse</span>(<span style="color: purple; font-weight: bold;">t</span>, <span style="color: purple; font-weight: bold;">tb</span>);
            }
            return true;
        }

</p></li>
<p>            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.StartTag</span>(&quot;body&quot;));
            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">framesetOk</span>(true);
            return <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">t</span>);
        }
    },
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
            switch (t.type) {
                case <span style="color: purple; font-weight: bold;">Character</span>: {
                    Token.Character <span style="color: purple; font-weight: bold;">c</span> = <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asCharacter</span>();
                    if (<span style="color: purple; font-weight: bold;">c</span>.<span style="color: green; font-weight: bold;">getData</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">nullString</span>)) {
                        <span style="color: blue; font-weight: bold;">// todo confirm that check</span>
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                        return false;
                    } else if (<span style="color: green; font-weight: bold;">isWhitespace</span>(<span style="color: purple; font-weight: bold;">c</span>)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">reconstructFormattingElements</span>();
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">c</span>);
                    } else {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">reconstructFormattingElements</span>();
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">c</span>);
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">framesetOk</span>(false);
                    }
                    break;
                }
                case <span style="color: purple; font-weight: bold;">Comment</span>: {
                    <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asComment</span>());
                    break;
                }
                case <span style="color: purple; font-weight: bold;">Doctype</span>: {
                    <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                    return false;
                }
                case <span style="color: purple; font-weight: bold;">StartTag</span>:
                    Token.StartTag <span style="color: purple; font-weight: bold;">startTag</span> = <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asStartTag</span>();
                    String <span style="color: purple; font-weight: bold;">name</span> = <span style="color: purple; font-weight: bold;">startTag</span>.<span style="color: green; font-weight: bold;">name</span>();
                    if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;html&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                        <span style="color: blue; font-weight: bold;">// merge attributes onto real html</span>
                        Element <span style="color: purple; font-weight: bold;">html</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getStack</span>().<span style="color: green; font-weight: bold;">getFirst</span>();
                        for (Attribute <span style="color: purple; font-weight: bold;">attribute</span> : <span style="color: purple; font-weight: bold;">startTag</span>.<span style="color: green; font-weight: bold;">getAttributes</span>()) {
                            if (!<span style="color: purple; font-weight: bold;">html</span>.<span style="color: green; font-weight: bold;">hasAttr</span>(<span style="color: purple; font-weight: bold;">attribute</span>.<span style="color: green; font-weight: bold;">getKey</span>()))
                                <span style="color: purple; font-weight: bold;">html</span>.<span style="color: green; font-weight: bold;">attributes</span>().<span style="color: green; font-weight: bold;">put</span>(<span style="color: purple; font-weight: bold;">attribute</span>);
                        }
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">name</span>, &quot;base&quot;, &quot;basefont&quot;, &quot;bgsound&quot;, &quot;command&quot;, &quot;link&quot;, &quot;meta&quot;, &quot;noframes&quot;, &quot;style&quot;, &quot;title&quot;)) {
                        return <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">t</span>, <span style="color: purple; font-weight: bold;">InHead</span>);
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;body&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                        LinkedList&lt;Element&gt; <span style="color: purple; font-weight: bold;">stack</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getStack</span>();
                        if (<span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">size</span>() == 1 || (<span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">size</span>() &gt; 2 &amp;&amp; !<span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">get</span>(1).<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(&quot;body&quot;))) {
                            <span style="color: blue; font-weight: bold;">// only in fragment case</span>
                            return false; <span style="color: blue; font-weight: bold;">// ignore</span>
                        } else {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">framesetOk</span>(false);
                            Element <span style="color: purple; font-weight: bold;">body</span> = <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">get</span>(1);
                            for (Attribute <span style="color: purple; font-weight: bold;">attribute</span> : <span style="color: purple; font-weight: bold;">startTag</span>.<span style="color: green; font-weight: bold;">getAttributes</span>()) {
                                if (!<span style="color: purple; font-weight: bold;">body</span>.<span style="color: green; font-weight: bold;">hasAttr</span>(<span style="color: purple; font-weight: bold;">attribute</span>.<span style="color: green; font-weight: bold;">getKey</span>()))
                                    <span style="color: purple; font-weight: bold;">body</span>.<span style="color: green; font-weight: bold;">attributes</span>().<span style="color: green; font-weight: bold;">put</span>(<span style="color: purple; font-weight: bold;">attribute</span>);
                            }
                        }
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;frameset&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                        LinkedList&lt;Element&gt; <span style="color: purple; font-weight: bold;">stack</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getStack</span>();
                        if (<span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">size</span>() == 1 || (<span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">size</span>() &gt; 2 &amp;&amp; !<span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">get</span>(1).<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(&quot;body&quot;))) {
                            <span style="color: blue; font-weight: bold;">// only in fragment case</span>
                            return false; <span style="color: blue; font-weight: bold;">// ignore</span>
                        } else if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">framesetOk</span>()) {
                            return false; <span style="color: blue; font-weight: bold;">// ignore frameset</span>
                        } else {
                            Element <span style="color: purple; font-weight: bold;">second</span> = <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">get</span>(1);
                            if (<span style="color: purple; font-weight: bold;">second</span>.<span style="color: green; font-weight: bold;">parent</span>() != null)
                                <span style="color: purple; font-weight: bold;">second</span>.<span style="color: green; font-weight: bold;">remove</span>();
                            <span style="color: blue; font-weight: bold;">// pop up to html element</span>
                            while (<span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">size</span>() &gt; 1)
                                <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">removeLast</span>();
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">InFrameset</span>);
                        }
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">name</span>,
                            &quot;address&quot;, &quot;article&quot;, &quot;aside&quot;, &quot;blockquote&quot;, &quot;center&quot;, &quot;details&quot;, &quot;dir&quot;, &quot;div&quot;, &quot;dl&quot;,
                            &quot;fieldset&quot;, &quot;figcaption&quot;, &quot;figure&quot;, &quot;footer&quot;, &quot;header&quot;, &quot;hgroup&quot;, &quot;menu&quot;, &quot;nav&quot;, &quot;ol&quot;,
                            &quot;p&quot;, &quot;section&quot;, &quot;summary&quot;, &quot;ul&quot;)) {
                        if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inButtonScope</span>(&quot;p&quot;)) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;p&quot;));
                        }
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">name</span>, &quot;h1&quot;, &quot;h2&quot;, &quot;h3&quot;, &quot;h4&quot;, &quot;h5&quot;, &quot;h6&quot;)) {
                        if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inButtonScope</span>(&quot;p&quot;)) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;p&quot;));
                        }
                        if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">currentElement</span>().<span style="color: green; font-weight: bold;">nodeName</span>(), &quot;h1&quot;, &quot;h2&quot;, &quot;h3&quot;, &quot;h4&quot;, &quot;h5&quot;, &quot;h6&quot;)) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">pop</span>();
                        }
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">name</span>, &quot;pre&quot;, &quot;listing&quot;)) {
                        if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inButtonScope</span>(&quot;p&quot;)) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;p&quot;));
                        }
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                        <span style="color: blue; font-weight: bold;">// todo: ignore LF if next token</span>
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">framesetOk</span>(false);
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;form&quot;)) {
                        if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getFormElement</span>() != null) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                            return false;
                        }
                        if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inButtonScope</span>(&quot;p&quot;)) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;p&quot;));
                        }
                        Element <span style="color: purple; font-weight: bold;">form</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">setFormElement</span>(<span style="color: purple; font-weight: bold;">form</span>);
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;li&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">framesetOk</span>(false);
                        LinkedList&lt;Element&gt; <span style="color: purple; font-weight: bold;">stack</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getStack</span>();
                        for (int <span style="color: purple; font-weight: bold;">i</span> = <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">size</span>() - 1; <span style="color: purple; font-weight: bold;">i</span> &gt; 0; <span style="color: purple; font-weight: bold;">i</span>--) {
                            Element <span style="color: purple; font-weight: bold;">el</span> = <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">i</span>);
                            if (<span style="color: purple; font-weight: bold;">el</span>.<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(&quot;li&quot;)) {
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;li&quot;));
                                break;
                            }
                            if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">isSpecial</span>(<span style="color: purple; font-weight: bold;">el</span>) &amp;&amp; !<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">el</span>.<span style="color: green; font-weight: bold;">nodeName</span>(), &quot;address&quot;, &quot;div&quot;, &quot;p&quot;))
                                break;
                        }
                        if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inButtonScope</span>(&quot;p&quot;)) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;p&quot;));
                        }
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">name</span>, &quot;dd&quot;, &quot;dt&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">framesetOk</span>(false);
                        LinkedList&lt;Element&gt; <span style="color: purple; font-weight: bold;">stack</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getStack</span>();
                        for (int <span style="color: purple; font-weight: bold;">i</span> = <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">size</span>() - 1; <span style="color: purple; font-weight: bold;">i</span> &gt; 0; <span style="color: purple; font-weight: bold;">i</span>--) {
                            Element <span style="color: purple; font-weight: bold;">el</span> = <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">i</span>);
                            if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">el</span>.<span style="color: green; font-weight: bold;">nodeName</span>(), &quot;dd&quot;, &quot;dt&quot;)) {
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(<span style="color: purple; font-weight: bold;">el</span>.<span style="color: green; font-weight: bold;">nodeName</span>()));
                                break;
                            }
                            if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">isSpecial</span>(<span style="color: purple; font-weight: bold;">el</span>) &amp;&amp; !<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">el</span>.<span style="color: green; font-weight: bold;">nodeName</span>(), &quot;address&quot;, &quot;div&quot;, &quot;p&quot;))
                                break;
                        }
                        if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inButtonScope</span>(&quot;p&quot;)) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;p&quot;));
                        }
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;plaintext&quot;)) {
                        if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inButtonScope</span>(&quot;p&quot;)) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;p&quot;));
                        }
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                        tb.tokeniser.<span style="color: green; font-weight: bold;">transition</span>(TokeniserState.PLAINTEXT); <span style="color: blue; font-weight: bold;">// once in, never gets out</span>
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;button&quot;)) {
                        if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inButtonScope</span>(&quot;button&quot;)) {
                            <span style="color: blue; font-weight: bold;">// close and reprocess</span>
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;button&quot;));
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                        } else {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">reconstructFormattingElements</span>();
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">framesetOk</span>(false);
                        }
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;a&quot;)) {
                        if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getActiveFormattingElement</span>(&quot;a&quot;) != null) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;a&quot;));

                            <span style="color: blue; font-weight: bold;">// still on stack?</span>
                            Element <span style="color: purple; font-weight: bold;">remainingA</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getFromStack</span>(&quot;a&quot;);
                            if (<span style="color: purple; font-weight: bold;">remainingA</span> != null) {
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">removeFromActiveFormattingElements</span>(<span style="color: purple; font-weight: bold;">remainingA</span>);
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">removeFromStack</span>(<span style="color: purple; font-weight: bold;">remainingA</span>);
                            }
                        }
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">reconstructFormattingElements</span>();
                        Element <span style="color: purple; font-weight: bold;">a</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">pushActiveFormattingElements</span>(<span style="color: purple; font-weight: bold;">a</span>);
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">name</span>,
                            &quot;b&quot;, &quot;big&quot;, &quot;code&quot;, &quot;em&quot;, &quot;font&quot;, &quot;i&quot;, &quot;s&quot;, &quot;small&quot;, &quot;strike&quot;, &quot;strong&quot;, &quot;tt&quot;, &quot;u&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">reconstructFormattingElements</span>();
                        Element <span style="color: purple; font-weight: bold;">el</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">pushActiveFormattingElements</span>(<span style="color: purple; font-weight: bold;">el</span>);
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;nobr&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">reconstructFormattingElements</span>();
                        if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inScope</span>(&quot;nobr&quot;)) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;nobr&quot;));
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">reconstructFormattingElements</span>();
                        }
                        Element <span style="color: purple; font-weight: bold;">el</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">pushActiveFormattingElements</span>(<span style="color: purple; font-weight: bold;">el</span>);
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">name</span>, &quot;applet&quot;, &quot;marquee&quot;, &quot;object&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">reconstructFormattingElements</span>();
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insertMarkerToFormattingElements</span>();
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">framesetOk</span>(false);
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;table&quot;)) {
                        if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getDocument</span>().<span style="color: green; font-weight: bold;">quirksMode</span>() != Document.QuirksMode.quirks &amp;&amp; <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inButtonScope</span>(&quot;p&quot;)) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;p&quot;));
                        }
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">framesetOk</span>(false);
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">InTable</span>);
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">name</span>, &quot;area&quot;, &quot;br&quot;, &quot;embed&quot;, &quot;img&quot;, &quot;keygen&quot;, &quot;wbr&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">reconstructFormattingElements</span>();
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insertEmpty</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">framesetOk</span>(false);
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;input&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">reconstructFormattingElements</span>();
                        Element <span style="color: purple; font-weight: bold;">el</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insertEmpty</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                        if (!<span style="color: purple; font-weight: bold;">el</span>.<span style="color: green; font-weight: bold;">attr</span>(&quot;type&quot;).<span style="color: green; font-weight: bold;">equalsIgnoreCase</span>(&quot;hidden&quot;))
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">framesetOk</span>(false);
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">name</span>, &quot;param&quot;, &quot;source&quot;, &quot;track&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insertEmpty</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;hr&quot;)) {
                        if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inButtonScope</span>(&quot;p&quot;)) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;p&quot;));
                        }
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insertEmpty</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">framesetOk</span>(false);
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;image&quot;)) {
                        <span style="color: blue; font-weight: bold;">// we&#x27;re not supposed to ask.</span>
                        <span style="color: purple; font-weight: bold;">startTag</span>.<span style="color: green; font-weight: bold;">name</span>(&quot;img&quot;);
                        return <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;isindex&quot;)) {
                        <span style="color: blue; font-weight: bold;">// how much do we care about the early 90s?</span>
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                        if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getFormElement</span>() != null)
                            return false;

                        tb.tokeniser.<span style="color: green; font-weight: bold;">acknowledgeSelfClosingFlag</span>();
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.StartTag</span>(&quot;form&quot;));
                        if (startTag.attributes.<span style="color: green; font-weight: bold;">hasKey</span>(&quot;action&quot;)) {
                            Element <span style="color: purple; font-weight: bold;">form</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getFormElement</span>();
                            <span style="color: purple; font-weight: bold;">form</span>.<span style="color: green; font-weight: bold;">attr</span>(&quot;action&quot;, startTag.attributes.<span style="color: green; font-weight: bold;">get</span>(&quot;action&quot;));
                        }
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.StartTag</span>(&quot;hr&quot;));
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.StartTag</span>(&quot;label&quot;));
                        <span style="color: blue; font-weight: bold;">// hope you like english.</span>
                        String <span style="color: purple; font-weight: bold;">prompt</span> = startTag.attributes.<span style="color: green; font-weight: bold;">hasKey</span>(&quot;prompt&quot;) ?
                                startTag.attributes.<span style="color: green; font-weight: bold;">get</span>(&quot;prompt&quot;) :
                                &quot;This is a searchable index. Enter search keywords: &quot;;

                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.Character</span>(<span style="color: purple; font-weight: bold;">prompt</span>));

                        <span style="color: blue; font-weight: bold;">// input</span>
                        Attributes <span style="color: purple; font-weight: bold;">inputAttribs</span> = new <span style="color: red; font-weight: bold;">Attributes</span>();
                        for (Attribute <span style="color: purple; font-weight: bold;">attr</span> : startTag.attributes) {
                            if (!<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">attr</span>.<span style="color: green; font-weight: bold;">getKey</span>(), &quot;name&quot;, &quot;action&quot;, &quot;prompt&quot;))
                                <span style="color: purple; font-weight: bold;">inputAttribs</span>.<span style="color: green; font-weight: bold;">put</span>(<span style="color: purple; font-weight: bold;">attr</span>);
                        }
                        <span style="color: purple; font-weight: bold;">inputAttribs</span>.<span style="color: green; font-weight: bold;">put</span>(&quot;name&quot;, &quot;isindex&quot;);
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.StartTag</span>(&quot;input&quot;, <span style="color: purple; font-weight: bold;">inputAttribs</span>));
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;label&quot;));
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.StartTag</span>(&quot;hr&quot;));
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;form&quot;));
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;textarea&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                        <span style="color: blue; font-weight: bold;">// todo: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move on to the next one. (Newlines at the start of textarea elements are ignored as an authoring convenience.)</span>
                        tb.tokeniser.<span style="color: green; font-weight: bold;">transition</span>(TokeniserState.Rcdata);
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">markInsertionMode</span>();
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">framesetOk</span>(false);
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">Text</span>);
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;xmp&quot;)) {
                        if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inButtonScope</span>(&quot;p&quot;)) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;p&quot;));
                        }
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">reconstructFormattingElements</span>();
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">framesetOk</span>(false);
                        <span style="color: green; font-weight: bold;">handleRawtext</span>(<span style="color: purple; font-weight: bold;">startTag</span>, <span style="color: purple; font-weight: bold;">tb</span>);
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;iframe&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">framesetOk</span>(false);
                        <span style="color: green; font-weight: bold;">handleRawtext</span>(<span style="color: purple; font-weight: bold;">startTag</span>, <span style="color: purple; font-weight: bold;">tb</span>);
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;noembed&quot;)) {
                        <span style="color: blue; font-weight: bold;">// also handle noscript if script enabled</span>
                        <span style="color: green; font-weight: bold;">handleRawtext</span>(<span style="color: purple; font-weight: bold;">startTag</span>, <span style="color: purple; font-weight: bold;">tb</span>);
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;select&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">reconstructFormattingElements</span>();
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">framesetOk</span>(false);

                        TreeBuilderState <span style="color: purple; font-weight: bold;">state</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">state</span>();
                        if (<span style="color: purple; font-weight: bold;">state</span>.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">InTable</span>) || <span style="color: purple; font-weight: bold;">state</span>.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">InCaption</span>) || <span style="color: purple; font-weight: bold;">state</span>.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">InTableBody</span>) || <span style="color: purple; font-weight: bold;">state</span>.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">InRow</span>) || <span style="color: purple; font-weight: bold;">state</span>.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">InCell</span>))
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">InSelectInTable</span>);
                        else
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">InSelect</span>);
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(&quot;optgroup&quot;, &quot;option&quot;)) {
                        if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">currentElement</span>().<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(&quot;option&quot;))
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;option&quot;));
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">reconstructFormattingElements</span>();
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(&quot;rp&quot;, &quot;rt&quot;)) {
                        if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inScope</span>(&quot;ruby&quot;)) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">generateImpliedEndTags</span>();
                            if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">currentElement</span>().<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(&quot;ruby&quot;)) {
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">popStackToBefore</span>(&quot;ruby&quot;); <span style="color: blue; font-weight: bold;">// i.e. close up to but not include name</span>
                            }
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                        }
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;math&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">reconstructFormattingElements</span>();
                        <span style="color: blue; font-weight: bold;">// todo: handle A start tag whose tag name is &quot;math&quot; (i.e. foreign, mathml)</span>
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                        tb.tokeniser.<span style="color: green; font-weight: bold;">acknowledgeSelfClosingFlag</span>();
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;svg&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">reconstructFormattingElements</span>();
                        <span style="color: blue; font-weight: bold;">// todo: handle A start tag whose tag name is &quot;svg&quot; (xlink, svg)</span>
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                        tb.tokeniser.<span style="color: green; font-weight: bold;">acknowledgeSelfClosingFlag</span>();
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">name</span>,
                            &quot;caption&quot;, &quot;col&quot;, &quot;colgroup&quot;, &quot;frame&quot;, &quot;head&quot;, &quot;tbody&quot;, &quot;td&quot;, &quot;tfoot&quot;, &quot;th&quot;, &quot;thead&quot;, &quot;tr&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                        return false;
                    } else {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">reconstructFormattingElements</span>();
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                    }
                    break;

                case <span style="color: purple; font-weight: bold;">EndTag</span>:
                    Token.EndTag <span style="color: purple; font-weight: bold;">endTag</span> = <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asEndTag</span>();
                    <span style="color: purple; font-weight: bold;">name</span> = <span style="color: purple; font-weight: bold;">endTag</span>.<span style="color: green; font-weight: bold;">name</span>();
                    if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;body&quot;)) {
                        if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inScope</span>(&quot;body&quot;)) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                            return false;
                        } else {
                            <span style="color: blue; font-weight: bold;">// todo: error if stack contains something not dd, dt, li, optgroup, option, p, rp, rt, tbody, td, tfoot, th, thead, tr, body, html</span>
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">AfterBody</span>);
                        }
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;html&quot;)) {
                        boolean <span style="color: purple; font-weight: bold;">notIgnored</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;body&quot;));
                        if (<span style="color: purple; font-weight: bold;">notIgnored</span>)
                            return <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">endTag</span>);
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">name</span>,
                            &quot;address&quot;, &quot;article&quot;, &quot;aside&quot;, &quot;blockquote&quot;, &quot;button&quot;, &quot;center&quot;, &quot;details&quot;, &quot;dir&quot;, &quot;div&quot;,
                            &quot;dl&quot;, &quot;fieldset&quot;, &quot;figcaption&quot;, &quot;figure&quot;, &quot;footer&quot;, &quot;header&quot;, &quot;hgroup&quot;, &quot;listing&quot;, &quot;menu&quot;,
                            &quot;nav&quot;, &quot;ol&quot;, &quot;pre&quot;, &quot;section&quot;, &quot;summary&quot;, &quot;ul&quot;)) {
                        <span style="color: blue; font-weight: bold;">// todo: refactor these lookups</span>
                        if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inScope</span>(<span style="color: purple; font-weight: bold;">name</span>)) {
                            <span style="color: blue; font-weight: bold;">// nothing to close</span>
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                            return false;
                        } else {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">generateImpliedEndTags</span>();
                            if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">currentElement</span>().<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">name</span>))
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">popStackToClose</span>(<span style="color: purple; font-weight: bold;">name</span>);
                        }
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;form&quot;)) {
                        Element <span style="color: purple; font-weight: bold;">currentForm</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getFormElement</span>();
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">setFormElement</span>(null);
                        if (<span style="color: purple; font-weight: bold;">currentForm</span> == null || !<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inScope</span>(<span style="color: purple; font-weight: bold;">name</span>)) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                            return false;
                        } else {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">generateImpliedEndTags</span>();
                            if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">currentElement</span>().<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">name</span>))
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                            <span style="color: blue; font-weight: bold;">// remove currentForm from stack. will shift anything under up.</span>
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">removeFromStack</span>(<span style="color: purple; font-weight: bold;">currentForm</span>);
                        }
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;p&quot;)) {
                        if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inButtonScope</span>(<span style="color: purple; font-weight: bold;">name</span>)) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.StartTag</span>(<span style="color: purple; font-weight: bold;">name</span>)); <span style="color: blue; font-weight: bold;">// if no p to close, creates an empty &lt;p&gt;&lt;/p&gt;</span>
                            return <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">endTag</span>);
                        } else {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">generateImpliedEndTags</span>(<span style="color: purple; font-weight: bold;">name</span>);
                            if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">currentElement</span>().<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">name</span>))
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">popStackToClose</span>(<span style="color: purple; font-weight: bold;">name</span>);
                        }
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;li&quot;)) {
                        if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inListItemScope</span>(<span style="color: purple; font-weight: bold;">name</span>)) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                            return false;
                        } else {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">generateImpliedEndTags</span>(<span style="color: purple; font-weight: bold;">name</span>);
                            if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">currentElement</span>().<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">name</span>))
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">popStackToClose</span>(<span style="color: purple; font-weight: bold;">name</span>);
                        }
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">name</span>, &quot;dd&quot;, &quot;dt&quot;)) {
                        if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inScope</span>(<span style="color: purple; font-weight: bold;">name</span>)) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                            return false;
                        } else {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">generateImpliedEndTags</span>(<span style="color: purple; font-weight: bold;">name</span>);
                            if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">currentElement</span>().<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">name</span>))
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">popStackToClose</span>(<span style="color: purple; font-weight: bold;">name</span>);
                        }
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">name</span>, &quot;h1&quot;, &quot;h2&quot;, &quot;h3&quot;, &quot;h4&quot;, &quot;h5&quot;, &quot;h6&quot;)) {
                        if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inScope</span>(new String[]{&quot;h1&quot;, &quot;h2&quot;, &quot;h3&quot;, &quot;h4&quot;, &quot;h5&quot;, &quot;h6&quot;})) {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                            return false;
                        } else {
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">generateImpliedEndTags</span>(<span style="color: purple; font-weight: bold;">name</span>);
                            if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">currentElement</span>().<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">name</span>))
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">popStackToClose</span>(&quot;h1&quot;, &quot;h2&quot;, &quot;h3&quot;, &quot;h4&quot;, &quot;h5&quot;, &quot;h6&quot;);
                        }
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;sarcasm&quot;)) {
                        <span style="color: blue; font-weight: bold;">// *sigh*</span>
                        return <span style="color: green; font-weight: bold;">anyOtherEndTag</span>(<span style="color: purple; font-weight: bold;">t</span>, <span style="color: purple; font-weight: bold;">tb</span>);
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">name</span>,
                            &quot;a&quot;, &quot;b&quot;, &quot;big&quot;, &quot;code&quot;, &quot;em&quot;, &quot;font&quot;, &quot;i&quot;, &quot;nobr&quot;, &quot;s&quot;, &quot;small&quot;, &quot;strike&quot;, &quot;strong&quot;, &quot;tt&quot;, &quot;u&quot;)) {
                        <span style="color: blue; font-weight: bold;">// Adoption Agency Algorithm.</span>
                        <span style="color: purple; font-weight: bold;">OUTER</span>:
                        for (int <span style="color: purple; font-weight: bold;">i</span> = 0; <span style="color: purple; font-weight: bold;">i</span> &lt; 8; <span style="color: purple; font-weight: bold;">i</span>++) {
                            Element <span style="color: purple; font-weight: bold;">formatEl</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getActiveFormattingElement</span>(<span style="color: purple; font-weight: bold;">name</span>);
                            if (<span style="color: purple; font-weight: bold;">formatEl</span> == null)
                                return <span style="color: green; font-weight: bold;">anyOtherEndTag</span>(<span style="color: purple; font-weight: bold;">t</span>, <span style="color: purple; font-weight: bold;">tb</span>);
                            else if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">onStack</span>(<span style="color: purple; font-weight: bold;">formatEl</span>)) {
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">removeFromActiveFormattingElements</span>(<span style="color: purple; font-weight: bold;">formatEl</span>);
                                return true;
                            } else if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inScope</span>(<span style="color: purple; font-weight: bold;">formatEl</span>.<span style="color: green; font-weight: bold;">nodeName</span>())) {
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                                return false;
                            } else if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">currentElement</span>() != <span style="color: purple; font-weight: bold;">formatEl</span>)
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);

                            Element <span style="color: purple; font-weight: bold;">furthestBlock</span> = null;
                            Element <span style="color: purple; font-weight: bold;">commonAncestor</span> = null;
                            boolean <span style="color: purple; font-weight: bold;">seenFormattingElement</span> = false;
                            LinkedList&lt;Element&gt; <span style="color: purple; font-weight: bold;">stack</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getStack</span>();
                            for (int <span style="color: purple; font-weight: bold;">si</span> = 0; <span style="color: purple; font-weight: bold;">si</span> &lt; <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">size</span>(); <span style="color: purple; font-weight: bold;">si</span>++) {
                                Element <span style="color: purple; font-weight: bold;">el</span> = <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">si</span>);
                                if (<span style="color: purple; font-weight: bold;">el</span> == <span style="color: purple; font-weight: bold;">formatEl</span>) {
                                    <span style="color: purple; font-weight: bold;">commonAncestor</span> = <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">si</span> - 1);
                                    <span style="color: purple; font-weight: bold;">seenFormattingElement</span> = true;
                                } else if (<span style="color: purple; font-weight: bold;">seenFormattingElement</span> &amp;&amp; <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">isSpecial</span>(<span style="color: purple; font-weight: bold;">el</span>)) {
                                    <span style="color: purple; font-weight: bold;">furthestBlock</span> = <span style="color: purple; font-weight: bold;">el</span>;
                                    break;
                                }
                            }
                            if (<span style="color: purple; font-weight: bold;">furthestBlock</span> == null) {
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">popStackToClose</span>(<span style="color: purple; font-weight: bold;">formatEl</span>.<span style="color: green; font-weight: bold;">nodeName</span>());
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">removeFromActiveFormattingElements</span>(<span style="color: purple; font-weight: bold;">formatEl</span>);
                                return true;
                            }

                            <span style="color: blue; font-weight: bold;">// todo: Let a bookmark note the position of the formatting element in the list of active formatting elements relative to the elements on either side of it in the list.</span>
                            <span style="color: blue; font-weight: bold;">// does that mean: int pos of format el in list?</span>
                            Element <span style="color: purple; font-weight: bold;">node</span> = <span style="color: purple; font-weight: bold;">furthestBlock</span>;
                            Element <span style="color: purple; font-weight: bold;">lastNode</span> = <span style="color: purple; font-weight: bold;">furthestBlock</span>;
                            <span style="color: purple; font-weight: bold;">INNER</span>:
                            for (int <span style="color: purple; font-weight: bold;">j</span> = 0; <span style="color: purple; font-weight: bold;">j</span> &lt; 3; <span style="color: purple; font-weight: bold;">j</span>++) {
                                if (<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">onStack</span>(<span style="color: purple; font-weight: bold;">node</span>))
                                    <span style="color: purple; font-weight: bold;">node</span> = <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">aboveOnStack</span>(<span style="color: purple; font-weight: bold;">node</span>);
                                if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">isInActiveFormattingElements</span>(<span style="color: purple; font-weight: bold;">node</span>)) { <span style="color: blue; font-weight: bold;">// note no bookmark check</span>
                                    <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">removeFromStack</span>(<span style="color: purple; font-weight: bold;">node</span>);
                                    continue <span style="color: purple; font-weight: bold;">INNER</span>;
                                } else if (<span style="color: purple; font-weight: bold;">node</span> == <span style="color: purple; font-weight: bold;">formatEl</span>)
                                    break <span style="color: purple; font-weight: bold;">INNER</span>;

                                Element <span style="color: purple; font-weight: bold;">replacement</span> = new <span style="color: red; font-weight: bold;">Element</span>(<span style="color: purple; font-weight: bold;">Tag</span>.<span style="color: green; font-weight: bold;">valueOf</span>(<span style="color: purple; font-weight: bold;">node</span>.<span style="color: green; font-weight: bold;">nodeName</span>()), <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getBaseUri</span>());
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">replaceActiveFormattingElement</span>(<span style="color: purple; font-weight: bold;">node</span>, <span style="color: purple; font-weight: bold;">replacement</span>);
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">replaceOnStack</span>(<span style="color: purple; font-weight: bold;">node</span>, <span style="color: purple; font-weight: bold;">replacement</span>);
                                <span style="color: purple; font-weight: bold;">node</span> = <span style="color: purple; font-weight: bold;">replacement</span>;

                                if (<span style="color: purple; font-weight: bold;">lastNode</span> == <span style="color: purple; font-weight: bold;">furthestBlock</span>) {
                                    <span style="color: blue; font-weight: bold;">// todo: move the aforementioned bookmark to be immediately after the new node in the list of active formatting elements.</span>
                                    <span style="color: blue; font-weight: bold;">// not getting how this bookmark both straddles the element above, but is inbetween here...</span>
                                }
                                if (<span style="color: purple; font-weight: bold;">lastNode</span>.<span style="color: green; font-weight: bold;">parent</span>() != null)
                                    <span style="color: purple; font-weight: bold;">lastNode</span>.<span style="color: green; font-weight: bold;">remove</span>();
                                <span style="color: purple; font-weight: bold;">node</span>.<span style="color: green; font-weight: bold;">appendChild</span>(<span style="color: purple; font-weight: bold;">lastNode</span>);

                                <span style="color: purple; font-weight: bold;">lastNode</span> = <span style="color: purple; font-weight: bold;">node</span>;
                            }

                            if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">commonAncestor</span>.<span style="color: green; font-weight: bold;">nodeName</span>(), &quot;table&quot;, &quot;tbody&quot;, &quot;tfoot&quot;, &quot;thead&quot;, &quot;tr&quot;)) {
                                if (<span style="color: purple; font-weight: bold;">lastNode</span>.<span style="color: green; font-weight: bold;">parent</span>() != null)
                                    <span style="color: purple; font-weight: bold;">lastNode</span>.<span style="color: green; font-weight: bold;">remove</span>();
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insertInFosterParent</span>(<span style="color: purple; font-weight: bold;">lastNode</span>);
                            } else {
                                if (<span style="color: purple; font-weight: bold;">lastNode</span>.<span style="color: green; font-weight: bold;">parent</span>() != null)
                                    <span style="color: purple; font-weight: bold;">lastNode</span>.<span style="color: green; font-weight: bold;">remove</span>();
                                <span style="color: purple; font-weight: bold;">commonAncestor</span>.<span style="color: green; font-weight: bold;">appendChild</span>(<span style="color: purple; font-weight: bold;">lastNode</span>);
                            }

                            Element <span style="color: purple; font-weight: bold;">adopter</span> = new <span style="color: red; font-weight: bold;">Element</span>(<span style="color: purple; font-weight: bold;">Tag</span>.<span style="color: green; font-weight: bold;">valueOf</span>(<span style="color: purple; font-weight: bold;">name</span>), <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">getBaseUri</span>());
                            Node[] <span style="color: purple; font-weight: bold;">childNodes</span> = <span style="color: purple; font-weight: bold;">furthestBlock</span>.<span style="color: green; font-weight: bold;">childNodes</span>().<span style="color: green; font-weight: bold;">toArray</span>(new Node[furthestBlock.<span style="color: green; font-weight: bold;">childNodes</span>().<span style="color: green; font-weight: bold;">size</span>()]);
                            for (Node <span style="color: purple; font-weight: bold;">childNode</span> : <span style="color: purple; font-weight: bold;">childNodes</span>) {
                                <span style="color: purple; font-weight: bold;">adopter</span>.<span style="color: green; font-weight: bold;">appendChild</span>(<span style="color: purple; font-weight: bold;">childNode</span>); <span style="color: blue; font-weight: bold;">// append will reparent. thus the clone to avvoid concurrent mod.</span>
                            }
                            <span style="color: purple; font-weight: bold;">furthestBlock</span>.<span style="color: green; font-weight: bold;">appendChild</span>(<span style="color: purple; font-weight: bold;">adopter</span>);
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">removeFromActiveFormattingElements</span>(<span style="color: purple; font-weight: bold;">formatEl</span>);
                            <span style="color: blue; font-weight: bold;">// todo: insert the new element into the list of active formatting elements at the position of the aforementioned bookmark.</span>
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">removeFromStack</span>(<span style="color: purple; font-weight: bold;">formatEl</span>);
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insertOnStackAfter</span>(<span style="color: purple; font-weight: bold;">furthestBlock</span>, <span style="color: purple; font-weight: bold;">adopter</span>);
                        }
                    } else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">name</span>, &quot;applet&quot;, &quot;marquee&quot;, &quot;object&quot;)) {
                        if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inScope</span>(&quot;name&quot;)) {
                            if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">inScope</span>(<span style="color: purple; font-weight: bold;">name</span>)) {
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                                return false;
                            }
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">generateImpliedEndTags</span>();
                            if (!<span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">currentElement</span>().<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">name</span>))
                                <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">popStackToClose</span>(<span style="color: purple; font-weight: bold;">name</span>);
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">clearFormattingElementsToLastMarker</span>();
                        }
                    } else if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;br&quot;)) {
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.StartTag</span>(&quot;br&quot;));
                        return false;
                    } else {
                        return <span style="color: green; font-weight: bold;">anyOtherEndTag</span>(<span style="color: purple; font-weight: bold;">t</span>, <span style="color: purple; font-weight: bold;">tb</span>);
                    }

                    break;
                case <span style="color: purple; font-weight: bold;">EOF</span>:
                    <span style="color: blue; font-weight: bold;">// todo: error if stack contains something not dd, dt, li, p, tbody, td, tfoot, th, thead, tr, body, html</span>
                    <span style="color: blue; font-weight: bold;">// stop parsing</span>
                    break;
            }
            return true;
        }

</p></li>
<p>        <span style="color: blue; font-weight: bold;">// in script, style etc. normally treated as data tags</span>
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
</p></li>
<p>        boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">t</span>, TreeBuilder <span style="color: purple; font-weight: bold;">tb</span>) {
</p></li>
<p>
</p></li>
<p>        if (<span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">isCharacter</span>()) {
            String <span style="color: purple; font-weight: bold;">data</span> = <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">asCharacter</span>().<span style="color: green; font-weight: bold;">getData</span>();
            <span style="color: blue; font-weight: bold;">// todo: this checks more than spec - &quot;\t&quot;, &quot;\n&quot;, &quot;\f&quot;, &quot;\r&quot;, &quot; &quot;</span>
            for (int <span style="color: purple; font-weight: bold;">i</span> = 0; <span style="color: purple; font-weight: bold;">i</span> &lt; <span style="color: purple; font-weight: bold;">data</span>.<span style="color: green; font-weight: bold;">length</span>(); <span style="color: purple; font-weight: bold;">i</span>++) {
                char <span style="color: purple; font-weight: bold;">c</span> = <span style="color: purple; font-weight: bold;">data</span>.<span style="color: green; font-weight: bold;">charAt</span>(<span style="color: purple; font-weight: bold;">i</span>);
                if (!<span style="color: purple; font-weight: bold;">Character</span>.<span style="color: green; font-weight: bold;">isWhitespace</span>(<span style="color: purple; font-weight: bold;">c</span>))
                    return false;
            }
            return true;
        }
        return false;
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Parser.java:</strong><br>
<p>        return <span style="color: purple; font-weight: bold;">treeBuilder</span>.parse(<span style="color: purple; font-weight: bold;">html</span>, <span style="color: purple; font-weight: bold;">baseUri</span>);
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>
</p></li>
<p>    private boolean canContainBlock = true; // Can this tag hold block level tags?
</p></li>
<p>        return preserveWhitespace;
    }
</p></li>
<p>            &quot;html&quot;, &quot;head&quot;, &quot;body&quot;, &quot;frameset&quot;, &quot;script&quot;, &quot;noscript&quot;, &quot;style&quot;, &quot;meta&quot;, &quot;link&quot;, &quot;title&quot;, &quot;frame&quot;,
            &quot;noframes&quot;, &quot;section&quot;, &quot;nav&quot;, &quot;aside&quot;, &quot;hgroup&quot;, &quot;header&quot;, &quot;footer&quot;, &quot;p&quot;, &quot;h1&quot;, &quot;h2&quot;, &quot;h3&quot;, &quot;h4&quot;, &quot;h5&quot;, &quot;h6&quot;,
            &quot;ul&quot;, &quot;ol&quot;, &quot;pre&quot;, &quot;div&quot;, &quot;blockquote&quot;, &quot;hr&quot;, &quot;address&quot;, &quot;figure&quot;, &quot;figcaption&quot;, &quot;form&quot;, &quot;fieldset&quot;, &quot;ins&quot;,
            &quot;del&quot;, &quot;dl&quot;, &quot;dt&quot;, &quot;dd&quot;, &quot;li&quot;, &quot;table&quot;, &quot;caption&quot;, &quot;thead&quot;, &quot;tfoot&quot;, &quot;tbody&quot;, &quot;colgroup&quot;, &quot;col&quot;, &quot;tr&quot;, &quot;th&quot;,
            &quot;td&quot;, &quot;video&quot;, &quot;audio&quot;, &quot;canvas&quot;, &quot;details&quot;, &quot;menu&quot;, &quot;plaintext&quot;
    };
    private static final String[] <span style="color: purple; font-weight: bold;">inlineTags</span> = {
            &quot;object&quot;, &quot;base&quot;, &quot;font&quot;, &quot;tt&quot;, &quot;i&quot;, &quot;b&quot;, &quot;u&quot;, &quot;big&quot;, &quot;small&quot;, &quot;em&quot;, &quot;strong&quot;, &quot;dfn&quot;, &quot;code&quot;, &quot;samp&quot;, &quot;kbd&quot;,
            &quot;var&quot;, &quot;cite&quot;, &quot;abbr&quot;, &quot;time&quot;, &quot;acronym&quot;, &quot;mark&quot;, &quot;ruby&quot;, &quot;rt&quot;, &quot;rp&quot;, &quot;a&quot;, &quot;img&quot;, &quot;br&quot;, &quot;wbr&quot;, &quot;map&quot;, &quot;q&quot;,
            &quot;sub&quot;, &quot;sup&quot;, &quot;bdo&quot;, &quot;iframe&quot;, &quot;embed&quot;, &quot;span&quot;, &quot;input&quot;, &quot;select&quot;, &quot;textarea&quot;, &quot;label&quot;, &quot;button&quot;, &quot;optgroup&quot;,
            &quot;option&quot;, &quot;legend&quot;, &quot;datalist&quot;, &quot;keygen&quot;, &quot;output&quot;, &quot;progress&quot;, &quot;meter&quot;, &quot;area&quot;, &quot;param&quot;, &quot;source&quot;, &quot;track&quot;,
            &quot;summary&quot;, &quot;command&quot;, &quot;device&quot;
    };
    private static final String[] <span style="color: purple; font-weight: bold;">emptyTags</span> = {
            &quot;meta&quot;, &quot;link&quot;, &quot;base&quot;, &quot;frame&quot;, &quot;img&quot;, &quot;br&quot;, &quot;wbr&quot;, &quot;embed&quot;, &quot;hr&quot;, &quot;input&quot;, &quot;keygen&quot;, &quot;col&quot;, &quot;command&quot;,
            &quot;device&quot;
    };
    private static final String[] <span style="color: purple; font-weight: bold;">formatAsInlineTags</span> = {
            &quot;title&quot;, &quot;a&quot;, &quot;p&quot;, &quot;h1&quot;, &quot;h2&quot;, &quot;h3&quot;, &quot;h4&quot;, &quot;h5&quot;, &quot;h6&quot;, &quot;pre&quot;, &quot;address&quot;, &quot;li&quot;, &quot;th&quot;, &quot;td&quot;
    };
    private static final String[] <span style="color: purple; font-weight: bold;">preserveWhitespaceTags</span> = {"pre", "plaintext", "title"};

</p></li>
<p>            Tag <span style="color: purple; font-weight: bold;">tag</span> = new <span style="color: red; font-weight: bold;">Tag</span>(<span style="color: purple; font-weight: bold;">tagName</span>);
            <span style="color: green; font-weight: bold;">register</span>(<span style="color: purple; font-weight: bold;">tag</span>);
        }
</p></li>
<p>            Tag <span style="color: purple; font-weight: bold;">tag</span> = new <span style="color: red; font-weight: bold;">Tag</span>(<span style="color: purple; font-weight: bold;">tagName</span>);
            tag.isBlock = false;
            tag.canContainBlock = false;
            tag.formatAsBlock = false;
            <span style="color: green; font-weight: bold;">register</span>(<span style="color: purple; font-weight: bold;">tag</span>);
        }
</p></li>
<p>            Tag <span style="color: purple; font-weight: bold;">tag</span> = <span style="color: purple; font-weight: bold;">tags</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">tagName</span>);
            <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">tag</span>);
            tag.canContainBlock = false;
            tag.canContainInline = false;
            tag.empty = true;
        }
</p></li>
<p>            Tag <span style="color: purple; font-weight: bold;">tag</span> = <span style="color: purple; font-weight: bold;">tags</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">tagName</span>);
            <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">tag</span>);
            tag.formatAsBlock = false;
        }
</p></li>
<p>            Tag <span style="color: purple; font-weight: bold;">tag</span> = <span style="color: purple; font-weight: bold;">tags</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">tagName</span>);
            <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">tag</span>);
            tag.preserveWhitespace = true;
        }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Token.java:</strong><br>
<p>    TokenType <span style="color: purple; font-weight: bold;">type</span>;
</p></li>
<p>    }

</p></li>
<p>        final StringBuilder <span style="color: purple; font-weight: bold;">publicIdentifier</span> = new <span style="color: red; font-weight: bold;">StringBuilder</span>();
        final StringBuilder <span style="color: purple; font-weight: bold;">systemIdentifier</span> = new <span style="color: red; font-weight: bold;">StringBuilder</span>();
        boolean <span style="color: purple; font-weight: bold;">forceQuirks</span> = false;

</p></li>
<p>            <span style="color: purple; font-weight: bold;">type</span> = TokenType.Doctype;
        }

</p></li>
<p>        protected String <span style="color: purple; font-weight: bold;">tagName</span>;
</p></li>
<p>        private String <span style="color: purple; font-weight: bold;">pendingAttributeValue</span>;

        boolean <span style="color: purple; font-weight: bold;">selfClosing</span> = false;
        Attributes <span style="color: purple; font-weight: bold;">attributes</span> = new <span style="color: red; font-weight: bold;">Attributes</span>(); <span style="color: blue; font-weight: bold;">// todo: allow nodes to not have attributes</span>
</p></li>
<p>            if (<span style="color: purple; font-weight: bold;">pendingAttributeName</span> != null) {
                if (<span style="color: purple; font-weight: bold;">pendingAttributeValue</span> == null)
                    <span style="color: purple; font-weight: bold;">pendingAttributeValue</span> = &quot;&quot;;
                Attribute <span style="color: purple; font-weight: bold;">attribute</span> = new <span style="color: red; font-weight: bold;">Attribute</span>(<span style="color: purple; font-weight: bold;">pendingAttributeName</span>, <span style="color: purple; font-weight: bold;">pendingAttributeValue</span>);
                <span style="color: purple; font-weight: bold;">attributes</span>.<span style="color: green; font-weight: bold;">put</span>(<span style="color: purple; font-weight: bold;">attribute</span>);
            }
            <span style="color: purple; font-weight: bold;">pendingAttributeName</span> = null;
            <span style="color: purple; font-weight: bold;">pendingAttributeValue</span> = null;
        }

</p></li>
<p>            <span style="color: blue; font-weight: bold;">// finalises for emit</span>
            if (<span style="color: purple; font-weight: bold;">pendingAttributeName</span> != null) {
                <span style="color: blue; font-weight: bold;">// todo: check if attribute name exists; if so, drop and error</span>
                <span style="color: green; font-weight: bold;">newAttribute</span>();
            }
        }

</p></li>
<p>            <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">isFalse</span>(<span style="color: purple; font-weight: bold;">tagName</span>.<span style="color: green; font-weight: bold;">isEmpty</span>());
            return <span style="color: purple; font-weight: bold;">tagName</span>;
        }

</p></li>
<p>            <span style="color: purple; font-weight: bold;">tagName</span> = <span style="color: purple; font-weight: bold;">name</span>;
            return this;
        }

</p></li>
<p>            return <span style="color: purple; font-weight: bold;">selfClosing</span>;
        }

</p></li>
<p>            <span style="color: purple; font-weight: bold;">tagName</span> = <span style="color: purple; font-weight: bold;">tagName</span> == null ? <span style="color: purple; font-weight: bold;">append</span> : <span style="color: purple; font-weight: bold;">tagName</span>.<span style="color: green; font-weight: bold;">concat</span>(<span style="color: purple; font-weight: bold;">append</span>);
        }

</p></li>
<p>            <span style="color: purple; font-weight: bold;">pendingAttributeName</span> = <span style="color: purple; font-weight: bold;">pendingAttributeName</span> == null ? <span style="color: purple; font-weight: bold;">append</span> : <span style="color: purple; font-weight: bold;">pendingAttributeName</span>.<span style="color: green; font-weight: bold;">concat</span>(<span style="color: purple; font-weight: bold;">append</span>);
        }

</p></li>
<p>            <span style="color: purple; font-weight: bold;">pendingAttributeValue</span> = <span style="color: purple; font-weight: bold;">pendingAttributeValue</span> == null ? <span style="color: purple; font-weight: bold;">append</span> : <span style="color: purple; font-weight: bold;">pendingAttributeValue</span>.<span style="color: green; font-weight: bold;">concat</span>(<span style="color: purple; font-weight: bold;">append</span>);
        }

</p></li>
<p>        }
    }
</p></li>
<p>        <span style="color: green; font-weight: bold;">StartTag</span>() {
            super();
            <span style="color: purple; font-weight: bold;">type</span> = TokenType.StartTag;
        }

</p></li>
<p>            this();
            this.<span style="color: purple; font-weight: bold;">tagName</span> = <span style="color: purple; font-weight: bold;">name</span>;
        }

</p></li>
<p>            super();
            <span style="color: purple; font-weight: bold;">type</span> = TokenType.EndTag;
        }

</p></li>
<p>
</p></li>
<p>            <span style="color: purple; font-weight: bold;">type</span> = TokenType.Comment;
        }

</p></li>
<p>            <span style="color: purple; font-weight: bold;">type</span> = TokenType.Character;
            this.<span style="color: purple; font-weight: bold;">data</span> = <span style="color: purple; font-weight: bold;">data</span>;
        }

</p></li>
<p>            return <span style="color: purple; font-weight: bold;">data</span>;
        }

</p></li>
<p>            <span style="color: purple; font-weight: bold;">type</span> = Token.TokenType.EOF;
        }
    }
</p></li>
<p>        return <span style="color: purple; font-weight: bold;">type</span> == TokenType.Doctype;
    }

</p></li>
<p>        return <span style="color: purple; font-weight: bold;">type</span> == TokenType.StartTag;
    }

</p></li>
<p>        return (StartTag) this;
    }

</p></li>
<p>        return <span style="color: purple; font-weight: bold;">type</span> == TokenType.EndTag;
    }

</p></li>
<p>        return (EndTag) this;
    }

</p></li>
<p>        return <span style="color: purple; font-weight: bold;">type</span> == TokenType.Comment;
    }

</p></li>
<p>        return <span style="color: purple; font-weight: bold;">type</span> == TokenType.Character;
    }

</p></li>
<p>        return (Character) this;
    }

</p></li>
<p>        <span style="color: purple; font-weight: bold;">Doctype</span>,
        <span style="color: purple; font-weight: bold;">StartTag</span>,
        <span style="color: purple; font-weight: bold;">EndTag</span>,
        <span style="color: purple; font-weight: bold;">Comment</span>,
        <span style="color: purple; font-weight: bold;">Character</span>,
        <span style="color: purple; font-weight: bold;">EOF</span>
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tokeniser.java:</strong><br>
<p>    private Token <span style="color: purple; font-weight: bold;">emitPending</span>; <span style="color: blue; font-weight: bold;">// the token we are about to emit on next read</span>
</p></li>
<p>    private StringBuilder <span style="color: purple; font-weight: bold;">charBuffer</span> = new <span style="color: red; font-weight: bold;">StringBuilder</span>(); <span style="color: blue; font-weight: bold;">// buffers characters to output as one token</span>
    StringBuilder <span style="color: purple; font-weight: bold;">dataBuffer</span>; <span style="color: blue; font-weight: bold;">// buffers data looking for &lt;/script&gt;</span>

</p></li>
<p>    Token.Comment <span style="color: purple; font-weight: bold;">commentPending</span>; <span style="color: blue; font-weight: bold;">// comment building up</span>
    private Token.StartTag <span style="color: purple; font-weight: bold;">lastStartTag</span>; <span style="color: blue; font-weight: bold;">// the last start tag emitted, to test appropriate end tag</span>
    private boolean <span style="color: purple; font-weight: bold;">selfClosingFlagAcknowledged</span> = true;

</p></li>
<p>        this.<span style="color: purple; font-weight: bold;">reader</span> = <span style="color: purple; font-weight: bold;">reader</span>;
    }

</p></li>
<p>        if (!<span style="color: purple; font-weight: bold;">selfClosingFlagAcknowledged</span>) {
            <span style="color: green; font-weight: bold;">error</span>(&quot;Self closing flag not acknowledged&quot;);
            <span style="color: purple; font-weight: bold;">selfClosingFlagAcknowledged</span> = true;
        }

        while (!<span style="color: purple; font-weight: bold;">isEmitPending</span>)
            <span style="color: purple; font-weight: bold;">state</span>.<span style="color: green; font-weight: bold;">read</span>(this, <span style="color: purple; font-weight: bold;">reader</span>);

        <span style="color: blue; font-weight: bold;">// if emit is pending, a non-character token was found: return any chars in buffer, and leave token for next read:</span>
        if (<span style="color: purple; font-weight: bold;">charBuffer</span>.<span style="color: green; font-weight: bold;">length</span>() &gt; 0) {
            String <span style="color: purple; font-weight: bold;">str</span> = <span style="color: purple; font-weight: bold;">charBuffer</span>.<span style="color: green; font-weight: bold;">toString</span>();
            <span style="color: purple; font-weight: bold;">charBuffer</span>.<span style="color: green; font-weight: bold;">delete</span>(0, <span style="color: purple; font-weight: bold;">charBuffer</span>.<span style="color: green; font-weight: bold;">length</span>());
            return new <span style="color: red; font-weight: bold;">Token.Character</span>(<span style="color: purple; font-weight: bold;">str</span>);
        } else {
            <span style="color: purple; font-weight: bold;">isEmitPending</span> = false;
            return <span style="color: purple; font-weight: bold;">emitPending</span>;
        }
    }

</p></li>
<p>        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">isFalse</span>(<span style="color: purple; font-weight: bold;">isEmitPending</span>, &quot;There is an unread token pending!&quot;);

        <span style="color: purple; font-weight: bold;">emitPending</span> = <span style="color: purple; font-weight: bold;">token</span>;
        <span style="color: purple; font-weight: bold;">isEmitPending</span> = true;

        if (token.type == Token.TokenType.StartTag) {
            Token.StartTag <span style="color: purple; font-weight: bold;">startTag</span> = (Token.StartTag) <span style="color: purple; font-weight: bold;">token</span>;
            <span style="color: purple; font-weight: bold;">lastStartTag</span> = <span style="color: purple; font-weight: bold;">startTag</span>;
            if (startTag.selfClosing)
                <span style="color: purple; font-weight: bold;">selfClosingFlagAcknowledged</span> = false;
        } else if (token.type == Token.TokenType.EndTag) {
            Token.EndTag <span style="color: purple; font-weight: bold;">endTag</span> = (Token.EndTag) <span style="color: purple; font-weight: bold;">token</span>;
            if (endTag.attributes.<span style="color: green; font-weight: bold;">size</span>() &gt; 0)
                <span style="color: green; font-weight: bold;">error</span>("Attributes incorrectly present on end tag");
        }
    }

</p></li>
<p>        <span style="color: blue; font-weight: bold;">// buffer strings up until last string token found, to emit only one token for a run of character refs etc.</span>
        <span style="color: blue; font-weight: bold;">// does not set isEmitPending; read checks that</span>
        <span style="color: purple; font-weight: bold;">charBuffer</span>.<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">str</span>);
    }

</p></li>
<p>        this.<span style="color: purple; font-weight: bold;">state</span> = <span style="color: purple; font-weight: bold;">state</span>;
    }

</p></li>
<p>        <span style="color: purple; font-weight: bold;">reader</span>.<span style="color: green; font-weight: bold;">advance</span>();
        this.<span style="color: purple; font-weight: bold;">state</span> = <span style="color: purple; font-weight: bold;">state</span>;
    }

</p></li>
<p>        <span style="color: purple; font-weight: bold;">tagPending</span> = <span style="color: purple; font-weight: bold;">start</span> ? new <span style="color: red; font-weight: bold;">Token.StartTag</span>() : new <span style="color: red; font-weight: bold;">Token.EndTag</span>();
        return <span style="color: purple; font-weight: bold;">tagPending</span>;
    }

</p></li>
<p>        <span style="color: purple; font-weight: bold;">tagPending</span>.<span style="color: green; font-weight: bold;">finaliseTag</span>();
        <span style="color: green; font-weight: bold;">emit</span>(<span style="color: purple; font-weight: bold;">tagPending</span>);
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TokeniserState.java:</strong><br>
<p>    <span style="color: purple; font-weight: bold;">Data</span> {
        <span style="color: blue; font-weight: bold;">// in data state, gather characters until a character reference or tag is found</span>
</p></li>
<p>            switch (<span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">current</span>()) {
                case &#x27;&amp;&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">advanceTransition</span>(<span style="color: purple; font-weight: bold;">CharacterReferenceInData</span>);
                    break;
                case &#x27;&lt;&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">advanceTransition</span>(<span style="color: purple; font-weight: bold;">TagOpen</span>);
                    break;
                case <span style="color: purple; font-weight: bold;">nullChar</span>:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">error</span>(this); <span style="color: blue; font-weight: bold;">// NOT replacement character (oddly?)</span>
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">emit</span>(<span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">consume</span>());
                    break;
                case <span style="color: purple; font-weight: bold;">eof</span>:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">emit</span>(new <span style="color: red; font-weight: bold;">Token.EOF</span>());
                    break;
                default:
                    String <span style="color: purple; font-weight: bold;">data</span> = <span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">consumeToAny</span>(&#x27;&amp;&#x27;, &#x27;&lt;&#x27;, <span style="color: purple; font-weight: bold;">nullChar</span>);
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">emit</span>(<span style="color: purple; font-weight: bold;">data</span>);
                    break;
            }
        }
    },
</p></li>
<p>        <span style="color: blue; font-weight: bold;">// from &amp; in data</span>
</p></li>
<p>        <span style="color: blue; font-weight: bold;">/// handles data in title, textarea etc</span>
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        <span style="color: blue; font-weight: bold;">// from &lt; in data</span>
</p></li>
<p>            switch (<span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">current</span>()) {
                case &#x27;!&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">advanceTransition</span>(<span style="color: purple; font-weight: bold;">MarkupDeclarationOpen</span>);
                    break;
                case &#x27;/&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">advanceTransition</span>(<span style="color: purple; font-weight: bold;">EndTagOpen</span>);
                    break;
                case &#x27;?&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">advanceTransition</span>(<span style="color: purple; font-weight: bold;">BogusComment</span>);
                    break;
                default:
                    if (<span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">matchesLetter</span>()) {
                        <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">createTagPending</span>(true);
                        <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">TagName</span>);
                    } else {
                        <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                        <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">emit</span>(&#x27;&lt;&#x27;); <span style="color: blue; font-weight: bold;">// char that got us here</span>
                        <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">Data</span>);
                    }
                    break;
            }
        }
    },
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
            if (<span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">isEmpty</span>()) {
                <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">eofError</span>(this);
                <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">emit</span>(&quot;&lt;/&quot;);
                <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">Data</span>);
            } else if (<span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">matchesLetter</span>()) {
                <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">createTagPending</span>(false);
                <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">TagName</span>);
            } else if (<span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">matches</span>(&#x27;&gt;&#x27;)) {
                <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">advanceTransition</span>(<span style="color: purple; font-weight: bold;">Data</span>);
            } else {
                <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">advanceTransition</span>(<span style="color: purple; font-weight: bold;">BogusComment</span>);
            }
        }
    },
</p></li>
<p>        <span style="color: blue; font-weight: bold;">// from &lt; or &lt;/ in data, will have start or end tag pending</span>
</p></li>
<p>            <span style="color: blue; font-weight: bold;">// previous TagOpen state did NOT consume, will have a letter char in current</span>
            String <span style="color: purple; font-weight: bold;">tagName</span> = <span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">consumeToAny</span>(&#x27;\t&#x27;, &#x27;\n&#x27;, &#x27;\f&#x27;, &#x27; &#x27;, &#x27;/&#x27;, &#x27;&gt;&#x27;, <span style="color: purple; font-weight: bold;">nullChar</span>).<span style="color: green; font-weight: bold;">toLowerCase</span>();
            t.tagPending.<span style="color: green; font-weight: bold;">appendTagName</span>(<span style="color: purple; font-weight: bold;">tagName</span>);

            switch (<span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">consume</span>()) {
                case &#x27;\t&#x27;:
                case &#x27;\n&#x27;:
                case &#x27;\f&#x27;:
                case &#x27; &#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">BeforeAttributeName</span>);
                    break;
                case &#x27;/&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">SelfClosingStartTag</span>);
                    break;
                case &#x27;&gt;&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">emitTagPending</span>();
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">Data</span>);
                    break;
                case <span style="color: purple; font-weight: bold;">nullChar</span>: <span style="color: blue; font-weight: bold;">// replacement</span>
                    t.tagPending.<span style="color: green; font-weight: bold;">appendTagName</span>(<span style="color: purple; font-weight: bold;">replacementStr</span>);
                    break;
                case <span style="color: purple; font-weight: bold;">eof</span>: <span style="color: blue; font-weight: bold;">// should emit pending tag?</span>
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">eofError</span>(this);
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">Data</span>);
                <span style="color: blue; font-weight: bold;">// no default, as covered with above consumeToAny</span>
            }
        }
    },
</p></li>
<p>        <span style="color: blue; font-weight: bold;">// from &lt; in rcdata</span>
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        <span style="color: blue; font-weight: bold;">// from tagname &lt;xxx</span>
</p></li>
<p>            char <span style="color: purple; font-weight: bold;">c</span> = <span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">consume</span>();
            switch (<span style="color: purple; font-weight: bold;">c</span>) {
                case &#x27;\t&#x27;:
                case &#x27;\n&#x27;:
                case &#x27;\f&#x27;:
                case &#x27; &#x27;:
                    break; <span style="color: blue; font-weight: bold;">// ignore whitespace</span>
                case &#x27;/&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">SelfClosingStartTag</span>);
                    break;
                case &#x27;&gt;&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">emitTagPending</span>();
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">Data</span>);
                    break;
                case <span style="color: purple; font-weight: bold;">nullChar</span>:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                    t.tagPending.<span style="color: green; font-weight: bold;">newAttribute</span>();
                    <span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">unconsume</span>();
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">AttributeName</span>);
                    break;
                case <span style="color: purple; font-weight: bold;">eof</span>:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">eofError</span>(this);
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">Data</span>);
                    break;
                case &#x27;&quot;&#x27;:
                case &#x27;\&#x27;&#x27;:
                case &#x27;&lt;&#x27;:
                case &#x27;=&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                    t.tagPending.<span style="color: green; font-weight: bold;">newAttribute</span>();
                    t.tagPending.<span style="color: green; font-weight: bold;">appendAttributeName</span>(<span style="color: purple; font-weight: bold;">c</span>);
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">AttributeName</span>);
                    break;
                default: <span style="color: blue; font-weight: bold;">// A-Z, anything else</span>
                    t.tagPending.<span style="color: green; font-weight: bold;">newAttribute</span>();
                    <span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">unconsume</span>();
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">AttributeName</span>);
            }
        }
    },
</p></li>
<p>        <span style="color: blue; font-weight: bold;">// from before attribute name</span>
</p></li>
<p>            String <span style="color: purple; font-weight: bold;">name</span> = <span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">consumeToAny</span>(&#x27;\t&#x27;, &#x27;\n&#x27;, &#x27;\f&#x27;, &#x27; &#x27;, &#x27;/&#x27;, &#x27;=&#x27;, &#x27;&gt;&#x27;, <span style="color: purple; font-weight: bold;">nullChar</span>, &#x27;&quot;&#x27;, &#x27;\&#x27;&#x27;, &#x27;&lt;&#x27;);
            t.tagPending.<span style="color: green; font-weight: bold;">appendAttributeName</span>(<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">toLowerCase</span>());

            char <span style="color: purple; font-weight: bold;">c</span> = <span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">consume</span>();
            switch (<span style="color: purple; font-weight: bold;">c</span>) {
                case &#x27;\t&#x27;:
                case &#x27;\n&#x27;:
                case &#x27;\f&#x27;:
                case &#x27; &#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">AfterAttributeName</span>);
                    break;
                case &#x27;/&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">SelfClosingStartTag</span>);
                    break;
                case &#x27;=&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">BeforeAttributeValue</span>);
                    break;
                case &#x27;&gt;&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">emitTagPending</span>();
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">Data</span>);
                    break;
                case <span style="color: purple; font-weight: bold;">nullChar</span>:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                    t.tagPending.<span style="color: green; font-weight: bold;">appendAttributeName</span>(<span style="color: purple; font-weight: bold;">replacementChar</span>);
                    break;
                case <span style="color: purple; font-weight: bold;">eof</span>:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">eofError</span>(this);
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">Data</span>);
                    break;
                case &#x27;&quot;&#x27;:
                case &#x27;\&#x27;&#x27;:
                case &#x27;&lt;&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                    t.tagPending.<span style="color: green; font-weight: bold;">appendAttributeName</span>(<span style="color: purple; font-weight: bold;">c</span>);
                <span style="color: blue; font-weight: bold;">// no default, as covered in consumeToAny</span>
            }
        }
    },
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
            char <span style="color: purple; font-weight: bold;">c</span> = <span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">consume</span>();
            switch (<span style="color: purple; font-weight: bold;">c</span>) {
                case &#x27;\t&#x27;:
                case &#x27;\n&#x27;:
                case &#x27;\f&#x27;:
                case &#x27; &#x27;:
                    <span style="color: blue; font-weight: bold;">// ignore</span>
                    break;
                case &#x27;&quot;&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">AttributeValue_doubleQuoted</span>);
                    break;
                case &#x27;&amp;&#x27;:
                    <span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">unconsume</span>();
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">AttributeValue_unquoted</span>);
                    break;
                case &#x27;\&#x27;&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">AttributeValue_singleQuoted</span>);
                    break;
                case <span style="color: purple; font-weight: bold;">nullChar</span>:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                    t.tagPending.<span style="color: green; font-weight: bold;">appendAttributeValue</span>(<span style="color: purple; font-weight: bold;">replacementChar</span>);
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">AttributeValue_unquoted</span>);
                    break;
                case <span style="color: purple; font-weight: bold;">eof</span>:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">eofError</span>(this);
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">Data</span>);
                    break;
                case &#x27;&gt;&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">emitTagPending</span>();
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">Data</span>);
                    break;
                case &#x27;&lt;&#x27;:
                case &#x27;=&#x27;:
                case &#x27;`&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                    t.tagPending.<span style="color: green; font-weight: bold;">appendAttributeValue</span>(<span style="color: purple; font-weight: bold;">c</span>);
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">AttributeValue_unquoted</span>);
                    break;
                default:
                    <span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">unconsume</span>();
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">AttributeValue_unquoted</span>);
            }
        }
    },
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
            String <span style="color: purple; font-weight: bold;">value</span> = <span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">consumeToAny</span>(&#x27;\t&#x27;, &#x27;\n&#x27;, &#x27;\f&#x27;, &#x27; &#x27;, &#x27;&amp;&#x27;, &#x27;&gt;&#x27;, <span style="color: purple; font-weight: bold;">nullChar</span>, &#x27;&quot;&#x27;, &#x27;\&#x27;&#x27;, &#x27;&lt;&#x27;, &#x27;=&#x27;, &#x27;`&#x27;);
            if (<span style="color: purple; font-weight: bold;">value</span>.<span style="color: green; font-weight: bold;">length</span>() &gt; 0)
                t.tagPending.<span style="color: green; font-weight: bold;">appendAttributeValue</span>(<span style="color: purple; font-weight: bold;">value</span>);

            char <span style="color: purple; font-weight: bold;">c</span> = <span style="color: purple; font-weight: bold;">r</span>.<span style="color: green; font-weight: bold;">consume</span>();
            switch (<span style="color: purple; font-weight: bold;">c</span>) {
                case &#x27;\t&#x27;:
                case &#x27;\n&#x27;:
                case &#x27;\f&#x27;:
                case &#x27; &#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">BeforeAttributeName</span>);
                    break;
                case &#x27;&amp;&#x27;:
                    Character <span style="color: purple; font-weight: bold;">ref</span> = <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">consumeCharacterReference</span>(&#x27;&gt;&#x27;, true);
                    if (<span style="color: purple; font-weight: bold;">ref</span> != null)
                        t.tagPending.<span style="color: green; font-weight: bold;">appendAttributeValue</span>(<span style="color: purple; font-weight: bold;">ref</span>);
                    else
                        t.tagPending.<span style="color: green; font-weight: bold;">appendAttributeValue</span>(&#x27;&amp;&#x27;);
                    break;
                case &#x27;&gt;&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">emitTagPending</span>();
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">Data</span>);
                    break;
                case <span style="color: purple; font-weight: bold;">nullChar</span>:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                    t.tagPending.<span style="color: green; font-weight: bold;">appendAttributeValue</span>(<span style="color: purple; font-weight: bold;">replacementChar</span>);
                    break;
                case <span style="color: purple; font-weight: bold;">eof</span>:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">eofError</span>(this);
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">transition</span>(<span style="color: purple; font-weight: bold;">Data</span>);
                    break;
                case &#x27;&quot;&#x27;:
                case &#x27;\&#x27;&#x27;:
                case &#x27;&lt;&#x27;:
                case &#x27;=&#x27;:
                case &#x27;`&#x27;:
                    <span style="color: purple; font-weight: bold;">t</span>.<span style="color: green; font-weight: bold;">error</span>(this);
                    t.tagPending.<span style="color: green; font-weight: bold;">appendAttributeValue</span>(<span style="color: purple; font-weight: bold;">c</span>);
                    break;
                <span style="color: blue; font-weight: bold;">// no default, handled in consume to any above</span>
            }

        }
    },
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>        void <span style="color: green; font-weight: bold;">read</span>(Tokeniser <span style="color: purple; font-weight: bold;">t</span>, CharacterReader <span style="color: purple; font-weight: bold;">r</span>) {
</p></li>
<p>    private static final char <span style="color: purple; font-weight: bold;">replacementChar</span> = Tokeniser.replacementChar;
</p></li>
<p>    private static final char <span style="color: purple; font-weight: bold;">eof</span> = CharacterReader.EOF;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>    CharacterReader <span style="color: purple; font-weight: bold;">reader</span>;
</p></li>
<p>    private TreeBuilderState <span style="color: purple; font-weight: bold;">state</span>; <span style="color: blue; font-weight: bold;">// the current state</span>
    private TreeBuilderState <span style="color: purple; font-weight: bold;">originalState</span>; <span style="color: blue; font-weight: bold;">// original / marked state</span>
    private Document <span style="color: purple; font-weight: bold;">doc</span>; <span style="color: blue; font-weight: bold;">// current doc we are building into</span>
    private LinkedList&lt;Element&gt; <span style="color: purple; font-weight: bold;">stack</span>; <span style="color: blue; font-weight: bold;">// the stack of open elements</span>

    private String <span style="color: purple; font-weight: bold;">baseUri</span>; <span style="color: blue; font-weight: bold;">// current base uri, for creating new elements</span>
    private Token <span style="color: purple; font-weight: bold;">currentToken</span>; <span style="color: blue; font-weight: bold;">// currentToken is used only for error tracking.</span>
    private Element <span style="color: purple; font-weight: bold;">headElement</span>; <span style="color: blue; font-weight: bold;">// the current head element</span>
    private Element <span style="color: purple; font-weight: bold;">formElement</span>; <span style="color: blue; font-weight: bold;">// the current form element</span>
    private Element <span style="color: purple; font-weight: bold;">contextElement</span>; <span style="color: blue; font-weight: bold;">// fragment parse context -- could be null even if fragment parsing</span>
    private LinkedList&lt;Element&gt; <span style="color: purple; font-weight: bold;">formattingElements</span> = new <span style="color: red; font-weight: bold;">LinkedList&lt;Element&gt;</span>(); <span style="color: blue; font-weight: bold;">// active (open) formatting elements</span>
    private List&lt;Token.Character&gt; <span style="color: purple; font-weight: bold;">pendingTableCharacters</span> = new <span style="color: red; font-weight: bold;">ArrayList&lt;Token.Character&gt;</span>(); <span style="color: blue; font-weight: bold;">// chars in table to be shifted out</span>

    private boolean <span style="color: purple; font-weight: bold;">framesetOk</span> = true; <span style="color: blue; font-weight: bold;">// if ok to go into frameset</span>
    private boolean <span style="color: purple; font-weight: bold;">fosterInserts</span> = false; <span style="color: blue; font-weight: bold;">// if next inserts should be fostered</span>
    private boolean <span style="color: purple; font-weight: bold;">fragmentParsing</span> = false; <span style="color: blue; font-weight: bold;">// if parsing a fragment of html</span>

    private boolean <span style="color: purple; font-weight: bold;">trackErrors</span> = false;
    private List&lt;ParseError&gt; <span style="color: purple; font-weight: bold;">errors</span> = new <span style="color: red; font-weight: bold;">ArrayList&lt;ParseError&gt;</span>();

    <span style="color: green; font-weight: bold;">TreeBuilder</span>() {}

    private void <span style="color: green; font-weight: bold;">initialiseParse</span>(String <span style="color: purple; font-weight: bold;">input</span>, String <span style="color: purple; font-weight: bold;">baseUri</span>) {
        <span style="color: purple; font-weight: bold;">doc</span> = new <span style="color: red; font-weight: bold;">Document</span>(<span style="color: purple; font-weight: bold;">baseUri</span>);
        <span style="color: purple; font-weight: bold;">reader</span> = new <span style="color: red; font-weight: bold;">CharacterReader</span>(<span style="color: purple; font-weight: bold;">input</span>);
        <span style="color: purple; font-weight: bold;">tokeniser</span> = new <span style="color: red; font-weight: bold;">Tokeniser</span>(<span style="color: purple; font-weight: bold;">reader</span>);
        <span style="color: purple; font-weight: bold;">stack</span> = new <span style="color: red; font-weight: bold;">LinkedList&lt;Element&gt;</span>();
        this.<span style="color: purple; font-weight: bold;">baseUri</span> = <span style="color: purple; font-weight: bold;">baseUri</span>;
    }

</p></li>
<p>        <span style="color: green; font-weight: bold;">runParser</span>();
        return <span style="color: purple; font-weight: bold;">doc</span>;
    }

</p></li>
<p>        <span style="color: blue; font-weight: bold;">// context may be null</span>
        <span style="color: green; font-weight: bold;">initialiseParse</span>(<span style="color: purple; font-weight: bold;">inputFragment</span>, <span style="color: purple; font-weight: bold;">baseUri</span>);
        <span style="color: purple; font-weight: bold;">contextElement</span> = <span style="color: purple; font-weight: bold;">context</span>;
        <span style="color: purple; font-weight: bold;">fragmentParsing</span> = true;
        Element <span style="color: purple; font-weight: bold;">root</span> = null;

        if (<span style="color: purple; font-weight: bold;">context</span> != null) {
            if (<span style="color: purple; font-weight: bold;">context</span>.<span style="color: green; font-weight: bold;">ownerDocument</span>() != null) <span style="color: blue; font-weight: bold;">// quirks setup:</span>
                <span style="color: purple; font-weight: bold;">doc</span>.<span style="color: green; font-weight: bold;">quirksMode</span>(<span style="color: purple; font-weight: bold;">context</span>.<span style="color: green; font-weight: bold;">ownerDocument</span>().<span style="color: green; font-weight: bold;">quirksMode</span>());

            <span style="color: blue; font-weight: bold;">// initialise the tokeniser state:</span>
            String <span style="color: purple; font-weight: bold;">contextTag</span> = <span style="color: purple; font-weight: bold;">context</span>.<span style="color: green; font-weight: bold;">tagName</span>();
            if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">contextTag</span>, &quot;title&quot;, &quot;textarea&quot;))
                <span style="color: purple; font-weight: bold;">tokeniser</span>.<span style="color: green; font-weight: bold;">transition</span>(TokeniserState.Rcdata);
            else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">contextTag</span>, &quot;iframe&quot;, &quot;noembed&quot;, &quot;noframes&quot;, &quot;style&quot;, &quot;xmp&quot;))
                <span style="color: purple; font-weight: bold;">tokeniser</span>.<span style="color: green; font-weight: bold;">transition</span>(TokeniserState.Rawtext);
            else if (<span style="color: purple; font-weight: bold;">contextTag</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;script&quot;))
                <span style="color: purple; font-weight: bold;">tokeniser</span>.<span style="color: green; font-weight: bold;">transition</span>(TokeniserState.ScriptData);
            else if (<span style="color: purple; font-weight: bold;">contextTag</span>.<span style="color: green; font-weight: bold;">equals</span>((&quot;noscript&quot;)))
                <span style="color: purple; font-weight: bold;">tokeniser</span>.<span style="color: green; font-weight: bold;">transition</span>(TokeniserState.Data); <span style="color: blue; font-weight: bold;">// if scripting enabled, rawtext</span>
            else if (<span style="color: purple; font-weight: bold;">contextTag</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;plaintext&quot;))
                <span style="color: purple; font-weight: bold;">tokeniser</span>.<span style="color: green; font-weight: bold;">transition</span>(TokeniserState.Data);
            else
                <span style="color: purple; font-weight: bold;">tokeniser</span>.<span style="color: green; font-weight: bold;">transition</span>(TokeniserState.Data); <span style="color: blue; font-weight: bold;">// default</span>

            <span style="color: purple; font-weight: bold;">root</span> = new <span style="color: red; font-weight: bold;">Element</span>(<span style="color: purple; font-weight: bold;">Tag</span>.<span style="color: green; font-weight: bold;">valueOf</span>(&quot;html&quot;), <span style="color: purple; font-weight: bold;">baseUri</span>);
            <span style="color: purple; font-weight: bold;">doc</span>.<span style="color: green; font-weight: bold;">appendChild</span>(<span style="color: purple; font-weight: bold;">root</span>);
            <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">push</span>(<span style="color: purple; font-weight: bold;">root</span>);
            <span style="color: green; font-weight: bold;">resetInsertionMode</span>();
            <span style="color: blue; font-weight: bold;">// todo: setup form element to nearest form on context (up ancestor chain)</span>
        }

        <span style="color: green; font-weight: bold;">runParser</span>();
        if (<span style="color: purple; font-weight: bold;">context</span> != null)
            return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">childNodes</span>();
        else
            return <span style="color: purple; font-weight: bold;">doc</span>.<span style="color: green; font-weight: bold;">childNodes</span>();
    }

    private void <span style="color: green; font-weight: bold;">runParser</span>() {
        while (true) {
            <span style="color: blue; font-weight: bold;">// todo: handle foreign content checks</span>

            Token <span style="color: purple; font-weight: bold;">token</span> = <span style="color: purple; font-weight: bold;">tokeniser</span>.<span style="color: green; font-weight: bold;">read</span>();
            <span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">token</span>);

            if (token.type == Token.TokenType.EOF)
                break;
        }
    }

</p></li>
<p>        return <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">getLast</span>();
    }

</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>    // linked hash map to preserve insertion order.
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        if (!(<span style="color: purple; font-weight: bold;">o</span> instanceof Element)) return false;
        if (!super.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">o</span>)) return false;

        Element <span style="color: purple; font-weight: bold;">element</span> = (Element) <span style="color: purple; font-weight: bold;">o</span>;

        if (<span style="color: purple; font-weight: bold;">tag</span> != null ? !<span style="color: purple; font-weight: bold;">tag</span>.<span style="color: green; font-weight: bold;">equals</span>(element.tag) : element.tag != null) return false;

        return true;
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Parser.java:</strong><br>
<p>        return <span style="color: purple; font-weight: bold;">parser</span>.parse();
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>    private static final Tag <span style="color: purple; font-weight: bold;">defaultAncestor</span>;
    static {
        <span style="color: purple; font-weight: bold;">defaultAncestor</span> = new <span style="color: red; font-weight: bold;">Tag</span>(&quot;BODY&quot;);
        <span style="color: purple; font-weight: bold;">tags</span>.<span style="color: green; font-weight: bold;">put</span>(defaultAncestor.tagName, <span style="color: purple; font-weight: bold;">defaultAncestor</span>);
    }

</p></li>
<p>    private boolean canContainBlock = true; // Can this tag hold block level tags?
</p></li>
<p>                <span style="color: purple; font-weight: bold;">tag</span>.<span style="color: green; font-weight: bold;">setExcludes</span>();
                tag.isBlock = false;
</p></li>
<p>        return <span style="color: green; font-weight: bold;">isValidAncestor</span>(<span style="color: purple; font-weight: bold;">child</span>);
    }

    boolean <span style="color: green; font-weight: bold;">isValidAncestor</span>(Tag <span style="color: purple; font-weight: bold;">child</span>) {
        if (child.ancestors.<span style="color: green; font-weight: bold;">isEmpty</span>())
            return true; <span style="color: blue; font-weight: bold;">// HTML tag</span>

        for (int <span style="color: purple; font-weight: bold;">i</span> = 0; <span style="color: purple; font-weight: bold;">i</span> &lt; child.ancestors.<span style="color: green; font-weight: bold;">size</span>(); <span style="color: purple; font-weight: bold;">i</span>++)
            if (this.<span style="color: green; font-weight: bold;">equals</span>(child.ancestors.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">i</span>)))
                return true;
        
        return false;
    }
</p></li>
<p>        <span style="color: blue; font-weight: bold;">// tags are set here in uppercase for legibility, but internally held as lowercase.</span>
        <span style="color: blue; font-weight: bold;">// TODO[must]: incorporate html 5 as appropriate</span>

        <span style="color: blue; font-weight: bold;">// document</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;HTML&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(); <span style="color: blue; font-weight: bold;">// specific includes not impl</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;HEAD&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;HTML&quot;).<span style="color: green; font-weight: bold;">setLimitChildren</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;BODY&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;HTML&quot;); <span style="color: blue; font-weight: bold;">// specific includes not impl</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;FRAMESET&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;HTML&quot;);

        <span style="color: blue; font-weight: bold;">// head</span>
        <span style="color: blue; font-weight: bold;">// all ancestors set to (head, body): so implicitly create head, but allow in body</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;SCRIPT&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;HEAD&quot;, &quot;BODY&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;NOSCRIPT&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;HEAD&quot;, &quot;BODY&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;STYLE&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;HEAD&quot;, &quot;BODY&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;META&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;HEAD&quot;, &quot;BODY&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;LINK&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;HEAD&quot;, &quot;BODY&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>(); <span style="color: blue; font-weight: bold;">// only within head</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;OBJECT&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;HEAD&quot;, &quot;BODY&quot;); <span style="color: blue; font-weight: bold;">// flow (block/inline) or param</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TITLE&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;HEAD&quot;, &quot;BODY&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>().<span style="color: green; font-weight: bold;">setFormatAsInline</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;BASE&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;HEAD&quot;, &quot;BODY&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();

        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;FRAME&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;FRAMESET&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;NOFRAMES&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;FRAMESET&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>();

        <span style="color: blue; font-weight: bold;">// html5 sections</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;SECTION&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;NAV&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;ASIDE&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setLimitChildren</span>(); <span style="color: blue; font-weight: bold;">// limited to h1 - h6</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;HEADER&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;HEADER&quot;, &quot;FOOTER&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;FOOTER&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;HEADER&quot;, &quot;FOOTER&quot;);

        <span style="color: blue; font-weight: bold;">// fontstyle</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;FONT&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setCanContainBlock</span>().<span style="color: green; font-weight: bold;">setFormatAsInline</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;TT&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;I&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;B&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;U&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;BIG&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;SMALL&quot;);

        <span style="color: blue; font-weight: bold;">// phrase</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;EM&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;STRONG&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;DFN&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;CODE&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;SAMP&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;KBD&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;VAR&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;CITE&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;ABBR&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;TIME&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;ACRONYM&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;MARK&quot;);
        
        <span style="color: blue; font-weight: bold;">// ruby</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;RUBY&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;RT&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;RUBY&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;RT&quot;, &quot;RP&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;RP&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;RUBY&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;RT&quot;, &quot;RP&quot;);

        <span style="color: blue; font-weight: bold;">// special</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;A&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setCanContainBlock</span>().<span style="color: green; font-weight: bold;">setFormatAsInline</span>(); <span style="color: blue; font-weight: bold;">// cannot contain self</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;IMG&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>().<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;BODY&quot;, &quot;NOSCRIPT&quot;); <span style="color: blue; font-weight: bold;">// noscript so an image can be in html-&gt;head-&gt;noscript</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;BR&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;WBR&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;MAP&quot;); <span style="color: blue; font-weight: bold;">// map is defined as inline, but can hold block (what?) or area. Seldom used so NBD.</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;Q&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;SUB&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;SUP&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;BDO&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;IFRAME&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;EMBED&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();

        <span style="color: blue; font-weight: bold;">// things past this point aren&#x27;t really blocks or inline. I&#x27;m using them because they can hold block or inline,</span>
        <span style="color: blue; font-weight: bold;">// but per the spec, only specific elements can hold this. if this becomes a real-world parsing problem,</span>
        <span style="color: blue; font-weight: bold;">// will need to have another non block/inline type, and explicit include &amp; exclude rules. should be right though</span>

        <span style="color: blue; font-weight: bold;">// block</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;SPAN&quot;).<span style="color: green; font-weight: bold;">setCanContainBlock</span>().<span style="color: green; font-weight: bold;">setFormatAsInline</span>(); <span style="color: blue; font-weight: bold;">// spec is phrasing only, practise is block</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;P&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>(); <span style="color: blue; font-weight: bold;">// emasculated block?</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H1&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;HGROUP&quot;, &quot;H1&quot;, &quot;H2&quot;, &quot;H3&quot;, &quot;H4&quot;, &quot;H5&quot;, &quot;H6&quot;).<span style="color: green; font-weight: bold;">setFormatAsInline</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H2&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;HGROUP&quot;, &quot;H1&quot;, &quot;H2&quot;, &quot;H3&quot;, &quot;H4&quot;, &quot;H5&quot;, &quot;H6&quot;).<span style="color: green; font-weight: bold;">setFormatAsInline</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H3&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;HGROUP&quot;, &quot;H1&quot;, &quot;H2&quot;, &quot;H3&quot;, &quot;H4&quot;, &quot;H5&quot;, &quot;H6&quot;).<span style="color: green; font-weight: bold;">setFormatAsInline</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H4&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;HGROUP&quot;, &quot;H1&quot;, &quot;H2&quot;, &quot;H3&quot;, &quot;H4&quot;, &quot;H5&quot;, &quot;H6&quot;).<span style="color: green; font-weight: bold;">setFormatAsInline</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H5&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;HGROUP&quot;, &quot;H1&quot;, &quot;H2&quot;, &quot;H3&quot;, &quot;H4&quot;, &quot;H5&quot;, &quot;H6&quot;).<span style="color: green; font-weight: bold;">setFormatAsInline</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H6&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;HGROUP&quot;, &quot;H1&quot;, &quot;H2&quot;, &quot;H3&quot;, &quot;H4&quot;, &quot;H5&quot;, &quot;H6&quot;).<span style="color: green; font-weight: bold;">setFormatAsInline</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;UL&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;OL&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;PRE&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>().<span style="color: green; font-weight: bold;">setPreserveWhitespace</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;DIV&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;BLOCKQUOTE&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;HR&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;ADDRESS&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;FIGURE&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;FIGCAPTION&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;FIGURE&quot;);

        <span style="color: blue; font-weight: bold;">// formctrl</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;FORM&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// can&#x27;t contain self</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;INPUT&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;FORM&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;SELECT&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;FORM&quot;); <span style="color: blue; font-weight: bold;">// just contain optgroup or option</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;TEXTAREA&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;FORM&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;LABEL&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;FORM&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// not self</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;BUTTON&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;FORM&quot;); <span style="color: blue; font-weight: bold;">// bunch of excludes not defined</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;OPTGROUP&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;SELECT&quot;); <span style="color: blue; font-weight: bold;">//  only contain option</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;OPTION&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;SELECT&quot;, &quot;OPTGROUP&quot;, &quot;DATALIST&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;FIELDSET&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;FORM&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;LEGEND&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;FIELDSET&quot;);
        
        <span style="color: blue; font-weight: bold;">// html5 form ctrl, not specced to have to be in forms</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;DATALIST&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;KEYGEN&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;OUTPUT&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;PROGRESS&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;METER&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>();

        <span style="color: blue; font-weight: bold;">// other</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;AREA&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;MAP&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>(); <span style="color: blue; font-weight: bold;">// not an inline per-se</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;PARAM&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;OBJECT&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;INS&quot;); <span style="color: blue; font-weight: bold;">// only within body</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;DEL&quot;); <span style="color: blue; font-weight: bold;">// only within body</span>

        <span style="color: blue; font-weight: bold;">// definition lists. per spec, dt and dd are inline and must directly descend from dl. However in practise</span>
        <span style="color: blue; font-weight: bold;">// these are all used as blocks and dl need only be an ancestor</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;DL&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// can&#x27;t nest</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;DT&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;DL&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;DL&quot;, &quot;DD&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// only within DL.</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;DD&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;DL&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;DL&quot;, &quot;DT&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// only within DL.</span>

        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;LI&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;UL&quot;, &quot;OL&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setFormatAsInline</span>(); <span style="color: blue; font-weight: bold;">// only within OL or UL.</span>

</p></li>
<p>        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setIgnoreEnd</span>(&quot;BODY&quot;, &quot;CAPTION&quot;, &quot;COL&quot;, &quot;COLGROUP&quot;, &quot;HTML&quot;, &quot;TBODY&quot;, &quot;TD&quot;, &quot;TFOO&quot;, &quot;TH&quot;, &quot;THEAD&quot;, &quot;TR&quot;); <span style="color: blue; font-weight: bold;">// specific list of only includes (tr, td, thead etc) not implemented</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;CAPTION&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;THEAD&quot;, &quot;TFOOT&quot;, &quot;TBODY&quot;, &quot;COLGROUP&quot;, &quot;COL&quot;, &quot;TR&quot;, &quot;TH&quot;, &quot;TD&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setIgnoreEnd</span>(&quot;BODY&quot;, &quot;COL&quot;, &quot;COLGROUP&quot;, &quot;HTML&quot;, &quot;TBODY&quot;, &quot;TD&quot;, &quot;TFOOT&quot;, &quot;TH&quot;, &quot;THEAD&quot;, &quot;TR&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;THEAD&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setLimitChildren</span>().<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setIgnoreEnd</span>(&quot;BODY&quot;, &quot;CAPTION&quot;, &quot;COL&quot;, &quot;COLGROUP&quot;, &quot;HTML&quot;, &quot;TD&quot;, &quot;TH&quot;, &quot;TR&quot;); <span style="color: blue; font-weight: bold;">// just TR</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TFOOT&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setLimitChildren</span>().<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setIgnoreEnd</span>(&quot;BODY&quot;, &quot;CAPTION&quot;, &quot;COL&quot;, &quot;COLGROUP&quot;, &quot;HTML&quot;, &quot;TD&quot;, &quot;TH&quot;, &quot;TR&quot;); <span style="color: blue; font-weight: bold;">// just TR</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TBODY&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setLimitChildren</span>().<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setIgnoreEnd</span>(&quot;BODY&quot;, &quot;CAPTION&quot;, &quot;COL&quot;, &quot;COLGROUP&quot;, &quot;HTML&quot;, &quot;TD&quot;, &quot;TH&quot;, &quot;TR&quot;); <span style="color: blue; font-weight: bold;">// optional / implicit open too. just TR</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;COLGROUP&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setLimitChildren</span>().<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setIgnoreEnd</span>(&quot;COL&quot;); <span style="color: blue; font-weight: bold;">// just COL</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;COL&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;COLGROUP&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TR&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TBODY&quot;, &quot;THEAD&quot;, &quot;TFOOT&quot;, &quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setLimitChildren</span>().<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setIgnoreEnd</span>(&quot;BODY&quot;, &quot;CAPTION&quot;, &quot;COL&quot;, &quot;COLGROUP&quot;, &quot;HTML&quot;, &quot;TD&quot;, &quot;TH&quot;); <span style="color: blue; font-weight: bold;">// just TH, TD</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TH&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TR&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;THEAD&quot;, &quot;TFOOT&quot;, &quot;TBODY&quot;, &quot;COLGROUP&quot;, &quot;COL&quot;, &quot;TR&quot;, &quot;TH&quot;, &quot;TD&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setIgnoreEnd</span>(&quot;BODY&quot;, &quot;CAPTION&quot;, &quot;COL&quot;, &quot;COLGROUP&quot;, &quot;HTML&quot;).<span style="color: green; font-weight: bold;">setFormatAsInline</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TD&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TR&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;THEAD&quot;, &quot;TFOOT&quot;, &quot;TBODY&quot;, &quot;COLGROUP&quot;, &quot;COL&quot;, &quot;TR&quot;, &quot;TH&quot;, &quot;TD&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setIgnoreEnd</span>(&quot;BODY&quot;, &quot;CAPTION&quot;, &quot;COL&quot;, &quot;COLGROUP&quot;, &quot;HTML&quot;).<span style="color: green; font-weight: bold;">setFormatAsInline</span>();
        
        <span style="color: blue; font-weight: bold;">// html5 media</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;VIDEO&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;VIDEO&quot;, &quot;AUDIO&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;AUDIO&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;VIDEO&quot;, &quot;AUDIO&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;SOURCE&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;VIDEO&quot;, &quot;AUDIO&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;TRACK&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;VIDEO&quot;, &quot;AUDIO&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;CANVAS&quot;);
        
        <span style="color: blue; font-weight: bold;">// html5 interactive</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;DETAILS&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;SUMMARY&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;DETAILS&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;COMMAND&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;MENU&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;DEVICE&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
    }

</p></li>
<p>        return <span style="color: green; font-weight: bold;">register</span>(new <span style="color: red; font-weight: bold;">Tag</span>(<span style="color: purple; font-weight: bold;">tagName</span>));
    }

</p></li>
<p>        Tag <span style="color: purple; font-weight: bold;">inline</span> = new <span style="color: red; font-weight: bold;">Tag</span>(<span style="color: purple; font-weight: bold;">tagName</span>);
        inline.isBlock = false;
        inline.canContainBlock = false;
        inline.formatAsBlock = false;
        return <span style="color: green; font-weight: bold;">register</span>(<span style="color: purple; font-weight: bold;">inline</span>);
    }
</p></li>
<p>        <span style="color: purple; font-weight: bold;">tag</span>.<span style="color: green; font-weight: bold;">setKnownTag</span>();
        synchronized (tags) {
</p></li>
</li>
</ul>
<h2>Commit: 84ab3d3</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/helper/StringUtil.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/helper/StringUtil.java:</strong><br>
<p>            return true;
        }
        return false;
    }
</p></li>
</li>
</ul>
<h2>Commit: dd4b682</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/helper/StringUtil.java:</strong><br>
<p>        if (<span style="color: purple; font-weight: bold;">c</span> == &#x27; &#x27; || <span style="color: purple; font-weight: bold;">c</span> == &#x27;\t&#x27; || <span style="color: purple; font-weight: bold;">c</span> == &#x27;\n&#x27; || <span style="color: purple; font-weight: bold;">c</span> == &#x27;\f&#x27; || <span style="color: purple; font-weight: bold;">c</span> == '\r'){
            return true;
        }
        return false;
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilderState.java:</strong><br>
<p>                    return false;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilderState.java:</strong><br>
<p>                    return false;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: 6c4f16f</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attribute.java:</strong><br>
<p>            "allowfullscreen", "async", "autofocus", "checked", "compact", "declare", "default", "defer", "disabled",
            "formnovalidate", "hidden", "inert", "ismap", "itemscope", "multiple", "muted", "nohref", "noresize",
            "noshade", "novalidate", "nowrap", "open", "readonly", "required", "reversed", "seamless", "selected",
            "sortable", "truespeed", "typemustmatch"
    };

</p></li>
<p>        if (!<span style="color: green; font-weight: bold;">shouldCollapseAttribute</span>(<span style="color: purple; font-weight: bold;">out</span>)) {
            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&quot;=\&quot;&quot;);
            <span style="color: purple; font-weight: bold;">Entities</span>.<span style="color: green; font-weight: bold;">escape</span>(<span style="color: purple; font-weight: bold;">accum</span>, <span style="color: purple; font-weight: bold;">value</span>, <span style="color: purple; font-weight: bold;">out</span>, true, false, false);
            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>('"');
        }
    }
</p></li>
<p>        return (&quot;&quot;.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">value</span>) || <span style="color: purple; font-weight: bold;">value</span>.<span style="color: green; font-weight: bold;">equalsIgnoreCase</span>(<span style="color: purple; font-weight: bold;">key</span>))
                &amp;&amp; <span style="color: purple; font-weight: bold;">out</span>.<span style="color: green; font-weight: bold;">syntax</span>() == Document.OutputSettings.Syntax.html
                &amp;&amp; <span style="color: purple; font-weight: bold;">Arrays</span>.<span style="color: green; font-weight: bold;">binarySearch</span>(<span style="color: purple; font-weight: bold;">booleanAttributes</span>, <span style="color: purple; font-weight: bold;">key</span>) >= 0;
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>
</p></li>
<p>
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        if (childNodes.isEmpty() &amp;&amp; tag.isSelfClosing()) {
            if (<span style="color: purple; font-weight: bold;">out</span>.<span style="color: green; font-weight: bold;">syntax</span>() == Document.OutputSettings.Syntax.html &amp;&amp; <span style="color: purple; font-weight: bold;">tag</span>.<span style="color: green; font-weight: bold;">isEmpty</span>())
                <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&#x27;&gt;&#x27;);
            else
                <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&quot; /&gt;&quot;); <span style="color: blue; font-weight: bold;">// &lt;img&gt; in html, &lt;img /&gt; in xml</span>
        }
        else
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>                       boolean <span style="color: purple; font-weight: bold;">inAttribute</span>, boolean <span style="color: purple; font-weight: bold;">normaliseWhite</span>, boolean <span style="color: purple; font-weight: bold;">stripLeadingWhite</span>) {

</p></li>
<p>        boolean <span style="color: purple; font-weight: bold;">reachedNonWhite</span> = false;
        EscapeMode <span style="color: purple; font-weight: bold;">escapeMode</span> = <span style="color: purple; font-weight: bold;">out</span>.<span style="color: green; font-weight: bold;">escapeMode</span>();
        CharsetEncoder <span style="color: purple; font-weight: bold;">encoder</span> = <span style="color: purple; font-weight: bold;">out</span>.<span style="color: green; font-weight: bold;">encoder</span>();
        Map<Character, String> map = escapeMode.getMap();
        final int length = string.length();
</p></li>
<p>        for (int offset = 0; offset &lt; length; offset += Character.charCount(codePoint)) {
            <span style="color: purple; font-weight: bold;">codePoint</span> = <span style="color: purple; font-weight: bold;">string</span>.<span style="color: green; font-weight: bold;">codePointAt</span>(<span style="color: purple; font-weight: bold;">offset</span>);

            if (<span style="color: purple; font-weight: bold;">normaliseWhite</span>) {
                if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">isWhitespace</span>(<span style="color: purple; font-weight: bold;">codePoint</span>)) {
                    if ((<span style="color: purple; font-weight: bold;">stripLeadingWhite</span> &amp;&amp; !<span style="color: purple; font-weight: bold;">reachedNonWhite</span>) || <span style="color: purple; font-weight: bold;">lastWasWhite</span>)
                        continue;
                    <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&#x27; &#x27;);
                    <span style="color: purple; font-weight: bold;">lastWasWhite</span> = true;
                    continue;
                } else {
                    <span style="color: purple; font-weight: bold;">lastWasWhite</span> = false;
                    <span style="color: purple; font-weight: bold;">reachedNonWhite</span> = true;
                }
            }
            // surrogate pairs, split implementation for efficiency on single char common case (saves creating strings, char[]):
</p></li>
<p>                switch (<span style="color: purple; font-weight: bold;">c</span>) {
                    case &#x27;&amp;&#x27;:
                        <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&quot;&amp;amp;&quot;);
                        break;
                    case 0xA0:
                        if (<span style="color: purple; font-weight: bold;">escapeMode</span> != EscapeMode.xhtml)
                            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&quot;&amp;nbsp;&quot;);
                        else
                            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">c</span>);
                        break;
                    case &#x27;&lt;&#x27;:
                        if (!<span style="color: purple; font-weight: bold;">inAttribute</span>)
                            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&quot;&amp;lt;&quot;);
                        else
                            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">c</span>);
                        break;
                    case &#x27;&gt;&#x27;:
                        if (!<span style="color: purple; font-weight: bold;">inAttribute</span>)
                            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&quot;&amp;gt;&quot;);
                        else
                            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">c</span>);
                        break;
                    case &#x27;&quot;&#x27;:
                        if (<span style="color: purple; font-weight: bold;">inAttribute</span>)
                            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&quot;&amp;quot;&quot;);
                        else
                            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">c</span>);
                        break;
                    default:
                        if (<span style="color: purple; font-weight: bold;">encoder</span>.<span style="color: green; font-weight: bold;">canEncode</span>(<span style="color: purple; font-weight: bold;">c</span>))
                            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">c</span>);
                        else if (<span style="color: purple; font-weight: bold;">map</span>.<span style="color: green; font-weight: bold;">containsKey</span>(<span style="color: purple; font-weight: bold;">c</span>))
                            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&#x27;&amp;&#x27;).<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">map</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">c</span>)).<span style="color: green; font-weight: bold;">append</span>(&#x27;;&#x27;);
                        else
                            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&quot;&amp;#x&quot;).<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">Integer</span>.<span style="color: green; font-weight: bold;">toHexString</span>(<span style="color: purple; font-weight: bold;">codePoint</span>)).<span style="color: green; font-weight: bold;">append</span>(';');
                }
            } else {
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>                &amp;&amp; !Element.preserveWhitespace((Element) parent());
        <span style="color: purple; font-weight: bold;">Entities</span>.<span style="color: green; font-weight: bold;">escape</span>(<span style="color: purple; font-weight: bold;">accum</span>, <span style="color: green; font-weight: bold;">getWholeText</span>(), <span style="color: purple; font-weight: bold;">out</span>, false, <span style="color: purple; font-weight: bold;">normaliseWhite</span>, false);
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>    };
</p></li>
<p>    };
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attribute.java:</strong><br>
<p>            .<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">key</span>)
            .<span style="color: green; font-weight: bold;">append</span>(&quot;=\&quot;&quot;)
            .<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">Entities</span>.<span style="color: green; font-weight: bold;">escape</span>(<span style="color: purple; font-weight: bold;">value</span>, <span style="color: purple; font-weight: bold;">out</span>))
            .<span style="color: green; font-weight: bold;">append</span>("\"");
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>            accum.append(" />");
        else
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>        StringBuilder accum = new StringBuilder(string.length() * 2);
        Map<Character, String> map = escapeMode.getMap();

</p></li>
<p>            final int <span style="color: purple; font-weight: bold;">codePoint</span> = <span style="color: purple; font-weight: bold;">string</span>.<span style="color: green; font-weight: bold;">codePointAt</span>(<span style="color: purple; font-weight: bold;">offset</span>);

</p></li>
<p>                    accum.append('&').append(map.get(c)).append(';');
                else if (encoder.canEncode(c))
                    accum.append(c);
                else
                    accum.append("&#x").append(Integer.toHexString(codePoint)).append(';');
            } else {
</p></li>
<p>            offset += Character.charCount(codePoint);
        }
</p></li>
<p>        return accum.toString();
    }
</p></li>
<p>            {"lt", 0x0003C},
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        if (<span style="color: purple; font-weight: bold;">out</span>.<span style="color: green; font-weight: bold;">prettyPrint</span>() &amp;&amp; <span style="color: green; font-weight: bold;">parent</span>() instanceof Element &amp;&amp; !<span style="color: purple; font-weight: bold;">Element</span>.<span style="color: green; font-weight: bold;">preserveWhitespace</span>((Element) <span style="color: green; font-weight: bold;">parent</span>()))
            <span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">appendNormalisedWhitespace</span>(<span style="color: purple; font-weight: bold;">accum</span>, <span style="color: purple; font-weight: bold;">html</span>, false);
        else
            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">html</span>);
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>    };
</p></li>
<p>    };
</p></li>
</li>
</ul>
<h2>Commit: 6b0dd15</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attribute.java:</strong><br>
<p>        this.value = value;
</p></li>
<p>        <span style="color: purple; font-weight: bold;">accum</span>
            .<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">key</span>)
            .<span style="color: green; font-weight: bold;">append</span>(&quot;=\&quot;&quot;)
            .<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">StringEscapeUtils</span>.<span style="color: green; font-weight: bold;">escapeHtml</span>(<span style="color: purple; font-weight: bold;">value</span>))
            .<span style="color: green; font-weight: bold;">append</span>("\"");
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>        for (Attribute <span style="color: purple; font-weight: bold;">attribute</span> : this) {
</p></li>
<p>        }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        return (Element) super.parent();
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        Validate.notNull(index);
</p></li>
<p>    }
</p></li>
<p>        this.<span style="color: purple; font-weight: bold;">siblingIndex</span> = <span style="color: purple; font-weight: bold;">siblingIndex</span>;
    }
</p></li>
<p>        outerHtml(accum);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>        <span style="color: blue; font-weight: bold;">//queue = new StringBuilder(data);</span>
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attribute.java:</strong><br>
<p>        this.value = value;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>        }
</p></li>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        return (Element) super.parent();
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        Validate.notNull(index);
</p></li>
<p>    }
</p></li>
<p>    protected static &lt;<span style="color: purple; font-weight: bold;">N</span> extends Node&gt; Integer <span style="color: green; font-weight: bold;">indexInList</span>(N <span style="color: purple; font-weight: bold;">search</span>, List&lt;N&gt; <span style="color: purple; font-weight: bold;">nodes</span>) {
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">search</span>);
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">nodes</span>);

        for (int i = 0; i &lt; <span style="color: purple; font-weight: bold;">nodes</span>.size(); i++) {
            N <span style="color: purple; font-weight: bold;">node</span> = <span style="color: purple; font-weight: bold;">nodes</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">i</span>);
            if (<span style="color: purple; font-weight: bold;">node</span>.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">search</span>))
                return <span style="color: purple; font-weight: bold;">i</span>;
        }
        return null;
    }
</p></li>
<p>        outerHtml(accum);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: 40a3cda</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attribute.java:</strong><br>
<p>        this.value = value;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>    // linked hash map to preserve insertion order.
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        this.baseUri = baseUri.trim();
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attribute.java:</strong><br>
<p>        this.value = value;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>    // linked hash map to preserve insertion order.
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        this.baseUri = baseUri.trim();
</p></li>
</li>
</ul>
<h2>Commit: 5b40706</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attribute.java:</strong><br>
<p>        this.value = value;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attribute.java:</strong><br>
<p>        this.value = value;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: a29e8b5</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attribute.java:</strong><br>
<p>        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">key</span>);
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">value</span>);
        this.<span style="color: purple; font-weight: bold;">key</span> = <span style="color: purple; font-weight: bold;">key</span>;
        this.<span style="color: purple; font-weight: bold;">value</span> = <span style="color: purple; font-weight: bold;">value</span>;
    }

</p></li>
<p>        return <span style="color: purple; font-weight: bold;">key</span>;
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>
    public String <span style="color: green; font-weight: bold;">get</span>(String <span style="color: purple; font-weight: bold;">key</span>) {
</p></li>
<p>        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">attribute</span>);
        <span style="color: green; font-weight: bold;">put</span>(<span style="color: purple; font-weight: bold;">attribute</span>.<span style="color: green; font-weight: bold;">getKey</span>(), <span style="color: purple; font-weight: bold;">attribute</span>.<span style="color: green; font-weight: bold;">getValue</span>());
    }

</p></li>
<p>
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: 57bce6d</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attribute.java:</strong><br>
<p>        accum
</p></li>
<p>            .append("\"");
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>        for (Attribute attribute : this) {
</p></li>
<p>        }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>
</p></li>
<p>
</p></li>
<p>            return <span style="color: purple; font-weight: bold;">charsetEncoder</span>;
        }
    }
</p></li>
<p>        return <span style="color: purple; font-weight: bold;">outputSettings</span>;
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        if (isBlock() || (parent() != null && parent().tag().canContainBlock() && siblingIndex() == 0))
</p></li>
<p>        <span style="color: purple; font-weight: bold;">attributes</span>.<span style="color: green; font-weight: bold;">html</span>(<span style="color: purple; font-weight: bold;">accum</span>, <span style="color: purple; font-weight: bold;">out</span>);

</p></li>
<p>        if (!(childNodes.isEmpty() && tag.isSelfClosing())) {
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>    public enum EscapeMode {
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>    }
</p></li>
<p>            this.accum = accum;
</p></li>
<p>        }
</p></li>
<p>        }
</p></li>
<p>        }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        String html = <span style="color: purple; font-weight: bold;">Entities</span>.<span style="color: green; font-weight: bold;">escape</span>(getWholeText(), <span style="color: purple; font-weight: bold;">out</span>);
        if (parent() instanceof Element && !((Element) parent()).preserveWhitespace()) {
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attribute.java:</strong><br>
<p>        accum
</p></li>
<p>            .append("\"");
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>        for (Attribute attribute : this) {
</p></li>
<p>        }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>        public OutputSettings() {}
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        if (isBlock() || (parent() != null && parent().tag().canContainBlock() && siblingIndex() == 0))
</p></li>
<p>                .<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">attributes</span>.<span style="color: green; font-weight: bold;">html</span>());

</p></li>
<p>        if (!(childNodes.isEmpty() && tag.isSelfClosing())) {
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>    public enum EscapeMode {
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>    }
</p></li>
<p>            this.accum = accum;
</p></li>
<p>        }
</p></li>
<p>        }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        String html = <span style="color: purple; font-weight: bold;">StringEscapeUtils</span>.<span style="color: green; font-weight: bold;">escapeHtml</span>(getWholeText());
        if (parent() instanceof Element && !((Element) parent()).preserveWhitespace()) {
</p></li>
</li>
</ul>
<h2>Commit: 847e03e</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: 5ca6b40</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>    protected static final String dataPrefix = "data-";
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>    protected static final String dataPrefix = "data-";
</p></li>
</li>
</ul>
<h2>Commit: 2f0a7bf</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>    private LinkedHashMap<String, String> attributes = new LinkedHashMap<String, String>(); // linked hash map to preserve insertion order.
</p></li>
<p>
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>        <span style="color: purple; font-weight: bold;">body</span> = new <span style="color: red; font-weight: bold;">Element</span> (new <span style="color: red; font-weight: bold;">StartTag</span>(<span style="color: purple; font-weight: bold;">Tag</span>.<span style="color: green; font-weight: bold;">valueOf</span>(&quot;body&quot;)));

        this.<span style="color: green; font-weight: bold;">addChild</span>(<span style="color: purple; font-weight: bold;">head</span>);
        this.<span style="color: green; font-weight: bold;">addChild</span>(<span style="color: purple; font-weight: bold;">body</span>);
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Parser.java:</strong><br>
<p>        return parser.parse();
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>    private LinkedHashMap<String, String> attributes = new LinkedHashMap<String, String>(); // linked hash map to preserve insertion order.
</p></li>
<p>
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Parser.java:</strong><br>
<p>        Parser parser = new Parser(<span style="color: purple; font-weight: bold;">ts</span>);
        return parser.parse();
</p></li>
</li>
</ul>
<h2>Commit: a657d09</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>}
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>        super(null, new <span style="color: red; font-weight: bold;">StartTag</span>(<span style="color: purple; font-weight: bold;">Tag</span>.<span style="color: green; font-weight: bold;">valueOf</span>("html"), null));
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        super(<span style="color: purple; font-weight: bold;">parentNode</span>, <span style="color: purple; font-weight: bold;">startTag</span>.<span style="color: green; font-weight: bold;">getAttributes</span>());
        this.<span style="color: purple; font-weight: bold;">tag</span> = <span style="color: purple; font-weight: bold;">startTag</span>.<span style="color: green; font-weight: bold;">getTag</span>();
        <span style="color: purple; font-weight: bold;">elementChildren</span> = new <span style="color: red; font-weight: bold;">ArrayList&lt;Element&gt;</span>();
    }

</p></li>
<p>        return <span style="color: purple; font-weight: bold;">tag</span>.<span style="color: green; font-weight: bold;">getName</span>();
    }

</p></li>
<p>        return <span style="color: purple; font-weight: bold;">tag</span>.<span style="color: green; font-weight: bold;">getName</span>();
    }

</p></li>
<p>        return <span style="color: purple; font-weight: bold;">tag</span>;
    }

</p></li>
<p>        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">child</span>);
        <span style="color: purple; font-weight: bold;">elementChildren</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">child</span>);
        <span style="color: purple; font-weight: bold;">childNodes</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">child</span>);
    }

</p></li>
<p>}
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        this.<span style="color: purple; font-weight: bold;">parentNode</span> = <span style="color: purple; font-weight: bold;">parentNode</span>;
        <span style="color: purple; font-weight: bold;">childNodes</span> = new <span style="color: red; font-weight: bold;">ArrayList&lt;Node&gt;</span>();
        this.<span style="color: purple; font-weight: bold;">attributes</span> = <span style="color: purple; font-weight: bold;">attributes</span>;
    }

</p></li>
<p>        return <span style="color: purple; font-weight: bold;">parentNode</span>;
    }

</p></li>
<p>        <span style="color: blue; font-weight: bold;">// TODO: implement</span>
        return null;
    }

</p></li>
<p>        return null;
    }
}
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        super(<span style="color: purple; font-weight: bold;">parentNode</span>, null);
        this.<span style="color: purple; font-weight: bold;">text</span> = <span style="color: purple; font-weight: bold;">text</span>;
    }

</p></li>
<p>        return "#text";
    }

</p></li>
<p>        return <span style="color: purple; font-weight: bold;">text</span>;
    }
}
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        return <span style="color: purple; font-weight: bold;">tagName</span>;
    }

</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: 7568b91</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>            Attribute <span style="color: purple; font-weight: bold;">attribute</span> = <span style="color: purple; font-weight: bold;">entry</span>.<span style="color: green; font-weight: bold;">getValue</span>();
            accum.append(" ");
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>            accum.append(" ");
</p></li>
</li>
</ul>
<h2>Commit: ac95e9f</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&quot; &quot;);
            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">attribute</span>.<span style="color: green; font-weight: bold;">html</span>());
        }
        return <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">toString</span>();
    }
    public String <span style="color: green; font-weight: bold;">toString</span>() {
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        StringBuilder <span style="color: purple; font-weight: bold;">accum</span> = new <span style="color: red; font-weight: bold;">StringBuilder</span>();
        <span style="color: purple; font-weight: bold;">accum</span>
                .<span style="color: green; font-weight: bold;">append</span>(&quot;&lt;&quot;)
                .<span style="color: green; font-weight: bold;">append</span>(<span style="color: green; font-weight: bold;">tagName</span>())
                .<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">attributes</span>.<span style="color: green; font-weight: bold;">html</span>());

        if (<span style="color: purple; font-weight: bold;">childNodes</span>.<span style="color: green; font-weight: bold;">isEmpty</span>() &amp;&amp; <span style="color: purple; font-weight: bold;">tag</span>.<span style="color: green; font-weight: bold;">isEmpty</span>()) {
            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&quot; /&gt;&quot;);
        } else {
            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&quot;&gt;&quot;);
            for (Node <span style="color: purple; font-weight: bold;">node</span> : <span style="color: purple; font-weight: bold;">childNodes</span>)
                <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">node</span>.<span style="color: green; font-weight: bold;">html</span>());
            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&quot;&lt;/&quot;).<span style="color: green; font-weight: bold;">append</span>(<span style="color: green; font-weight: bold;">tagName</span>()).<span style="color: green; font-weight: bold;">append</span>(&quot;&gt;&quot;);
        }

        return <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">toString</span>();
    }

</p></li>
<p>        return <span style="color: green; font-weight: bold;">html</span>();
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        return <span style="color: purple; font-weight: bold;">StringEscapeUtils</span>.<span style="color: green; font-weight: bold;">escapeHtml</span>(<span style="color: green; font-weight: bold;">getWholeText</span>());
    }

</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Attributes.java:</strong><br>
<p>
</p></li>
</li>
</ul>
<h2>Commit: edcc4a0</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: 3205f0e</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        super(<span style="color: purple; font-weight: bold;">baseUri</span>, <span style="color: purple; font-weight: bold;">attributes</span>);
        
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">tag</span>);    
        this.tag = <span style="color: purple; font-weight: bold;">tag</span>;
        elementChildren = new ArrayList<Element>();
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        super(<span style="color: purple; font-weight: bold;">startTag</span>.<span style="color: green; font-weight: bold;">getBaseUri</span>(), <span style="color: purple; font-weight: bold;">startTag</span>.<span style="color: green; font-weight: bold;">getAttributes</span>());
        this.tag = <span style="color: purple; font-weight: bold;">startTag</span>.<span style="color: green; font-weight: bold;">getTag</span>();
        elementChildren = new ArrayList<Element>();
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: e97f564</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>    static {
        <span style="color: purple; font-weight: bold;">defaultAncestor</span> = new <span style="color: red; font-weight: bold;">Tag</span>(&quot;BODY&quot;, true, true, true, false, false);
        <span style="color: purple; font-weight: bold;">tags</span>.<span style="color: green; font-weight: bold;">put</span>(defaultAncestor.tagName, <span style="color: purple; font-weight: bold;">defaultAncestor</span>);
    }

</p></li>
<p>        if (child.ancestors.<span style="color: green; font-weight: bold;">isEmpty</span>())
            return true; <span style="color: blue; font-weight: bold;">// HTML tag</span>

        for (Tag <span style="color: purple; font-weight: bold;">tag</span> : child.ancestors) {
            if (this.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">tag</span>))
                return true;
        }
        return false;
    }

</p></li>
<p>        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;HTML&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(null); <span style="color: blue; font-weight: bold;">// specific includes not impl</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;HEAD&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;HTML&quot;); <span style="color: blue; font-weight: bold;">// specific includes not impl: SCRIPT, STYLE, META, LINK, OBJECT</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;BODY&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;HTML&quot;); <span style="color: blue; font-weight: bold;">// specific includes not impl</span>

        <span style="color: blue; font-weight: bold;">// head</span>
        <span style="color: blue; font-weight: bold;">// all ancestors set to (head, body): so implicitly create head, but allow in body</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;SCRIPT&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;HEAD&quot;, &quot;BODY&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;STYLE&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;HEAD&quot;, &quot;BODY&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;META&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;HEAD&quot;, &quot;BODY&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;LINK&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;HEAD&quot;, &quot;BODY&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>(); <span style="color: blue; font-weight: bold;">// only within head</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;OBJECT&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;HEAD&quot;, &quot;BODY&quot;); <span style="color: blue; font-weight: bold;">// flow (block/inline) or param</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;TITLE&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;HEAD&quot;, &quot;BODY&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;BASE&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;HEAD&quot;, &quot;BODY&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();



        // fontstyle
</p></li>
<p>        <span style="color: green; font-weight: bold;">createInline</span>(&quot;INPUT&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;FORM&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;SELECT&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;FORM&quot;); <span style="color: blue; font-weight: bold;">// just contain optgroup or option</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;TEXTAREA&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;FORM&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;LABEL&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;FORM&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // not self
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;BUTTON&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;FORM&quot;); // bunch of excludes not defined
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;OPTGROUP&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;SELECT&quot;); <span style="color: blue; font-weight: bold;">//  only contain option</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;OPTION&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;SELECT&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;FIELDSET&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;FORM&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;LEGEND&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>("FIELDSET");

</p></li>
<p>        createBlock("INS"); // only within body
</p></li>
<p>        <span style="color: green; font-weight: bold;">createInline</span>(&quot;DT&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;DL&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// only within DL.</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;DD&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;DL&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// only within DL.</span>

</p></li>
<p>
</p></li>
<p>        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;CAPTION&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;TABLE&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;THEAD&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // just TR
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TFOOT&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // just TR
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TBODY&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // optional / implicit open too. just TR
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;COLGROUP&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // just COL
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;COL&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;COLGROUP&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TR&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // just TH, TD
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TH&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;TR&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TD&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;TR&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>();
    }
</p></li>
<p>        synchronized (tags) {
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>        <span style="color: purple; font-weight: bold;">head</span> = new <span style="color: red; font-weight: bold;">Element</span> (new <span style="color: red; font-weight: bold;">StartTag</span>(<span style="color: purple; font-weight: bold;">Tag</span>.<span style="color: green; font-weight: bold;">valueOf</span>(&quot;head&quot;)));
        <span style="color: purple; font-weight: bold;">body</span> = new <span style="color: red; font-weight: bold;">Element</span> (new <span style="color: red; font-weight: bold;">StartTag</span>(<span style="color: purple; font-weight: bold;">Tag</span>.<span style="color: green; font-weight: bold;">valueOf</span>(&quot;body&quot;)));

        this.<span style="color: green; font-weight: bold;">addChild</span>(<span style="color: purple; font-weight: bold;">head</span>);
        this.<span style="color: green; font-weight: bold;">addChild</span>(<span style="color: purple; font-weight: bold;">body</span>);
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createInline("BR").setEmpty();
</p></li>
<p>        createInline("MAP"); // map is defined as inline, but can hold block (what?) or area. Seldom used so NBD.
</p></li>
<p>        createBlock("DIV");
</p></li>
<p>        createBlock("HR").setEmpty();
</p></li>
<p>        createBlock("FIELDSET");
        createBlock("ADDRESS").setContainInlineOnly();
</p></li>
<p>        createInline(&quot;SELECT&quot;); <span style="color: blue; font-weight: bold;">// just optgroup or option</span>
        createInline(&quot;TEXTAREA&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>();
        createInline(&quot;LABEL&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // not self
        createInline(&quot;BUTTON&quot;); // bunch of excludes not defined
        createInline(&quot;OPTGROUP&quot;); <span style="color: blue; font-weight: bold;">// only in select, only contain option</span>
        createInline(&quot;OPTION&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>();
        createInline(&quot;LEGEND&quot;); <span style="color: blue; font-weight: bold;">// only within fieldset (implicit?)</span>

        <span style="color: blue; font-weight: bold;">// document</span>
        createBlock(&quot;HTML&quot;); <span style="color: blue; font-weight: bold;">// specific includes not impl</span>
        createBlock(&quot;HEAD&quot;); <span style="color: blue; font-weight: bold;">// specific includes not impl: SCRIPT, STYLE, META, LINK, OBJECT</span>
        createBlock(&quot;BODY&quot;); <span style="color: blue; font-weight: bold;">// specific includes not impl</span>

</p></li>
<p>        createInline(&quot;PARAM&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>(); <span style="color: blue; font-weight: bold;">// only within object</span>
        createBlock("INS"); // only within body
</p></li>
<p>        createInline(&quot;DD&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// only within DL. Prolly should create implicit DL?</span>

        createBlock(&quot;LI&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// only within OL or UL. Implicit?</span>


</p></li>
<p>        <span style="color: green; font-weight: bold;">createInline</span>(&quot;THEAD&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // just TR
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;TFOOT&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // just TR
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;TBODY&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // optional / implicit open too. just TR
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;COLGROUP&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // just COL
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;COL&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;TR&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // just TH, TD
        createBlock(&quot;TD&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>();
        
        <span style="color: blue; font-weight: bold;">// head</span>
        createInline(&quot;TITLE&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>();
        createInline(&quot;BASE&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        createInline(&quot;META&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        createInline(&quot;STYLE&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>();
    }
</p></li>
</li>
</ul>
<h2>Commit: f5b1a2a</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: 0474436</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        super(startTag.getAttributes());
        this.tag = startTag.getTag();
</p></li>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        childNodes = new ArrayList<Node>();
</p></li>
<p>        this.<span style="color: purple; font-weight: bold;">parentNode</span> = <span style="color: purple; font-weight: bold;">parentNode</span>;
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        super();
        attributes.put(TEXT_KEY, text);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        super(<span style="color: purple; font-weight: bold;">parentNode</span>, startTag.getAttributes());
        this.tag = startTag.getTag();
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        this.parentNode = parentNode;
        childNodes = new ArrayList<Node>();
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        super(<span style="color: purple; font-weight: bold;">parentNode</span>);
        attributes.put(TEXT_KEY, text);
</p></li>
</li>
</ul>
<h2>Commit: f8841ed</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>        private Charset <span style="color: purple; font-weight: bold;">charset</span> = <span style="color: purple; font-weight: bold;">Charset</span>.<span style="color: green; font-weight: bold;">forName</span>(&quot;UTF-8&quot;);
        
        public <span style="color: green; font-weight: bold;">OutputSettings</span>() {}

</p></li>
<p>            return <span style="color: purple; font-weight: bold;">escapeMode</span>;
        }

</p></li>
<p>}
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>        <span style="color: purple; font-weight: bold;">base</span>, <span style="color: purple; font-weight: bold;">extended</span>
    }
</p></li>
<p>        StringBuilder accum = new StringBuilder(string.length() * 2);
        Map&lt;Character, String&gt; <span style="color: purple; font-weight: bold;">map</span> = <span style="color: purple; font-weight: bold;">escapeMode</span> == EscapeMode.extended ? <span style="color: purple; font-weight: bold;">fullByVal</span> : <span style="color: purple; font-weight: bold;">baseByVal</span>;

</p></li>
<p>                accum.append(&quot;&amp;&quot;).append(<span style="color: purple; font-weight: bold;">map</span>.get(<span style="color: purple; font-weight: bold;">c</span>)).append(";");
            else if (encoder.canEncode(c))
</p></li>
<p>        }

        return accum.toString();
    }

</p></li>
<p>        <span style="color: purple; font-weight: bold;">baseByVal</span> = new HashMap&lt;<span style="color: red; font-weight: bold;">Character</span>, String&gt;(baseArray.length);
        <span style="color: purple; font-weight: bold;">fullByVal</span> = new <span style="color: red; font-weight: bold;">HashMap&lt;Character, String&gt;</span>(fullArray.length);

</p></li>
<p>            Character <span style="color: purple; font-weight: bold;">c</span> = <span style="color: purple; font-weight: bold;">Character</span>.<span style="color: green; font-weight: bold;">valueOf</span>((char) ((Integer) <span style="color: purple; font-weight: bold;">entity</span>[1]).<span style="color: green; font-weight: bold;">intValue</span>());
            <span style="color: purple; font-weight: bold;">base</span>.<span style="color: green; font-weight: bold;">put</span>((String) <span style="color: purple; font-weight: bold;">entity</span>[0], <span style="color: purple; font-weight: bold;">c</span>);
            <span style="color: purple; font-weight: bold;">baseByVal</span>.put(<span style="color: purple; font-weight: bold;">c</span>, ((String) entity[0]).toLowerCase());
        }
        for (Object[] entity : <span style="color: purple; font-weight: bold;">fullArray</span>) {
</p></li>
<p>            <span style="color: purple; font-weight: bold;">full</span>.<span style="color: green; font-weight: bold;">put</span>((String) <span style="color: purple; font-weight: bold;">entity</span>[0], <span style="color: purple; font-weight: bold;">c</span>);
            <span style="color: purple; font-weight: bold;">fullByVal</span>.<span style="color: green; font-weight: bold;">put</span>(<span style="color: purple; font-weight: bold;">c</span>, ((String) <span style="color: purple; font-weight: bold;">entity</span>[0]).<span style="color: green; font-weight: bold;">toLowerCase</span>());
        }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/Entities.java:</strong><br>
<p>    static final Map<String, Integer> full;
    static final Map<Integer, String> fullByVal;

</p></li>
<p>        <span style="color: blue; font-weight: bold;">// todo: this needs option to: use base names only (with numerical as fallback)</span>
        StringBuilder accum = new StringBuilder((int) (<span style="color: purple; font-weight: bold;">string</span>.<span style="color: green; font-weight: bold;">length</span>() * 1.5));
        CharsetEncoder <span style="color: purple; font-weight: bold;">encoder</span> = <span style="color: purple; font-weight: bold;">charset</span>.<span style="color: green; font-weight: bold;">newEncoder</span>();

</p></li>
<p>                accum.append(&quot;&amp;&quot;).append(<span style="color: purple; font-weight: bold;">fullByVal</span>.get((int) <span style="color: purple; font-weight: bold;">c</span>)).append(";");
            else if (encoder.canEncode(c))
</p></li>
<p>        }
</p></li>
<p>        full = new HashMap&lt;String, <span style="color: red; font-weight: bold;">Integer</span>&gt;(fullArray.length);
        <span style="color: purple; font-weight: bold;">fullByVal</span> = new HashMap&lt;<span style="color: red; font-weight: bold;">Integer</span>, String>(fullArray.length);

</p></li>
<p>        for (Object[] entity : <span style="color: purple; font-weight: bold;">fullArray</span>) {
</p></li>
<p>            fullByVal.<span style="color: green; font-weight: bold;">put</span>((Integer) entity[1], ((String) <span style="color: purple; font-weight: bold;">entity</span>[0]));
        }
</p></li>
</li>
</ul>
<h2>Commit: e256bb7</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>        private int <span style="color: purple; font-weight: bold;">indentAmount</span> = 1;

</p></li>
<p>            return <span style="color: purple; font-weight: bold;">prettyPrint</span>;
        }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>            indent(accum, depth, <span style="color: purple; font-weight: bold;">out</span>);
        accum
</p></li>
<p>                indent(accum, depth, <span style="color: purple; font-weight: bold;">out</span>);
            accum.append("</").append(tagName()).append(">");
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>            html = normaliseWhitespace(html);
</p></li>
<p>            indent(accum, depth, <span style="color: purple; font-weight: bold;">out</span>);
        accum.append(html);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>            indent(accum, depth);
        accum
</p></li>
<p>                indent(accum, depth);
            accum.append("</").append(tagName()).append(">");
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>            html = normaliseWhitespace(html);
</p></li>
<p>            indent(accum, depth);
        accum.append(html);
</p></li>
</li>
</ul>
<h2>Commit: 3982ea1</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>        private int indentAmount = 1;
</p></li>
<p>            return <span style="color: purple; font-weight: bold;">outline</span>;
        }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>            indent(accum, depth, out);
</p></li>
<p>                    tag.formatAsBlock() || (out.<span style="color: green; font-weight: bold;">outline</span>() &amp;&amp; childNodes.size()&gt;1 || (childNodes.size()==1 &amp;&amp; !(childNodes.<span style="color: green; font-weight: bold;">get</span>(0) instanceof TextNode)))
            )))
                indent(accum, depth, out);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>            indent(accum, depth, out);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>        private int indentAmount = 1;
</p></li>
<p>            return <span style="color: purple; font-weight: bold;">forceAllElementAsBlock</span>;
        }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>            indent(accum, depth, out);
</p></li>
<p>                indent(accum, depth, out);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>            indent(accum, depth, out);
</p></li>
</li>
</ul>
<h2>Commit: e064bc4</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Document.java:</strong><br>
<p>        private int indentAmount = 1;
</p></li>
<p>            return <span style="color: purple; font-weight: bold;">forceAllElementAsBlock</span>;
        }
        
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>            indent(accum, depth, out);
</p></li>
<p>                indent(accum, depth, out);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>            indent(accum, depth, out);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>            indent(accum, depth, out);
</p></li>
<p>                indent(accum, depth, out);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>            indent(accum, depth, out);
</p></li>
</li>
</ul>
<h2>Commit: 83b8d1a</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        this(new <span style="color: red; font-weight: bold;">StartTag</span>(<span style="color: purple; font-weight: bold;">tag</span>, <span style="color: purple; font-weight: bold;">baseUri</span>));
    }

</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: e5cd584</h2>
<h3>addition:</h3><ul>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>    }
</p></li>
<p>        childNodes.add(child);
</p></li>
</li>
</ul>
<h2>Commit: 990285b</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        <span style="color: blue; font-weight: bold;">// was - Node#addChildren(child). short-circuits an array create and a loop.</span>
        <span style="color: green; font-weight: bold;">reparentChild</span>(child);
        <span style="color: purple; font-weight: bold;">childNodes</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">child</span>);
        <span style="color: purple; font-weight: bold;">child</span>.<span style="color: green; font-weight: bold;">setSiblingIndex</span>(<span style="color: purple; font-weight: bold;">childNodes</span>.<span style="color: green; font-weight: bold;">size</span>()-1);
        return this;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        if (child.parentNode != null)
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        <span style="color: green; font-weight: bold;">addChildren</span>(child);
        return this;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        if (child.parentNode != null)
</p></li>
</li>
</ul>
<h2>Commit: 05ea09d</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        return this;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        this.parentNode = parentNode;
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        <span style="color: purple; font-weight: bold;">childNodes</span>.<span style="color: green; font-weight: bold;">add</span>(child);
        return this;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        this.parentNode = parentNode;
</p></li>
</li>
</ul>
<h2>Commit: 95945f1</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        Validate.notNull(child);
</p></li>
<p>        return this;
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        Validate.notNull(child);
</p></li>
<p>        child.setParentNode(this);
</p></li>
</li>
</ul>
<h2>Commit: 9bed789</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>    public String nodeName() {
</p></li>
<p>        Validate.notNull(child);
</p></li>
<p><span style="color: blue; font-weight: bold;">     * Get the outer HTML for this element. E.g. on a {@code div} with one empty {@code p}, would return
     * {@code &lt;div&gt;&lt;p&gt;&lt;/p&gt;&lt;/div&gt;}.
     * 
     * @return the outer HTML
     * @see #html()
     */</span>
    public String outerHtml() {
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        Validate.notNull(child);
</p></li>
</li>
</ul>
<h2>Commit: abdf227</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        elementChildren.add(child);
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: 83d1848</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        Validate.notNull(child);
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        Validate.notNull(child);
</p></li>
</li>
</ul>
<h2>Commit: 1f3cfcf</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>    public boolean <span style="color: green; font-weight: bold;">equals</span>(Object <span style="color: purple; font-weight: bold;">o</span>) {
        if (this == <span style="color: purple; font-weight: bold;">o</span>) return true;
        if (!(<span style="color: purple; font-weight: bold;">o</span> instanceof Element)) return false;
        if (!super.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">o</span>)) return false;

        Element <span style="color: purple; font-weight: bold;">element</span> = (Element) <span style="color: purple; font-weight: bold;">o</span>;

</p></li>
<p>
        return true;
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        this.query = query.trim();
</p></li>
<p>                <span style="color: green; font-weight: bold;">groupOr</span>();
            } else { <span style="color: blue; font-weight: bold;">// unhandled</span>
</p></li>
<p>    }
</p></li>
<p>
</p></li>
<p>        <span style="color: blue; font-weight: bold;">// no-op; just append uniques</span>
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        this.query = query.trim();
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: b04c541</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        return tag.getName();
</p></li>
<p>        return tag.getName();
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        return <span style="color: purple; font-weight: bold;">childNodes</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">index</span>);
    }

</p></li>
<p>        return parentNode;
</p></li>
<p>        // TODO: implement
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        return "#text";
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        return tag.getName();
</p></li>
<p>        return tag.getName();
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        return Collections.unmodifiableList(childNodes);
</p></li>
<p>        return parentNode;
</p></li>
<p>        // TODO: implement
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        return "#text";
</p></li>
</li>
</ul>
<h2>Commit: 694efa8</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>            indent(accum, depth, out);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>            indent(accum, depth, out);
</p></li>
</li>
</ul>
<h2>Commit: 13c2af3</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>            indent(accum, depth, out);
</p></li>
<p>                indent(accum, depth, out);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>            indent(accum, depth, out);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>    private boolean canContainBlock = true; // Can this tag hold block level tags?
</p></li>
<p>        return <span style="color: purple; font-weight: bold;">formatAsBlock</span>;
    }

</p></li>
<p>        createInline("BASE").setAncestor("HEAD", "BODY").setEmpty();
</p></li>
<p>        createBlock("P").setContainInlineOnly(); // emasculated block?
</p></li>
<p>        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H2&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;HGROUP&quot;, &quot;H1&quot;, &quot;H2&quot;, &quot;H3&quot;, &quot;H4&quot;, &quot;H5&quot;, &quot;H6&quot;).<span style="color: green; font-weight: bold;">setFormatAsInline</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H3&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;HGROUP&quot;, &quot;H1&quot;, &quot;H2&quot;, &quot;H3&quot;, &quot;H4&quot;, &quot;H5&quot;, &quot;H6&quot;).<span style="color: green; font-weight: bold;">setFormatAsInline</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H4&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;HGROUP&quot;, &quot;H1&quot;, &quot;H2&quot;, &quot;H3&quot;, &quot;H4&quot;, &quot;H5&quot;, &quot;H6&quot;).<span style="color: green; font-weight: bold;">setFormatAsInline</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H5&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;HGROUP&quot;, &quot;H1&quot;, &quot;H2&quot;, &quot;H3&quot;, &quot;H4&quot;, &quot;H5&quot;, &quot;H6&quot;).<span style="color: green; font-weight: bold;">setFormatAsInline</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H6&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;HGROUP&quot;, &quot;H1&quot;, &quot;H2&quot;, &quot;H3&quot;, &quot;H4&quot;, &quot;H5&quot;, &quot;H6&quot;).<span style="color: green; font-weight: bold;">setFormatAsInline</span>();
        createBlock("UL");
</p></li>
<p>
</p></li>
<p>        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TD&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TR&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;THEAD&quot;, &quot;TFOOT&quot;, &quot;TBODY&quot;, &quot;COLGROUP&quot;, &quot;COL&quot;, &quot;TR&quot;, &quot;TH&quot;, &quot;TD&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setIgnoreEnd</span>(&quot;BODY&quot;, &quot;CAPTION&quot;, &quot;COL&quot;, &quot;COLGROUP&quot;, &quot;HTML&quot;).<span style="color: green; font-weight: bold;">setFormatAsInline</span>();
        
</p></li>
<p>        return register(inline);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>            indent(accum, depth, out);
</p></li>
<p>                indent(accum, depth, out);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>            indent(accum, depth, out);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createInline("BASE").setAncestor("HEAD", "BODY").setEmpty();
</p></li>
<p>        createBlock("P").setContainInlineOnly(); // emasculated block?
</p></li>
<p>        createBlock("H2").setAncestor("BODY", "HGROUP").setExcludes("HGROUP", "H1", "H2", "H3", "H4", "H5", "H6");
        createBlock("H3").setAncestor("BODY", "HGROUP").setExcludes("HGROUP", "H1", "H2", "H3", "H4", "H5", "H6");
        createBlock("H4").setAncestor("BODY", "HGROUP").setExcludes("HGROUP", "H1", "H2", "H3", "H4", "H5", "H6");
        createBlock("H5").setAncestor("BODY", "HGROUP").setExcludes("HGROUP", "H1", "H2", "H3", "H4", "H5", "H6");
        createBlock("H6").setAncestor("BODY", "HGROUP").setExcludes("HGROUP", "H1", "H2", "H3", "H4", "H5", "H6");
        createBlock("UL");
</p></li>
<p>
</p></li>
<p>        createBlock("TD").setParent("TR").setExcludes("THEAD", "TFOOT", "TBODY", "COLGROUP", "COL", "TR", "TH", "TD").setOptionalClosing().setIgnoreEnd("BODY", "CAPTION", "COL", "COLGROUP", "HTML");
        
</p></li>
</li>
</ul>
<h2>Commit: 9824d00</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>            accum.append(" />");
</p></li>
<p>            if (!<span style="color: purple; font-weight: bold;">childNodes</span>.<span style="color: green; font-weight: bold;">isEmpty</span>() &amp;&amp; <span style="color: purple; font-weight: bold;">tag</span>.<span style="color: green; font-weight: bold;">canContainBlock</span>())
                indent(accum, depth);
            accum.append("</").append(tagName()).append(">");
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>    private boolean preserveWhitespace = false; // for pre, textarea, script etc
</p></li>
<p>        synchronized (tags) {
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>            accum.append(" />");
</p></li>
<p>            if (tag.canContainBlock()) indent(accum, depth);
            accum.append("</").append(tagName()).append(">");
</p></li>
</li>
</ul>
<h2>Commit: 10cfa04</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        if (isBlock() || (parent() != null && parent().tag().canContainBlock() && siblingIndex() == 0))
</p></li>
<p>        accum
</p></li>
<p>            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(" />");
</p></li>
<p>            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(">");
</p></li>
<p>
</p></li>
<p>        if (!<span style="color: purple; font-weight: bold;">tag</span>.<span style="color: green; font-weight: bold;">isEmpty</span>()) {
            if (<span style="color: purple; font-weight: bold;">tag</span>.<span style="color: green; font-weight: bold;">canContainBlock</span>()) <span style="color: green; font-weight: bold;">indent</span>(<span style="color: purple; font-weight: bold;">accum</span>, <span style="color: purple; font-weight: bold;">depth</span>);
            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&quot;&lt;/&quot;).<span style="color: green; font-weight: bold;">append</span>(<span style="color: green; font-weight: bold;">tagName</span>()).<span style="color: green; font-weight: bold;">append</span>(">");
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>            return null; <span style="color: blue; font-weight: bold;">// root</span>
        
        List<Node> siblings = parentNode.childNodes;
</p></li>
<p>        new <span style="color: red; font-weight: bold;">NodeTraversor</span>(new <span style="color: red; font-weight: bold;">OuterHtmlVisitor</span>(<span style="color: purple; font-weight: bold;">accum</span>)).<span style="color: green; font-weight: bold;">traverse</span>(this);
    }

</p></li>
<p>            this.<span style="color: purple; font-weight: bold;">accum</span> = <span style="color: purple; font-weight: bold;">accum</span>;
        }

</p></li>
<p>            <span style="color: purple; font-weight: bold;">node</span>.<span style="color: green; font-weight: bold;">outerHtmlHead</span>(<span style="color: purple; font-weight: bold;">accum</span>, <span style="color: purple; font-weight: bold;">depth</span>);
        }

</p></li>
<p>            <span style="color: purple; font-weight: bold;">node</span>.<span style="color: green; font-weight: bold;">outerHtmlTail</span>(<span style="color: purple; font-weight: bold;">accum</span>, <span style="color: purple; font-weight: bold;">depth</span>);
        }
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        String html = StringEscapeUtils.escapeHtml(getWholeText());
</p></li>
<p>        accum.append(html);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/Collector.java:</strong><br>
<p>        return elements;
</p></li>
<p>            this.<span style="color: purple; font-weight: bold;">elements</span> = <span style="color: purple; font-weight: bold;">elements</span>;
            this.<span style="color: purple; font-weight: bold;">eval</span> = <span style="color: purple; font-weight: bold;">eval</span>;
        }

</p></li>
<p>            if (<span style="color: purple; font-weight: bold;">node</span> instanceof Element) {
                Element <span style="color: purple; font-weight: bold;">el</span> = (Element) <span style="color: purple; font-weight: bold;">node</span>;
                if (<span style="color: purple; font-weight: bold;">eval</span>.<span style="color: green; font-weight: bold;">matches</span>(<span style="color: purple; font-weight: bold;">el</span>))
                    <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">el</span>);
            }
        }

</p></li>
<p>            <span style="color: blue; font-weight: bold;">// void</span>
        }
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/NodeTraversor.java:</strong><br>
<p>        this.<span style="color: purple; font-weight: bold;">visitor</span> = <span style="color: purple; font-weight: bold;">visitor</span>;
    }

</p></li>
<p>        Node <span style="color: purple; font-weight: bold;">node</span> = <span style="color: purple; font-weight: bold;">root</span>;
        int <span style="color: purple; font-weight: bold;">depth</span> = 0;
        
        while (<span style="color: purple; font-weight: bold;">node</span> != null) {
            <span style="color: purple; font-weight: bold;">visitor</span>.<span style="color: green; font-weight: bold;">head</span>(<span style="color: purple; font-weight: bold;">node</span>, <span style="color: purple; font-weight: bold;">depth</span>);
            if (<span style="color: purple; font-weight: bold;">node</span>.<span style="color: green; font-weight: bold;">childNodes</span>().<span style="color: green; font-weight: bold;">size</span>() &gt; 0) {
                <span style="color: purple; font-weight: bold;">node</span> = <span style="color: purple; font-weight: bold;">node</span>.<span style="color: green; font-weight: bold;">childNode</span>(0);
                <span style="color: purple; font-weight: bold;">depth</span>++;
            } else {
                while (<span style="color: purple; font-weight: bold;">node</span>.<span style="color: green; font-weight: bold;">nextSibling</span>() == null &amp;&amp; <span style="color: purple; font-weight: bold;">depth</span> &gt; 0) {
                    <span style="color: purple; font-weight: bold;">visitor</span>.<span style="color: green; font-weight: bold;">tail</span>(<span style="color: purple; font-weight: bold;">node</span>, <span style="color: purple; font-weight: bold;">depth</span>);
                    <span style="color: purple; font-weight: bold;">node</span> = <span style="color: purple; font-weight: bold;">node</span>.<span style="color: green; font-weight: bold;">parent</span>();
                    <span style="color: purple; font-weight: bold;">depth</span>--;
                }
                <span style="color: purple; font-weight: bold;">visitor</span>.<span style="color: green; font-weight: bold;">tail</span>(<span style="color: purple; font-weight: bold;">node</span>, <span style="color: purple; font-weight: bold;">depth</span>);
                if (<span style="color: purple; font-weight: bold;">node</span> == <span style="color: purple; font-weight: bold;">root</span>)
                    break;
                <span style="color: purple; font-weight: bold;">node</span> = <span style="color: purple; font-weight: bold;">node</span>.<span style="color: green; font-weight: bold;">nextSibling</span>();
            }
        }
    }
}
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        if (isBlock() || (parent() != null && parent().tag().canContainBlock() && siblingIndex() == 0))
</p></li>
<p>        accum
</p></li>
<p>            <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(" />");
</p></li>
<p>            accum.append(">");
</p></li>
<p>            if (tag.canContainBlock()) indent(accum);
            accum.append("</").append(tagName()).append(">");
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        String html = StringEscapeUtils.escapeHtml(getWholeText());
</p></li>
<p>        accum.append(html);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/Collector.java:</strong><br>
<p>        return elements;
</p></li>
<p>        if (eval.matches(<span style="color: purple; font-weight: bold;">element</span>))
            elements.add(<span style="color: purple; font-weight: bold;">element</span>);
        for (Element <span style="color: purple; font-weight: bold;">child</span>: <span style="color: purple; font-weight: bold;">element</span>.<span style="color: green; font-weight: bold;">children</span>())
            <span style="color: green; font-weight: bold;">accumulateMatches</span>(<span style="color: purple; font-weight: bold;">eval</span>, <span style="color: purple; font-weight: bold;">elements</span>, <span style="color: purple; font-weight: bold;">child</span>);
    }
</p></li>
</li>
</ul>
<h2>Commit: a52e669</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>            <span style="color: green; font-weight: bold;">indent</span>(<span style="color: purple; font-weight: bold;">accum</span>);
        accum
</p></li>
<p>            accum.append("</").append(tagName()).append(">");
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        return <span style="color: green; font-weight: bold;">indexInList</span>(this, <span style="color: green; font-weight: bold;">parent</span>().<span style="color: purple; font-weight: bold;">childNodes</span>);
    }

    protected static <N extends Node> Integer indexInList(N search, List<N> nodes) {
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>            <span style="color: green; font-weight: bold;">indent</span>(<span style="color: purple; font-weight: bold;">accum</span>);
        accum.append(html);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;NOSCRIPT&quot;).setAncestor(&quot;HEAD&quot;, &quot;BODY&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;STYLE&quot;).setAncestor(&quot;HEAD&quot;, &quot;BODY&quot;).setContainDataOnly();
        <span style="color: green; font-weight: bold;">createBlock</span>("META").setAncestor("HEAD", "BODY").setEmpty();
        createBlock("LINK").setAncestor("HEAD", "BODY").setEmpty(); // only within head
</p></li>
<p>        createInline("BASE").setAncestor("HEAD", "BODY").setEmpty();
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        accum
</p></li>
<p>                <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>("\n");
            html(accum);
</p></li>
<p>                <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>("\n");
        }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        <span style="color: green; font-weight: bold;">createInline</span>(&quot;NOSCRIPT&quot;).setAncestor(&quot;HEAD&quot;, &quot;BODY&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;STYLE&quot;).setAncestor(&quot;HEAD&quot;, &quot;BODY&quot;).setContainDataOnly();
        <span style="color: green; font-weight: bold;">createInline</span>("META").setAncestor("HEAD", "BODY").setEmpty();
        createBlock("LINK").setAncestor("HEAD", "BODY").setEmpty(); // only within head
</p></li>
<p>        createInline("BASE").setAncestor("HEAD", "BODY").setEmpty();
</p></li>
</li>
</ul>
<h2>Commit: 62ea04e</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        accum
</p></li>
<p>                <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>("\n");
            html(accum);
</p></li>
<p>                <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>("\n");
        }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>            <span style="color: purple; font-weight: bold;">html</span> = <span style="color: green; font-weight: bold;">normaliseWhitespace</span>(<span style="color: purple; font-weight: bold;">html</span>);
        }

</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>            html = <span style="color: green; font-weight: bold;">normaliseWhitespace</span>(<span style="color: purple; font-weight: bold;">html</span>).<span style="color: green; font-weight: bold;">trim</span>();

</p></li>
</li>
</ul>
<h2>Commit: 7898cdf</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        accum
</p></li>
<p>            accum.append("</").append(tagName()).append(">");
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        StringBuilder <span style="color: purple; font-weight: bold;">accum</span> = new <span style="color: red; font-weight: bold;">StringBuilder</span>();
        <span style="color: green; font-weight: bold;">outerHtml</span>(<span style="color: purple; font-weight: bold;">accum</span>);
        return <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">toString</span>();
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        String <span style="color: purple; font-weight: bold;">html</span> = <span style="color: purple; font-weight: bold;">StringEscapeUtils</span>.<span style="color: green; font-weight: bold;">escapeHtml</span>(<span style="color: green; font-weight: bold;">getWholeText</span>());
        if (<span style="color: green; font-weight: bold;">parent</span>() instanceof Element &amp;&amp; !((Element) <span style="color: green; font-weight: bold;">parent</span>()).<span style="color: green; font-weight: bold;">tag</span>().<span style="color: green; font-weight: bold;">preserveWhitespace</span>())
            <span style="color: purple; font-weight: bold;">html</span> = <span style="color: green; font-weight: bold;">normaliseWhitespace</span>(<span style="color: purple; font-weight: bold;">html</span>).<span style="color: green; font-weight: bold;">trim</span>();

        <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">html</span>);
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p><span style="color: blue; font-weight: bold;">     * Get the outer HTML for this element. E.g. on a {@code div} with one empty {@code p}, would return
     * {@code &lt;div&gt;&lt;p&gt;&lt;/p&gt;&lt;/div&gt;}.
     * 
     * @return the outer HTML
     * @see #html()
     */</span>
    public String outerHtml() {
        StringBuilder <span style="color: purple; font-weight: bold;">accum</span> = new <span style="color: red; font-weight: bold;">StringBuilder</span>();
        accum
</p></li>
<p>            accum.append("</").append(tagName()).append(">");
</p></li>
<p>        return <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">toString</span>();
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        return <span style="color: purple; font-weight: bold;">StringEscapeUtils</span>.<span style="color: green; font-weight: bold;">escapeHtml</span>(<span style="color: green; font-weight: bold;">getWholeText</span>());
    }
</p></li>
</li>
</ul>
<h2>Commit: 0e4c8bf</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        StringBuilder accum = new StringBuilder();
</p></li>
<p>            accum.append("</").append(tagName()).append(">");
</p></li>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        return StringEscapeUtils.escapeHtml(getWholeText());
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        StringBuilder accum = new StringBuilder();
</p></li>
<p>                accum.append(node.<span style="color: green; font-weight: bold;">html</span>());
            accum.append("</").append(tagName()).append(">");
</p></li>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        return StringEscapeUtils.escapeHtml(getWholeText());
</p></li>
</li>
</ul>
<h2>Commit: d94f56c</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>            )))
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>            )))
</p></li>
</li>
</ul>
<h2>Commit: e8e29ca</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: ffde882</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>    public Element <span style="color: green; font-weight: bold;">parent</span>() {
        return (Element) super.<span style="color: green; font-weight: bold;">parent</span>();
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        Integer <span style="color: purple; font-weight: bold;">index</span> = <span style="color: green; font-weight: bold;">indexInList</span>(this, <span style="color: purple; font-weight: bold;">siblings</span>);
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">index</span>);
        if (<span style="color: purple; font-weight: bold;">siblings</span>.<span style="color: green; font-weight: bold;">size</span>() &gt; <span style="color: purple; font-weight: bold;">index</span>+1)
            return <span style="color: purple; font-weight: bold;">siblings</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">index</span>+1);
        else
            return null;
    }
</p></li>
<p>        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">search</span>);
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">nodes</span>);

        for (int <span style="color: purple; font-weight: bold;">i</span> = 0; <span style="color: purple; font-weight: bold;">i</span> &lt; <span style="color: purple; font-weight: bold;">nodes</span>.<span style="color: green; font-weight: bold;">size</span>(); <span style="color: purple; font-weight: bold;">i</span>++) {
            N <span style="color: purple; font-weight: bold;">node</span> = <span style="color: purple; font-weight: bold;">nodes</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">i</span>);
            if (<span style="color: purple; font-weight: bold;">node</span>.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">search</span>))
                return <span style="color: purple; font-weight: bold;">i</span>;
        }
        return null;
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        return null;
    }
</p></li>
<p>        return null;
</p></li>
</li>
</ul>
<h2>Commit: 1fd0a61</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        <span style="color: blue; font-weight: bold;">// looks only at this element and one level up, to prevent recursion &amp; needless stack searches</span>
        if (<span style="color: purple; font-weight: bold;">node</span> != null &amp;&amp; <span style="color: purple; font-weight: bold;">node</span> instanceof Element) {
            Element <span style="color: purple; font-weight: bold;">element</span> = (Element) <span style="color: purple; font-weight: bold;">node</span>;
            return element.tag.<span style="color: green; font-weight: bold;">preserveWhitespace</span>() ||
                <span style="color: purple; font-weight: bold;">element</span>.<span style="color: green; font-weight: bold;">parent</span>() != null &amp;&amp; <span style="color: purple; font-weight: bold;">element</span>.<span style="color: green; font-weight: bold;">parent</span>().<span style="color: purple; font-weight: bold;">tag</span>.<span style="color: green; font-weight: bold;">preserveWhitespace</span>();
        }
        return false;
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>            html = normaliseWhitespace(html);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        return <span style="color: purple; font-weight: bold;">tag</span>.<span style="color: green; font-weight: bold;">preserveWhitespace</span>() || <span style="color: green; font-weight: bold;">parent</span>() != null &amp;&amp; <span style="color: green; font-weight: bold;">parent</span>().<span style="color: green; font-weight: bold;">preserveWhitespace</span>();
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>            html = normaliseWhitespace(html);
</p></li>
</li>
</ul>
<h2>Commit: 496e6a1</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        return <span style="color: purple; font-weight: bold;">tag</span>.<span style="color: green; font-weight: bold;">preserveWhitespace</span>() || <span style="color: green; font-weight: bold;">parent</span>() != null &amp;&amp; <span style="color: green; font-weight: bold;">parent</span>().<span style="color: green; font-weight: bold;">preserveWhitespace</span>();
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>            html = normaliseWhitespace(html);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>            html = normaliseWhitespace(html);
</p></li>
</li>
</ul>
<h2>Commit: f31916f</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        return Selector.select(<span style="color: purple; font-weight: bold;">cssQuery</span>, this);
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        return Selector.select(<span style="color: purple; font-weight: bold;">query</span>, this);
    }
</p></li>
</li>
</ul>
<h2>Commit: e4ff08f</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        return Selector.select(query, this);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/Elements.java:</strong><br>
<p>        contents = new ArrayList<Element>();
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        return new Selector(query, root).select();
</p></li>
<p>        tq.consumeWhitespace();
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        return Selector.select(query, this);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/ElementList.java:</strong><br>
<p>        contents = new ArrayList<Element>();
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        return new Selector(query, root).select();
</p></li>
<p>        tq.consumeWhitespace();
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: 0402525</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        return <span style="color: purple; font-weight: bold;">Selector</span>.<span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">query</span>, this);
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>        Validate.notNull(data);
</p></li>
<p>        return queue.isEmpty();
</p></li>
<p>        int len = seq.length();
</p></li>
<p>        for (String <span style="color: purple; font-weight: bold;">s</span> : <span style="color: purple; font-weight: bold;">seq</span>) {
            if (<span style="color: green; font-weight: bold;">matches</span>(<span style="color: purple; font-weight: bold;">s</span>))
                return true;
        }
        return false;
    }

</p></li>
<p>        if (matches(seq)) {
</p></li>
<p>        return !<span style="color: purple; font-weight: bold;">queue</span>.<span style="color: green; font-weight: bold;">isEmpty</span>() &amp;&amp; <span style="color: purple; font-weight: bold;">Character</span>.<span style="color: green; font-weight: bold;">isWhitespace</span>(<span style="color: purple; font-weight: bold;">queue</span>.<span style="color: green; font-weight: bold;">peek</span>());
    }

</p></li>
<p>        return !<span style="color: purple; font-weight: bold;">queue</span>.<span style="color: green; font-weight: bold;">isEmpty</span>() &amp;&amp; <span style="color: purple; font-weight: bold;">Character</span>.<span style="color: green; font-weight: bold;">isLetterOrDigit</span>(<span style="color: purple; font-weight: bold;">queue</span>.<span style="color: green; font-weight: bold;">peek</span>());
    }

</p></li>
<p>        while (!queue.isEmpty() && Character.isWhitespace(queue.peekFirst())) {
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/ElementList.java:</strong><br>
<p>        <span style="color: purple; font-weight: bold;">contents</span> = new <span style="color: red; font-weight: bold;">ArrayList&lt;Element&gt;</span>();
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">query</span>);
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">root</span>);

        this.<span style="color: purple; font-weight: bold;">elements</span> = new <span style="color: red; font-weight: bold;">ElementList</span>();
        this.<span style="color: purple; font-weight: bold;">query</span> = <span style="color: purple; font-weight: bold;">query</span>.<span style="color: green; font-weight: bold;">trim</span>();
        this.<span style="color: purple; font-weight: bold;">root</span> = <span style="color: purple; font-weight: bold;">root</span>;
        this.<span style="color: purple; font-weight: bold;">tq</span> = new <span style="color: red; font-weight: bold;">TokenQueue</span>(<span style="color: purple; font-weight: bold;">query</span>);
    }

</p></li>
<p>        return new <span style="color: red; font-weight: bold;">Selector</span>(<span style="color: purple; font-weight: bold;">query</span>, <span style="color: purple; font-weight: bold;">root</span>).<span style="color: green; font-weight: bold;">select</span>();
    }

</p></li>
<p>        <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consumeWhitespace</span>();
        while (!<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">isEmpty</span>()) {
            if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;#&quot;)) {
                <span style="color: green; font-weight: bold;">byId</span>();
            } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;.&quot;)) {
                <span style="color: green; font-weight: bold;">byClass</span>();
            } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchesWord</span>()) {
                <span style="color: green; font-weight: bold;">byTag</span>();
            } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;[&quot;)) {
                <span style="color: green; font-weight: bold;">byAttribute</span>();
            } else { <span style="color: blue; font-weight: bold;">// unhandled</span>
                throw new <span style="color: red; font-weight: bold;">SelectorParseException</span>(&quot;Could not parse query &quot; + <span style="color: purple; font-weight: bold;">query</span>);
            }
        }
        return <span style="color: purple; font-weight: bold;">elements</span>;
    }

    private void <span style="color: green; font-weight: bold;">byId</span>() {
        String <span style="color: purple; font-weight: bold;">id</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consumeWord</span>();
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">id</span>);

        Element <span style="color: purple; font-weight: bold;">found</span> = <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementById</span>(<span style="color: purple; font-weight: bold;">id</span>);
        if(<span style="color: purple; font-weight: bold;">found</span> != null)
            <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">found</span>);
    }

    private void <span style="color: green; font-weight: bold;">byClass</span>() {
        String <span style="color: purple; font-weight: bold;">className</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consumeClassName</span>();
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">className</span>);

        List&lt;Element&gt; <span style="color: purple; font-weight: bold;">found</span> = <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsWithClass</span>(<span style="color: purple; font-weight: bold;">className</span>);
        <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">found</span>);
    }

    private void <span style="color: green; font-weight: bold;">byTag</span>() {
        String <span style="color: purple; font-weight: bold;">tagName</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consumeWord</span>();
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">tagName</span>);

        <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByTag</span>(<span style="color: purple; font-weight: bold;">tagName</span>));
    }

    private void <span style="color: green; font-weight: bold;">byAttribute</span>() {
        String <span style="color: purple; font-weight: bold;">key</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consumeToAny</span>(&quot;=&quot;, &quot;]&quot;);
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">key</span>);
        String <span style="color: purple; font-weight: bold;">value</span> = null;
        if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;=&quot;))
            <span style="color: purple; font-weight: bold;">value</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>(&quot;]&quot;);
        else
            <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consume</span>(&quot;]&quot;);

        if (<span style="color: purple; font-weight: bold;">value</span> != null)
            <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsWithAttributeValue</span>(<span style="color: purple; font-weight: bold;">key</span>, <span style="color: purple; font-weight: bold;">value</span>));
        else {
            <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsWithAttribute</span>(<span style="color: purple; font-weight: bold;">key</span>));
        }

    }

    public static class <span style="color: red; font-weight: bold;">SelectorParseException</span> extends <span style="color: red; font-weight: bold;">IllegalStateException</span> {
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>        Validate.notNull(data);
</p></li>
<p>        return queue.isEmpty();
</p></li>
<p>        int len = seq.length();
</p></li>
<p>        if (matches(seq)) {
</p></li>
<p>        while (!queue.isEmpty() && Character.isWhitespace(queue.peekFirst())) {
</p></li>
</li>
</ul>
<h2>Commit: e2c62cd</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        return tag;
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Element.java:</strong><br>
<p>        return tag;
</p></li>
</li>
</ul>
<h2>Commit: 528b793</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>        <span style="color: blue; font-weight: bold;">/** Default HTML output entities. */</span>
</p></li>
<p>        <span style="color: blue; font-weight: bold;">/** Complete HTML entities. */</span>
</p></li>
<p>
</p></li>
<p>            {"quot", 0x00022},
</p></li>
<p>        baseByVal = new HashMap<Character, String>(baseArray.length);
</p></li>
<p>            Character c = Character.valueOf((char) ((Integer) entity[1]).intValue());
</p></li>
<p>        }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>
</p></li>
<p>            {"quot", 0x00022},
</p></li>
<p>        baseByVal = new HashMap<Character, String>(baseArray.length);
</p></li>
<p>            Character c = Character.valueOf((char) ((Integer) entity[1]).intValue());
</p></li>
<p>        }
</p></li>
</li>
</ul>
<h2>Commit: f4f2efb</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>
</p></li>
<p>            this.<span style="color: purple; font-weight: bold;">map</span> = <span style="color: purple; font-weight: bold;">map</span>;
        }

</p></li>
<p>            return <span style="color: purple; font-weight: bold;">map</span>;
        }
    }
</p></li>
<p>
</p></li>
<p>            {"quot", 0x00022},
            {"amp", 0x00026},
            {"apos", 0x00027},
            {"lt", 0x0003C},
            {"gt", 0x0003E}
    };

</p></li>
<p>        baseByVal = new HashMap<Character, String>(baseArray.length);
</p></li>
<p>            Character <span style="color: purple; font-weight: bold;">c</span> = <span style="color: purple; font-weight: bold;">Character</span>.<span style="color: green; font-weight: bold;">valueOf</span>((char) ((Integer) <span style="color: purple; font-weight: bold;">entity</span>[1]).<span style="color: green; font-weight: bold;">intValue</span>());
            <span style="color: purple; font-weight: bold;">minimumByVal</span>.<span style="color: green; font-weight: bold;">put</span>(<span style="color: purple; font-weight: bold;">c</span>, ((String) <span style="color: purple; font-weight: bold;">entity</span>[0]));
        }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>    }
</p></li>
<p>
</p></li>
</li>
</ul>
<h2>Commit: 472c7e5</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>        <span style="color: purple; font-weight: bold;">baseByVal</span> = <span style="color: green; font-weight: bold;">toCharacterKey</span>(<span style="color: green; font-weight: bold;">loadEntities</span>(&quot;entities-base.properties&quot;)); <span style="color: blue; font-weight: bold;">// most common / default</span>
        <span style="color: purple; font-weight: bold;">full</span> = <span style="color: green; font-weight: bold;">loadEntities</span>(&quot;entities-full.properties&quot;); <span style="color: blue; font-weight: bold;">// extended and overblown.</span>
        <span style="color: purple; font-weight: bold;">fullByVal</span> = <span style="color: green; font-weight: bold;">toCharacterKey</span>(<span style="color: purple; font-weight: bold;">full</span>);

</p></li>
<p>
</p></li>
<p>        Properties <span style="color: purple; font-weight: bold;">properties</span> = new <span style="color: red; font-weight: bold;">Properties</span>();
        Map&lt;String, Character&gt; <span style="color: purple; font-weight: bold;">entities</span> = new <span style="color: red; font-weight: bold;">HashMap&lt;String, Character&gt;</span>();
        try {
            InputStream <span style="color: purple; font-weight: bold;">in</span> = Entities.class.<span style="color: green; font-weight: bold;">getResourceAsStream</span>(<span style="color: purple; font-weight: bold;">filename</span>);
            <span style="color: purple; font-weight: bold;">properties</span>.<span style="color: green; font-weight: bold;">load</span>(<span style="color: purple; font-weight: bold;">in</span>);
            <span style="color: purple; font-weight: bold;">in</span>.<span style="color: green; font-weight: bold;">close</span>();
        } catch (IOException <span style="color: purple; font-weight: bold;">e</span>) {
            throw new <span style="color: red; font-weight: bold;">MissingResourceException</span>(&quot;Error loading entities resource: &quot; + <span style="color: purple; font-weight: bold;">e</span>.<span style="color: green; font-weight: bold;">getMessage</span>(), &quot;Entities&quot;, <span style="color: purple; font-weight: bold;">filename</span>);
        }
</p></li>
<p>        for (Map.Entry <span style="color: purple; font-weight: bold;">entry</span>: <span style="color: purple; font-weight: bold;">properties</span>.<span style="color: green; font-weight: bold;">entrySet</span>()) {
            Character <span style="color: purple; font-weight: bold;">val</span> = <span style="color: purple; font-weight: bold;">Character</span>.<span style="color: green; font-weight: bold;">valueOf</span>((char) <span style="color: purple; font-weight: bold;">Integer</span>.<span style="color: green; font-weight: bold;">parseInt</span>((String) <span style="color: purple; font-weight: bold;">entry</span>.<span style="color: green; font-weight: bold;">getValue</span>(), 16));
            String <span style="color: purple; font-weight: bold;">name</span> = (String) <span style="color: purple; font-weight: bold;">entry</span>.<span style="color: green; font-weight: bold;">getKey</span>();
            <span style="color: purple; font-weight: bold;">entities</span>.<span style="color: green; font-weight: bold;">put</span>(<span style="color: purple; font-weight: bold;">name</span>, <span style="color: purple; font-weight: bold;">val</span>);
        }
</p></li>
<p>    }
</p></li>
<p>        Map&lt;Character, String&gt; <span style="color: purple; font-weight: bold;">outMap</span> = new <span style="color: red; font-weight: bold;">HashMap&lt;Character, String&gt;</span>();
        for (Map.Entry&lt;String, Character&gt; <span style="color: purple; font-weight: bold;">entry</span>: <span style="color: purple; font-weight: bold;">inMap</span>.<span style="color: green; font-weight: bold;">entrySet</span>()) {
            Character <span style="color: purple; font-weight: bold;">character</span> = <span style="color: purple; font-weight: bold;">entry</span>.<span style="color: green; font-weight: bold;">getValue</span>();
            String <span style="color: purple; font-weight: bold;">name</span> = <span style="color: purple; font-weight: bold;">entry</span>.<span style="color: green; font-weight: bold;">getKey</span>();

</p></li>
<p>                <span style="color: blue; font-weight: bold;">// dupe, prefer the lower case version</span>
                if (<span style="color: purple; font-weight: bold;">name</span>.<span style="color: green; font-weight: bold;">toLowerCase</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">name</span>))
                    <span style="color: purple; font-weight: bold;">outMap</span>.<span style="color: green; font-weight: bold;">put</span>(<span style="color: purple; font-weight: bold;">character</span>, <span style="color: purple; font-weight: bold;">name</span>);
            } else {
                <span style="color: purple; font-weight: bold;">outMap</span>.<span style="color: green; font-weight: bold;">put</span>(<span style="color: purple; font-weight: bold;">character</span>, <span style="color: purple; font-weight: bold;">name</span>);
            }
        }
        return <span style="color: purple; font-weight: bold;">outMap</span>;
    }
}
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>        xhtmlByVal = new HashMap&lt;Character, String&gt;(xhtmlArray.length);
        <span style="color: purple; font-weight: bold;">baseByVal</span> = new <span style="color: red; font-weight: bold;">HashMap&lt;Character, String&gt;</span>(baseArray.length);
        <span style="color: purple; font-weight: bold;">fullByVal</span> = new <span style="color: red; font-weight: bold;">HashMap&lt;Character, String&gt;</span>(fullArray.length);

</p></li>
<p>            Character <span style="color: purple; font-weight: bold;">c</span> = <span style="color: purple; font-weight: bold;">Character</span>.<span style="color: green; font-weight: bold;">valueOf</span>((char) ((Integer) <span style="color: purple; font-weight: bold;">entity</span>[1]).<span style="color: green; font-weight: bold;">intValue</span>());
            <span style="color: purple; font-weight: bold;">baseByVal</span>.<span style="color: green; font-weight: bold;">put</span>(<span style="color: purple; font-weight: bold;">c</span>, ((String) <span style="color: purple; font-weight: bold;">entity</span>[0]));
        }
</p></li>
<p>            Character <span style="color: purple; font-weight: bold;">c</span> = <span style="color: purple; font-weight: bold;">Character</span>.<span style="color: green; font-weight: bold;">valueOf</span>((char) ((Integer) <span style="color: purple; font-weight: bold;">entity</span>[1]).<span style="color: green; font-weight: bold;">intValue</span>());
            <span style="color: purple; font-weight: bold;">full</span>.<span style="color: green; font-weight: bold;">put</span>((String) <span style="color: purple; font-weight: bold;">entity</span>[0], <span style="color: purple; font-weight: bold;">c</span>);
            <span style="color: purple; font-weight: bold;">fullByVal</span>.<span style="color: green; font-weight: bold;">put</span>(<span style="color: purple; font-weight: bold;">c</span>, ((String) <span style="color: purple; font-weight: bold;">entity</span>[0]));
        }
</p></li>
</li>
</ul>
<h2>Commit: 17486e2</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/Entities.java:</strong><br>
<p>    static final Map&lt;String, Integer&gt; <span style="color: purple; font-weight: bold;">base</span>;
    static final Map&lt;String, Integer&gt; <span style="color: purple; font-weight: bold;">full</span>;
    static final Map&lt;Integer, String&gt; <span style="color: purple; font-weight: bold;">fullByVal</span>;

</p></li>
<p>        <span style="color: blue; font-weight: bold;">// todo: this needs option to: use base names only (with numerical as fallback)</span>
        StringBuilder <span style="color: purple; font-weight: bold;">accum</span> = new <span style="color: red; font-weight: bold;">StringBuilder</span>((int) (<span style="color: purple; font-weight: bold;">string</span>.<span style="color: green; font-weight: bold;">length</span>() * 1.5));
        CharsetEncoder <span style="color: purple; font-weight: bold;">encoder</span> = <span style="color: purple; font-weight: bold;">charset</span>.<span style="color: green; font-weight: bold;">newEncoder</span>();

        for (int <span style="color: purple; font-weight: bold;">pos</span> = 0; <span style="color: purple; font-weight: bold;">pos</span> &lt; <span style="color: purple; font-weight: bold;">string</span>.<span style="color: green; font-weight: bold;">length</span>(); <span style="color: purple; font-weight: bold;">pos</span>++) {
            Character <span style="color: purple; font-weight: bold;">c</span> = <span style="color: purple; font-weight: bold;">string</span>.<span style="color: green; font-weight: bold;">charAt</span>(<span style="color: purple; font-weight: bold;">pos</span>);
            if (<span style="color: purple; font-weight: bold;">fullByVal</span>.<span style="color: green; font-weight: bold;">containsKey</span>((int) <span style="color: purple; font-weight: bold;">c</span>))
                <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&quot;&amp;&quot;).<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">fullByVal</span>.<span style="color: green; font-weight: bold;">get</span>((int) <span style="color: purple; font-weight: bold;">c</span>)).<span style="color: green; font-weight: bold;">append</span>(&quot;;&quot;);
            else if (<span style="color: purple; font-weight: bold;">encoder</span>.<span style="color: green; font-weight: bold;">canEncode</span>(<span style="color: purple; font-weight: bold;">c</span>))
                <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">c</span>);
            else
                <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&quot;&amp;#&quot;).<span style="color: green; font-weight: bold;">append</span>((int)<span style="color: purple; font-weight: bold;">c</span>).<span style="color: green; font-weight: bold;">append</span>(";");
        }
</p></li>
<p>        <span style="color: purple; font-weight: bold;">full</span> = new <span style="color: red; font-weight: bold;">HashMap&lt;String, Integer&gt;</span>(fullArray.length);
        <span style="color: purple; font-weight: bold;">fullByVal</span> = new <span style="color: red; font-weight: bold;">HashMap&lt;Integer, String&gt;</span>(fullArray.length);

</p></li>
<p>        for (Object[] <span style="color: purple; font-weight: bold;">entity</span> : <span style="color: purple; font-weight: bold;">fullArray</span>) {
            <span style="color: purple; font-weight: bold;">full</span>.<span style="color: green; font-weight: bold;">put</span>(((String) <span style="color: purple; font-weight: bold;">entity</span>[0]).<span style="color: green; font-weight: bold;">toLowerCase</span>(), (Integer) <span style="color: purple; font-weight: bold;">entity</span>[1]);
            <span style="color: purple; font-weight: bold;">fullByVal</span>.<span style="color: green; font-weight: bold;">put</span>((Integer) <span style="color: purple; font-weight: bold;">entity</span>[1], ((String) <span style="color: purple; font-weight: bold;">entity</span>[0]));
        }
    }

</p></li>
<p>}
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: a31ec08</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>        <span style="color: purple; font-weight: bold;">baseByVal</span> = <span style="color: green; font-weight: bold;">toCharacterKey</span>(<span style="color: purple; font-weight: bold;">base</span>);
        full = loadEntities("entities-full.properties"); // extended and overblown.
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>        full = loadEntities("entities-full.properties"); // extended and overblown.
</p></li>
</li>
</ul>
<h2>Commit: 5e52f1b</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>        }
</p></li>
<p>        }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>            <span style="color: purple; font-weight: bold;">baseByVal</span>.<span style="color: green; font-weight: bold;">put</span>(<span style="color: purple; font-weight: bold;">c</span>, ((String) <span style="color: purple; font-weight: bold;">entity</span>[0]).<span style="color: green; font-weight: bold;">toLowerCase</span>());
        }
</p></li>
<p>        }
</p></li>
</li>
</ul>
<h2>Commit: ff329d5</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>    public enum EscapeMode {
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>    public enum EscapeMode {
</p></li>
</li>
</ul>
<h2>Commit: 09d99e7</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>    public enum EscapeMode {
</p></li>
<p>            else if (encoder.canEncode(c))
</p></li>
<p>            else
</p></li>
<p>        }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>                <span style="color: purple; font-weight: bold;">node</span>.<span style="color: green; font-weight: bold;">outerHtmlTail</span>(<span style="color: purple; font-weight: bold;">accum</span>, <span style="color: purple; font-weight: bold;">depth</span>, <span style="color: purple; font-weight: bold;">out</span>);
        }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>    public enum EscapeMode {
</p></li>
<p>            else if (encoder.canEncode(c))
</p></li>
<p>            else
</p></li>
<p>        }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        }
</p></li>
</li>
</ul>
<h2>Commit: a991deb</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>            } else {
</p></li>
<p>            }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>            } else {
</p></li>
<p>            }
</p></li>
</li>
</ul>
<h2>Commit: ae51709</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>            } else {
</p></li>
<p>            }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>            } else {
</p></li>
<p>            }
</p></li>
</li>
</ul>
<h2>Commit: 43cd48b</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>            <span style="color: blue; font-weight: bold;">// surrogate pairs, split implementation for efficiency on single char common case (saves creating strings, char[]):</span>
            if (<span style="color: purple; font-weight: bold;">codePoint</span> &lt; Character.MIN_SUPPLEMENTARY_CODE_POINT) {
                final char <span style="color: purple; font-weight: bold;">c</span> = (char) <span style="color: purple; font-weight: bold;">codePoint</span>;
                if (<span style="color: purple; font-weight: bold;">map</span>.<span style="color: green; font-weight: bold;">containsKey</span>(<span style="color: purple; font-weight: bold;">c</span>))
                    <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&#x27;&amp;&#x27;).<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">map</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">c</span>)).<span style="color: green; font-weight: bold;">append</span>(&#x27;;&#x27;);
                else if (<span style="color: purple; font-weight: bold;">encoder</span>.<span style="color: green; font-weight: bold;">canEncode</span>(<span style="color: purple; font-weight: bold;">c</span>))
                    <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">c</span>);
                else
                    <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&quot;&amp;#&quot;).<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">codePoint</span>).<span style="color: green; font-weight: bold;">append</span>(&#x27;;&#x27;);
            } else {
                final String <span style="color: purple; font-weight: bold;">c</span> = new <span style="color: red; font-weight: bold;">String</span>(<span style="color: purple; font-weight: bold;">Character</span>.<span style="color: green; font-weight: bold;">toChars</span>(<span style="color: purple; font-weight: bold;">codePoint</span>));
                if (<span style="color: purple; font-weight: bold;">encoder</span>.<span style="color: green; font-weight: bold;">canEncode</span>(<span style="color: purple; font-weight: bold;">c</span>))
                    <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">c</span>);
                else
                    <span style="color: purple; font-weight: bold;">accum</span>.<span style="color: green; font-weight: bold;">append</span>(&quot;&amp;#&quot;).<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">codePoint</span>).<span style="color: green; font-weight: bold;">append</span>(';');
            }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Token.java:</strong><br>
<p>            pendingAttributeValue.append(append);
        }
</p></li>
<p>            if (<span style="color: purple; font-weight: bold;">pendingAttributeValue</span> == null)
                <span style="color: purple; font-weight: bold;">pendingAttributeValue</span> = new <span style="color: red; font-weight: bold;">StringBuilder</span>();
        }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TokeniserState.java:</strong><br>
<p>            }
</p></li>
<p>            }
</p></li>
<p>                        t.tagPending.appendAttributeValue(<span style="color: purple; font-weight: bold;">ref</span>);
                    else
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>        final int length = string.length();
</p></li>
<p>
            if (chars.length==1 &amp;&amp; <span style="color: purple; font-weight: bold;">map</span>.<span style="color: green; font-weight: bold;">containsKey</span>(<span style="color: purple; font-weight: bold;">chars</span>[0]))
                accum.append(&#x27;&amp;&#x27;).append(map.get(<span style="color: purple; font-weight: bold;">chars</span>[0])).append(&#x27;;&#x27;);
            else if (encoder.canEncode(new <span style="color: red; font-weight: bold;">String</span>(<span style="color: purple; font-weight: bold;">chars</span>)))
                accum.append(new <span style="color: red; font-weight: bold;">String</span>(<span style="color: purple; font-weight: bold;">chars</span>));
            else
                accum.append("&#").append(codePoint).append(';');

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Token.java:</strong><br>
<p>        }
</p></li>
<p>        }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TokeniserState.java:</strong><br>
<p>            }
</p></li>
<p>            }
</p></li>
<p>                        t.tagPending.appendAttributeValue(new <span style="color: red; font-weight: bold;">String</span>(<span style="color: purple; font-weight: bold;">ref</span>));
                    else
</p></li>
</li>
</ul>
<h2>Commit: c2a9605</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>        final int <span style="color: purple; font-weight: bold;">length</span> = <span style="color: purple; font-weight: bold;">string</span>.<span style="color: green; font-weight: bold;">length</span>();
        for (int <span style="color: purple; font-weight: bold;">offset</span> = 0; <span style="color: purple; font-weight: bold;">offset</span> &lt; <span style="color: purple; font-weight: bold;">length</span>; ) {
            final int <span style="color: purple; font-weight: bold;">codePoint</span> = string.<span style="color: green; font-weight: bold;">codePointAt</span>(<span style="color: purple; font-weight: bold;">offset</span>);
            char[] <span style="color: purple; font-weight: bold;">chars</span> = <span style="color: purple; font-weight: bold;">Character</span>.<span style="color: green; font-weight: bold;">toChars</span>(<span style="color: purple; font-weight: bold;">codePoint</span>);

            if (chars.length==1 &amp;&amp; <span style="color: purple; font-weight: bold;">map</span>.<span style="color: green; font-weight: bold;">containsKey</span>(<span style="color: purple; font-weight: bold;">chars</span>[0]))
                accum.append(&#x27;&amp;&#x27;).append(map.get(<span style="color: purple; font-weight: bold;">chars</span>[0])).append(&#x27;;&#x27;);
            else if (encoder.canEncode(new <span style="color: red; font-weight: bold;">String</span>(<span style="color: purple; font-weight: bold;">chars</span>)))
                accum.append(new <span style="color: red; font-weight: bold;">String</span>(<span style="color: purple; font-weight: bold;">chars</span>));
            else
</p></li>
<p>
            <span style="color: purple; font-weight: bold;">offset</span> += <span style="color: purple; font-weight: bold;">Character</span>.<span style="color: green; font-weight: bold;">charCount</span>(<span style="color: purple; font-weight: bold;">codePoint</span>);
        }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Entities.java:</strong><br>
<p>            Character <span style="color: purple; font-weight: bold;">c</span> = string.<span style="color: green; font-weight: bold;">charAt</span>(<span style="color: purple; font-weight: bold;">pos</span>);
            if (<span style="color: purple; font-weight: bold;">map</span>.<span style="color: green; font-weight: bold;">containsKey</span>(<span style="color: purple; font-weight: bold;">c</span>))
                accum.append(&#x27;&amp;&#x27;).append(map.get(<span style="color: purple; font-weight: bold;">c</span>)).append(&#x27;;&#x27;);
            else if (encoder.canEncode(<span style="color: purple; font-weight: bold;">c</span>))
                accum.append(<span style="color: purple; font-weight: bold;">c</span>.<span style="color: green; font-weight: bold;">charValue</span>());
            else
</p></li>
<p>        }
</p></li>
</li>
</ul>
<h2>Commit: 7eefa1b</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        attributes = null;
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        attributes = null;
</p></li>
</li>
</ul>
<h2>Commit: f548940</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        <span style="color: purple; font-weight: bold;">childNodes</span> = Collections.EMPTY_LIST;
        <span style="color: purple; font-weight: bold;">attributes</span> = null;
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        this.<span style="color: purple; font-weight: bold;">text</span> = <span style="color: purple; font-weight: bold;">text</span>;
    }
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        attributes.put(TEXT_KEY, text);
    }
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: c95216a</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        return <span style="color: purple; font-weight: bold;">Collections</span>.<span style="color: green; font-weight: bold;">unmodifiableList</span>(<span style="color: purple; font-weight: bold;">childNodes</span>);
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        <span style="color: purple; font-weight: bold;">attributes</span>.<span style="color: green; font-weight: bold;">put</span>(<span style="color: purple; font-weight: bold;">TEXT_KEY</span>, <span style="color: purple; font-weight: bold;">text</span>);
    }
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        this.<span style="color: purple; font-weight: bold;">text</span> = <span style="color: purple; font-weight: bold;">text</span>;
    }
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: deaf9f6</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        return <span style="color: purple; font-weight: bold;">childNodes</span>.<span style="color: green; font-weight: bold;">size</span>();
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                            for (Node childNode : childNodes) {
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/NodeTraversor.java:</strong><br>
<p>                node = node.childNode(0);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        <span style="color: blue; font-weight: bold;">// leaving the documentation as is (warning of unmodifiability) to discourage out-of-API modifications</span>
        return <span style="color: purple; font-weight: bold;">childNodes</span>;
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                            for (Node childNode : childNodes) {
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/NodeTraversor.java:</strong><br>
<p>                node = node.childNode(0);
</p></li>
</li>
</ul>
<h2>Commit: 074d9bf</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        <span style="color: blue; font-weight: bold;">// leaving the documentation as is (warning of unmodifiability) to discourage out-of-API modifications</span>
        return <span style="color: purple; font-weight: bold;">childNodes</span>;
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: c07ba8a</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        return ownerDocument() != null ? ownerDocument().outputSettings() : (new Document("")).outputSettings();
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        return ownerDocument() != null ? ownerDocument().outputSettings() : (new Document("")).outputSettings();
</p></li>
</li>
</ul>
<h2>Commit: da9b977</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>    }

</p></li>
<p>        return <span style="color: green; font-weight: bold;">ownerDocument</span>() != null ? <span style="color: green; font-weight: bold;">ownerDocument</span>().<span style="color: green; font-weight: bold;">outputSettings</span>() : (new <span style="color: red; font-weight: bold;">Document</span>(&quot;&quot;)).<span style="color: green; font-weight: bold;">outputSettings</span>();
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: 0ea12d3</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        outerHtml(accum);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        outerHtml(accum);
</p></li>
</li>
</ul>
<h2>Commit: 2ca58b7</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        if (this instanceof Document)
            return (Document) this;
        else if (<span style="color: purple; font-weight: bold;">parentNode</span> == null)
            return null;
        else
            return <span style="color: purple; font-weight: bold;">parentNode</span>.<span style="color: green; font-weight: bold;">ownerDocument</span>();
    }
    
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: d6da0b0</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        return parentNode;
</p></li>
<p>            throw new <span style="color: red; font-weight: bold;">NotImplementedException</span>(&quot;Cannot (yet) move nodes in tree&quot;); <span style="color: blue; font-weight: bold;">// TODO: remove from prev node children</span>
        this.parentNode = parentNode;
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        return parentNode;
</p></li>
</li>
</ul>
<h2>Commit: 2c8b9ad</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        return <span style="color: purple; font-weight: bold;">parentNode</span>;
    }
    
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/NodeTraversor.java:</strong><br>
<p>                    depth--;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/QueryParser.java:</strong><br>
<p>
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/NodeTraversor.java:</strong><br>
<p>                    depth--;
</p></li>
</li>
</ul>
<h2>Commit: 674dab0</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        if (child.parentNode != null)
            child.parentNode.<span style="color: green; font-weight: bold;">removeChild</span>(<span style="color: purple; font-weight: bold;">child</span>);
        <span style="color: purple; font-weight: bold;">child</span>.<span style="color: green; font-weight: bold;">setParentNode</span>(this);
    }
    
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: b0c8d3e</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        return siblingIndex;
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Node.java:</strong><br>
<p>        return siblingIndex;
</p></li>
</li>
</ul>
<h2>Commit: 05faab3</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        Entities.escape(accum, getWholeText(), out, false, normaliseWhite, false);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        Entities.escape(accum, getWholeText(), out, false, normaliseWhite, false);
</p></li>
</li>
</ul>
<h2>Commit: d6fd163</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        String html = Entities.escape(getWholeText(), out);
        if (out.prettyPrint() &amp;&amp; parent() instanceof Element &amp;&amp; !Element.preserveWhitespace((Element) parent()))
            <span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">appendNormalisedWhitespace</span>(<span style="color: purple; font-weight: bold;">accum</span>, <span style="color: purple; font-weight: bold;">html</span>, false);
        else
            accum.append(html);
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>        if (out.prettyPrint() &amp;&amp; parent() instanceof Element &amp;&amp; !Element.preserveWhitespace((Element) parent())) {
            <span style="color: purple; font-weight: bold;">html</span> = <span style="color: green; font-weight: bold;">normaliseWhitespace</span>(<span style="color: purple; font-weight: bold;">html</span>);
        }

        if (out.prettyPrint() && ((siblingIndex() == 0 && parentNode instanceof Element && ((Element) parentNode).tag().formatAsBlock() && !isBlank()) || (out.outline() && siblingNodes().size()>0 && !isBlank()) ))
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: f0f3eab</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>            indent(accum);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/TextNode.java:</strong><br>
<p>            indent(accum);
</p></li>
</li>
</ul>
<h2>Commit: d1b5770</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/CharacterReader.java:</strong><br>
<p>
</p></li>
<p>        final int <span style="color: purple; font-weight: bold;">remaining</span> = <span style="color: purple; font-weight: bold;">length</span>;

</p></li>
<p>            for (char <span style="color: purple; font-weight: bold;">c</span> : <span style="color: purple; font-weight: bold;">chars</span>) {
                if (<span style="color: purple; font-weight: bold;">input</span>[<span style="color: purple; font-weight: bold;">pos</span>] == <span style="color: purple; font-weight: bold;">c</span>)
                    break <span style="color: purple; font-weight: bold;">OUTER</span>;
</p></li>
<p>    }

</p></li>
<p>        final int <span style="color: purple; font-weight: bold;">start</span> = <span style="color: purple; font-weight: bold;">pos</span>;
        final int <span style="color: purple; font-weight: bold;">remaining</span> = <span style="color: purple; font-weight: bold;">length</span>;
        final char[] <span style="color: purple; font-weight: bold;">val</span> = <span style="color: purple; font-weight: bold;">input</span>;

        while (<span style="color: purple; font-weight: bold;">pos</span> &lt; <span style="color: purple; font-weight: bold;">remaining</span>) {
            if (<span style="color: purple; font-weight: bold;">Arrays</span>.<span style="color: green; font-weight: bold;">binarySearch</span>(<span style="color: purple; font-weight: bold;">chars</span>, <span style="color: purple; font-weight: bold;">val</span>[<span style="color: purple; font-weight: bold;">pos</span>]) &gt;= 0)
                break;
            <span style="color: purple; font-weight: bold;">pos</span>++;
        }

        return <span style="color: purple; font-weight: bold;">pos</span> &gt; <span style="color: purple; font-weight: bold;">start</span> ? <span style="color: green; font-weight: bold;">cacheString</span>(<span style="color: purple; font-weight: bold;">start</span>, <span style="color: purple; font-weight: bold;">pos</span>-<span style="color: purple; font-weight: bold;">start</span>) : "";
    }

</p></li>
<p>        <span style="color: blue; font-weight: bold;">// &amp;, &lt;, null</span>
        final int <span style="color: purple; font-weight: bold;">start</span> = <span style="color: purple; font-weight: bold;">pos</span>;
        final int <span style="color: purple; font-weight: bold;">remaining</span> = <span style="color: purple; font-weight: bold;">length</span>;
        final char[] <span style="color: purple; font-weight: bold;">val</span> = <span style="color: purple; font-weight: bold;">input</span>;

        while (<span style="color: purple; font-weight: bold;">pos</span> &lt; <span style="color: purple; font-weight: bold;">remaining</span>) {
            final char <span style="color: purple; font-weight: bold;">c</span> = <span style="color: purple; font-weight: bold;">val</span>[<span style="color: purple; font-weight: bold;">pos</span>];
            if (<span style="color: purple; font-weight: bold;">c</span> == &#x27;&amp;&#x27;|| <span style="color: purple; font-weight: bold;">c</span> ==  &#x27;&lt;&#x27; || <span style="color: purple; font-weight: bold;">c</span> ==  TokeniserState.nullChar)
                break;
            <span style="color: purple; font-weight: bold;">pos</span>++;
        }

        return <span style="color: purple; font-weight: bold;">pos</span> &gt; <span style="color: purple; font-weight: bold;">start</span> ? <span style="color: green; font-weight: bold;">cacheString</span>(<span style="color: purple; font-weight: bold;">start</span>, <span style="color: purple; font-weight: bold;">pos</span>-<span style="color: purple; font-weight: bold;">start</span>) : "";
    }

</p></li>
<p>        <span style="color: blue; font-weight: bold;">// &#x27;\t&#x27;, &#x27;\n&#x27;, &#x27;\r&#x27;, &#x27;\f&#x27;, &#x27; &#x27;, &#x27;/&#x27;, &#x27;&gt;&#x27;, nullChar</span>
        final int <span style="color: purple; font-weight: bold;">start</span> = <span style="color: purple; font-weight: bold;">pos</span>;
        final int <span style="color: purple; font-weight: bold;">remaining</span> = <span style="color: purple; font-weight: bold;">length</span>;
        final char[] <span style="color: purple; font-weight: bold;">val</span> = <span style="color: purple; font-weight: bold;">input</span>;

        while (<span style="color: purple; font-weight: bold;">pos</span> &lt; <span style="color: purple; font-weight: bold;">remaining</span>) {
            final char <span style="color: purple; font-weight: bold;">c</span> = <span style="color: purple; font-weight: bold;">val</span>[<span style="color: purple; font-weight: bold;">pos</span>];
            if (<span style="color: purple; font-weight: bold;">c</span> == &#x27;\t&#x27;|| <span style="color: purple; font-weight: bold;">c</span> ==  &#x27;\n&#x27;|| <span style="color: purple; font-weight: bold;">c</span> ==  &#x27;\r&#x27;|| <span style="color: purple; font-weight: bold;">c</span> ==  &#x27;\f&#x27;|| <span style="color: purple; font-weight: bold;">c</span> ==  &#x27; &#x27;|| <span style="color: purple; font-weight: bold;">c</span> ==  &#x27;/&#x27;|| <span style="color: purple; font-weight: bold;">c</span> ==  &#x27;&gt;&#x27;|| <span style="color: purple; font-weight: bold;">c</span> ==  TokeniserState.nullChar)
                break;
            <span style="color: purple; font-weight: bold;">pos</span>++;
        }

        return <span style="color: purple; font-weight: bold;">pos</span> &gt; <span style="color: purple; font-weight: bold;">start</span> ? <span style="color: green; font-weight: bold;">cacheString</span>(<span style="color: purple; font-weight: bold;">start</span>, <span style="color: purple; font-weight: bold;">pos</span>-<span style="color: purple; font-weight: bold;">start</span>) : "";
    }
</p></li>
<p>        final char[] <span style="color: purple; font-weight: bold;">val</span> = <span style="color: purple; font-weight: bold;">input</span>;
        final String[] <span style="color: purple; font-weight: bold;">cache</span> = <span style="color: purple; font-weight: bold;">stringCache</span>;

        <span style="color: blue; font-weight: bold;">// limit (no cache):</span>
        if (<span style="color: purple; font-weight: bold;">count</span> &gt; <span style="color: purple; font-weight: bold;">maxCacheLen</span>)
            return new <span style="color: red; font-weight: bold;">String</span>(<span style="color: purple; font-weight: bold;">val</span>, <span style="color: purple; font-weight: bold;">start</span>, <span style="color: purple; font-weight: bold;">count</span>);

        <span style="color: blue; font-weight: bold;">// calculate hash:</span>
        int <span style="color: purple; font-weight: bold;">hash</span> = 0;
        int <span style="color: purple; font-weight: bold;">offset</span> = <span style="color: purple; font-weight: bold;">start</span>;
        for (int <span style="color: purple; font-weight: bold;">i</span> = 0; <span style="color: purple; font-weight: bold;">i</span> &lt; <span style="color: purple; font-weight: bold;">count</span>; <span style="color: purple; font-weight: bold;">i</span>++) {
            <span style="color: purple; font-weight: bold;">hash</span> = 31 * <span style="color: purple; font-weight: bold;">hash</span> + <span style="color: purple; font-weight: bold;">val</span>[<span style="color: purple; font-weight: bold;">offset</span>++];
        }

        <span style="color: blue; font-weight: bold;">// get from cache</span>
        final int <span style="color: purple; font-weight: bold;">index</span> = <span style="color: purple; font-weight: bold;">hash</span> &amp; cache.length - 1;
        String <span style="color: purple; font-weight: bold;">cached</span> = <span style="color: purple; font-weight: bold;">cache</span>[<span style="color: purple; font-weight: bold;">index</span>];

        if (<span style="color: purple; font-weight: bold;">cached</span> == null) { <span style="color: blue; font-weight: bold;">// miss, add</span>
            <span style="color: purple; font-weight: bold;">cached</span> = new <span style="color: red; font-weight: bold;">String</span>(<span style="color: purple; font-weight: bold;">val</span>, <span style="color: purple; font-weight: bold;">start</span>, <span style="color: purple; font-weight: bold;">count</span>);
            <span style="color: purple; font-weight: bold;">cache</span>[<span style="color: purple; font-weight: bold;">index</span>] = <span style="color: purple; font-weight: bold;">cached</span>;
        } else { <span style="color: blue; font-weight: bold;">// hashcode hit, check equality</span>
            if (<span style="color: green; font-weight: bold;">rangeEquals</span>(<span style="color: purple; font-weight: bold;">start</span>, <span style="color: purple; font-weight: bold;">count</span>, <span style="color: purple; font-weight: bold;">cached</span>)) {
                <span style="color: blue; font-weight: bold;">// hit</span>
                return <span style="color: purple; font-weight: bold;">cached</span>;
            } else { <span style="color: blue; font-weight: bold;">// hashcode conflict</span>
                <span style="color: purple; font-weight: bold;">cached</span> = new <span style="color: red; font-weight: bold;">String</span>(<span style="color: purple; font-weight: bold;">val</span>, <span style="color: purple; font-weight: bold;">start</span>, <span style="color: purple; font-weight: bold;">count</span>);
            }
        }
        return <span style="color: purple; font-weight: bold;">cached</span>;
    }

</p></li>
<p>        if (<span style="color: purple; font-weight: bold;">count</span> == <span style="color: purple; font-weight: bold;">cached</span>.<span style="color: green; font-weight: bold;">length</span>()) {
            char <span style="color: purple; font-weight: bold;">one</span>[] = <span style="color: purple; font-weight: bold;">input</span>;
            char <span style="color: purple; font-weight: bold;">two</span>[] = <span style="color: purple; font-weight: bold;">cached</span>.<span style="color: green; font-weight: bold;">toCharArray</span>();
            int <span style="color: purple; font-weight: bold;">i</span> = <span style="color: purple; font-weight: bold;">start</span>;
            int <span style="color: purple; font-weight: bold;">j</span> = 0;
            while (<span style="color: purple; font-weight: bold;">count</span>-- != 0) {
                if (<span style="color: purple; font-weight: bold;">one</span>[<span style="color: purple; font-weight: bold;">i</span>++] != <span style="color: purple; font-weight: bold;">two</span>[<span style="color: purple; font-weight: bold;">j</span>++])
                    return false;
            }
            return true;
        }
        return false;
    }
}
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/CharacterReader.java:</strong><br>
<p>
</p></li>
<p>            for (int i = 0; i &lt; chars.length; i++) {
                if (input[pos] == <span style="color: purple; font-weight: bold;">chars</span>[<span style="color: purple; font-weight: bold;">i</span>])
                    break OUTER;
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: 231aab6</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/CharacterReader.java:</strong><br>
<p>        this.length = this.<span style="color: purple; font-weight: bold;">input</span>.<span style="color: purple; font-weight: bold;">length</span>;
    }
</p></li>
<p>    }
</p></li>
<p>        pos++;
</p></li>
<p>        int start = pos;
</p></li>
<p>            for (int <span style="color: purple; font-weight: bold;">i</span> = 0; <span style="color: purple; font-weight: bold;">i</span> &lt; chars.length; <span style="color: purple; font-weight: bold;">i</span>++) {
                if (<span style="color: purple; font-weight: bold;">input</span>[<span style="color: purple; font-weight: bold;">pos</span>] == <span style="color: purple; font-weight: bold;">chars</span>[<span style="color: purple; font-weight: bold;">i</span>])
                    break <span style="color: purple; font-weight: bold;">OUTER</span>;
</p></li>
<p>    }
</p></li>
<p>        return (c >= 'A' && c <= 'Z') || (c >= 'a' && c <= 'z');
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/CharacterReader.java:</strong><br>
<p>        this.length = input.<span style="color: green; font-weight: bold;">length</span>();
    }
</p></li>
<p>    }
</p></li>
<p>        pos++;
</p></li>
<p>        int start = pos;
</p></li>
<p>            char <span style="color: purple; font-weight: bold;">c</span> = <span style="color: purple; font-weight: bold;">input</span>.<span style="color: green; font-weight: bold;">charAt</span>(<span style="color: purple; font-weight: bold;">pos</span>);
            for (char <span style="color: purple; font-weight: bold;">seek</span> : <span style="color: purple; font-weight: bold;">seq</span>) {
                if (<span style="color: purple; font-weight: bold;">seek</span> == <span style="color: purple; font-weight: bold;">c</span>)
                    break <span style="color: purple; font-weight: bold;">OUTER</span>;
</p></li>
<p>    }
</p></li>
<p>        return (c >= 'A' && c <= 'Z') || (c >= 'a' && c <= 'z');
</p></li>
</li>
</ul>
<h2>Commit: 3e284b6</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokeniserState.java:</strong><br>
<p>            t.tagPending.appendTagName(tagName);
</p></li>
<p>                case '\f':
</p></li>
<p>                case '\f':
</p></li>
<p>            t.tagPending.appendAttributeName(name.toLowerCase());
</p></li>
<p>                case '\f':
</p></li>
<p>                case '\f':
</p></li>
<p>            if (value.length() > 0)
</p></li>
<p>                case '\f':
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/CharacterReader.java:</strong><br>
<p>
        this.input = input;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TokeniserState.java:</strong><br>
<p>            t.tagPending.appendTagName(tagName);
</p></li>
<p>            t.tagPending.appendAttributeName(name.toLowerCase());
</p></li>
<p>            if (value.length() > 0)
</p></li>
</li>
</ul>
<h2>Commit: 128b3f8</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/CharacterReader.java:</strong><br>
<p>        <span style="color: purple; font-weight: bold;">input</span> = <span style="color: purple; font-weight: bold;">input</span>.<span style="color: green; font-weight: bold;">replaceAll</span>(&quot;\r\n?&quot;, &quot;\n&quot;); <span style="color: blue; font-weight: bold;">// normalise carriage returns to newlines</span>

        this.input = input;
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: 80158d6</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/CharacterReader.java:</strong><br>
<p>    }
</p></li>
<p>        pos++;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>        if (<span style="color: purple; font-weight: bold;">tagName</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;script&quot;) || <span style="color: purple; font-weight: bold;">tagName</span>.<span style="color: green; font-weight: bold;">equals</span>("style"))
            node = new DataNode(characterToken.getData(), baseUri);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                        tb.reconstructFormattingElements();
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/CharacterReader.java:</strong><br>
<p>    }
</p></li>
<p>        pos++;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>            node = new DataNode(characterToken.getData(), baseUri);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                        tb.reconstructFormattingElements();
</p></li>
</li>
</ul>
<h2>Commit: f16c0c1</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/CharacterReader.java:</strong><br>
<p>        <span style="color: purple; font-weight: bold;">pos</span>++;
        return <span style="color: purple; font-weight: bold;">val</span>;
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/CharacterReader.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: 07a3c08</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/CharacterReader.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/CharacterReader.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: 59453e2</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/CharacterReader.java:</strong><br>
<p>                    return false;
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/CharacterReader.java:</strong><br>
<p>            int i = start;
</p></li>
<p>                    return false;
</p></li>
</li>
</ul>
<h2>Commit: 5000be3</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>
</p></li>
<p>    private Element <span style="color: purple; font-weight: bold;">headElement</span>; <span style="color: blue; font-weight: bold;">// the current head element</span>
</p></li>
<p>    private List&lt;Token.Character&gt; <span style="color: purple; font-weight: bold;">pendingTableCharacters</span> = new <span style="color: red; font-weight: bold;">ArrayList&lt;Token.Character&gt;</span>(); <span style="color: blue; font-weight: bold;">// chars in table to be shifted out</span>

</p></li>
<p>    private boolean <span style="color: purple; font-weight: bold;">fosterInserts</span> = false; <span style="color: blue; font-weight: bold;">// if next inserts should be fostered</span>
    private boolean <span style="color: purple; font-weight: bold;">fragmentParsing</span> = false; <span style="color: blue; font-weight: bold;">// if parsing a fragment of html</span>

</p></li>
<p>
</p></li>
<p>    Document <span style="color: green; font-weight: bold;">parse</span>(String <span style="color: purple; font-weight: bold;">input</span>, String <span style="color: purple; font-weight: bold;">baseUri</span>) {
        <span style="color: purple; font-weight: bold;">state</span> = HtmlTreeBuilderState.Initial;
        return super.<span style="color: green; font-weight: bold;">parse</span>(<span style="color: purple; font-weight: bold;">input</span>, <span style="color: purple; font-weight: bold;">baseUri</span>);
    }

</p></li>
<p>    boolean <span style="color: green; font-weight: bold;">process</span>(Token <span style="color: purple; font-weight: bold;">token</span>) {
        <span style="color: purple; font-weight: bold;">currentToken</span> = <span style="color: purple; font-weight: bold;">token</span>;
        return this.<span style="color: purple; font-weight: bold;">state</span>.<span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">token</span>, this);
    }

</p></li>
<p>        this.<span style="color: purple; font-weight: bold;">state</span> = <span style="color: purple; font-weight: bold;">state</span>;
    }

</p></li>
<p>        this.<span style="color: purple; font-weight: bold;">framesetOk</span> = <span style="color: purple; font-weight: bold;">framesetOk</span>;
    }

</p></li>
<p>        return <span style="color: purple; font-weight: bold;">framesetOk</span>;
    }

</p></li>
<p>        <span style="color: blue; font-weight: bold;">// handle empty unknown tags</span>
        <span style="color: blue; font-weight: bold;">// when the spec expects an empty tag, will directly hit insertEmpty, so won&#x27;t generate fake end tag.</span>
        if (<span style="color: purple; font-weight: bold;">startTag</span>.<span style="color: green; font-weight: bold;">isSelfClosing</span>() &amp;&amp; !<span style="color: purple; font-weight: bold;">Tag</span>.<span style="color: green; font-weight: bold;">isKnownTag</span>(<span style="color: purple; font-weight: bold;">startTag</span>.<span style="color: green; font-weight: bold;">name</span>())) {
            Element <span style="color: purple; font-weight: bold;">el</span> = <span style="color: green; font-weight: bold;">insertEmpty</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
            <span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(<span style="color: purple; font-weight: bold;">el</span>.<span style="color: green; font-weight: bold;">tagName</span>())); <span style="color: blue; font-weight: bold;">// ensure we get out of whatever state we are in</span>
            return <span style="color: purple; font-weight: bold;">el</span>;
        }
        
        Element <span style="color: purple; font-weight: bold;">el</span> = new <span style="color: red; font-weight: bold;">Element</span>(<span style="color: purple; font-weight: bold;">Tag</span>.<span style="color: green; font-weight: bold;">valueOf</span>(<span style="color: purple; font-weight: bold;">startTag</span>.<span style="color: green; font-weight: bold;">name</span>()), <span style="color: purple; font-weight: bold;">baseUri</span>, startTag.attributes);
        <span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">el</span>);
        return <span style="color: purple; font-weight: bold;">el</span>;
    }

</p></li>
<p>        Element <span style="color: purple; font-weight: bold;">el</span> = new <span style="color: red; font-weight: bold;">Element</span>(<span style="color: purple; font-weight: bold;">Tag</span>.<span style="color: green; font-weight: bold;">valueOf</span>(<span style="color: purple; font-weight: bold;">startTagName</span>), <span style="color: purple; font-weight: bold;">baseUri</span>);
        <span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">el</span>);
        return <span style="color: purple; font-weight: bold;">el</span>;
    }

</p></li>
<p>        <span style="color: green; font-weight: bold;">insertNode</span>(<span style="color: purple; font-weight: bold;">el</span>);
        <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">el</span>);
    }

</p></li>
<p>        Node <span style="color: purple; font-weight: bold;">node</span>;
        <span style="color: blue; font-weight: bold;">// characters in script and style go in as datanodes, not text nodes</span>
        if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: green; font-weight: bold;">currentElement</span>().<span style="color: green; font-weight: bold;">tagName</span>(), &quot;script&quot;, &quot;style&quot;))
            <span style="color: purple; font-weight: bold;">node</span> = new <span style="color: red; font-weight: bold;">DataNode</span>(<span style="color: purple; font-weight: bold;">characterToken</span>.<span style="color: green; font-weight: bold;">getData</span>(), <span style="color: purple; font-weight: bold;">baseUri</span>);
        else
            <span style="color: purple; font-weight: bold;">node</span> = new <span style="color: red; font-weight: bold;">TextNode</span>(<span style="color: purple; font-weight: bold;">characterToken</span>.<span style="color: green; font-weight: bold;">getData</span>(), <span style="color: purple; font-weight: bold;">baseUri</span>);
        <span style="color: green; font-weight: bold;">currentElement</span>().<span style="color: green; font-weight: bold;">appendChild</span>(<span style="color: purple; font-weight: bold;">node</span>); <span style="color: blue; font-weight: bold;">// doesn&#x27;t use insertNode, because we don&#x27;t foster these; and will always have a stack.</span>
    }

</p></li>
<p>        <span style="color: blue; font-weight: bold;">// if the stack hasn&#x27;t been set up yet, elements (doctype, comments) go into the doc</span>
        if (<span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">size</span>() == 0)
            <span style="color: purple; font-weight: bold;">doc</span>.<span style="color: green; font-weight: bold;">appendChild</span>(<span style="color: purple; font-weight: bold;">node</span>);
        else if (<span style="color: green; font-weight: bold;">isFosterInserts</span>())
            <span style="color: green; font-weight: bold;">insertInFosterParent</span>(<span style="color: purple; font-weight: bold;">node</span>);
        else
            <span style="color: green; font-weight: bold;">currentElement</span>().<span style="color: green; font-weight: bold;">appendChild</span>(<span style="color: purple; font-weight: bold;">node</span>);
    }

</p></li>
<p>        <span style="color: blue; font-weight: bold;">// todo - dev, remove validation check</span>
        if (<span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">peekLast</span>().<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(&quot;td&quot;) &amp;&amp; !<span style="color: purple; font-weight: bold;">state</span>.<span style="color: green; font-weight: bold;">name</span>().<span style="color: green; font-weight: bold;">equals</span>(&quot;InCell&quot;))
            <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">isFalse</span>(true, &quot;pop td not in cell&quot;);
        if (<span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">peekLast</span>().<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(&quot;html&quot;))
            <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">isFalse</span>(true, &quot;popping html!&quot;);
        return <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">pollLast</span>();
    }

</p></li>
<p>        Iterator&lt;Element&gt; <span style="color: purple; font-weight: bold;">it</span> = <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">descendingIterator</span>();
        while (<span style="color: purple; font-weight: bold;">it</span>.<span style="color: green; font-weight: bold;">hasNext</span>()) {
            Element <span style="color: purple; font-weight: bold;">next</span> = <span style="color: purple; font-weight: bold;">it</span>.<span style="color: green; font-weight: bold;">next</span>();
            if (<span style="color: purple; font-weight: bold;">next</span>.<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">elName</span>)) {
                <span style="color: purple; font-weight: bold;">it</span>.<span style="color: green; font-weight: bold;">remove</span>();
                break;
            } else {
                <span style="color: purple; font-weight: bold;">it</span>.<span style="color: green; font-weight: bold;">remove</span>();
            }
        }
    }

</p></li>
<p>        return <span style="color: green; font-weight: bold;">inSpecificScope</span>(new String[]{<span style="color: purple; font-weight: bold;">targetName</span>}, <span style="color: purple; font-weight: bold;">baseTypes</span>, <span style="color: purple; font-weight: bold;">extraTypes</span>);
    }

</p></li>
<p>        Iterator&lt;Element&gt; <span style="color: purple; font-weight: bold;">it</span> = <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">descendingIterator</span>();
        while (<span style="color: purple; font-weight: bold;">it</span>.<span style="color: green; font-weight: bold;">hasNext</span>()) {
            Element <span style="color: purple; font-weight: bold;">el</span> = <span style="color: purple; font-weight: bold;">it</span>.<span style="color: green; font-weight: bold;">next</span>();
            String <span style="color: purple; font-weight: bold;">elName</span> = <span style="color: purple; font-weight: bold;">el</span>.<span style="color: green; font-weight: bold;">nodeName</span>();
            if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">elName</span>, <span style="color: purple; font-weight: bold;">targetNames</span>))
                return true;
            if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">elName</span>, <span style="color: purple; font-weight: bold;">baseTypes</span>))
                return false;
            if (<span style="color: purple; font-weight: bold;">extraTypes</span> != null &amp;&amp; <span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">elName</span>, <span style="color: purple; font-weight: bold;">extraTypes</span>))
                return false;
        }
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">fail</span>("Should not be reachable");
        return false;
    }

</p></li>
<p>        return <span style="color: green; font-weight: bold;">inScope</span>(<span style="color: purple; font-weight: bold;">targetName</span>, null);
    }

</p></li>
<p>        return <span style="color: green; font-weight: bold;">inSpecificScope</span>(<span style="color: purple; font-weight: bold;">targetName</span>, new String[]{&quot;applet&quot;, &quot;caption&quot;, &quot;html&quot;, &quot;table&quot;, &quot;td&quot;, &quot;th&quot;, &quot;marquee&quot;, &quot;object&quot;}, <span style="color: purple; font-weight: bold;">extras</span>);
        <span style="color: blue; font-weight: bold;">// todo: in mathml namespace: mi, mo, mn, ms, mtext annotation-xml</span>
        <span style="color: blue; font-weight: bold;">// todo: in svg namespace: forignOjbect, desc, title</span>
    }

</p></li>
<p>        return <span style="color: green; font-weight: bold;">inScope</span>(<span style="color: purple; font-weight: bold;">targetName</span>, new String[]{"button"});
    }

</p></li>
<p>        this.<span style="color: purple; font-weight: bold;">headElement</span> = <span style="color: purple; font-weight: bold;">headElement</span>;
    }

</p></li>
<p>        return <span style="color: purple; font-weight: bold;">fosterInserts</span>;
    }

</p></li>
<p>        while ((<span style="color: purple; font-weight: bold;">excludeTag</span> != null &amp;&amp; !<span style="color: green; font-weight: bold;">currentElement</span>().<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">excludeTag</span>)) &amp;&amp;
                <span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: green; font-weight: bold;">currentElement</span>().<span style="color: green; font-weight: bold;">nodeName</span>(), &quot;dd&quot;, &quot;dt&quot;, &quot;li&quot;, &quot;option&quot;, &quot;optgroup&quot;, &quot;p&quot;, &quot;rp&quot;, &quot;rt&quot;))
            <span style="color: green; font-weight: bold;">pop</span>();
    }

</p></li>
<p>        <span style="color: green; font-weight: bold;">generateImpliedEndTags</span>(null);
    }

</p></li>
<p>        int <span style="color: purple; font-weight: bold;">size</span> = <span style="color: purple; font-weight: bold;">formattingElements</span>.<span style="color: green; font-weight: bold;">size</span>();
        if (<span style="color: purple; font-weight: bold;">size</span> == 0 || <span style="color: purple; font-weight: bold;">formattingElements</span>.<span style="color: green; font-weight: bold;">getLast</span>() == null || <span style="color: green; font-weight: bold;">onStack</span>(<span style="color: purple; font-weight: bold;">formattingElements</span>.<span style="color: green; font-weight: bold;">getLast</span>()))
            return;

        Element <span style="color: purple; font-weight: bold;">entry</span> = <span style="color: purple; font-weight: bold;">formattingElements</span>.<span style="color: green; font-weight: bold;">getLast</span>();
        int <span style="color: purple; font-weight: bold;">pos</span> = <span style="color: purple; font-weight: bold;">size</span> - 1;
        boolean <span style="color: purple; font-weight: bold;">skip</span> = false;
        while (true) {
            if (<span style="color: purple; font-weight: bold;">pos</span> == 0) { <span style="color: blue; font-weight: bold;">// step 4. if none before, skip to 8</span>
                <span style="color: purple; font-weight: bold;">skip</span> = true;
                break;
            }
            <span style="color: purple; font-weight: bold;">entry</span> = <span style="color: purple; font-weight: bold;">formattingElements</span>.<span style="color: green; font-weight: bold;">get</span>(--<span style="color: purple; font-weight: bold;">pos</span>); <span style="color: blue; font-weight: bold;">// step 5. one earlier than entry</span>
            if (<span style="color: purple; font-weight: bold;">entry</span> == null || <span style="color: green; font-weight: bold;">onStack</span>(<span style="color: purple; font-weight: bold;">entry</span>)) <span style="color: blue; font-weight: bold;">// step 6 - neither marker nor on stack</span>
                break; <span style="color: blue; font-weight: bold;">// jump to 8, else continue back to 4</span>
        }
        while(true) {
            if (!<span style="color: purple; font-weight: bold;">skip</span>) <span style="color: blue; font-weight: bold;">// step 7: on later than entry</span>
                <span style="color: purple; font-weight: bold;">entry</span> = <span style="color: purple; font-weight: bold;">formattingElements</span>.<span style="color: green; font-weight: bold;">get</span>(++<span style="color: purple; font-weight: bold;">pos</span>);
            <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">entry</span>); <span style="color: blue; font-weight: bold;">// should not occur, as we break at last element</span>

            <span style="color: blue; font-weight: bold;">// 8. create new element from element, 9 insert into current node, onto stack</span>
            <span style="color: purple; font-weight: bold;">skip</span> = false; <span style="color: blue; font-weight: bold;">// can only skip increment from 4.</span>
            Element <span style="color: purple; font-weight: bold;">newEl</span> = <span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">entry</span>.<span style="color: green; font-weight: bold;">nodeName</span>()); <span style="color: blue; font-weight: bold;">// todo: avoid fostering here?</span>
            <span style="color: blue; font-weight: bold;">// newEl.namespace(entry.namespace()); // todo: namespaces</span>
            <span style="color: purple; font-weight: bold;">newEl</span>.<span style="color: green; font-weight: bold;">attributes</span>().<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">entry</span>.<span style="color: green; font-weight: bold;">attributes</span>());

            <span style="color: blue; font-weight: bold;">// 10. replace entry with new entry</span>
            <span style="color: purple; font-weight: bold;">formattingElements</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">pos</span>, <span style="color: purple; font-weight: bold;">newEl</span>);
            <span style="color: purple; font-weight: bold;">formattingElements</span>.<span style="color: green; font-weight: bold;">remove</span>(<span style="color: purple; font-weight: bold;">pos</span> + 1);

            <span style="color: blue; font-weight: bold;">// 11</span>
            if (<span style="color: purple; font-weight: bold;">pos</span> == <span style="color: purple; font-weight: bold;">size</span>-1) <span style="color: blue; font-weight: bold;">// if not last entry in list, jump to 7</span>
                break;
        }
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>    Initial {
</p></li>
<p>            if (isWhitespace(t)) {
</p></li>
<p>            if (t.isDoctype()) {
</p></li>
<p>            tb.insert("html");
</p></li>
<p>            if (isWhitespace(t)) {
</p></li>
<p>            if (isWhitespace(t)) {
</p></li>
<p>            if (isWhitespace(t)) {
</p></li>
<p>            tb.process(new Token.StartTag("body"));
</p></li>
<p>            switch (t.type) {
</p></li>
<p>                        if (state.equals(InTable) || state.equals(InCaption) || state.equals(InTableBody) || state.equals(InRow) || state.equals(InCell))
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Parser.java:</strong><br>
<p>        return treeBuilder.parse(html, baseUri);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>    CharacterReader reader;
</p></li>
<p>        doc = new Document(baseUri);
</p></li>
<p>        while (true) {
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilderState.java:</strong><br>
<p>    Initial {
</p></li>
<p>            if (isWhitespace(t)) {
</p></li>
<p>            if (t.isDoctype()) {
</p></li>
<p>            tb.insert("html");
</p></li>
<p>            if (isWhitespace(t)) {
</p></li>
<p>            if (isWhitespace(t)) {
</p></li>
<p>            if (isWhitespace(t)) {
</p></li>
<p>            tb.process(new Token.StartTag("body"));
</p></li>
<p>            switch (t.type) {
</p></li>
<p>                        if (state.equals(InTable) || state.equals(InCaption) || state.equals(InTableBody) || state.equals(InRow) || state.equals(InCell))
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Parser.java:</strong><br>
<p>        return treeBuilder.parse(html, baseUri);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>    CharacterReader reader;
</p></li>
<p>    private TreeBuilderState <span style="color: purple; font-weight: bold;">state</span>; <span style="color: blue; font-weight: bold;">// the current state</span>
    private TreeBuilderState <span style="color: purple; font-weight: bold;">originalState</span>; <span style="color: blue; font-weight: bold;">// original / marked state</span>
    private Document doc; // current doc we are building into
    private DescendableLinkedList&lt;Element&gt; stack; // the stack of open elements

    private String baseUri; // current base uri, for creating new elements
    private boolean <span style="color: purple; font-weight: bold;">baseUriSetFromDoc</span> = false;
    private Token currentToken; // currentToken is used only for error tracking.
    private Element <span style="color: purple; font-weight: bold;">headElement</span>; <span style="color: blue; font-weight: bold;">// the current head element</span>
    private Element <span style="color: purple; font-weight: bold;">formElement</span>; <span style="color: blue; font-weight: bold;">// the current form element</span>
    private Element <span style="color: purple; font-weight: bold;">contextElement</span>; <span style="color: blue; font-weight: bold;">// fragment parse context -- could be null even if fragment parsing</span>
    private DescendableLinkedList&lt;Element&gt; <span style="color: purple; font-weight: bold;">formattingElements</span> = new <span style="color: red; font-weight: bold;">DescendableLinkedList&lt;Element&gt;</span>(); <span style="color: blue; font-weight: bold;">// active (open) formatting elements</span>
    private List&lt;Token.Character&gt; <span style="color: purple; font-weight: bold;">pendingTableCharacters</span> = new <span style="color: red; font-weight: bold;">ArrayList&lt;Token.Character&gt;</span>(); <span style="color: blue; font-weight: bold;">// chars in table to be shifted out</span>

    private boolean <span style="color: purple; font-weight: bold;">framesetOk</span> = true; <span style="color: blue; font-weight: bold;">// if ok to go into frameset</span>
    private boolean <span style="color: purple; font-weight: bold;">fosterInserts</span> = false; <span style="color: blue; font-weight: bold;">// if next inserts should be fostered</span>
    private boolean <span style="color: purple; font-weight: bold;">fragmentParsing</span> = false; <span style="color: blue; font-weight: bold;">// if parsing a fragment of html</span>

    private boolean trackErrors = false;
    private List&lt;ParseError&gt; errors = new ArrayList&lt;ParseError&gt;();

    <span style="color: green; font-weight: bold;">TreeBuilder</span>() {}

    private void initialiseParse(String input, String baseUri) {
        doc = new Document(baseUri);
</p></li>
<p>        <span style="color: blue; font-weight: bold;">// context may be null</span>
        <span style="color: green; font-weight: bold;">initialiseParse</span>(<span style="color: purple; font-weight: bold;">inputFragment</span>, <span style="color: purple; font-weight: bold;">baseUri</span>);
        <span style="color: purple; font-weight: bold;">contextElement</span> = <span style="color: purple; font-weight: bold;">context</span>;
        <span style="color: purple; font-weight: bold;">fragmentParsing</span> = true;
        Element <span style="color: purple; font-weight: bold;">root</span> = null;

        if (<span style="color: purple; font-weight: bold;">context</span> != null) {
            if (<span style="color: purple; font-weight: bold;">context</span>.<span style="color: green; font-weight: bold;">ownerDocument</span>() != null) <span style="color: blue; font-weight: bold;">// quirks setup:</span>
                <span style="color: purple; font-weight: bold;">doc</span>.<span style="color: green; font-weight: bold;">quirksMode</span>(<span style="color: purple; font-weight: bold;">context</span>.<span style="color: green; font-weight: bold;">ownerDocument</span>().<span style="color: green; font-weight: bold;">quirksMode</span>());

            <span style="color: blue; font-weight: bold;">// initialise the tokeniser state:</span>
            String <span style="color: purple; font-weight: bold;">contextTag</span> = <span style="color: purple; font-weight: bold;">context</span>.<span style="color: green; font-weight: bold;">tagName</span>();
            if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">contextTag</span>, &quot;title&quot;, &quot;textarea&quot;))
                <span style="color: purple; font-weight: bold;">tokeniser</span>.<span style="color: green; font-weight: bold;">transition</span>(TokeniserState.Rcdata);
            else if (<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">in</span>(<span style="color: purple; font-weight: bold;">contextTag</span>, &quot;iframe&quot;, &quot;noembed&quot;, &quot;noframes&quot;, &quot;style&quot;, &quot;xmp&quot;))
                <span style="color: purple; font-weight: bold;">tokeniser</span>.<span style="color: green; font-weight: bold;">transition</span>(TokeniserState.Rawtext);
            else if (<span style="color: purple; font-weight: bold;">contextTag</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;script&quot;))
                <span style="color: purple; font-weight: bold;">tokeniser</span>.<span style="color: green; font-weight: bold;">transition</span>(TokeniserState.ScriptData);
            else if (<span style="color: purple; font-weight: bold;">contextTag</span>.<span style="color: green; font-weight: bold;">equals</span>((&quot;noscript&quot;)))
                <span style="color: purple; font-weight: bold;">tokeniser</span>.<span style="color: green; font-weight: bold;">transition</span>(TokeniserState.Data); <span style="color: blue; font-weight: bold;">// if scripting enabled, rawtext</span>
            else if (<span style="color: purple; font-weight: bold;">contextTag</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;plaintext&quot;))
                <span style="color: purple; font-weight: bold;">tokeniser</span>.<span style="color: green; font-weight: bold;">transition</span>(TokeniserState.Data);
            else
                <span style="color: purple; font-weight: bold;">tokeniser</span>.<span style="color: green; font-weight: bold;">transition</span>(TokeniserState.Data); <span style="color: blue; font-weight: bold;">// default</span>

            <span style="color: purple; font-weight: bold;">root</span> = new <span style="color: red; font-weight: bold;">Element</span>(<span style="color: purple; font-weight: bold;">Tag</span>.<span style="color: green; font-weight: bold;">valueOf</span>(&quot;html&quot;), <span style="color: purple; font-weight: bold;">baseUri</span>);
            <span style="color: purple; font-weight: bold;">doc</span>.<span style="color: green; font-weight: bold;">appendChild</span>(<span style="color: purple; font-weight: bold;">root</span>);
            <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">push</span>(<span style="color: purple; font-weight: bold;">root</span>);
            <span style="color: green; font-weight: bold;">resetInsertionMode</span>();
            <span style="color: blue; font-weight: bold;">// todo: setup form element to nearest form on context (up ancestor chain)</span>
        }

        <span style="color: green; font-weight: bold;">runParser</span>();
        if (<span style="color: purple; font-weight: bold;">context</span> != null)
            return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">childNodes</span>();
        else
            return <span style="color: purple; font-weight: bold;">doc</span>.<span style="color: green; font-weight: bold;">childNodes</span>();
    }

    private void runParser() {
        while (true) {
</p></li>
<p>
            Token token = tokeniser.read();
</p></li>
</li>
</ul>
<h2>Commit: de098c3</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>    public static final String[] <span style="color: purple; font-weight: bold;">TagsSearchInScope</span> = new String[]{&quot;applet&quot;, &quot;caption&quot;, &quot;html&quot;, &quot;table&quot;, &quot;td&quot;, &quot;th&quot;, &quot;marquee&quot;, &quot;object&quot;};
    private static final String[] <span style="color: purple; font-weight: bold;">TagSearchList</span> = new String[]{&quot;ol&quot;, &quot;ul&quot;};
    private static final String[] <span style="color: purple; font-weight: bold;">TagSearchButton</span> = new String[]{&quot;button&quot;};
    private static final String[] <span style="color: purple; font-weight: bold;">TagSearchTableScope</span> = new String[]{&quot;html&quot;, &quot;table&quot;};
    private static final String[] <span style="color: purple; font-weight: bold;">TagSearchSelectScope</span> = new String[]{&quot;optgroup&quot;, &quot;option&quot;};
    private static final String[] <span style="color: purple; font-weight: bold;">TagSearchEndTags</span> = new String[]{&quot;dd&quot;, &quot;dt&quot;, &quot;li&quot;, &quot;option&quot;, &quot;optgroup&quot;, &quot;p&quot;, &quot;rp&quot;, &quot;rt&quot;};
    private static final String[] <span style="color: purple; font-weight: bold;">TagSearchSpecial</span> = new String[]{"address", "applet", "area", "article", "aside", "base", "basefont", "bgsound",
            "blockquote", "body", "br", "button", "caption", "center", "col", "colgroup", "command", "dd",
            "details", "dir", "div", "dl", "dt", "embed", "fieldset", "figcaption", "figure", "footer", "form",
            "frame", "frameset", "h1", "h2", "h3", "h4", "h5", "h6", "head", "header", "hgroup", "hr", "html",
            "iframe", "img", "input", "isindex", "li", "link", "listing", "marquee", "menu", "meta", "nav",
            "noembed", "noframes", "noscript", "object", "ol", "p", "param", "plaintext", "pre", "script",
            "section", "select", "style", "summary", "table", "tbody", "td", "textarea", "tfoot", "th", "thead",
            "title", "tr", "ul", "wbr", "xmp"};

</p></li>
<p>            node = new DataNode(characterToken.getData(), baseUri);
</p></li>
<p>        // todo: in mathml namespace: mi, mo, mn, ms, mtext annotation-xml
</p></li>
<p>    }
</p></li>
<p>            pop();
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>            node = new DataNode(characterToken.getData(), baseUri);
</p></li>
<p>        // todo: in mathml namespace: mi, mo, mn, ms, mtext annotation-xml
</p></li>
<p>    }
</p></li>
<p>            pop();
</p></li>
</li>
</ul>
<h2>Commit: 01a6269</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>    private List<Token.Character> pendingTableCharacters = new ArrayList<Token.Character>(); // chars in table to be shifted out
</p></li>
<p>        return <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">remove</span>(<span style="color: purple; font-weight: bold;">size</span>-1);
    }
</p></li>
<p>            Element <span style="color: purple; font-weight: bold;">next</span> = <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">pos</span>);
            <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">remove</span>(<span style="color: purple; font-weight: bold;">pos</span>);
            if (<span style="color: purple; font-weight: bold;">next</span>.<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">elName</span>))
                break;
</p></li>
<p>            Element <span style="color: purple; font-weight: bold;">el</span> = <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">pos</span>);
            String <span style="color: purple; font-weight: bold;">elName</span> = <span style="color: purple; font-weight: bold;">el</span>.<span style="color: green; font-weight: bold;">nodeName</span>();
</p></li>
<p>        return <span style="color: purple; font-weight: bold;">formattingElements</span>.<span style="color: green; font-weight: bold;">size</span>() &gt; 0 ? <span style="color: purple; font-weight: bold;">formattingElements</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">formattingElements</span>.<span style="color: green; font-weight: bold;">size</span>()-1) : null;
    }

</p></li>
<p>        if (<span style="color: purple; font-weight: bold;">last</span> == null || onStack(<span style="color: purple; font-weight: bold;">last</span>))
            return;
</p></li>
<p>        int size = formattingElements.size();
        int pos = size - 1;
</p></li>
<p>
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                        for (Attribute attribute : startTag.getAttributes()) {
</p></li>
<p>                        if (stack.size() == 1 || (stack.size() > 2 && !stack.get(1).nodeName().equals("body"))) {
</p></li>
<p>                        if (stack.size() == 1 || (stack.size() > 2 && !stack.get(1).nodeName().equals("body"))) {
</p></li>
<p>                            tb.insert(startTag);
</p></li>
<p>                        for (int i = stack.size() - 1; i > 0; i--) {
</p></li>
<p>                        for (int i = stack.size() - 1; i > 0; i--) {
</p></li>
<p>                            // the spec doesn't limit to < 64, but in degenerate cases (9000+ stack depth) this prevents
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>        this.baseUri = baseUri;
</p></li>
<p>        return <span style="color: purple; font-weight: bold;">size</span> &gt; 0 ? <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">size</span>-1) : null;
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>    private List<Token.Character> pendingTableCharacters = new ArrayList<Token.Character>(); // chars in table to be shifted out
</p></li>
<p>        if (<span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">peekLast</span>().<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(&quot;td&quot;) &amp;&amp; !<span style="color: purple; font-weight: bold;">state</span>.<span style="color: green; font-weight: bold;">name</span>().<span style="color: green; font-weight: bold;">equals</span>(&quot;InCell&quot;))
            <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">isFalse</span>(true, &quot;pop td not in cell&quot;);
        if (<span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">peekLast</span>().<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(&quot;html&quot;))
            <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">isFalse</span>(true, &quot;popping html!&quot;);
        return <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">pollLast</span>();
    }
</p></li>
<p>        while (<span style="color: purple; font-weight: bold;">it</span>.<span style="color: green; font-weight: bold;">hasNext</span>()) {
            Element <span style="color: purple; font-weight: bold;">next</span> = <span style="color: purple; font-weight: bold;">it</span>.<span style="color: green; font-weight: bold;">next</span>();
            if (<span style="color: purple; font-weight: bold;">next</span>.<span style="color: green; font-weight: bold;">nodeName</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">elName</span>)) {
                <span style="color: purple; font-weight: bold;">it</span>.<span style="color: green; font-weight: bold;">remove</span>();
                break;
</p></li>
<p>                <span style="color: purple; font-weight: bold;">it</span>.<span style="color: green; font-weight: bold;">remove</span>();
            }
        }
</p></li>
<p>        while (<span style="color: purple; font-weight: bold;">it</span>.<span style="color: green; font-weight: bold;">hasNext</span>()) {
            Element <span style="color: purple; font-weight: bold;">el</span> = <span style="color: purple; font-weight: bold;">it</span>.<span style="color: green; font-weight: bold;">next</span>();
            String <span style="color: purple; font-weight: bold;">elName</span> = <span style="color: purple; font-weight: bold;">el</span>.<span style="color: green; font-weight: bold;">nodeName</span>();
</p></li>
<p>        if (<span style="color: purple; font-weight: bold;">size</span> == 0 || formattingElements.<span style="color: green; font-weight: bold;">getLast</span>() == null || onStack(<span style="color: purple; font-weight: bold;">formattingElements</span>.<span style="color: green; font-weight: bold;">getLast</span>()))
            return;
</p></li>
<p>        int pos = size - 1;
</p></li>
<p>            <span style="color: purple; font-weight: bold;">formattingElements</span>.<span style="color: green; font-weight: bold;">remove</span>(<span style="color: purple; font-weight: bold;">pos</span> + 1);

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                        for (Attribute attribute : startTag.getAttributes()) {
</p></li>
<p>                        if (stack.size() == 1 || (stack.size() > 2 && !stack.get(1).nodeName().equals("body"))) {
</p></li>
<p>                        if (stack.size() == 1 || (stack.size() > 2 && !stack.get(1).nodeName().equals("body"))) {
</p></li>
<p>                            tb.insert(startTag);
</p></li>
<p>                        for (int i = stack.size() - 1; i > 0; i--) {
</p></li>
<p>                        for (int i = stack.size() - 1; i > 0; i--) {
</p></li>
<p>                            // the spec doesn't limit to < 64, but in degenerate cases (9000+ stack depth) this prevents
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>        this.baseUri = baseUri;
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: e991936</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>    private Token.EndTag <span style="color: purple; font-weight: bold;">emptyEnd</span> = new <span style="color: red; font-weight: bold;">Token.EndTag</span>(); <span style="color: blue; font-weight: bold;">// reused empty end tag</span>

</p></li>
<p>            return el;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                return tb.process(t);
</p></li>
<p>                return tb.process(t);
</p></li>
<p>            return tb.process(t);
</p></li>
<p>            tb.framesetOk(true);
</p></li>
<p>                        }
</p></li>
<p>                        }
</p></li>
<p>                        }
</p></li>
<p>                        }
</p></li>
<p>                                break;
</p></li>
<p>                        }
</p></li>
<p>                                break;
</p></li>
<p>                        }
</p></li>
<p>                        }
</p></li>
<p>                            tb.process(startTag);
</p></li>
<p>
</p></li>
<p>                            tb.reconstructFormattingElements();
</p></li>
<p>                        }
</p></li>
<p>                        }
</p></li>
<p>                        if (startTag.attributes.hasKey("action")) {
</p></li>
<p>                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">processStartTag</span>("label");
                        // hope you like english.
</p></li>
<p>
</p></li>
<p>                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">processEndTag</span>(&quot;label&quot;);
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">processStartTag</span>(&quot;hr&quot;);
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">processEndTag</span>("form");
                    } else if (name.equals("textarea")) {
</p></li>
<p>                        }
</p></li>
<p>                        tb.reconstructFormattingElements();
</p></li>
<p>                        if (notIgnored)
</p></li>
<p>                            return tb.process(endTag);
</p></li>
<p>                        return false;
</p></li>
<p>        }
</p></li>
<p>        // todo: this checks more than spec - "\t", "\n", "\f", "\r", " "
        for (int i = 0; i < data.length(); i++) {
            char c = data.charAt(i);
            if (!StringUtil.isWhitespace(c))
                return false;
        }
        return true;
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Token.java:</strong><br>
<p>        if (<span style="color: purple; font-weight: bold;">sb</span> != null) {
            <span style="color: purple; font-weight: bold;">sb</span>.<span style="color: green; font-weight: bold;">delete</span>(0, <span style="color: purple; font-weight: bold;">sb</span>.<span style="color: green; font-weight: bold;">length</span>());
        }
    }

</p></li>
<p>        private boolean <span style="color: purple; font-weight: bold;">hasPendingAttributeValue</span> = false;
        boolean selfClosing = false;
</p></li>
<p>        Tag <span style="color: green; font-weight: bold;">reset</span>() {
            <span style="color: purple; font-weight: bold;">tagName</span> = null;
            <span style="color: purple; font-weight: bold;">pendingAttributeName</span> = null;
            <span style="color: green; font-weight: bold;">reset</span>(<span style="color: purple; font-weight: bold;">pendingAttributeValue</span>);
            <span style="color: purple; font-weight: bold;">hasPendingAttributeValue</span> = false;
            <span style="color: purple; font-weight: bold;">selfClosing</span> = false;
            <span style="color: purple; font-weight: bold;">attributes</span> = null;
            return this;
        }

</p></li>
<p>                    attribute = new Attribute(pendingAttributeName, "");
</p></li>
<p>        }
</p></li>
<p>        }
</p></li>
<p>        Tag <span style="color: green; font-weight: bold;">reset</span>() {
            super.<span style="color: green; font-weight: bold;">reset</span>();
            <span style="color: purple; font-weight: bold;">attributes</span> = new <span style="color: red; font-weight: bold;">Attributes</span>();
            <span style="color: blue; font-weight: bold;">// todo - would prefer these to be null, but need to check Element assertions</span>
            return this;
        }
</p></li>
<p>            super();
            <span style="color: purple; font-weight: bold;">type</span> = TokenType.Character;
</p></li>
<p>
</p></li>
<p>        Token <span style="color: green; font-weight: bold;">reset</span>() {
            <span style="color: purple; font-weight: bold;">data</span> = null;
            return this;
        }

</p></li>
<p>            this.data = data;
</p></li>
<p>        }
</p></li>
<p>        Token <span style="color: green; font-weight: bold;">reset</span>() {
            return this;
        }
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tokeniser.java:</strong><br>
<p>
</p></li>
<p>    Token.EndTag <span style="color: purple; font-weight: bold;">endPending</span> = new <span style="color: red; font-weight: bold;">Token.EndTag</span>();
    Token.Character <span style="color: purple; font-weight: bold;">charPending</span> = new <span style="color: red; font-weight: bold;">Token.Character</span>();
    Token.Doctype <span style="color: purple; font-weight: bold;">doctypePending</span> = new <span style="color: red; font-weight: bold;">Token.Doctype</span>(); // doctype building up
    Token.Comment <span style="color: purple; font-weight: bold;">commentPending</span> = new <span style="color: red; font-weight: bold;">Token.Comment</span>(); // comment building up
    private String lastStartTag; // the last start tag emitted, to test appropriate end tag
</p></li>
<p>        } else if (charsString != null) {
</p></li>
<p>            charsString = null;
</p></li>
<p>            if (startTag.selfClosing)
</p></li>
<p>        return tagPending;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>    private Token.EndTag <span style="color: purple; font-weight: bold;">end</span>  = new <span style="color: red; font-weight: bold;">Token.EndTag</span>();

</p></li>
<p>
</p></li>
<p>        return <span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">start</span>.<span style="color: green; font-weight: bold;">reset</span>().<span style="color: green; font-weight: bold;">name</span>(<span style="color: purple; font-weight: bold;">name</span>));
    }

</p></li>
<p>        return <span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">end</span>.<span style="color: green; font-weight: bold;">reset</span>().<span style="color: green; font-weight: bold;">name</span>(<span style="color: purple; font-weight: bold;">name</span>));
    }

</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>
</p></li>
<p>            return el;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                return tb.process(t);
</p></li>
<p>                return tb.process(t);
</p></li>
<p>            return tb.process(t);
</p></li>
<p>            tb.framesetOk(true);
</p></li>
<p>                        }
</p></li>
<p>                        }
</p></li>
<p>                        }
</p></li>
<p>                        }
</p></li>
<p>                                break;
</p></li>
<p>                        }
</p></li>
<p>                                break;
</p></li>
<p>                        }
</p></li>
<p>                        }
</p></li>
<p>                            tb.process(startTag);
</p></li>
<p>
</p></li>
<p>                            tb.reconstructFormattingElements();
</p></li>
<p>                        }
</p></li>
<p>                        }
</p></li>
<p>                        if (startTag.attributes.hasKey("action")) {
</p></li>
<p>                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.StartTag</span>("label"));
                        // hope you like english.
</p></li>
<p>
</p></li>
<p>                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>(&quot;label&quot;));
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.StartTag</span>(&quot;hr&quot;));
                        <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(new <span style="color: red; font-weight: bold;">Token.EndTag</span>("form"));
                    } else if (name.equals("textarea")) {
</p></li>
<p>                        }
</p></li>
<p>                        tb.reconstructFormattingElements();
</p></li>
<p>                        if (notIgnored)
</p></li>
<p>                            return tb.process(endTag);
</p></li>
<p>                        return false;
</p></li>
<p>            for (int i = 0; i < data.length(); i++) {
                char c = data.charAt(i);
                if (!StringUtil.isWhitespace(c))
                    return false;
            }
            return true;
        }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Token.java:</strong><br>
<p>
        boolean selfClosing = false;
</p></li>
<p>                    attribute = new Attribute(pendingAttributeName, "");
</p></li>
<p>                <span style="color: purple; font-weight: bold;">pendingAttributeValue</span>.<span style="color: green; font-weight: bold;">delete</span>(0, <span style="color: purple; font-weight: bold;">pendingAttributeValue</span>.<span style="color: green; font-weight: bold;">length</span>());
        }
</p></li>
<p>                <span style="color: purple; font-weight: bold;">pendingAttributeValue</span> = new <span style="color: red; font-weight: bold;">StringBuilder</span>();
        }
</p></li>
<p>            this();
            this.<span style="color: purple; font-weight: bold;">tagName</span> = <span style="color: purple; font-weight: bold;">name</span>;
        }
</p></li>
<p>            type = TokenType.Character;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tokeniser.java:</strong><br>
<p>
</p></li>
<p>    Token.Comment <span style="color: purple; font-weight: bold;">commentPending</span>; // comment building up
    private Token.StartTag lastStartTag; // the last start tag emitted, to test appropriate end tag
    private boolean selfClosingFlagAcknowledged = true;
</p></li>
<p>        } else if (charsString != null) {
</p></li>
<p>            charsString = null;
</p></li>
<p>            if (startTag.selfClosing)
</p></li>
<p>        return tagPending;
</p></li>
</li>
</ul>
<h2>Commit: 17796e3</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>
</p></li>
<p>        return inSpecificScope(<span style="color: purple; font-weight: bold;">specificScopeTarget</span>, baseTypes, extraTypes);
    }
</p></li>
<p>        // todo: in mathml namespace: mi, mo, mn, ms, mtext annotation-xml
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>    }
</p></li>
<p>        // todo: in mathml namespace: mi, mo, mn, ms, mtext annotation-xml
</p></li>
</li>
</ul>
<h2>Commit: 2518e92</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>            tokeniser.emit(new Token.EndTag(el.tagName()));  // ensure we get out of whatever state we are in. emitted for yielded processing
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                        tb.tokeniser.transition(TokeniserState.ScriptData);
</p></li>
<p>                    } else if (name.equals("head")) {
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                        tb.tokeniser.transition(TokeniserState.ScriptData);
</p></li>
</li>
</ul>
<h2>Commit: c3c952e</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>        if (startTag.isSelfClosing()) {
            Element el = insertEmpty(startTag);
</p></li>
<p>            <span style="color: purple; font-weight: bold;">tokeniser</span>.<span style="color: green; font-weight: bold;">emit</span>(new Token.EndTag(el.tagName()));  <span style="color: blue; font-weight: bold;">// ensure we get out of whatever state we are in. emitted for yielded processing</span>
            return el;
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>        if (<span style="color: purple; font-weight: bold;">startTag</span>.<span style="color: green; font-weight: bold;">isSelfClosing</span>() &amp;&amp; !<span style="color: purple; font-weight: bold;">Tag</span>.<span style="color: green; font-weight: bold;">isKnownTag</span>(<span style="color: purple; font-weight: bold;">startTag</span>.<span style="color: green; font-weight: bold;">name</span>())) {
            Element el = insertEmpty(startTag);
</p></li>
<p>            return el;
</p></li>
</li>
</ul>
<h2>Commit: c5792eb</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>        <span style="color: blue; font-weight: bold;">// connect form controls to their form element</span>
        if (<span style="color: purple; font-weight: bold;">node</span> instanceof Element &amp;&amp; ((Element) <span style="color: purple; font-weight: bold;">node</span>).<span style="color: green; font-weight: bold;">tag</span>().<span style="color: green; font-weight: bold;">isFormListed</span>()) {
            if (<span style="color: purple; font-weight: bold;">formElement</span> != null)
                <span style="color: purple; font-weight: bold;">formElement</span>.<span style="color: green; font-weight: bold;">addElement</span>((Element) <span style="color: purple; font-weight: bold;">node</span>);
        }
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                    } else if (name.equals("li")) {
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>    private boolean <span style="color: purple; font-weight: bold;">formSubmit</span> = false; <span style="color: blue; font-weight: bold;">// a control that can be submitted in a form: input etc</span>

</p></li>
<p>        return <span style="color: purple; font-weight: bold;">formList</span>;
    }

</p></li>
<p>            &quot;pre&quot;, &quot;plaintext&quot;, &quot;title&quot;, &quot;textarea&quot;
    };
    <span style="color: blue; font-weight: bold;">// todo: I think we just need submit tags, and can scrub listed</span>
</p></li>
<p>            &quot;button&quot;, &quot;fieldset&quot;, &quot;input&quot;, &quot;keygen&quot;, &quot;object&quot;, &quot;output&quot;, &quot;select&quot;, &quot;textarea&quot;
    };
    private static final String[] <span style="color: purple; font-weight: bold;">formSubmitTags</span> = {
            "button", "input", "keygen", "object", "select", "textarea"
    };

</p></li>
<p>            Tag <span style="color: purple; font-weight: bold;">tag</span> = <span style="color: purple; font-weight: bold;">tags</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">tagName</span>);
            <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">tag</span>);
            tag.formList = true;
        }
</p></li>
<p>            Tag <span style="color: purple; font-weight: bold;">tag</span> = <span style="color: purple; font-weight: bold;">tags</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">tagName</span>);
            <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">tag</span>);
            tag.formSubmit = true;
        }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                        tb.<span style="color: green; font-weight: bold;">setFormElement</span>(<span style="color: purple; font-weight: bold;">form</span>);
                    } else if (name.equals("li")) {
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>
</p></li>
</li>
</ul>
<h2>Commit: ac5e9e8</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>        Element el = new Element(Tag.valueOf(startTagName), baseUri);
</p></li>
<p>            // newEl.namespace(entry.namespace()); // todo: namespaces
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>            tb.transition(BeforeHead);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>        Element el = new Element(Tag.valueOf(startTagName), baseUri);
</p></li>
<p>            // newEl.namespace(entry.namespace()); // todo: namespaces
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>            tb.transition(BeforeHead);
</p></li>
</li>
</ul>
<h2>Commit: 21ee3e9</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>        return super.parse(input, baseUri, errors);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: f8a5dfb</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>        state = HtmlTreeBuilderState.Initial;
</p></li>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/ParseErrorList.java:</strong><br>
<p>        super(<span style="color: purple; font-weight: bold;">initialCapacity</span>);
        this.<span style="color: purple; font-weight: bold;">maxSize</span> = <span style="color: purple; font-weight: bold;">maxSize</span>;
    }
    
</p></li>
<p>        return new <span style="color: red; font-weight: bold;">ParseErrorList</span>(0, 0);
    }
    
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Parser.java:</strong><br>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tokeniser.java:</strong><br>
<p>        this.reader = reader;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>        Validate.notNull(input, "String input must not be null");
</p></li>
<p>        tokeniser = new Tokeniser(reader, errors);
</p></li>
<p>        initialiseParse(input, baseUri, <span style="color: purple; font-weight: bold;">errors</span>);
        runParser();
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>        state = HtmlTreeBuilderState.Initial;
</p></li>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Parser.java:</strong><br>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tokeniser.java:</strong><br>
<p>        this.reader = reader;
</p></li>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>        Validate.notNull(input, "String input must not be null");
</p></li>
<p>        <span style="color: purple; font-weight: bold;">errors</span> = <span style="color: purple; font-weight: bold;">trackErrors</span> ? new <span style="color: red; font-weight: bold;">ArrayList&lt;ParseError&gt;</span>() : null;
        tokeniser = new Tokeniser(reader, errors);
</p></li>
<p>        initialiseParse(input, baseUri, <span style="color: purple; font-weight: bold;">trackErrors</span>);
        runParser();
</p></li>
</li>
</ul>
<h2>Commit: 433d2f1</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>        state = HtmlTreeBuilderState.Initial;
</p></li>
<p>    }
</p></li>
<p>        currentToken = token;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Parser.java:</strong><br>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>        doc = new Document(baseUri);
</p></li>
<p>        this.<span style="color: purple; font-weight: bold;">trackErrors</span> = <span style="color: purple; font-weight: bold;">trackErrors</span>;
    }
</p></li>
<p>        initialiseParse(input, baseUri, <span style="color: purple; font-weight: bold;">trackErrors</span>);
        runParser();
</p></li>
<p>        return stack.getLast();
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilder.java:</strong><br>
<p>        state = HtmlTreeBuilderState.Initial;
</p></li>
<p>    }
</p></li>
<p>        currentToken = token;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Parser.java:</strong><br>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>        doc = new Document(baseUri);
</p></li>
<p>        runParser();
</p></li>
<p>        return stack.getLast();
</p></li>
</li>
</ul>
<h2>Commit: 13672ea</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilderState.java:</strong><br>
<p>    Initial {
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilderState.java:</strong><br>
<p>    Initial {
</p></li>
</li>
</ul>
<h2>Commit: 3d6f1e4</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilderState.java:</strong><br>
<p>
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilderState.java:</strong><br>
<p>
</p></li>
</li>
</ul>
<h2>Commit: 862c256</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                        return tb.process(t, InHead);
</p></li>
<p>                        if (tb.inButtonScope("p")) {
</p></li>
<p>                        if (tb.inButtonScope("p")) {
</p></li>
<p>                            tb.error(this);
</p></li>
<p>                        if (tb.inButtonScope("p")) {
</p></li>
<p>                                break;
</p></li>
<p>                        tb.framesetOk(false);
</p></li>
<p>                                tb.process(new Token.EndTag(el.nodeName()));
</p></li>
<p>                                break;
</p></li>
<p>                        tb.reconstructFormattingElements();
</p></li>
<p>                        tb.reconstructFormattingElements();
</p></li>
<p>                        tb.reconstructFormattingElements();
</p></li>
<p>                        tb.insertEmpty(startTag);
</p></li>
<p>                                inputAttribs.put(attr);
</p></li>
<p>                        if (tb.currentElement().nodeName().equals("option"))
</p></li>
<p>                        if (tb.inScope("ruby")) {
</p></li>
<p>                        tb.error(this);
</p></li>
<p>                        if (!tb.inScope(name)) {
</p></li>
<p>                        if (!tb.inScope(name)) {
</p></li>
<p>                        if (!tb.inScope(Constants.Headings)) {
                            tb.error(this);
</p></li>
<p>                        }
</p></li>
<p>                        // Adoption Agency Algorithm.
</p></li>
<p>                                if (lastNode.parent() != null)
</p></li>
<p>                        if (!tb.inScope("name")) {
</p></li>
<p>        private static final String[] <span style="color: purple; font-weight: bold;">InBodyStartToHead</span> = new String[]{&quot;base&quot;, &quot;basefont&quot;, &quot;bgsound&quot;, &quot;command&quot;, &quot;link&quot;, &quot;meta&quot;, &quot;noframes&quot;, &quot;script&quot;, &quot;style&quot;, &quot;title&quot;};
        private static final String[] <span style="color: purple; font-weight: bold;">InBodyStartPClosers</span> = new String[]{&quot;address&quot;, &quot;article&quot;, &quot;aside&quot;, &quot;blockquote&quot;, &quot;center&quot;, &quot;details&quot;, &quot;dir&quot;, &quot;div&quot;, &quot;dl&quot;,
                &quot;fieldset&quot;, &quot;figcaption&quot;, &quot;figure&quot;, &quot;footer&quot;, &quot;header&quot;, &quot;hgroup&quot;, &quot;menu&quot;, &quot;nav&quot;, &quot;ol&quot;,
                &quot;p&quot;, &quot;section&quot;, &quot;summary&quot;, &quot;ul&quot;};
        private static final String[] <span style="color: purple; font-weight: bold;">Headings</span> = new String[]{&quot;h1&quot;, &quot;h2&quot;, &quot;h3&quot;, &quot;h4&quot;, &quot;h5&quot;, &quot;h6&quot;};
        private static final String[] <span style="color: purple; font-weight: bold;">InBodyStartPreListing</span> = new String[]{&quot;pre&quot;, &quot;listing&quot;};
        private static final String[] <span style="color: purple; font-weight: bold;">InBodyStartLiBreakers</span> = new String[]{&quot;address&quot;, &quot;div&quot;, &quot;p&quot;};
        private static final String[] <span style="color: purple; font-weight: bold;">DdDt</span> = new String[]{&quot;dd&quot;, &quot;dt&quot;};
        private static final String[] <span style="color: purple; font-weight: bold;">Formatters</span> = new String[]{&quot;b&quot;, &quot;big&quot;, &quot;code&quot;, &quot;em&quot;, &quot;font&quot;, &quot;i&quot;, &quot;s&quot;, &quot;small&quot;, &quot;strike&quot;, &quot;strong&quot;, &quot;tt&quot;, &quot;u&quot;};
        private static final String[] <span style="color: purple; font-weight: bold;">InBodyStartApplets</span> = new String[]{&quot;applet&quot;, &quot;marquee&quot;, &quot;object&quot;};
        private static final String[] <span style="color: purple; font-weight: bold;">InBodyStartEmptyFormatters</span> = new String[]{&quot;area&quot;, &quot;br&quot;, &quot;embed&quot;, &quot;img&quot;, &quot;keygen&quot;, &quot;wbr&quot;};
        private static final String[] <span style="color: purple; font-weight: bold;">InBodyStartMedia</span> = new String[]{&quot;param&quot;, &quot;source&quot;, &quot;track&quot;};
        private static final String[] <span style="color: purple; font-weight: bold;">InBodyStartInputAttribs</span> = new String[]{&quot;name&quot;, &quot;action&quot;, &quot;prompt&quot;};
        private static final String[] <span style="color: purple; font-weight: bold;">InBodyStartOptions</span> = new String[]{&quot;optgroup&quot;, &quot;option&quot;};
        private static final String[] <span style="color: purple; font-weight: bold;">InBodyStartRuby</span> = new String[]{&quot;rp&quot;, &quot;rt&quot;};
        private static final String[] <span style="color: purple; font-weight: bold;">InBodyStartDrop</span> = new String[]{&quot;caption&quot;, &quot;col&quot;, &quot;colgroup&quot;, &quot;frame&quot;, &quot;head&quot;, &quot;tbody&quot;, &quot;td&quot;, &quot;tfoot&quot;, &quot;th&quot;, &quot;thead&quot;, &quot;tr&quot;};
        private static final String[] <span style="color: purple; font-weight: bold;">InBodyEndClosers</span> = new String[]{&quot;address&quot;, &quot;article&quot;, &quot;aside&quot;, &quot;blockquote&quot;, &quot;button&quot;, &quot;center&quot;, &quot;details&quot;, &quot;dir&quot;, &quot;div&quot;,
                &quot;dl&quot;, &quot;fieldset&quot;, &quot;figcaption&quot;, &quot;figure&quot;, &quot;footer&quot;, &quot;header&quot;, &quot;hgroup&quot;, &quot;listing&quot;, &quot;menu&quot;,
                &quot;nav&quot;, &quot;ol&quot;, &quot;pre&quot;, &quot;section&quot;, &quot;summary&quot;, &quot;ul&quot;};
        private static final String[] <span style="color: purple; font-weight: bold;">InBodyEndAdoptionFormatters</span> = new String[]{&quot;a&quot;, &quot;b&quot;, &quot;big&quot;, &quot;code&quot;, &quot;em&quot;, &quot;font&quot;, &quot;i&quot;, &quot;nobr&quot;, &quot;s&quot;, &quot;small&quot;, &quot;strike&quot;, &quot;strong&quot;, &quot;tt&quot;, &quot;u&quot;};
        private static final String[] <span style="color: purple; font-weight: bold;">InBodyEndTableFosters</span> = new String[]{"table", "tbody", "tfoot", "thead", "tr"};
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                        return tb.process(t, InHead);
</p></li>
<p>                            "address", "article", "aside", "blockquote", "center", "details", "dir", "div", "dl",
                            "fieldset", "figcaption", "figure", "footer", "header", "hgroup", "menu", "nav", "ol",
                            "p", "section", "summary", "ul")) {
                        if (tb.inButtonScope("p")) {
</p></li>
<p>                        if (tb.inButtonScope("p")) {
</p></li>
<p>                            tb.error(this);
</p></li>
<p>                        if (tb.inButtonScope("p")) {
</p></li>
<p>                                break;
</p></li>
<p>                        tb.framesetOk(false);
</p></li>
<p>                                tb.process(new Token.EndTag(el.nodeName()));
</p></li>
<p>                                break;
</p></li>
<p>                            "b", "big", "code", "em", "font", "i", "s", "small", "strike", "strong", "tt", "u")) {
                        tb.reconstructFormattingElements();
</p></li>
<p>                        tb.reconstructFormattingElements();
</p></li>
<p>                        tb.reconstructFormattingElements();
</p></li>
<p>                        tb.insertEmpty(startTag);
</p></li>
<p>                                inputAttribs.put(attr);
</p></li>
<p>                        if (tb.currentElement().nodeName().equals("option"))
</p></li>
<p>                        if (tb.inScope("ruby")) {
</p></li>
<p>                            "caption", "col", "colgroup", "frame", "head", "tbody", "td", "tfoot", "th", "thead", "tr")) {
                        tb.error(this);
</p></li>
<p>                            &quot;address&quot;, &quot;article&quot;, &quot;aside&quot;, &quot;blockquote&quot;, &quot;button&quot;, &quot;center&quot;, &quot;details&quot;, &quot;dir&quot;, &quot;div&quot;,
                            &quot;dl&quot;, &quot;fieldset&quot;, &quot;figcaption&quot;, &quot;figure&quot;, &quot;footer&quot;, &quot;header&quot;, &quot;hgroup&quot;, &quot;listing&quot;, &quot;menu&quot;,
                            &quot;nav&quot;, &quot;ol&quot;, &quot;pre&quot;, &quot;section&quot;, &quot;summary&quot;, &quot;ul&quot;)) {
                        <span style="color: blue; font-weight: bold;">// todo: refactor these lookups</span>
                        if (!tb.inScope(name)) {
</p></li>
<p>                        if (!tb.inScope(name)) {
</p></li>
<p>                        if (!tb.inScope(new String[]{"h1", "h2", "h3", "h4", "h5", "h6"})) {
                            tb.error(this);
</p></li>
<p>                        }
</p></li>
<p>                            "a", "b", "big", "code", "em", "font", "i", "nobr", "s", "small", "strike", "strong", "tt", "u")) {
                        // Adoption Agency Algorithm.
</p></li>
<p>                                if (lastNode.parent() != null)
</p></li>
<p>                        if (!tb.inScope("name")) {
</p></li>
</li>
</ul>
<h2>Commit: 1e84edb</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilderState.java:</strong><br>
<p>                        if (name.equals("base") && el.hasAttr("href"))
</p></li>
<p>                    } else if (name.equals("meta")) {
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>    private Token currentToken; // currentToken is used only for error tracking.
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilderState.java:</strong><br>
<p>                        if (name.equals("base") && el.hasAttr("href"))
</p></li>
<p>                    } else if (name.equals("meta")) {
</p></li>
</li>
</ul>
<h2>Commit: 95c64c0</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                                } else if (node == formatEl)
</p></li>
<p>
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                        for (int <span style="color: purple; font-weight: bold;">i</span> = 0; <span style="color: purple; font-weight: bold;">i</span> &lt; 8; <span style="color: purple; font-weight: bold;">i</span>++) {
</p></li>
<p>                            for (int <span style="color: purple; font-weight: bold;">j</span> = 0; <span style="color: purple; font-weight: bold;">j</span> &lt; 3; <span style="color: purple; font-weight: bold;">j</span>++) {
</p></li>
<p>                                } else if (<span style="color: purple; font-weight: bold;">node</span> == <span style="color: purple; font-weight: bold;">formatEl</span>)
</p></li>
<p>
</p></li>
</li>
</ul>
<h2>Commit: 9e9e158</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                            return <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">startTag</span>.<span style="color: green; font-weight: bold;">name</span>(&quot;img&quot;)); <span style="color: blue; font-weight: bold;">// change &lt;image&gt; to &lt;img&gt;, unless in svg</span>
                        else
                            <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">insert</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                    } else if (name.equals("isindex")) {
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                        <span style="color: purple; font-weight: bold;">startTag</span>.<span style="color: green; font-weight: bold;">name</span>(&quot;img&quot;);
                        return <span style="color: purple; font-weight: bold;">tb</span>.<span style="color: green; font-weight: bold;">process</span>(<span style="color: purple; font-weight: bold;">startTag</span>);
                    } else if (name.equals("isindex")) {
</p></li>
</li>
</ul>
<h2>Commit: 8627ba3</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                            for (int si = 0; si &lt; <span style="color: purple; font-weight: bold;">stackSize</span> && si < 64; si++) {
                                Element el = stack.get(si);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                                Element el = stack.get(si);
</p></li>
</li>
</ul>
<h2>Commit: 76399e5</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                            <span style="color: purple; font-weight: bold;">adopter</span>.<span style="color: green; font-weight: bold;">attributes</span>().<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">formatEl</span>.<span style="color: green; font-weight: bold;">attributes</span>());
                            Node[] childNodes = furthestBlock.childNodes().toArray(new Node[furthestBlock.childNodeSize()]);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                            Node[] childNodes = furthestBlock.childNodes().toArray(new Node[furthestBlock.childNodeSize()]);
</p></li>
</li>
</ul>
<h2>Commit: 2d56df2</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                            <span style="color: blue; font-weight: bold;">// run-aways</span>
                            for (int si = 0; <span style="color: purple; font-weight: bold;">si</span> &lt; <span style="color: purple; font-weight: bold;">stack</span>.<span style="color: green; font-weight: bold;">size</span>() &amp;&amp; <span style="color: purple; font-weight: bold;">si</span> < 64; si++) {
                                Element el = stack.get(si);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java:</strong><br>
<p>                                Element el = stack.get(si);
</p></li>
</li>
</ul>
<h2>Commit: 7fe8680</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilderState.java:</strong><br>
<p>                        return tb.process(t, InHead);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilderState.java:</strong><br>
<p>                        return tb.process(t, InHead);
</p></li>
</li>
</ul>
<h2>Commit: 7649933</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Parser.java:</strong><br>
<p>        return parser.parse();
    }
    
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Parser.java:</strong><br>
<p>        return parser.parse();
</p></li>
</li>
</ul>
<h2>Commit: 9db51cf</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Parser.java:</strong><br>
<p>        TokenStream <span style="color: purple; font-weight: bold;">ts</span> = <span style="color: purple; font-weight: bold;">TokenStream</span>.<span style="color: green; font-weight: bold;">create</span>(<span style="color: purple; font-weight: bold;">html</span>);
        Parser <span style="color: purple; font-weight: bold;">parser</span> = new <span style="color: red; font-weight: bold;">Parser</span>(<span style="color: purple; font-weight: bold;">ts</span>);
        return <span style="color: purple; font-weight: bold;">parser</span>.<span style="color: green; font-weight: bold;">parse</span>();
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: c4bb2a4</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        tags.put(defaultAncestor.tagName, defaultAncestor);
</p></li>
<p>    private boolean <span style="color: purple; font-weight: bold;">canContainBlock</span> = true; // Can this tag hold block level tags?
    private boolean <span style="color: purple; font-weight: bold;">canContainInline</span> = true; // only pcdata if not
    private boolean <span style="color: purple; font-weight: bold;">optionalClosing</span> = false; // If tag is open, and another seen, close previous tag
</p></li>
<p>    private List<Tag> ancestors;
</p></li>
<p>        this.tagName = tagName.toLowerCase();
</p></li>
<p>                tag.setAncestor(defaultAncestor.tagName);
</p></li>
<p>    }
</p></li>
<p>        inline.isBlock = false;
        inline.canContainBlock = false;
        return register(<span style="color: purple; font-weight: bold;">inline</span>);
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        tags.put(defaultAncestor.tagName, defaultAncestor);
</p></li>
<p>    private boolean <span style="color: purple; font-weight: bold;">canContainBlock</span>; // Can this tag hold block level tags?
    private boolean <span style="color: purple; font-weight: bold;">canContainInline</span>; // only pcdata if not
    private boolean <span style="color: purple; font-weight: bold;">optionalClosing</span>; // If tag is open, and another seen, close previous tag
    private boolean <span style="color: purple; font-weight: bold;">empty</span>; // can hold nothing; e.g. img
    private List<Tag> ancestors;
</p></li>
<p>        this.tagName = tagName.toLowerCase();
</p></li>
<p>        this.<span style="color: purple; font-weight: bold;">canContainBlock</span> = <span style="color: purple; font-weight: bold;">canContainBlock</span>;
        this.<span style="color: purple; font-weight: bold;">canContainInline</span> = <span style="color: purple; font-weight: bold;">canContainInline</span>;
        this.<span style="color: purple; font-weight: bold;">optionalClosing</span> = <span style="color: purple; font-weight: bold;">optionalClosing</span>;
        this.<span style="color: purple; font-weight: bold;">empty</span> = <span style="color: purple; font-weight: bold;">empty</span>;
    }
</p></li>
<p>                tag.setAncestor(defaultAncestor.tagName);
</p></li>
<p>    }
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: 548ce13</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>
</p></li>
<p>    private boolean <span style="color: purple; font-weight: bold;">canContainBlock</span>; <span style="color: blue; font-weight: bold;">// Can this tag hold block level tags?</span>
    private boolean <span style="color: purple; font-weight: bold;">canContainInline</span>; <span style="color: blue; font-weight: bold;">// only pcdata if not</span>
    private boolean <span style="color: purple; font-weight: bold;">optionalClosing</span>; <span style="color: blue; font-weight: bold;">// If tag is open, and another seen, close previous tag</span>
    private boolean <span style="color: purple; font-weight: bold;">empty</span>; <span style="color: blue; font-weight: bold;">// can hold nothing; e.g. img</span>

</p></li>
<p>        this.<span style="color: purple; font-weight: bold;">tagName</span> = <span style="color: purple; font-weight: bold;">tagName</span>.<span style="color: green; font-weight: bold;">toLowerCase</span>();
        <span style="color: purple; font-weight: bold;">isBlock</span> = <span style="color: purple; font-weight: bold;">block</span>;
        this.<span style="color: purple; font-weight: bold;">canContainBlock</span> = <span style="color: purple; font-weight: bold;">canContainBlock</span>;
        this.<span style="color: purple; font-weight: bold;">canContainInline</span> = <span style="color: purple; font-weight: bold;">canContainInline</span>;
        this.<span style="color: purple; font-weight: bold;">optionalClosing</span> = <span style="color: purple; font-weight: bold;">optionalClosing</span>;
        this.<span style="color: purple; font-weight: bold;">empty</span> = <span style="color: purple; font-weight: bold;">empty</span>;
    }

</p></li>
<p>        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">tagName</span>);
        <span style="color: purple; font-weight: bold;">tagName</span> = <span style="color: purple; font-weight: bold;">tagName</span>.<span style="color: green; font-weight: bold;">trim</span>().<span style="color: green; font-weight: bold;">toLowerCase</span>();
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">tagName</span>);

        synchronized (<span style="color: purple; font-weight: bold;">tags</span>) {
            Tag <span style="color: purple; font-weight: bold;">tag</span> = <span style="color: purple; font-weight: bold;">tags</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">tagName</span>);
            if (<span style="color: purple; font-weight: bold;">tag</span> == null) {
                <span style="color: blue; font-weight: bold;">// not defined: create default</span>
                <span style="color: blue; font-weight: bold;">// TODO: log, generate warning?</span>
                <span style="color: purple; font-weight: bold;">tag</span> = new <span style="color: red; font-weight: bold;">Tag</span>(<span style="color: purple; font-weight: bold;">tagName</span>, true, true, true, false, false);
                <span style="color: green; font-weight: bold;">register</span>(<span style="color: purple; font-weight: bold;">tag</span>);
            }
            return <span style="color: purple; font-weight: bold;">tag</span>;
        }
    }

</p></li>
<p>        <span style="color: blue; font-weight: bold;">// tags are set here in uppercase for legibility, but internally held as lowercase.</span>
        <span style="color: blue; font-weight: bold;">// TODO[must]: incorporate html 5 as appropriate</span>

        <span style="color: blue; font-weight: bold;">// fontstyle</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;TT&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;I&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;B&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;BIG&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;SMALL&quot;);

        <span style="color: blue; font-weight: bold;">// phrase</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;EM&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;STRONG&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;DFN&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;CODE&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;SAMP&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;KBD&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;VAR&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;CITE&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;ABBR&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;ACRONYM&quot;);

        <span style="color: blue; font-weight: bold;">// special</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;A&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// cannot contain self</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;IMG&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;OBJECT&quot;); <span style="color: blue; font-weight: bold;">// flow (block/inline) or param</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;BR&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;SCRIPT&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;MAP&quot;); <span style="color: blue; font-weight: bold;">// map is defined as inline, but can hold block (what?) or area. Seldom used so NBD.</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;Q&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;SUB&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;SUP&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;SPAN&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;BDO&quot;);

        <span style="color: blue; font-weight: bold;">// things past this point aren&#x27;t really blocks or inline. I&#x27;m using them because they can hold block or inline,</span>
        <span style="color: blue; font-weight: bold;">// but per the spec, only specific elements can hold this. if this becomes a real-world parsing problem,</span>
        <span style="color: blue; font-weight: bold;">// will need to have another non block/inline type, and explicit include &amp; exclude rules. should be right though</span>

        <span style="color: blue; font-weight: bold;">// block</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;P&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>(); <span style="color: blue; font-weight: bold;">// emasculated block?</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H1&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H2&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H3&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H4&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H5&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H6&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;UL&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;OL&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;PRE&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;DL&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;DIV&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;NOSCRIPT&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;BLOCKQUOTE&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;FORM&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// can&#x27;t contian self</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;HR&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TABLE&quot;); <span style="color: blue; font-weight: bold;">// specific list of only includes (tr, td, thead etc) not implemented</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;FIELDSET&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;ADDRESS&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();


        <span style="color: blue; font-weight: bold;">// formctrl</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;INPUT&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;SELECT&quot;); <span style="color: blue; font-weight: bold;">// just optgroup or option</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;TEXTAREA&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;LABEL&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// not self</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;BUTTON&quot;); <span style="color: blue; font-weight: bold;">// bunch of excludes not defined</span>

        <span style="color: blue; font-weight: bold;">// document</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;HTML&quot;); <span style="color: blue; font-weight: bold;">// specific includes not impl</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;HEAD&quot;); <span style="color: blue; font-weight: bold;">// specific includes not impl: SCRIPT, STYLE, META, LINK, OBJECT</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;BODY&quot;); <span style="color: blue; font-weight: bold;">// specific includes not impl</span>

        <span style="color: blue; font-weight: bold;">// other</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;AREA&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>(); <span style="color: blue; font-weight: bold;">// not an inline per-se</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;LINK&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>(); <span style="color: blue; font-weight: bold;">// only within head</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;PARAM&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>(); <span style="color: blue; font-weight: bold;">// only within object</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;INS&quot;); <span style="color: blue; font-weight: bold;">// only within body</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;DEL&quot;); <span style="color: blue; font-weight: bold;">// only within body</span>

        <span style="color: green; font-weight: bold;">createInline</span>(&quot;DT&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// only within DL. Prolly should create implicit DL?</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;DD&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// only within DL. Prolly should create implicit DL?</span>

        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;LI&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// only within OL or UL. Implicit?</span>

        <span style="color: green; font-weight: bold;">createInline</span>(&quot;OPTGROUP&quot;); <span style="color: blue; font-weight: bold;">// only in select, only contain option</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;OPTION&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;TEXTAREA&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;LEGEND&quot;); <span style="color: blue; font-weight: bold;">// only within fieldset (implicit?)</span>

</p></li>
<p>        <span style="color: green; font-weight: bold;">createInline</span>(&quot;CAPTION&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;THEAD&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// just TR</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;TFOOT&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// just TR</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;TBODY&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// optional / implicit open too. just TR</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;COLGROUP&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// just COL</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;COL&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;TR&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// just TH, TD</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TD&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>();
        
        <span style="color: blue; font-weight: bold;">// head</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;TITLE&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;BASE&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;META&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;STYLE&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>();
    }

</p></li>
<p>        return <span style="color: green; font-weight: bold;">register</span>(new <span style="color: red; font-weight: bold;">Tag</span>(<span style="color: purple; font-weight: bold;">tagName</span>, true, true, true, false, false));
    }

</p></li>
<p>        return <span style="color: green; font-weight: bold;">register</span>(new <span style="color: red; font-weight: bold;">Tag</span>(<span style="color: purple; font-weight: bold;">tagName</span>, false, false, true, false, false));
    }

</p></li>
<p>        synchronized (<span style="color: purple; font-weight: bold;">tags</span>) {
            <span style="color: purple; font-weight: bold;">tags</span>.<span style="color: green; font-weight: bold;">put</span>(tag.tagName, <span style="color: purple; font-weight: bold;">tag</span>);
        }
        return <span style="color: purple; font-weight: bold;">tag</span>;
    }

</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: 837d77f</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>            "svg", "math"
    };
</p></li>
<p>            "data", "bdi"
    };
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>    };
</p></li>
<p>    };
</p></li>
</li>
</ul>
<h2>Commit: 615f530</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>            "td", "video", "audio", "canvas", "details", "menu", "plaintext"
</p></li>
<p>            "ins", "del", "s"
    };
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>            "td", "video", "audio", "canvas", "details", "menu", "plaintext"
</p></li>
<p>    };
</p></li>
</li>
</ul>
<h2>Commit: ae80e51</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>    };
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>    };
</p></li>
</li>
</ul>
<h2>Commit: 94002db</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>
</p></li>
</li>
</ul>
<h2>Commit: 7690381</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>    };
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>    };
</p></li>
</li>
</ul>
<h2>Commit: e42cce4</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createInline("TT");
</p></li>
<p>        createInline("IMG").setEmpty().setAncestor("BODY", "NOSCRIPT"); // noscript so an image can be in html->head->noscript
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createInline("TT");
</p></li>
<p>        createInline("IMG").setEmpty().setAncestor("BODY", "NOSCRIPT"); // noscript so an image can be in html->head->noscript
</p></li>
</li>
</ul>
<h2>Commit: 9fcda18</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createBlock("HEAD").setParent("HTML").setLimitChildren();
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createBlock("HEAD").setParent("HTML").setLimitChildren();
</p></li>
</li>
</ul>
<h2>Commit: 6dbe51b</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createInline("BIG");
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: 82855b0</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createInline("BR").setEmpty();
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createInline("BR").setEmpty();
</p></li>
</li>
</ul>
<h2>Commit: 0b56f3e</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createBlock("P").setContainInlineOnly(); // emasculated block?
</p></li>
<p>        createBlock("H2").setAncestor("BODY", "HGROUP").setExcludes("HGROUP", "H1", "H2", "H3", "H4", "H5", "H6");
        createBlock("H3").setAncestor("BODY", "HGROUP").setExcludes("HGROUP", "H1", "H2", "H3", "H4", "H5", "H6");
        createBlock("H4").setAncestor("BODY", "HGROUP").setExcludes("HGROUP", "H1", "H2", "H3", "H4", "H5", "H6");
        createBlock("H5").setAncestor("BODY", "HGROUP").setExcludes("HGROUP", "H1", "H2", "H3", "H4", "H5", "H6");
        createBlock("H6").setAncestor("BODY", "HGROUP").setExcludes("HGROUP", "H1", "H2", "H3", "H4", "H5", "H6");
        createBlock("UL");
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createBlock("P").setContainInlineOnly(); // emasculated block?
</p></li>
<p>        createBlock("H2").setAncestor("BODY", "HGROUP").setExcludes("H1", "H2", "H3", "H4", "H5", "H6");
        createBlock("H3").setAncestor("BODY", "HGROUP").setExcludes("H1", "H2", "H3", "H4", "H5", "H6");
        createBlock("H4").setAncestor("BODY", "HGROUP").setExcludes("H1", "H2", "H3", "H4", "H5", "H6");
        createBlock("H5").setAncestor("BODY", "HGROUP").setExcludes("H1", "H2", "H3", "H4", "H5", "H6");
        createBlock("H6").setAncestor("BODY", "HGROUP").setExcludes("H1", "H2", "H3", "H4", "H5", "H6");
        createBlock("UL");
</p></li>
</li>
</ul>
<h2>Commit: b87be0c</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createBlock("P").setContainInlineOnly(); // emasculated block?
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createInline("BDO");
</p></li>
</li>
</ul>
<h2>Commit: 6e760a4</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createBlock(&quot;H2&quot;).setAncestor(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;H1&quot;, &quot;H2&quot;, &quot;H3&quot;, &quot;H4&quot;, &quot;H5&quot;, &quot;H6&quot;);
        createBlock(&quot;H3&quot;).setAncestor(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;H1&quot;, &quot;H2&quot;, &quot;H3&quot;, &quot;H4&quot;, &quot;H5&quot;, &quot;H6&quot;);
        createBlock(&quot;H4&quot;).setAncestor(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;H1&quot;, &quot;H2&quot;, &quot;H3&quot;, &quot;H4&quot;, &quot;H5&quot;, &quot;H6&quot;);
        createBlock(&quot;H5&quot;).setAncestor(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;H1&quot;, &quot;H2&quot;, &quot;H3&quot;, &quot;H4&quot;, &quot;H5&quot;, &quot;H6&quot;);
        createBlock(&quot;H6&quot;).setAncestor(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>("H1", "H2", "H3", "H4", "H5", "H6");
        createBlock("UL");
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createBlock(&quot;H2&quot;).setAncestor(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        createBlock(&quot;H3&quot;).setAncestor(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        createBlock(&quot;H4&quot;).setAncestor(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        createBlock(&quot;H5&quot;).setAncestor(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        createBlock(&quot;H6&quot;).setAncestor(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        createBlock("UL");
</p></li>
</li>
</ul>
<h2>Commit: f0f280c</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;SECTION&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;NAV&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;ASIDE&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setLimitChildren</span>(); <span style="color: blue; font-weight: bold;">// limited to h1 - h6</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;HEADER&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;HEADER&quot;, &quot;FOOTER&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;FOOTER&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>("HEADER", "FOOTER");

</p></li>
<p>        createInline("CODE");
</p></li>
<p>        createInline("ACRONYM");
</p></li>
<p>        
        <span style="color: blue; font-weight: bold;">// ruby</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;RUBY&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;RT&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;RUBY&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;RT&quot;, &quot;RP&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;RP&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;RUBY&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>("RT", "RP");

</p></li>
<p>        createInline("MAP"); // map is defined as inline, but can hold block (what?) or area. Seldom used so NBD.
</p></li>
<p>        <span style="color: green; font-weight: bold;">createInline</span>(&quot;EMBED&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();

</p></li>
<p>        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H2&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H3&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H4&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H5&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;H6&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;BODY&quot;, &quot;HGROUP&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        createBlock("UL");
</p></li>
<p>        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;FIGCAPTION&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>("FIGURE");

</p></li>
<p>        createBlock("FIELDSET").setAncestor("FORM");
</p></li>
<p>        <span style="color: blue; font-weight: bold;">// html5 form ctrl, not specced to have to be in forms</span>
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;DATALIST&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;KEYGEN&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;OUTPUT&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;PROGRESS&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;METER&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>();

</p></li>
<p>        createInline("PARAM").setParent("OBJECT").setEmpty();
</p></li>
<p>        <span style="color: blue; font-weight: bold;">// html5 media</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;VIDEO&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;VIDEO&quot;, &quot;AUDIO&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;AUDIO&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;VIDEO&quot;, &quot;AUDIO&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;SOURCE&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;VIDEO&quot;, &quot;AUDIO&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;TRACK&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;VIDEO&quot;, &quot;AUDIO&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;CANVAS&quot;);
        
        <span style="color: blue; font-weight: bold;">// html5 interactive</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;DETAILS&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;SUMMARY&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;DETAILS&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;COMMAND&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;MENU&quot;);
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;DEVICE&quot;).<span style="color: green; font-weight: bold;">setEmpty</span>();
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>
</p></li>
<p>        createInline("CODE");
</p></li>
<p>        createBlock(&quot;H2&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        createBlock(&quot;H3&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        createBlock(&quot;H4&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        createBlock(&quot;H5&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        createBlock(&quot;H6&quot;).<span style="color: green; font-weight: bold;">setContainInlineOnly</span>();
        createBlock("UL");
</p></li>
<p>
</p></li>
<p>        createBlock("FIELDSET").setAncestor("FORM");
</p></li>
<p>        createInline("PARAM").setParent("OBJECT").setEmpty();
</p></li>
</li>
</ul>
<h2>Commit: e05e185</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createBlock("BODY").setAncestor("HTML"); // specific includes not impl
</p></li>
<p>        createBlock("FIELDSET").setAncestor("FORM");
</p></li>
<p>        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;DD&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;DL&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;DL&quot;, &quot;DT&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // only within DL.

</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createBlock("BODY").setAncestor("HTML"); // specific includes not impl
</p></li>
<p>        createBlock("FIELDSET").setAncestor("FORM");
</p></li>
<p>        createBlock(&quot;DD&quot;).setAncestor(&quot;DL&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // only within DL.

</p></li>
</li>
</ul>
<h2>Commit: 7520dee</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createInline("INPUT").setAncestor("FORM").setEmpty();
</p></li>
<p>        <span style="color: blue; font-weight: bold;">// these are all used as blocks and dl need only be an ancestor</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;DL&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); <span style="color: blue; font-weight: bold;">// can&#x27;t nest</span>
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;DT&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;DL&quot;).setOptionalClosing(); // only within DL.
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;DD&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>("DL").setOptionalClosing(); // only within DL.

</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createInline("INPUT").setAncestor("FORM").setEmpty();
</p></li>
<p>        <span style="color: green; font-weight: bold;">createInline</span>(&quot;DT&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;DL&quot;).setOptionalClosing(); // only within DL.
        <span style="color: green; font-weight: bold;">createInline</span>(&quot;DD&quot;).<span style="color: green; font-weight: bold;">setParent</span>("DL").setOptionalClosing(); // only within DL.

</p></li>
</li>
</ul>
<h2>Commit: 0831a08</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createBlock("FIELDSET").setAncestor("FORM");
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>        if (<span style="color: purple; font-weight: bold;">count</span> > remainingLength())
            return false;
</p></li>
<p>        while (--<span style="color: purple; font-weight: bold;">count</span> &gt;= 0) {
            if (<span style="color: purple; font-weight: bold;">Character</span>.<span style="color: green; font-weight: bold;">toLowerCase</span>(<span style="color: purple; font-weight: bold;">seq</span>.<span style="color: green; font-weight: bold;">charAt</span>(<span style="color: purple; font-weight: bold;">count</span>)) != <span style="color: purple; font-weight: bold;">Character</span>.<span style="color: green; font-weight: bold;">toLowerCase</span>(<span style="color: purple; font-weight: bold;">queue</span>.<span style="color: green; font-weight: bold;">charAt</span>(<span style="color: purple; font-weight: bold;">pos</span>+<span style="color: purple; font-weight: bold;">count</span>)))
                return false;
        }
        return true;
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createBlock("FIELDSET").setAncestor("FORM");
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>        queue = new StringBuilder(data);
</p></li>
<p>    }
</p></li>
<p>        if (<span style="color: purple; font-weight: bold;">len</span> > remainingLength())
            return false;
</p></li>
<p>        return <span style="color: purple; font-weight: bold;">seq</span>.<span style="color: green; font-weight: bold;">toLowerCase</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">check</span>);
    }
</p></li>
</li>
</ul>
<h2>Commit: 0081d16</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>    }

    boolean <span style="color: green; font-weight: bold;">isValidAncestor</span>(Tag child) {
        if (child.ancestors.isEmpty())
</p></li>
<p>        createBlock(&quot;NOFRAMES&quot;).<span style="color: green; font-weight: bold;">setParent</span>("FRAMESET").setContainDataOnly();

</p></li>
<p>        createInline(&quot;OPTION&quot;).<span style="color: green; font-weight: bold;">setParent</span>("SELECT").setContainDataOnly();
        createBlock("FIELDSET").setAncestor("FORM");
</p></li>
<p>        createBlock("INS"); // only within body
</p></li>
<p>        createInline(&quot;DD&quot;).<span style="color: green; font-weight: bold;">setParent</span>("DL").setOptionalClosing(); // only within DL.

</p></li>
<p>        createBlock(&quot;THEAD&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TABLE&quot;).setOptionalClosing(); // just TR
        createBlock(&quot;TFOOT&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TABLE&quot;).setOptionalClosing(); // just TR
        createBlock(&quot;TBODY&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TABLE&quot;).setOptionalClosing(); // optional / implicit open too. just TR
        createBlock(&quot;COLGROUP&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TABLE&quot;).setOptionalClosing(); // just COL
        createBlock(&quot;COL&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;COLGROUP&quot;).setEmpty();
        createBlock(&quot;TR&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TABLE&quot;).setOptionalClosing(); // just TH, TD
        createBlock(&quot;TH&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TR&quot;).setOptionalClosing();
        createBlock(&quot;TD&quot;).<span style="color: green; font-weight: bold;">setParent</span>("TR").setOptionalClosing();
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createBlock(&quot;NOFRAMES&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>("FRAMESET").setContainDataOnly();

</p></li>
<p>        createInline(&quot;OPTION&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>("SELECT").setContainDataOnly();
        createBlock("FIELDSET").setAncestor("FORM");
</p></li>
<p>        createBlock("INS"); // only within body
</p></li>
<p>        createInline(&quot;DD&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>("DL").setOptionalClosing(); // only within DL.

</p></li>
<p>        createBlock(&quot;THEAD&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;TABLE&quot;).setOptionalClosing(); // just TR
        createBlock(&quot;TFOOT&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;TABLE&quot;).setOptionalClosing(); // just TR
        createBlock(&quot;TBODY&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;TABLE&quot;).setOptionalClosing(); // optional / implicit open too. just TR
        createBlock(&quot;COLGROUP&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;TABLE&quot;).setOptionalClosing(); // just COL
        createBlock(&quot;COL&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;COLGROUP&quot;).setEmpty();
        createBlock(&quot;TR&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;TABLE&quot;).setOptionalClosing(); // just TH, TD
        createBlock(&quot;TH&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;TR&quot;).setOptionalClosing();
        createBlock(&quot;TD&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>("TR").setOptionalClosing();
    }
</p></li>
</li>
</ul>
<h2>Commit: 45e787d</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createInline("TT");
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: 6788a6d</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>
</p></li>
<p>        createInline("STYLE").setAncestor("HEAD", "BODY").setContainDataOnly();
</p></li>
<p>        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;NOFRAMES&quot;).<span style="color: green; font-weight: bold;">setAncestor</span>(&quot;FRAMESET&quot;).<span style="color: green; font-weight: bold;">setContainDataOnly</span>();


</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createBlock("BLOCKQUOTE");
</p></li>
</li>
</ul>
<h2>Commit: ad405f9</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>    private List<Tag> ancestors;
</p></li>
<p>        createBlock("DIV");
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createBlock("DIV");
</p></li>
</li>
</ul>
<h2>Commit: ef74889</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createBlock("HEAD").setAncestor("HTML"); // specific includes not impl: SCRIPT, STYLE, META, LINK, OBJECT
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createBlock("HEAD").setAncestor("HTML"); // specific includes not impl: SCRIPT, STYLE, META, LINK, OBJECT
</p></li>
</li>
</ul>
<h2>Commit: 4bd743a</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createInline("LABEL").setOptionalClosing(); // not self
</p></li>
<p>        createInline("OPTION").setContainDataOnly();
        createInline("LEGEND"); // only within fieldset (implicit?)

</p></li>
<p>
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>            Character <span style="color: purple; font-weight: bold;">check</span> = <span style="color: purple; font-weight: bold;">Character</span>.<span style="color: green; font-weight: bold;">toLowerCase</span>(<span style="color: purple; font-weight: bold;">seqChars</span>[<span style="color: purple; font-weight: bold;">i</span>]);
            if (!<span style="color: purple; font-weight: bold;">found</span>.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">check</span>))
                return false;
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createInline("LABEL").setOptionalClosing(); // not self
</p></li>
<p>        createInline("OPTION").setContainDataOnly();
        createInline("TEXTAREA").setContainDataOnly();
        createInline("LEGEND"); // only within fieldset (implicit?)

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>                return false;
</p></li>
</li>
</ul>
<h2>Commit: 78d40f4</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;CAPTION&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;THEAD&quot;, &quot;TFOOT&quot;, &quot;TBODY&quot;, &quot;COLGROUP&quot;, &quot;COL&quot;, &quot;TR&quot;, &quot;TH&quot;, &quot;TD&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setIgnoreEnd</span>(&quot;BODY&quot;, &quot;COL&quot;, &quot;COLGROUP&quot;, &quot;HTML&quot;, &quot;TBODY&quot;, &quot;TD&quot;, &quot;TFOOT&quot;, &quot;TH&quot;, &quot;THEAD&quot;, &quot;TR&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;THEAD&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setLimitChildren</span>().<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setIgnoreEnd</span>(&quot;BODY&quot;, &quot;CAPTION&quot;, &quot;COL&quot;, &quot;COLGROUP&quot;, &quot;HTML&quot;, &quot;TD&quot;, &quot;TH&quot;, &quot;TR&quot;); // just TR
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TFOOT&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setLimitChildren</span>().<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setIgnoreEnd</span>(&quot;BODY&quot;, &quot;CAPTION&quot;, &quot;COL&quot;, &quot;COLGROUP&quot;, &quot;HTML&quot;, &quot;TD&quot;, &quot;TH&quot;, &quot;TR&quot;); // just TR
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TBODY&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setLimitChildren</span>().<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setIgnoreEnd</span>(&quot;BODY&quot;, &quot;CAPTION&quot;, &quot;COL&quot;, &quot;COLGROUP&quot;, &quot;HTML&quot;, &quot;TD&quot;, &quot;TH&quot;, &quot;TR&quot;); // optional / implicit open too. just TR
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;COLGROUP&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setLimitChildren</span>().<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setIgnoreEnd</span>("COL"); // just COL
        createBlock("COL").setParent("COLGROUP").setEmpty();
</p></li>
<p>        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TH&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TR&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;THEAD&quot;, &quot;TFOOT&quot;, &quot;TBODY&quot;, &quot;COLGROUP&quot;, &quot;COL&quot;, &quot;TR&quot;, &quot;TH&quot;, &quot;TD&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setIgnoreEnd</span>(&quot;BODY&quot;, &quot;CAPTION&quot;, &quot;COL&quot;, &quot;COLGROUP&quot;, &quot;HTML&quot;);
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TD&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TR&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;THEAD&quot;, &quot;TFOOT&quot;, &quot;TBODY&quot;, &quot;COLGROUP&quot;, &quot;COL&quot;, &quot;TR&quot;, &quot;TH&quot;, &quot;TD&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>().<span style="color: green; font-weight: bold;">setIgnoreEnd</span>("BODY", "CAPTION", "COL", "COLGROUP", "HTML");
        
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createBlock("CAPTION").setParent("TABLE").setExcludes("THEAD", "TFOOT", "TBODY", "COLGROUP", "COL", "TR", "TH", "TD").setOptionalClosing();
        createBlock("THEAD").setParent("TABLE").setLimitChildren().setOptionalClosing(); // just TR
        createBlock("TFOOT").setParent("TABLE").setLimitChildren().setOptionalClosing(); // just TR
        createBlock("TBODY").setParent("TABLE").setLimitChildren().setOptionalClosing(); // optional / implicit open too. just TR
        createBlock("COLGROUP").setParent("TABLE").setLimitChildren().setOptionalClosing(); // just COL
        createBlock("COL").setParent("COLGROUP").setEmpty();
</p></li>
<p>        createBlock("TH").setParent("TR").setExcludes("THEAD", "TFOOT", "TBODY", "COLGROUP", "COL", "TR", "TH", "TD").setOptionalClosing();
        createBlock("TD").setParent("TR").setExcludes("THEAD", "TFOOT", "TBODY", "COLGROUP", "COL", "TR", "TH", "TD").setOptionalClosing();
        
</p></li>
</li>
</ul>
<h2>Commit: a147ce5</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createBlock("THEAD").setParent("TABLE").setLimitChildren().setOptionalClosing(); // just TR
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        createBlock("THEAD").setParent("TABLE").setLimitChildren().setOptionalClosing(); // just TR
</p></li>
</li>
</ul>
<h2>Commit: ba5d660</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>                tag.isBlock = false;
</p></li>
<p>    }
</p></li>
<p>        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TFOOT&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setLimitChildren</span>().<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // just TR
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TBODY&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setLimitChildren</span>().<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // optional / implicit open too. just TR
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;COLGROUP&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setLimitChildren</span>().<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // just COL
        createBlock("COL").setParent("COLGROUP").setEmpty();
</p></li>
<p>        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TH&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TR&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;THEAD&quot;, &quot;TFOOT&quot;, &quot;TBODY&quot;, &quot;COLGROUP&quot;, &quot;COL&quot;, &quot;TR&quot;, &quot;TH&quot;, &quot;TD&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>();
        <span style="color: green; font-weight: bold;">createBlock</span>(&quot;TD&quot;).<span style="color: green; font-weight: bold;">setParent</span>(&quot;TR&quot;).<span style="color: green; font-weight: bold;">setExcludes</span>(&quot;THEAD&quot;, &quot;TFOOT&quot;, &quot;TBODY&quot;, &quot;COLGROUP&quot;, &quot;COL&quot;, &quot;TR&quot;, &quot;TH&quot;, &quot;TD&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>();
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>    }
</p></li>
<p>        createBlock(&quot;TFOOT&quot;).setParent(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // just TR
        createBlock(&quot;TBODY&quot;).setParent(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // optional / implicit open too. just TR
        createBlock(&quot;COLGROUP&quot;).setParent(&quot;TABLE&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>(); // just COL
        createBlock("COL").setParent("COLGROUP").setEmpty();
</p></li>
<p>        createBlock(&quot;TH&quot;).setParent(&quot;TR&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>();
        createBlock(&quot;TD&quot;).setParent(&quot;TR&quot;).<span style="color: green; font-weight: bold;">setOptionalClosing</span>();
    }
</p></li>
</li>
</ul>
<h2>Commit: 09b0d1b</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>            if (this.<span style="color: green; font-weight: bold;">equals</span>(child.ancestors.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">i</span>)))
                return true;
</p></li>
<p>        return false;
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>            if (this.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">tag</span>))
                return true;
</p></li>
<p>        return false;
</p></li>
</li>
</ul>
<h2>Commit: 9c8969d</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        if (child.ancestors.isEmpty())
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        if (child.ancestors.isEmpty())
</p></li>
</li>
</ul>
<h2>Commit: 9b85aea</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        if (tag == null) {
            // not defined: create default; go anywhere, do anything! (incl be inside a <p>)
            tag = new Tag(tagName);
            tag.isBlock = false;
            tag.canContainBlock = true;
        }
</p></li>
<p>    }
</p></li>
<p>        tags.put(tag.tagName, tag);
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>            Tag <span style="color: purple; font-weight: bold;">tag</span> = <span style="color: purple; font-weight: bold;">tags</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">tagName</span>);
            if (<span style="color: purple; font-weight: bold;">tag</span> == null) {
                <span style="color: blue; font-weight: bold;">// not defined: create default; go anywhere, do anything! (incl be inside a &lt;p&gt;)</span>
                <span style="color: purple; font-weight: bold;">tag</span> = new <span style="color: red; font-weight: bold;">Tag</span>(<span style="color: purple; font-weight: bold;">tagName</span>);
                tag.isBlock = false;
                tag.canContainBlock = true;
            }
            return <span style="color: purple; font-weight: bold;">tag</span>;
        }
</p></li>
<p>        synchronized (<span style="color: purple; font-weight: bold;">tags</span>) {
            <span style="color: purple; font-weight: bold;">tags</span>.<span style="color: green; font-weight: bold;">put</span>(tag.tagName, <span style="color: purple; font-weight: bold;">tag</span>);
        }
        return <span style="color: purple; font-weight: bold;">tag</span>;
    }
</p></li>
</li>
</ul>
<h2>Commit: c75e9cc</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        if (<span style="color: purple; font-weight: bold;">tag</span> == null) {
</p></li>
<p>            <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">tagName</span>);
            <span style="color: purple; font-weight: bold;">tag</span> = <span style="color: purple; font-weight: bold;">tags</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">tagName</span>);

            if (<span style="color: purple; font-weight: bold;">tag</span> == null) {
                <span style="color: blue; font-weight: bold;">// not defined: create default; go anywhere, do anything! (incl be inside a &lt;p&gt;)</span>
                <span style="color: purple; font-weight: bold;">tag</span> = new <span style="color: red; font-weight: bold;">Tag</span>(<span style="color: purple; font-weight: bold;">tagName</span>);
                tag.isBlock = false;
                tag.canContainBlock = true;
            }
        }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>        Validate.notEmpty(tagName);

        Tag tag = tags.get(tagName);
</p></li>
<p>            tag = new Tag(tagName);
            tag.isBlock = false;
            tag.canContainBlock = true;
        }
</p></li>
</li>
</ul>
<h2>Commit: 2cce405</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>                tag = new Tag(tagName);
</p></li>
<p>                tag.canContainBlock = true;
            }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>                tag = new Tag(tagName);
</p></li>
</li>
</ul>
<h2>Commit: 40979c9</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>            }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tag.java:</strong><br>
<p>                tag = new Tag(tagName, true, true, true, false, false);
</p></li>
<p>            }
</p></li>
</li>
</ul>
<h2>Commit: f61ba0f</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Token.java:</strong><br>
<p>            if (attributes == null)
</p></li>
<p>            // finalises for emit
</p></li>
<p>            Validate.isFalse(tagName == null || tagName.length() == 0);
</p></li>
<p>            tagName = name;
</p></li>
<p>            return selfClosing;
</p></li>
<p>            tagName = tagName == null ? append : tagName.concat(append);
</p></li>
<p>            pendingAttributeName = pendingAttributeName == null ? append : pendingAttributeName.concat(append);
</p></li>
<p>            ensureAttributeValue();
</p></li>
<p>            if (pendingAttributeValue == null)
</p></li>
<p>        StartTag() {
</p></li>
<p>        return type == TokenType.Doctype;
</p></li>
<p>        return type == TokenType.StartTag;
</p></li>
<p>        return (StartTag) this;
</p></li>
<p>        return type == TokenType.EndTag;
</p></li>
<p>        return (EndTag) this;
</p></li>
<p>        return type == TokenType.Comment;
</p></li>
<p>        return type == TokenType.Character;
</p></li>
<p>        return (Character) this;
</p></li>
<p>        Doctype,
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Token.java:</strong><br>
<p>            if (attributes == null)
</p></li>
<p>            // finalises for emit
</p></li>
<p>            Validate.isFalse(tagName == null || tagName.length() == 0);
</p></li>
<p>            tagName = name;
</p></li>
<p>            return selfClosing;
</p></li>
<p>            tagName = tagName == null ? append : tagName.concat(append);
</p></li>
<p>            pendingAttributeName = pendingAttributeName == null ? append : pendingAttributeName.concat(append);
</p></li>
<p>            ensureAttributeValue();
</p></li>
<p>            if (pendingAttributeValue == null)
</p></li>
<p>        StartTag() {
</p></li>
<p>        return type == TokenType.Doctype;
</p></li>
<p>        return type == TokenType.StartTag;
</p></li>
<p>        return (StartTag) this;
</p></li>
<p>        return type == TokenType.EndTag;
</p></li>
<p>        return (EndTag) this;
</p></li>
<p>        return type == TokenType.Comment;
</p></li>
<p>        return type == TokenType.Character;
</p></li>
<p>        return (Character) this;
</p></li>
<p>        Doctype,
</p></li>
</li>
</ul>
<h2>Commit: caf61a4</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Token.java:</strong><br>
<p>
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: 666275a</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Token.java:</strong><br>
<p>                <span style="color: purple; font-weight: bold;">attributes</span> = new <span style="color: red; font-weight: bold;">Attributes</span>();

            if (pendingAttributeName != null) {
</p></li>
<p>            type = TokenType.StartTag;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/Tokeniser.java:</strong><br>
<p>                error("Attributes incorrectly present on end tag");
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tokeniser.java:</strong><br>
<p>                error("Attributes incorrectly present on end tag");
</p></li>
</li>
</ul>
<h2>Commit: ede1316</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Token.java:</strong><br>
<p>
</p></li>
<p>                if (pendingAttributeValue == null)
</p></li>
<p>                else
                    <span style="color: purple; font-weight: bold;">attribute</span> = new <span style="color: red; font-weight: bold;">Attribute</span>(<span style="color: purple; font-weight: bold;">pendingAttributeName</span>, <span style="color: purple; font-weight: bold;">pendingAttributeValue</span>.<span style="color: green; font-weight: bold;">toString</span>());
                attributes.put(attribute);
</p></li>
<p>        }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Token.java:</strong><br>
<p>        private String pendingAttributeValue;

</p></li>
<p>                Attribute attribute = new Attribute(pendingAttributeName, <span style="color: purple; font-weight: bold;">pendingAttributeValue</span>);
                attributes.put(attribute);
</p></li>
<p>        }
</p></li>
</li>
</ul>
<h2>Commit: e187364</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Token.java:</strong><br>
<p>            return tagName;
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Token.java:</strong><br>
<p>            return tagName;
</p></li>
</li>
</ul>
<h2>Commit: e30ed5d</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Token.java:</strong><br>
<p>            return tagName;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>
</p></li>
<p>    private List<Token.Character> pendingTableCharacters = new ArrayList<Token.Character>(); // chars in table to be shifted out
</p></li>
<p>        this.baseUri = baseUri;
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Token.java:</strong><br>
<p>            return tagName;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>
</p></li>
<p>    private List<Token.Character> pendingTableCharacters = new ArrayList<Token.Character>(); // chars in table to be shifted out
</p></li>
<p>        this.baseUri = baseUri;
</p></li>
</li>
</ul>
<h2>Commit: 8633b01</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Token.java:</strong><br>
<p>                <span style="color: purple; font-weight: bold;">pendingAttributeValue</span>.<span style="color: green; font-weight: bold;">delete</span>(0, <span style="color: purple; font-weight: bold;">pendingAttributeValue</span>.<span style="color: green; font-weight: bold;">length</span>());
        }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Token.java:</strong><br>
<p>        }
</p></li>
</li>
</ul>
<h2>Commit: 027c415</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>    private static final Character ESC = '\\'; // escape char for chomp balanced.
</p></li>
<p>    }
</p></li>
<p>    }
    
</p></li>
<p>        return queue.<span style="color: green; font-weight: bold;">length</span>() - <span style="color: purple; font-weight: bold;">pos</span>;
    }
</p></li>
<p>            return false;
</p></li>
<p>        return seq.<span style="color: green; font-weight: bold;">equalsIgnoreCase</span>(check);
    }
</p></li>
<p>    }
</p></li>
<p>    }
</p></li>
<p>            consume();
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>    private static final Character ESC = '\\'; // escape char for chomp balanced.
</p></li>
<p>        char[] <span style="color: purple; font-weight: bold;">chars</span> = <span style="color: purple; font-weight: bold;">data</span>.<span style="color: green; font-weight: bold;">toCharArray</span>();
        for (char <span style="color: purple; font-weight: bold;">c</span> : <span style="color: purple; font-weight: bold;">chars</span>) {
            <span style="color: purple; font-weight: bold;">queue</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">c</span>);
        }
    }
</p></li>
<p>    }
</p></li>
<p>            return false;
</p></li>
<p>        char[] <span style="color: purple; font-weight: bold;">seqChars</span> = <span style="color: purple; font-weight: bold;">seq</span>.<span style="color: green; font-weight: bold;">toCharArray</span>();
        for (int <span style="color: purple; font-weight: bold;">i</span> = 0; <span style="color: purple; font-weight: bold;">i</span> &lt; <span style="color: purple; font-weight: bold;">len</span>; <span style="color: purple; font-weight: bold;">i</span>++) {
            Character <span style="color: purple; font-weight: bold;">found</span> = <span style="color: purple; font-weight: bold;">Character</span>.<span style="color: green; font-weight: bold;">toLowerCase</span>(<span style="color: purple; font-weight: bold;">chars</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">i</span>));
            Character <span style="color: purple; font-weight: bold;">check</span> = <span style="color: purple; font-weight: bold;">Character</span>.<span style="color: green; font-weight: bold;">toLowerCase</span>(<span style="color: purple; font-weight: bold;">seqChars</span>[<span style="color: purple; font-weight: bold;">i</span>]);
            if (!<span style="color: purple; font-weight: bold;">found</span>.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">check</span>))
                return false;
        }
        return true;
    }
</p></li>
<p>    }
</p></li>
<p>    }
</p></li>
<p>            consume();
</p></li>
</li>
</ul>
<h2>Commit: 03336ea</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>
</p></li>
<p>        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">data</span>);

        <span style="color: purple; font-weight: bold;">queue</span> = new <span style="color: red; font-weight: bold;">LinkedList&lt;Character&gt;</span>();
        char[] <span style="color: purple; font-weight: bold;">chars</span> = <span style="color: purple; font-weight: bold;">data</span>.<span style="color: green; font-weight: bold;">toCharArray</span>();
        for (char <span style="color: purple; font-weight: bold;">c</span> : <span style="color: purple; font-weight: bold;">chars</span>) {
            <span style="color: purple; font-weight: bold;">queue</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">c</span>);
        }
    }

</p></li>
<p>        return <span style="color: purple; font-weight: bold;">queue</span>.<span style="color: green; font-weight: bold;">isEmpty</span>();
    }

</p></li>
<p>        int <span style="color: purple; font-weight: bold;">len</span> = <span style="color: purple; font-weight: bold;">seq</span>.<span style="color: green; font-weight: bold;">length</span>();
        if (<span style="color: purple; font-weight: bold;">len</span> &gt; <span style="color: purple; font-weight: bold;">queue</span>.<span style="color: green; font-weight: bold;">size</span>())
            return false;
        List&lt;Character&gt; <span style="color: purple; font-weight: bold;">chars</span> = <span style="color: purple; font-weight: bold;">queue</span>.<span style="color: green; font-weight: bold;">subList</span>(0, <span style="color: purple; font-weight: bold;">len</span>);
        char[] <span style="color: purple; font-weight: bold;">seqChars</span> = <span style="color: purple; font-weight: bold;">seq</span>.<span style="color: green; font-weight: bold;">toCharArray</span>();
        for (int <span style="color: purple; font-weight: bold;">i</span> = 0; <span style="color: purple; font-weight: bold;">i</span> &lt; <span style="color: purple; font-weight: bold;">len</span>; <span style="color: purple; font-weight: bold;">i</span>++) {
            if (!<span style="color: purple; font-weight: bold;">chars</span>.<span style="color: green; font-weight: bold;">get</span>(<span style="color: purple; font-weight: bold;">i</span>).<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">seqChars</span>[<span style="color: purple; font-weight: bold;">i</span>]))
                return false;
        }
        return true;
    }

</p></li>
<p>        if (<span style="color: green; font-weight: bold;">matches</span>(<span style="color: purple; font-weight: bold;">seq</span>)) {
            <span style="color: green; font-weight: bold;">consume</span>(<span style="color: purple; font-weight: bold;">seq</span>);
            return true;
        } else {
            return false;
        }
    }

</p></li>
<p>        while (!<span style="color: purple; font-weight: bold;">queue</span>.<span style="color: green; font-weight: bold;">isEmpty</span>() &amp;&amp; <span style="color: purple; font-weight: bold;">Character</span>.<span style="color: green; font-weight: bold;">isWhitespace</span>(<span style="color: purple; font-weight: bold;">queue</span>.<span style="color: green; font-weight: bold;">peekFirst</span>())) {
            <span style="color: green; font-weight: bold;">consume</span>();
        }
    }

</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: 6cff72a</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>    }
</p></li>
<p>        return <span style="color: purple; font-weight: bold;">seq</span>.<span style="color: green; font-weight: bold;">toLowerCase</span>().<span style="color: green; font-weight: bold;">equals</span>(check);
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>        return seq.<span style="color: green; font-weight: bold;">equalsIgnoreCase</span>(check);
    }
</p></li>
</li>
</ul>
<h2>Commit: 19aecf2</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>            return true;
</p></li>
<p>    }
</p></li>
<p>    }
</p></li>
<p>            seen = true;
</p></li>
<p>            <span style="color: purple; font-weight: bold;">pos</span>++;
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>            return true;
</p></li>
<p>    }
</p></li>
<p>    }
</p></li>
<p>            seen = true;
</p></li>
<p>            pos++;
</p></li>
</li>
</ul>
<h2>Commit: 8a49d09</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>            pos++;
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>            pos++;
</p></li>
</li>
</ul>
<h2>Commit: e5f6e08</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>        int <span style="color: purple; font-weight: bold;">start</span> = <span style="color: purple; font-weight: bold;">pos</span>;
        while (!<span style="color: green; font-weight: bold;">isEmpty</span>() &amp;&amp; (<span style="color: green; font-weight: bold;">matchesWord</span>() || <span style="color: green; font-weight: bold;">matchesAny</span>(&quot;|&quot;)))
            <span style="color: purple; font-weight: bold;">pos</span>++;
        
        return <span style="color: purple; font-weight: bold;">queue</span>.<span style="color: green; font-weight: bold;">substring</span>(<span style="color: purple; font-weight: bold;">start</span>, <span style="color: purple; font-weight: bold;">pos</span>);
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        Validate.notEmpty(tagName);
</p></li>
<p>        <span style="color: blue; font-weight: bold;">// namespaces: if element name is &quot;abc:def&quot;, selector must be &quot;abc|def&quot;, so flip:</span>
        if (<span style="color: purple; font-weight: bold;">tagName</span>.<span style="color: green; font-weight: bold;">contains</span>(&quot;|&quot;))
            <span style="color: purple; font-weight: bold;">tagName</span> = <span style="color: purple; font-weight: bold;">tagName</span>.<span style="color: green; font-weight: bold;">replace</span>("|", ":");
        return root.getElementsByTag(tagName);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        Validate.notEmpty(tagName);
</p></li>
<p>        return root.getElementsByTag(tagName);
</p></li>
</li>
</ul>
<h2>Commit: 40a3575</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>            consume();
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>            consume();
</p></li>
</li>
</ul>
<h2>Commit: eb95cc7</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>        boolean <span style="color: purple; font-weight: bold;">seen</span> = false;
        while (!queue.isEmpty() && Character.isWhitespace(queue.peekFirst())) {
</p></li>
<p>        }
</p></li>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        boolean <span style="color: purple; font-weight: bold;">seenWhite</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consumeWhitespace</span>();
        if (!tq.isEmpty()) { 
            if (tq.matchChomp(",")) { // group or
</p></li>
<p>                return filterForChildren(elements, <span style="color: purple; font-weight: bold;">candidates</span>);
            } else if (<span style="color: purple; font-weight: bold;">seenWhite</span>) { <span style="color: blue; font-weight: bold;">// ancestor descendant</span>
                Elements <span style="color: purple; font-weight: bold;">candidates</span> = new <span style="color: red; font-weight: bold;">Elements</span>(<span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">remainder</span>(), <span style="color: purple; font-weight: bold;">elements</span>));
                return <span style="color: green; font-weight: bold;">filterForDescendants</span>(<span style="color: purple; font-weight: bold;">elements</span>, <span style="color: purple; font-weight: bold;">candidates</span>);
            } else { <span style="color: blue; font-weight: bold;">// E.class, E#id, E[attr] etc. AND</span>
                Elements <span style="color: purple; font-weight: bold;">candidates</span> = new <span style="color: red; font-weight: bold;">Elements</span>(<span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">remainder</span>(), <span style="color: purple; font-weight: bold;">elements</span>));
                return <span style="color: green; font-weight: bold;">filterForSelf</span>(<span style="color: purple; font-weight: bold;">elements</span>, <span style="color: purple; font-weight: bold;">candidates</span>);
            }
</p></li>
<p>    private static Elements filterForChildren(Collection&lt;Element&gt; parents, Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">candidates</span>) {
        Elements children = new Elements();
</p></li>
<p>            for (Element p : parents) {
</p></li>
<p>                }
            }
        }
        return children;
    }
    
    <span style="color: blue; font-weight: bold;">// children or lower descendants. input candidates stemmed from found elements, so are either a descendant </span>
    <span style="color: blue; font-weight: bold;">// or the original element; so check that parent is not child</span>
    private static Elements <span style="color: green; font-weight: bold;">filterForDescendants</span>(Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">parents</span>, Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">candidates</span>) {
        Elements <span style="color: purple; font-weight: bold;">children</span> = new <span style="color: red; font-weight: bold;">Elements</span>();
        <span style="color: purple; font-weight: bold;">CHILD</span>: for (Element <span style="color: purple; font-weight: bold;">c</span> : <span style="color: purple; font-weight: bold;">candidates</span>) {
            boolean <span style="color: purple; font-weight: bold;">found</span> = false;
            for (Element <span style="color: purple; font-weight: bold;">p</span> : <span style="color: purple; font-weight: bold;">parents</span>) {
                if (<span style="color: purple; font-weight: bold;">c</span>.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">p</span>)) {
                    <span style="color: purple; font-weight: bold;">found</span> = true;
                    continue <span style="color: purple; font-weight: bold;">CHILD</span>;
                }
</p></li>
<p>                <span style="color: purple; font-weight: bold;">children</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">c</span>);
        }
        return <span style="color: purple; font-weight: bold;">children</span>;
    }
    
    <span style="color: blue; font-weight: bold;">// union of both sets, for e.class type selectors</span>
    private static Elements <span style="color: green; font-weight: bold;">filterForSelf</span>(Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">parents</span>, Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">candidates</span>) {
        Elements <span style="color: purple; font-weight: bold;">children</span> = new <span style="color: red; font-weight: bold;">Elements</span>();
        <span style="color: purple; font-weight: bold;">CHILD</span>: for (Element <span style="color: purple; font-weight: bold;">c</span> : <span style="color: purple; font-weight: bold;">candidates</span>) {
            for (Element <span style="color: purple; font-weight: bold;">p</span> : <span style="color: purple; font-weight: bold;">parents</span>) {
                if (<span style="color: purple; font-weight: bold;">c</span>.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">p</span>)) {
                    <span style="color: purple; font-weight: bold;">children</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">c</span>);
                    continue <span style="color: purple; font-weight: bold;">CHILD</span>;
                }
            }   
        }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>        while (!queue.isEmpty() && Character.isWhitespace(queue.peekFirst())) {
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>
</p></li>
<p>        if (!tq.isEmpty()) {
            if (tq.matchChomp(",")) { // group or
</p></li>
<p>                return filterForChildren(elements, <span style="color: purple; font-weight: bold;">candidateChildren</span>);
            } else { <span style="color: blue; font-weight: bold;">// ancestor descendant (AND, really)</span>
                return new Elements(select(tq.remainder(), elements));
            }
</p></li>
<p>        Elements children = new Elements();
</p></li>
<p>            for (Element p : parents) {
</p></li>
<p>                }
</p></li>
</li>
</ul>
<h2>Commit: bbca7db</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Collector.java:</strong><br>
<p>        return elements;
</p></li>
<p>            this.<span style="color: purple; font-weight: bold;">root</span> = <span style="color: purple; font-weight: bold;">root</span>;
            this.elements = elements;
</p></li>
<p>                    elements.add(el);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/Evaluator.java:</strong><br>
<p>    }

</p></li>
<p>            this.tagName = tagName;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/QueryParser.java:</strong><br>
<p>
</p></li>
<p>
</p></li>
<p>        this.<span style="color: purple; font-weight: bold;">query</span> = <span style="color: purple; font-weight: bold;">query</span>;
        this.<span style="color: purple; font-weight: bold;">tq</span> = new <span style="color: red; font-weight: bold;">TokenQueue</span>(<span style="color: purple; font-weight: bold;">query</span>);
    }

</p></li>
<p>        QueryParser <span style="color: purple; font-weight: bold;">p</span> = new <span style="color: red; font-weight: bold;">QueryParser</span>(<span style="color: purple; font-weight: bold;">query</span>);
        return <span style="color: purple; font-weight: bold;">p</span>.<span style="color: green; font-weight: bold;">parse</span>();
    }

</p></li>
<p>        <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consumeWhitespace</span>();

        if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchesAny</span>(<span style="color: purple; font-weight: bold;">combinators</span>)) { <span style="color: blue; font-weight: bold;">// if starts with a combinator, use root as elements</span>
            <span style="color: purple; font-weight: bold;">evals</span>.<span style="color: green; font-weight: bold;">add</span>(new <span style="color: red; font-weight: bold;">RootSelector</span>());
            <span style="color: green; font-weight: bold;">combinator</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consume</span>());
        } else {
            <span style="color: green; font-weight: bold;">findElements</span>();
        }

        while (!<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">isEmpty</span>()) {
            <span style="color: blue; font-weight: bold;">// hierarchy and extras</span>
            boolean <span style="color: purple; font-weight: bold;">seenWhite</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consumeWhitespace</span>();

            if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;,&quot;)) { <span style="color: blue; font-weight: bold;">// group or</span>
                OrSelector <span style="color: purple; font-weight: bold;">or</span> = new <span style="color: red; font-weight: bold;">OrSelector</span>(<span style="color: purple; font-weight: bold;">evals</span>);
                <span style="color: purple; font-weight: bold;">evals</span>.<span style="color: green; font-weight: bold;">clear</span>();
                <span style="color: purple; font-weight: bold;">evals</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">or</span>);
                while (!<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">isEmpty</span>()) {
                    String <span style="color: purple; font-weight: bold;">subQuery</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>(&quot;,&quot;);
                    <span style="color: purple; font-weight: bold;">or</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: green; font-weight: bold;">parse</span>(<span style="color: purple; font-weight: bold;">subQuery</span>));
                }
            } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchesAny</span>(<span style="color: purple; font-weight: bold;">combinators</span>)) {
                <span style="color: green; font-weight: bold;">combinator</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consume</span>());
            } else if (<span style="color: purple; font-weight: bold;">seenWhite</span>) {
                <span style="color: green; font-weight: bold;">combinator</span>(&#x27; &#x27;);
            } else { <span style="color: blue; font-weight: bold;">// E.class, E#id, E[attr] etc. AND</span>
                <span style="color: green; font-weight: bold;">findElements</span>(); <span style="color: blue; font-weight: bold;">// take next el, #. etc off queue</span>
            }
        }

        if (<span style="color: purple; font-weight: bold;">evals</span>.<span style="color: green; font-weight: bold;">size</span>() == 1)
            return <span style="color: purple; font-weight: bold;">evals</span>.<span style="color: green; font-weight: bold;">get</span>(0);

        return new <span style="color: red; font-weight: bold;">AndSelector</span>(<span style="color: purple; font-weight: bold;">evals</span>);
    }

</p></li>
<p>        if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;#&quot;))
            <span style="color: green; font-weight: bold;">byId</span>();
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;.&quot;))
            <span style="color: green; font-weight: bold;">byClass</span>();
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchesWord</span>())
            <span style="color: green; font-weight: bold;">byTag</span>();
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;[&quot;))
            <span style="color: green; font-weight: bold;">byAttribute</span>();
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;*&quot;))
            <span style="color: green; font-weight: bold;">allElements</span>();
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;:lt(&quot;))
            <span style="color: green; font-weight: bold;">indexLessThan</span>();
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;:gt(&quot;))
            <span style="color: green; font-weight: bold;">indexGreaterThan</span>();
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;:eq(&quot;))
            <span style="color: green; font-weight: bold;">indexEquals</span>();
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;:has(&quot;))
            <span style="color: green; font-weight: bold;">has</span>();
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;:contains(&quot;))
            <span style="color: green; font-weight: bold;">contains</span>(false);
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;:containsOwn(&quot;))
            <span style="color: green; font-weight: bold;">contains</span>(true);
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;:matches(&quot;))
            <span style="color: green; font-weight: bold;">matches</span>(false);
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;:matchesOwn(&quot;))
            <span style="color: green; font-weight: bold;">matches</span>(true);
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;:not(&quot;))
            <span style="color: green; font-weight: bold;">not</span>();
        else <span style="color: blue; font-weight: bold;">// unhandled</span>
            throw new <span style="color: red; font-weight: bold;">Selector.SelectorParseException</span>(&quot;Could not parse query &#x27;%s&#x27;: unexpected token at &#x27;%s&#x27;&quot;, <span style="color: purple; font-weight: bold;">query</span>, <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">remainder</span>());

    }

</p></li>
<p>        String <span style="color: purple; font-weight: bold;">tagName</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consumeElementSelector</span>();
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">tagName</span>);

        <span style="color: blue; font-weight: bold;">// namespaces: if element name is &quot;abc:def&quot;, selector must be &quot;abc|def&quot;, so flip:</span>
        if (<span style="color: purple; font-weight: bold;">tagName</span>.<span style="color: green; font-weight: bold;">contains</span>(&quot;|&quot;))
            <span style="color: purple; font-weight: bold;">tagName</span> = <span style="color: purple; font-weight: bold;">tagName</span>.<span style="color: green; font-weight: bold;">replace</span>(&quot;|&quot;, &quot;:&quot;);

        <span style="color: purple; font-weight: bold;">evals</span>.<span style="color: green; font-weight: bold;">add</span>(new <span style="color: red; font-weight: bold;">Evaluator.Tag</span>(<span style="color: purple; font-weight: bold;">tagName</span>.<span style="color: green; font-weight: bold;">trim</span>().<span style="color: green; font-weight: bold;">toLowerCase</span>()));
    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        this.root = root;
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Collector.java:</strong><br>
<p>        return elements;
</p></li>
<p>            this.elements = elements;
</p></li>
<p>                    elements.add(el);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Evaluator.java:</strong><br>
<p>    
    /**
</p></li>
<p>            this.tagName = tagName;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        this.<span style="color: purple; font-weight: bold;">query</span> = <span style="color: purple; font-weight: bold;">query</span>;
        this.root = root;
</p></li>
<p>    }
</p></li>
<p>        
        if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchesAny</span>(<span style="color: purple; font-weight: bold;">combinators</span>)) { <span style="color: blue; font-weight: bold;">// if starts with a combinator, use root as elements</span>
            <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">root</span>);
            <span style="color: green; font-weight: bold;">combinator</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consume</span>());
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;:has(&quot;)) {
            <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getAllElements</span>());
        } else {
            <span style="color: green; font-weight: bold;">addElements</span>(<span style="color: green; font-weight: bold;">findElements</span>()); <span style="color: blue; font-weight: bold;">// chomp first element matcher off queue </span>
        }            
               
        while (!<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">isEmpty</span>()) {
            <span style="color: blue; font-weight: bold;">// hierarchy and extras</span>
            boolean <span style="color: purple; font-weight: bold;">seenWhite</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consumeWhitespace</span>();
            
            if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;,&quot;)) { <span style="color: blue; font-weight: bold;">// group or</span>
                while (!<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">isEmpty</span>()) {
                    String <span style="color: purple; font-weight: bold;">subQuery</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>(&quot;,&quot;);
                    <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">subQuery</span>, <span style="color: purple; font-weight: bold;">root</span>));
                }
            } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchesAny</span>(<span style="color: purple; font-weight: bold;">combinators</span>)) {
                <span style="color: green; font-weight: bold;">combinator</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consume</span>());
            } else if (<span style="color: purple; font-weight: bold;">seenWhite</span>) {
                <span style="color: green; font-weight: bold;">combinator</span>(&#x27; &#x27;);
            } else { <span style="color: blue; font-weight: bold;">// E.class, E#id, E[attr] etc. AND</span>
                Elements <span style="color: purple; font-weight: bold;">candidates</span> = <span style="color: green; font-weight: bold;">findElements</span>(); <span style="color: blue; font-weight: bold;">// take next el, #. etc off queue</span>
                <span style="color: green; font-weight: bold;">intersectElements</span>(<span style="color: green; font-weight: bold;">filterForSelf</span>(<span style="color: purple; font-weight: bold;">elements</span>, <span style="color: purple; font-weight: bold;">candidates</span>));
            }
        }
        return new <span style="color: red; font-weight: bold;">Elements</span>(<span style="color: purple; font-weight: bold;">elements</span>);
    }
    
    private void <span style="color: green; font-weight: bold;">combinator</span>(char <span style="color: purple; font-weight: bold;">combinator</span>) {
        <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consumeWhitespace</span>();
        String <span style="color: purple; font-weight: bold;">subQuery</span> = <span style="color: green; font-weight: bold;">consumeSubQuery</span>(); <span style="color: blue; font-weight: bold;">// support multi &gt; childs</span>
        
        Elements <span style="color: purple; font-weight: bold;">output</span>;
        if (<span style="color: purple; font-weight: bold;">combinator</span> == &#x27;&gt;&#x27;)
            <span style="color: purple; font-weight: bold;">output</span> = <span style="color: green; font-weight: bold;">filterForChildren</span>(<span style="color: purple; font-weight: bold;">elements</span>, <span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">subQuery</span>, <span style="color: purple; font-weight: bold;">elements</span>));
        else if (<span style="color: purple; font-weight: bold;">combinator</span> == &#x27; &#x27;)
            <span style="color: purple; font-weight: bold;">output</span> = <span style="color: green; font-weight: bold;">filterForDescendants</span>(<span style="color: purple; font-weight: bold;">elements</span>, <span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">subQuery</span>, <span style="color: purple; font-weight: bold;">elements</span>));
        else if (<span style="color: purple; font-weight: bold;">combinator</span> == &#x27;+&#x27;)
            <span style="color: purple; font-weight: bold;">output</span> = <span style="color: green; font-weight: bold;">filterForAdjacentSiblings</span>(<span style="color: purple; font-weight: bold;">elements</span>, <span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">subQuery</span>, <span style="color: purple; font-weight: bold;">root</span>));
        else if (<span style="color: purple; font-weight: bold;">combinator</span> == &#x27;~&#x27;)
            <span style="color: purple; font-weight: bold;">output</span> = <span style="color: green; font-weight: bold;">filterForGeneralSiblings</span>(<span style="color: purple; font-weight: bold;">elements</span>, <span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">subQuery</span>, <span style="color: purple; font-weight: bold;">root</span>));
        else
            throw new <span style="color: red; font-weight: bold;">IllegalStateException</span>(&quot;Unknown combinator: &quot; + <span style="color: purple; font-weight: bold;">combinator</span>);
        
        <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">clear</span>(); <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">output</span>);
    }

    private String <span style="color: green; font-weight: bold;">consumeSubQuery</span>() {
        StringBuilder <span style="color: purple; font-weight: bold;">sq</span> = new <span style="color: red; font-weight: bold;">StringBuilder</span>();
        while (!<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">isEmpty</span>()) {
            if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;(&quot;))
                <span style="color: purple; font-weight: bold;">sq</span>.<span style="color: green; font-weight: bold;">append</span>(&quot;(&quot;).<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompBalanced</span>(&#x27;(&#x27;, &#x27;)&#x27;)).<span style="color: green; font-weight: bold;">append</span>(&quot;)&quot;);
            else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;[&quot;))
                <span style="color: purple; font-weight: bold;">sq</span>.<span style="color: green; font-weight: bold;">append</span>(&quot;[&quot;).<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompBalanced</span>(&#x27;[&#x27;, &#x27;]&#x27;)).<span style="color: green; font-weight: bold;">append</span>(&quot;]&quot;);
            else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchesAny</span>(<span style="color: purple; font-weight: bold;">combinators</span>))
                break;
            else
                <span style="color: purple; font-weight: bold;">sq</span>.<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consume</span>());
        }
        return <span style="color: purple; font-weight: bold;">sq</span>.<span style="color: green; font-weight: bold;">toString</span>();
    }
    
    private Elements <span style="color: green; font-weight: bold;">findElements</span>() {
        if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;#&quot;)) {
            return <span style="color: green; font-weight: bold;">byId</span>();
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;.&quot;)) {
            return <span style="color: green; font-weight: bold;">byClass</span>();
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchesWord</span>()) {
            return <span style="color: green; font-weight: bold;">byTag</span>();
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;[&quot;)) {
            return <span style="color: green; font-weight: bold;">byAttribute</span>();
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;*&quot;)) {
            return <span style="color: green; font-weight: bold;">allElements</span>();
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;:lt(&quot;)) {
            return <span style="color: green; font-weight: bold;">indexLessThan</span>();
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;:gt(&quot;)) {
            return <span style="color: green; font-weight: bold;">indexGreaterThan</span>();
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;:eq(&quot;)) {
            return <span style="color: green; font-weight: bold;">indexEquals</span>();
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;:has(&quot;)) {
            return <span style="color: green; font-weight: bold;">has</span>();
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;:contains(&quot;)) {
            return <span style="color: green; font-weight: bold;">contains</span>(false);
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;:containsOwn(&quot;)) {
            return <span style="color: green; font-weight: bold;">contains</span>(true);
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;:matches(&quot;)) {
            return <span style="color: green; font-weight: bold;">matches</span>(false);
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;:matchesOwn(&quot;)) {
            return <span style="color: green; font-weight: bold;">matches</span>(true);
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;:not(&quot;)) {
            return <span style="color: green; font-weight: bold;">not</span>();
        } else { <span style="color: blue; font-weight: bold;">// unhandled</span>
            throw new <span style="color: red; font-weight: bold;">SelectorParseException</span>(&quot;Could not parse query &#x27;%s&#x27;: unexpected token at &#x27;%s&#x27;&quot;, <span style="color: purple; font-weight: bold;">query</span>, <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">remainder</span>());
        }
    }
    
    private void <span style="color: green; font-weight: bold;">addElements</span>(Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">add</span>) {
        <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">add</span>);
    }
    
    private void <span style="color: green; font-weight: bold;">intersectElements</span>(Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">intersect</span>) {
        <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">retainAll</span>(<span style="color: purple; font-weight: bold;">intersect</span>);
    }

    private Elements <span style="color: green; font-weight: bold;">byId</span>() {
        String <span style="color: purple; font-weight: bold;">id</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consumeCssIdentifier</span>();
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">id</span>);

        Element <span style="color: purple; font-weight: bold;">found</span> = <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementById</span>(<span style="color: purple; font-weight: bold;">id</span>);
        Elements <span style="color: purple; font-weight: bold;">byId</span> = new <span style="color: red; font-weight: bold;">Elements</span>();
        if(<span style="color: purple; font-weight: bold;">found</span> != null)
            <span style="color: purple; font-weight: bold;">byId</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">found</span>);
        return <span style="color: purple; font-weight: bold;">byId</span>;
    }

    private Elements <span style="color: green; font-weight: bold;">byClass</span>() {
        String <span style="color: purple; font-weight: bold;">className</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consumeCssIdentifier</span>();
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">className</span>);

        return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByClass</span>(<span style="color: purple; font-weight: bold;">className</span>);
    }

    private Elements <span style="color: green; font-weight: bold;">byTag</span>() {
        String <span style="color: purple; font-weight: bold;">tagName</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consumeElementSelector</span>();
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">tagName</span>);
        
        <span style="color: blue; font-weight: bold;">// namespaces: if element name is &quot;abc:def&quot;, selector must be &quot;abc|def&quot;, so flip:</span>
        if (<span style="color: purple; font-weight: bold;">tagName</span>.<span style="color: green; font-weight: bold;">contains</span>(&quot;|&quot;))
            <span style="color: purple; font-weight: bold;">tagName</span> = <span style="color: purple; font-weight: bold;">tagName</span>.<span style="color: green; font-weight: bold;">replace</span>(&quot;|&quot;, &quot;:&quot;);
        return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByTag</span>(<span style="color: purple; font-weight: bold;">tagName</span>);
    }

    private Elements <span style="color: green; font-weight: bold;">byAttribute</span>() {
        TokenQueue <span style="color: purple; font-weight: bold;">cq</span> = new <span style="color: red; font-weight: bold;">TokenQueue</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompBalanced</span>(&#x27;[&#x27;, &#x27;]&#x27;)); <span style="color: blue; font-weight: bold;">// content queue</span>
        String <span style="color: purple; font-weight: bold;">key</span> = <span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">consumeToAny</span>(&quot;=&quot;, &quot;!=&quot;, &quot;^=&quot;, &quot;$=&quot;, &quot;*=&quot;, &quot;~=&quot;); <span style="color: blue; font-weight: bold;">// eq, not, start, end, contain, match, (no val)</span>
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">key</span>);
        <span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">consumeWhitespace</span>();

        if (<span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">isEmpty</span>()) {
            return <span style="color: purple; font-weight: bold;">key</span>.<span style="color: green; font-weight: bold;">startsWith</span>(&quot;^&quot;) ? <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByAttributeStarting</span>(<span style="color: purple; font-weight: bold;">key</span>.<span style="color: green; font-weight: bold;">substring</span>(1)) : <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByAttribute</span>(<span style="color: purple; font-weight: bold;">key</span>);
        } else {
            if (<span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;=&quot;))
                return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByAttributeValue</span>(<span style="color: purple; font-weight: bold;">key</span>, <span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">remainder</span>());

            else if (<span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;!=&quot;))
                return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByAttributeValueNot</span>(<span style="color: purple; font-weight: bold;">key</span>, <span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">remainder</span>());

            else if (<span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;^=&quot;))
                return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByAttributeValueStarting</span>(<span style="color: purple; font-weight: bold;">key</span>, <span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">remainder</span>());

            else if (<span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;$=&quot;))
                return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByAttributeValueEnding</span>(<span style="color: purple; font-weight: bold;">key</span>, <span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">remainder</span>());

            else if (<span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;*=&quot;))
                return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByAttributeValueContaining</span>(<span style="color: purple; font-weight: bold;">key</span>, <span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">remainder</span>());
            
            else if (<span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;~=&quot;))
                return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByAttributeValueMatching</span>(<span style="color: purple; font-weight: bold;">key</span>, <span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">remainder</span>());
            
            else
                throw new <span style="color: red; font-weight: bold;">SelectorParseException</span>(&quot;Could not parse attribute query &#x27;%s&#x27;: unexpected token at &#x27;%s&#x27;&quot;, <span style="color: purple; font-weight: bold;">query</span>, <span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">remainder</span>());
        }
    }

    private Elements <span style="color: green; font-weight: bold;">allElements</span>() {
        return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getAllElements</span>();
    }
    
    <span style="color: blue; font-weight: bold;">// pseudo selectors :lt, :gt, :eq</span>
    private Elements <span style="color: green; font-weight: bold;">indexLessThan</span>() {
        return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByIndexLessThan</span>(<span style="color: green; font-weight: bold;">consumeIndex</span>());
    }
    
    private Elements <span style="color: green; font-weight: bold;">indexGreaterThan</span>() {
        return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByIndexGreaterThan</span>(<span style="color: green; font-weight: bold;">consumeIndex</span>());
    }
    
    private Elements <span style="color: green; font-weight: bold;">indexEquals</span>() {
        return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByIndexEquals</span>(<span style="color: green; font-weight: bold;">consumeIndex</span>());
    }

    private int <span style="color: green; font-weight: bold;">consumeIndex</span>() {
        String <span style="color: purple; font-weight: bold;">indexS</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>(&quot;)&quot;).<span style="color: green; font-weight: bold;">trim</span>();
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">isTrue</span>(<span style="color: purple; font-weight: bold;">StringUtil</span>.<span style="color: green; font-weight: bold;">isNumeric</span>(<span style="color: purple; font-weight: bold;">indexS</span>), &quot;Index must be numeric&quot;);
        return <span style="color: purple; font-weight: bold;">Integer</span>.<span style="color: green; font-weight: bold;">parseInt</span>(<span style="color: purple; font-weight: bold;">indexS</span>);
    }

    <span style="color: blue; font-weight: bold;">// pseudo selector :has(el)</span>
    private Elements <span style="color: green; font-weight: bold;">has</span>() {
        <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consume</span>(&quot;:has&quot;);
        String <span style="color: purple; font-weight: bold;">subQuery</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompBalanced</span>(&#x27;(&#x27;,&#x27;)&#x27;);
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">subQuery</span>, &quot;:has(el) subselect must not be empty&quot;);

        return <span style="color: green; font-weight: bold;">filterForParentsOfDescendants</span>(<span style="color: purple; font-weight: bold;">elements</span>, <span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">subQuery</span>, <span style="color: purple; font-weight: bold;">elements</span>));
    }
    
    <span style="color: blue; font-weight: bold;">// pseudo selector :contains(text), containsOwn(text)</span>
    private Elements <span style="color: green; font-weight: bold;">contains</span>(boolean <span style="color: purple; font-weight: bold;">own</span>) {
        <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consume</span>(<span style="color: purple; font-weight: bold;">own</span> ? &quot;:containsOwn&quot; : &quot;:contains&quot;);
        String <span style="color: purple; font-weight: bold;">searchText</span> = <span style="color: purple; font-weight: bold;">TokenQueue</span>.<span style="color: green; font-weight: bold;">unescape</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompBalanced</span>(&#x27;(&#x27;,&#x27;)&#x27;));
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">searchText</span>, &quot;:contains(text) query must not be empty&quot;);
        
        return <span style="color: purple; font-weight: bold;">own</span> ? <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsContainingOwnText</span>(<span style="color: purple; font-weight: bold;">searchText</span>) : <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsContainingText</span>(<span style="color: purple; font-weight: bold;">searchText</span>);
    }
    
    <span style="color: blue; font-weight: bold;">// :matches(regex), matchesOwn(regex)</span>
    private Elements <span style="color: green; font-weight: bold;">matches</span>(boolean <span style="color: purple; font-weight: bold;">own</span>) {
        <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consume</span>(<span style="color: purple; font-weight: bold;">own</span>? &quot;:matchesOwn&quot; : &quot;:matches&quot;);
        String <span style="color: purple; font-weight: bold;">regex</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompBalanced</span>(&#x27;(&#x27;, &#x27;)&#x27;); <span style="color: blue; font-weight: bold;">// don&#x27;t unescape, as regex bits will be escaped</span>
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">regex</span>, &quot;:matches(regex) query must not be empty&quot;);
        
        return <span style="color: purple; font-weight: bold;">own</span> ? <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsMatchingOwnText</span>(<span style="color: purple; font-weight: bold;">regex</span>) : <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsMatchingText</span>(<span style="color: purple; font-weight: bold;">regex</span>);
    }

    <span style="color: blue; font-weight: bold;">// :not(selector)</span>
    private Elements <span style="color: green; font-weight: bold;">not</span>() {
        <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consume</span>(&quot;:not&quot;);
        String <span style="color: purple; font-weight: bold;">subQuery</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompBalanced</span>(&#x27;(&#x27;, &#x27;)&#x27;);
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">subQuery</span>, &quot;:not(selector) subselect must not be empty&quot;);

        return <span style="color: green; font-weight: bold;">filterOut</span>(<span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getAllElements</span>(), <span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">subQuery</span>, <span style="color: purple; font-weight: bold;">root</span>));
    }

    <span style="color: blue; font-weight: bold;">// direct child descendants</span>
    private static Elements <span style="color: green; font-weight: bold;">filterForChildren</span>(Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">parents</span>, Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">candidates</span>) {
        Elements <span style="color: purple; font-weight: bold;">children</span> = new <span style="color: red; font-weight: bold;">Elements</span>();
        <span style="color: purple; font-weight: bold;">CHILD</span>: for (Element <span style="color: purple; font-weight: bold;">c</span> : <span style="color: purple; font-weight: bold;">candidates</span>) {
            for (Element <span style="color: purple; font-weight: bold;">p</span> : <span style="color: purple; font-weight: bold;">parents</span>) {
                if (<span style="color: purple; font-weight: bold;">c</span>.<span style="color: green; font-weight: bold;">parent</span>() != null &amp;&amp; <span style="color: purple; font-weight: bold;">c</span>.<span style="color: green; font-weight: bold;">parent</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">p</span>)) {
                    <span style="color: purple; font-weight: bold;">children</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">c</span>);
                    continue <span style="color: purple; font-weight: bold;">CHILD</span>;
                }
            }
        }
        return <span style="color: purple; font-weight: bold;">children</span>;
    }
    
    <span style="color: blue; font-weight: bold;">// children or lower descendants. input candidates stemmed from found elements, so are either a descendant </span>
    <span style="color: blue; font-weight: bold;">// or the original element; so check that parent is not child</span>
    private static Elements <span style="color: green; font-weight: bold;">filterForDescendants</span>(Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">parents</span>, Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">candidates</span>) {
        Elements <span style="color: purple; font-weight: bold;">children</span> = new <span style="color: red; font-weight: bold;">Elements</span>();
        <span style="color: purple; font-weight: bold;">CHILD</span>: for (Element <span style="color: purple; font-weight: bold;">c</span> : <span style="color: purple; font-weight: bold;">candidates</span>) {
            for (Element <span style="color: purple; font-weight: bold;">p</span> : <span style="color: purple; font-weight: bold;">parents</span>) {
                if (<span style="color: purple; font-weight: bold;">c</span>.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">p</span>)) {
                    continue <span style="color: purple; font-weight: bold;">CHILD</span>;
                }
            }
            <span style="color: purple; font-weight: bold;">children</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">c</span>);
        }
        return <span style="color: purple; font-weight: bold;">children</span>;
    }

    <span style="color: blue; font-weight: bold;">// implements :has(el). Finds elements that contain the matched elements</span>
    private static Elements <span style="color: green; font-weight: bold;">filterForParentsOfDescendants</span>(Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">parents</span>, Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">children</span>) {
        Elements <span style="color: purple; font-weight: bold;">filteredParents</span> = new <span style="color: red; font-weight: bold;">Elements</span>();
        for (Element <span style="color: purple; font-weight: bold;">p</span> : <span style="color: purple; font-weight: bold;">parents</span>) {
            for (Element <span style="color: purple; font-weight: bold;">c</span> : <span style="color: purple; font-weight: bold;">children</span>) {
                if (<span style="color: purple; font-weight: bold;">c</span>.<span style="color: green; font-weight: bold;">parents</span>().<span style="color: green; font-weight: bold;">contains</span>(<span style="color: purple; font-weight: bold;">p</span>)) {
                    <span style="color: purple; font-weight: bold;">filteredParents</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">p</span>);
                }
            }
        }
        return <span style="color: purple; font-weight: bold;">filteredParents</span>;
    }
    
    <span style="color: blue; font-weight: bold;">// adjacent siblings</span>
    private static Elements <span style="color: green; font-weight: bold;">filterForAdjacentSiblings</span>(Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">elements</span>, Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">candidates</span>) {
        Elements <span style="color: purple; font-weight: bold;">siblings</span> = new <span style="color: red; font-weight: bold;">Elements</span>();
        <span style="color: purple; font-weight: bold;">SIBLING</span>: for (Element <span style="color: purple; font-weight: bold;">c</span>: <span style="color: purple; font-weight: bold;">candidates</span>) {
            for (Element <span style="color: purple; font-weight: bold;">e</span>: <span style="color: purple; font-weight: bold;">elements</span>) {
                if (!<span style="color: purple; font-weight: bold;">e</span>.<span style="color: green; font-weight: bold;">parent</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">c</span>.<span style="color: green; font-weight: bold;">parent</span>()))
                    continue;
                Element <span style="color: purple; font-weight: bold;">previousSib</span> = <span style="color: purple; font-weight: bold;">c</span>.<span style="color: green; font-weight: bold;">previousElementSibling</span>();
                if (<span style="color: purple; font-weight: bold;">previousSib</span> != null &amp;&amp; <span style="color: purple; font-weight: bold;">previousSib</span>.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">e</span>)) {
                    <span style="color: purple; font-weight: bold;">siblings</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">c</span>);
                    continue <span style="color: purple; font-weight: bold;">SIBLING</span>;
                }
            }
        }
        return <span style="color: purple; font-weight: bold;">siblings</span>;
    }
    
    <span style="color: blue; font-weight: bold;">// preceeding siblings</span>
    private static Elements <span style="color: green; font-weight: bold;">filterForGeneralSiblings</span>(Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">elements</span>, Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">candidates</span>) {
        Elements <span style="color: purple; font-weight: bold;">output</span> = new <span style="color: red; font-weight: bold;">Elements</span>();
        <span style="color: purple; font-weight: bold;">SIBLING</span>: for (Element <span style="color: purple; font-weight: bold;">c</span>: <span style="color: purple; font-weight: bold;">candidates</span>) {
            for (Element <span style="color: purple; font-weight: bold;">e</span>: <span style="color: purple; font-weight: bold;">elements</span>) {
                if (!<span style="color: purple; font-weight: bold;">e</span>.<span style="color: green; font-weight: bold;">parent</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">c</span>.<span style="color: green; font-weight: bold;">parent</span>()))
                    continue;
                int <span style="color: purple; font-weight: bold;">ePos</span> = <span style="color: purple; font-weight: bold;">e</span>.<span style="color: green; font-weight: bold;">elementSiblingIndex</span>();
                int <span style="color: purple; font-weight: bold;">cPos</span> = <span style="color: purple; font-weight: bold;">c</span>.<span style="color: green; font-weight: bold;">elementSiblingIndex</span>();
                if (<span style="color: purple; font-weight: bold;">cPos</span> &gt; <span style="color: purple; font-weight: bold;">ePos</span>) {
                    <span style="color: purple; font-weight: bold;">output</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">c</span>);
                    continue <span style="color: purple; font-weight: bold;">SIBLING</span>;
                }
            }
        }
        return <span style="color: purple; font-weight: bold;">output</span>;
    }
    
    <span style="color: blue; font-weight: bold;">// union of both sets, for e.class type selectors</span>
    private static Elements <span style="color: green; font-weight: bold;">filterForSelf</span>(Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">parents</span>, Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">candidates</span>) {
        Elements <span style="color: purple; font-weight: bold;">children</span> = new <span style="color: red; font-weight: bold;">Elements</span>();
        <span style="color: purple; font-weight: bold;">CHILD</span>: for (Element <span style="color: purple; font-weight: bold;">c</span> : <span style="color: purple; font-weight: bold;">candidates</span>) {
            for (Element <span style="color: purple; font-weight: bold;">p</span> : <span style="color: purple; font-weight: bold;">parents</span>) {
                if (<span style="color: purple; font-weight: bold;">c</span>.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">p</span>)) {
                    <span style="color: purple; font-weight: bold;">children</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">c</span>);
                    continue <span style="color: purple; font-weight: bold;">CHILD</span>;
                }
            }   
        }
        return <span style="color: purple; font-weight: bold;">children</span>;
    }
</p></li>
</li>
</ul>
<h2>Commit: f11c3b4</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>        if (count > remainingLength())
</p></li>
<p>    	
    	return <span style="color: purple; font-weight: bold;">queue</span>.<span style="color: green; font-weight: bold;">regionMatches</span>(true, <span style="color: purple; font-weight: bold;">pos</span>, <span style="color: purple; font-weight: bold;">seq</span>, 0, <span style="color: purple; font-weight: bold;">seq</span>.<span style="color: green; font-weight: bold;">length</span>());
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokenQueue.java:</strong><br>
<p>        if (<span style="color: purple; font-weight: bold;">count</span> &gt; <span style="color: green; font-weight: bold;">remainingLength</span>())
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: 8e52445</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tokeniser.java:</strong><br>
<p>
</p></li>
<p>    }

</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TokeniserState.java:</strong><br>
<p>                    t.emit(data);
</p></li>
<p>            String tagName = r.<span style="color: green; font-weight: bold;">consumeTagName</span>().toLowerCase();
            t.tagPending.appendTagName(tagName);
</p></li>
<p>            t.tagPending.appendAttributeName(name.toLowerCase());
</p></li>
<p>    private static final char[] <span style="color: purple; font-weight: bold;">attributeDoubleValueCharsSorted</span> = new char[]{&#x27;&quot;&#x27;, &#x27;&amp;&#x27;, <span style="color: purple; font-weight: bold;">nullChar</span>};
    private static final char[] <span style="color: purple; font-weight: bold;">attributeNameCharsSorted</span> = new char[]{&#x27;\t&#x27;, &#x27;\n&#x27;, &#x27;\r&#x27;, &#x27;\f&#x27;, &#x27; &#x27;, &#x27;/&#x27;, &#x27;=&#x27;, &#x27;&gt;&#x27;, <span style="color: purple; font-weight: bold;">nullChar</span>, '"', '\'', '<'};

</p></li>
<p>        <span style="color: purple; font-weight: bold;">Arrays</span>.<span style="color: green; font-weight: bold;">sort</span>(<span style="color: purple; font-weight: bold;">attributeDoubleValueCharsSorted</span>);
        <span style="color: purple; font-weight: bold;">Arrays</span>.<span style="color: green; font-weight: bold;">sort</span>(<span style="color: purple; font-weight: bold;">attributeNameCharsSorted</span>);
    }

</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokeniserState.java:</strong><br>
<p>                    t.emit(data);
</p></li>
<p>            t.tagPending.appendTagName(tagName);
</p></li>
<p>            t.tagPending.appendAttributeName(name.toLowerCase());
</p></li>
<p>    private static final char replacementChar = Tokeniser.replacementChar;
</p></li>
</li>
</ul>
<h2>Commit: 4ec4cf2</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tokeniser.java:</strong><br>
<p>    private StringBuilder <span style="color: purple; font-weight: bold;">charsBuilder</span> = new StringBuilder(1024); <span style="color: blue; font-weight: bold;">// buffers characters to output as one token, if more than one emit per read</span>
    StringBuilder dataBuffer; // buffers data looking for </script>
</p></li>
<p>            String str = <span style="color: purple; font-weight: bold;">charsBuilder</span>.toString();
            <span style="color: purple; font-weight: bold;">charsBuilder</span>.delete(0, <span style="color: purple; font-weight: bold;">charsBuilder</span>.length());
            <span style="color: purple; font-weight: bold;">charsString</span> = null;
            return new Token.Character(str);
</p></li>
<p>            Token <span style="color: purple; font-weight: bold;">token</span> = new <span style="color: red; font-weight: bold;">Token.Character</span>(<span style="color: purple; font-weight: bold;">charsString</span>);
            <span style="color: purple; font-weight: bold;">charsString</span> = null;
            return <span style="color: purple; font-weight: bold;">token</span>;
        } else {
</p></li>
<p>        <span style="color: blue; font-weight: bold;">// buffer strings up until last string token found, to emit only one token for a run of character refs etc.</span>
</p></li>
<p>            <span style="color: purple; font-weight: bold;">charsString</span> = <span style="color: purple; font-weight: bold;">str</span>;
        }
        else {
            if (<span style="color: purple; font-weight: bold;">charsBuilder</span>.<span style="color: green; font-weight: bold;">length</span>() == 0) { <span style="color: blue; font-weight: bold;">// switching to string builder as more than one emit before read</span>
                <span style="color: purple; font-weight: bold;">charsBuilder</span>.<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">charsString</span>);
            }
            <span style="color: purple; font-weight: bold;">charsBuilder</span>.<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">str</span>);
        }
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tokeniser.java:</strong><br>
<p>    StringBuilder dataBuffer; // buffers data looking for </script>
</p></li>
<p>            String str = <span style="color: purple; font-weight: bold;">charBuffer</span>.toString();
            <span style="color: purple; font-weight: bold;">charBuffer</span>.delete(0, <span style="color: purple; font-weight: bold;">charBuffer</span>.length());
            return new Token.Character(str);
</p></li>
<p>        <span style="color: blue; font-weight: bold;">// buffer strings up until last string token found, to emit only one token for a run of character refs etc.</span>
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: be94f55</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tokeniser.java:</strong><br>
<p>        this.reader = reader;
</p></li>
<p>        this.trackErrors = <span style="color: purple; font-weight: bold;">errors</span> != null;
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>        errors = <span style="color: purple; font-weight: bold;">trackErrors</span> ? new <span style="color: red; font-weight: bold;">ArrayList&lt;ParseError&gt;</span>() : null;
        tokeniser = new Tokeniser(reader, <span style="color: purple; font-weight: bold;">errors</span>);
        stack = new DescendableLinkedList<Element>();
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tokeniser.java:</strong><br>
<p>        this.reader = reader;
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>        stack = new DescendableLinkedList<Element>();
</p></li>
<p>        this.trackErrors = trackErrors;
    }
</p></li>
</li>
</ul>
<h2>Commit: 1894858</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/Tokeniser.java:</strong><br>
<p>    char[] consumeCharacterReference(Character additionalAllowedCharacter, boolean inAttribute) {
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: 4de5fe8</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokeniserState.java:</strong><br>
<p>            }
</p></li>
<p>            }
</p></li>
<p>                    if (<span style="color: purple; font-weight: bold;">ref</span> != null &amp;&amp; ref.length&gt;0)
                        t.tagPending.appendAttributeValue(new <span style="color: red; font-weight: bold;">String</span>(<span style="color: purple; font-weight: bold;">ref</span>));
                    else
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokeniserState.java:</strong><br>
<p>            }
</p></li>
<p>            }
</p></li>
<p>                    if (ref != null)
                        t.tagPending.appendAttributeValue(<span style="color: purple; font-weight: bold;">ref</span>);
                    else
</p></li>
</li>
</ul>
<h2>Commit: 82200d7</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokeniserState.java:</strong><br>
<p>                    if (ref != null && ref.length>0)
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TokeniserState.java:</strong><br>
<p>                    if (ref != null && ref.length>0)
</p></li>
</li>
</ul>
<h2>Commit: 7d7a298</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>        doc = new Document(baseUri);
</p></li>
<p>        this.errors = errors;
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>        <span style="color: green; font-weight: bold;">init</span>(<span style="color: purple; font-weight: bold;">baseUri</span>, <span style="color: purple; font-weight: bold;">errors</span>);
    }

    protected void <span style="color: green; font-weight: bold;">initialiseParse</span>(CharBuffer <span style="color: purple; font-weight: bold;">input</span>, String <span style="color: purple; font-weight: bold;">baseUri</span>, ParseErrorList <span style="color: purple; font-weight: bold;">errors</span>) {
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">input</span>, &quot;Input buffer must not be null&quot;);
        <span style="color: purple; font-weight: bold;">reader</span> = new <span style="color: red; font-weight: bold;">CharacterReader</span>(<span style="color: purple; font-weight: bold;">input</span>);
        <span style="color: green; font-weight: bold;">init</span>(<span style="color: purple; font-weight: bold;">baseUri</span>, <span style="color: purple; font-weight: bold;">errors</span>);
    }

    protected void <span style="color: green; font-weight: bold;">init</span>(String <span style="color: purple; font-weight: bold;">baseUri</span>, ParseErrorList <span style="color: purple; font-weight: bold;">errors</span>) {
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">baseUri</span>, "BaseURI must not be null");
</p></li>
</li>
</ul>
<h2>Commit: e47d908</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>        <span style="color: green; font-weight: bold;">init</span>(<span style="color: purple; font-weight: bold;">baseUri</span>, <span style="color: purple; font-weight: bold;">errors</span>);
    }

</p></li>
<p>        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">input</span>, &quot;Input buffer must not be null&quot;);
        <span style="color: purple; font-weight: bold;">reader</span> = new <span style="color: red; font-weight: bold;">CharacterReader</span>(<span style="color: purple; font-weight: bold;">input</span>);
</p></li>
<p>    }

    protected void <span style="color: green; font-weight: bold;">init</span>(String baseUri, ParseErrorList errors) {
        Validate.notNull(baseUri, "BaseURI must not be null");
        doc = new Document(baseUri);
        this.errors = errors;
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>
</p></li>
<p>        reader = new CharacterReader(input);
</p></li>
</li>
</ul>
<h2>Commit: d8c3f9c</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/parser/TreeBuilder.java:</strong><br>
<p>        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notNull</span>(<span style="color: purple; font-weight: bold;">baseUri</span>, "BaseURI must not be null");

        doc = new Document(baseUri);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: 3dd9e66</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Collector.java:</strong><br>
<p>        Elements elements = new <span style="color: red; font-weight: bold;">Elements</span>();
        accumulateMatches(eval, elements, root);
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Collector.java:</strong><br>
<p>        List&lt;Element&gt; elements = new <span style="color: red; font-weight: bold;">ArrayList&lt;Element&gt;</span>();
        accumulateMatches(eval, elements, root);
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: f435b79</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Collector.java:</strong><br>
<p>        List&lt;Element&gt; <span style="color: purple; font-weight: bold;">elements</span> = new <span style="color: red; font-weight: bold;">ArrayList&lt;Element&gt;</span>();
        <span style="color: green; font-weight: bold;">accumulateMatches</span>(<span style="color: purple; font-weight: bold;">eval</span>, <span style="color: purple; font-weight: bold;">elements</span>, <span style="color: purple; font-weight: bold;">root</span>);
        return <span style="color: purple; font-weight: bold;">Collections</span>.<span style="color: green; font-weight: bold;">unmodifiableList</span>(<span style="color: purple; font-weight: bold;">elements</span>);
    }

</p></li>
<p>        if (<span style="color: purple; font-weight: bold;">eval</span>.<span style="color: green; font-weight: bold;">matches</span>(<span style="color: purple; font-weight: bold;">element</span>))
            <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">element</span>);
        for (Element <span style="color: purple; font-weight: bold;">child</span>: <span style="color: purple; font-weight: bold;">element</span>.<span style="color: green; font-weight: bold;">children</span>())
            <span style="color: green; font-weight: bold;">accumulateMatches</span>(<span style="color: purple; font-weight: bold;">eval</span>, <span style="color: purple; font-weight: bold;">elements</span>, <span style="color: purple; font-weight: bold;">child</span>);
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: ae7308a</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Collector.java:</strong><br>
<p>                    elements.add(el);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Evaluator.java:</strong><br>
<p>        public boolean matches(Element <span style="color: purple; font-weight: bold;">root</span>, Element element) {
            return (element.tagName().equals(tagName));
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Collector.java:</strong><br>
<p>                    elements.add(el);
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/nodes/Evaluator.java:</strong><br>
<p>            return (element.tagName().equals(tagName));
</p></li>
</li>
</ul>
<h2>Commit: b9c1740</h2>
<h3>addition:</h3><ul>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Elements.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: f2535d7</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Evaluator.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Evaluator.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: 64ec9cf</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Evaluator.java:</strong><br>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/QueryParser.java:</strong><br>
<p>            combinator(tq.consume());
</p></li>
<p>                evals.clear();
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Evaluator.java:</strong><br>
<p>    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/QueryParser.java:</strong><br>
<p>            combinator(tq.consume());
</p></li>
<p>                evals.clear();
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: 7ea1e53</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Evaluator.java:</strong><br>
<p>    
</p></li>
<p>            this.tagName = tagName;
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Evaluator.java:</strong><br>
<p>    
</p></li>
<p>            this.tagName = tagName;
</p></li>
</li>
</ul>
<h2>Commit: 80c826d</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/nodes/Evaluator.java:</strong><br>
<p>    
    public abstract boolean <span style="color: green; font-weight: bold;">matches</span>(Element <span style="color: purple; font-weight: bold;">element</span>);
</p></li>
<p>            this.<span style="color: purple; font-weight: bold;">tagName</span> = <span style="color: purple; font-weight: bold;">tagName</span>;
        }

</p></li>
<p>            return (<span style="color: purple; font-weight: bold;">element</span>.<span style="color: green; font-weight: bold;">tagName</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">tagName</span>));
        }
    }
</p></li>
</li>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: db2d5aa</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/QueryParser.java:</strong><br>
<p>        	<span style="color: green; font-weight: bold;">cssNthChild</span>(false, false);
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;:nth-last-child(&quot;))
        	<span style="color: green; font-weight: bold;">cssNthChild</span>(true, false);
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;:nth-of-type(&quot;))
        	<span style="color: green; font-weight: bold;">cssNthChild</span>(false, true);
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;:nth-last-of-type(&quot;))
        	<span style="color: green; font-weight: bold;">cssNthChild</span>(true, true);
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;:first-child&quot;))
        	<span style="color: purple; font-weight: bold;">evals</span>.<span style="color: green; font-weight: bold;">add</span>(new <span style="color: red; font-weight: bold;">Evaluator.IsFirstChild</span>());
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;:last-child&quot;))
        	<span style="color: purple; font-weight: bold;">evals</span>.<span style="color: green; font-weight: bold;">add</span>(new <span style="color: red; font-weight: bold;">Evaluator.IsLastChild</span>());
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;:first-of-type&quot;))
        	<span style="color: purple; font-weight: bold;">evals</span>.<span style="color: green; font-weight: bold;">add</span>(new <span style="color: red; font-weight: bold;">Evaluator.IsFirstOfType</span>());
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;:last-of-type&quot;))
        	<span style="color: purple; font-weight: bold;">evals</span>.<span style="color: green; font-weight: bold;">add</span>(new <span style="color: red; font-weight: bold;">Evaluator.IsLastOfType</span>());
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;:only-child&quot;))
        	<span style="color: purple; font-weight: bold;">evals</span>.<span style="color: green; font-weight: bold;">add</span>(new <span style="color: red; font-weight: bold;">Evaluator.IsOnlyChild</span>());
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;:only-of-type&quot;))
        	<span style="color: purple; font-weight: bold;">evals</span>.<span style="color: green; font-weight: bold;">add</span>(new <span style="color: red; font-weight: bold;">Evaluator.IsOnlyOfType</span>());
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;:empty&quot;))
        	<span style="color: purple; font-weight: bold;">evals</span>.<span style="color: green; font-weight: bold;">add</span>(new <span style="color: red; font-weight: bold;">Evaluator.IsEmpty</span>());
        else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;:root&quot;))
        	<span style="color: purple; font-weight: bold;">evals</span>.<span style="color: green; font-weight: bold;">add</span>(new <span style="color: red; font-weight: bold;">Evaluator.IsRoot</span>());
		else <span style="color: blue; font-weight: bold;">// unhandled</span>
            throw new <span style="color: red; font-weight: bold;">Selector.SelectorParseException</span>(&quot;Could not parse query &#x27;%s&#x27;: unexpected token at &#x27;%s&#x27;&quot;, <span style="color: purple; font-weight: bold;">query</span>, <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">remainder</span>());
</p></li>
<p>    private static final Pattern <span style="color: purple; font-weight: bold;">NTH_B</span>  = <span style="color: purple; font-weight: bold;">Pattern</span>.<span style="color: green; font-weight: bold;">compile</span>("(\\+|-)?(\\d+)");

</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/QueryParser.java:</strong><br>
<p>            throw new Selector.SelectorParseException("Could not parse query '%s': unexpected token at '%s'", query, tq.remainder());
</p></li>
</li>
</ul>
<h2>Commit: 249e5a8</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/QueryParser.java:</strong><br>
<p>                combinator(tq.consume());
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/QueryParser.java:</strong><br>
<p>                CombiningEvaluator.Or or = new CombiningEvaluator.Or(<span style="color: purple; font-weight: bold;">evals</span>);
                <span style="color: purple; font-weight: bold;">evals</span>.<span style="color: green; font-weight: bold;">clear</span>();
                evals.add(or);
                while (!<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">isEmpty</span>()) {
                    String <span style="color: purple; font-weight: bold;">subQuery</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>(&quot;,&quot;);
                    <span style="color: purple; font-weight: bold;">or</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: green; font-weight: bold;">parse</span>(<span style="color: purple; font-weight: bold;">subQuery</span>));
                }
            } else if (tq.matchesAny(combinators)) {
                combinator(tq.consume());
</p></li>
</li>
</ul>
<h2>Commit: e8e755b</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        <span style="color: purple; font-weight: bold;">query</span> = query.trim();
        Validate.notEmpty(query);
</p></li>
<p>        this.root = root;
</p></li>
<p>        if (tq.matchChomp(&quot;#&quot;)) {
            byId();
        } else if (tq.matchChomp(&quot;.&quot;)) {
            byClass();
        } else if (tq.matchesWord()) {
            byTag();
        } else if (tq.matchChomp(&quot;[&quot;)) {
            byAttribute();
        } else { // unhandled
            throw new SelectorParseException(&quot;Could not parse query &quot; + query);
        }
        <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consumeWhitespace</span>();

        <span style="color: blue; font-weight: bold;">// hierarchy (todo: implement &gt;, +, ~)</span>
        if (!tq.isEmpty()) {
            if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;,&quot;)) { <span style="color: blue; font-weight: bold;">// group or</span>
                while (!<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">isEmpty</span>()) {
                    String <span style="color: purple; font-weight: bold;">subQuery</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>(&quot;,&quot;);
                    <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">subQuery</span>, <span style="color: purple; font-weight: bold;">root</span>));
                }
                return new <span style="color: red; font-weight: bold;">Elements</span>(<span style="color: purple; font-weight: bold;">elements</span>);
            } else { <span style="color: blue; font-weight: bold;">// ancestor descendant (AND, really)</span>
                return new <span style="color: red; font-weight: bold;">Elements</span>(<span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">remainder</span>(), <span style="color: purple; font-weight: bold;">elements</span>));
            }
</p></li>
<p>            return new <span style="color: red; font-weight: bold;">Elements</span>(<span style="color: purple; font-weight: bold;">elements</span>);
        }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        this.root = root;
</p></li>
<p>            if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;#&quot;)) {
                <span style="color: green; font-weight: bold;">byId</span>();
            } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;.&quot;)) {
                <span style="color: green; font-weight: bold;">byClass</span>();
            } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchesWord</span>()) {
                <span style="color: green; font-weight: bold;">byTag</span>();
            } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;[&quot;)) {
                <span style="color: green; font-weight: bold;">byAttribute</span>();
            } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;,&quot;)) {
                <span style="color: green; font-weight: bold;">groupOr</span>();
            } else { <span style="color: blue; font-weight: bold;">// unhandled</span>
                throw new <span style="color: red; font-weight: bold;">SelectorParseException</span>(&quot;Could not parse query &quot; + <span style="color: purple; font-weight: bold;">query</span>);
            }
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: d0a7e3a</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        
</p></li>
<p>    private String <span style="color: green; font-weight: bold;">consumeSubQuery</span>() {
        StringBuilder <span style="color: purple; font-weight: bold;">sq</span> = new <span style="color: red; font-weight: bold;">StringBuilder</span>();
        while (!<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">isEmpty</span>()) {
            if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;(&quot;))
                <span style="color: purple; font-weight: bold;">sq</span>.<span style="color: green; font-weight: bold;">append</span>(&quot;(&quot;).<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompBalanced</span>(&#x27;(&#x27;, &#x27;)&#x27;)).<span style="color: green; font-weight: bold;">append</span>(&quot;)&quot;);
            else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;[&quot;))
                <span style="color: purple; font-weight: bold;">sq</span>.<span style="color: green; font-weight: bold;">append</span>(&quot;[&quot;).<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompBalanced</span>(&#x27;[&#x27;, &#x27;]&#x27;)).<span style="color: green; font-weight: bold;">append</span>(&quot;]&quot;);
            else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchesAny</span>(<span style="color: purple; font-weight: bold;">combinators</span>))
                break;
            else
                <span style="color: purple; font-weight: bold;">sq</span>.<span style="color: green; font-weight: bold;">append</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consume</span>());
        }
        return <span style="color: purple; font-weight: bold;">sq</span>.<span style="color: green; font-weight: bold;">toString</span>();
    }
    
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        
</p></li>
</li>
</ul>
<h2>Commit: 112c154</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        } else if (tq.matches(":has(")) {
</p></li>
<p>            } else if (seenWhite) {
</p></li>
<p>            } else { // E.class, E#id, E[attr] etc. AND
</p></li>
<p>        tq.consumeWhitespace();
</p></li>
<p>            output = filterForChildren(elements, select(subQuery, elements));
</p></li>
<p>            output = filterForDescendants(elements, select(subQuery, elements));
</p></li>
<p>            output = filterForAdjacentSiblings(elements, select(subQuery, root));
</p></li>
<p>            output = filterForGeneralSiblings(elements, select(subQuery, root));
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        } else if (tq.matches(":has(")) {
</p></li>
<p>            } else if (seenWhite) {
</p></li>
<p>            } else { // E.class, E#id, E[attr] etc. AND
</p></li>
<p>        tq.consumeWhitespace();
</p></li>
<p>            output = filterForChildren(elements, select(subQuery, elements));
</p></li>
<p>            output = filterForDescendants(elements, select(subQuery, elements));
</p></li>
<p>            output = filterForAdjacentSiblings(elements, select(subQuery, root));
</p></li>
<p>            output = filterForGeneralSiblings(elements, select(subQuery, root));
</p></li>
</li>
</ul>
<h2>Commit: f462438</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>            <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getAllElements</span>());
        } else {
</p></li>
<p>            return <span style="color: green; font-weight: bold;">not</span>();
        } else { <span style="color: blue; font-weight: bold;">// unhandled</span>
</p></li>
<p>    private Elements <span style="color: green; font-weight: bold;">not</span>() {
        <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consume</span>(&quot;:not&quot;);
        String <span style="color: purple; font-weight: bold;">subQuery</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompBalanced</span>(&#x27;(&#x27;, &#x27;)&#x27;);
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">subQuery</span>, &quot;:not(selector) subselect must not be empty&quot;);

        return <span style="color: green; font-weight: bold;">filterOut</span>(<span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getAllElements</span>(), <span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">subQuery</span>, <span style="color: purple; font-weight: bold;">root</span>));
    }

    // direct child descendants
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: 2217137</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;:containsOwn(&quot;)) {
            return <span style="color: green; font-weight: bold;">contains</span>(true);
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(":matches(")) {
</p></li>
<p>        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matches</span>(&quot;:matchesOwn(&quot;)) {
            return <span style="color: green; font-weight: bold;">matches</span>(true);
        } else { <span style="color: blue; font-weight: bold;">// unhandled</span>
</p></li>
<p>    private Elements contains(boolean <span style="color: purple; font-weight: bold;">own</span>) {
        tq.consume(<span style="color: purple; font-weight: bold;">own</span> ? ":containsOwn" : ":contains");
        String searchText = TokenQueue.unescape(tq.chompBalanced('(',')'));
</p></li>
<p>    }
</p></li>
<p>    private Elements matches(boolean <span style="color: purple; font-weight: bold;">own</span>) {
        tq.consume(<span style="color: purple; font-weight: bold;">own</span>? ":matchesOwn" : ":matches");
        String regex = tq.chompBalanced('(', ')'); // don't unescape, as regex bits will be escaped
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        } else if (tq.matches(":matches(")) {
</p></li>
<p>        } else { // unhandled
</p></li>
<p>    private Elements contains() {
        tq.consume(":contains");
        String searchText = TokenQueue.unescape(tq.chompBalanced('(',')'));
</p></li>
<p>    }
</p></li>
<p>    private Elements matches() {
        tq.consume(":matches");
        String regex = tq.chompBalanced('(', ')'); // don't unescape, as regex bits will be escaped
</p></li>
<p>    }
</p></li>
</li>
</ul>
<h2>Commit: eb1edd4</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>            return byAttribute();
</p></li>
<p>        String <span style="color: purple; font-weight: bold;">key</span> = <span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">consumeToAny</span>("=", "!=", "^=", "$=", "*=", "~="); // eq, not, start, end, contain, match, (no val)
        Validate.notEmpty(key);
</p></li>
<p>
</p></li>
<p>            return key.startsWith("^") ? root.getElementsByAttributeStarting(key.substring(1)) : root.getElementsByAttribute(key);
</p></li>
<p>                return root.getElementsByAttributeValue(key, <span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">remainder</span>());

</p></li>
<p>                return root.getElementsByAttributeValueNot(key, <span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">remainder</span>());

</p></li>
<p>                return root.getElementsByAttributeValueStarting(key, <span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">remainder</span>());

</p></li>
<p>                return root.getElementsByAttributeValueEnding(key, <span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">remainder</span>());

</p></li>
<p>                return root.getElementsByAttributeValueContaining(key, <span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">remainder</span>());
            
</p></li>
<p>                return root.getElementsByAttributeValueMatching(key, <span style="color: purple; font-weight: bold;">cq</span>.<span style="color: green; font-weight: bold;">remainder</span>());
            
</p></li>
<p>        }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>            return byAttribute();
</p></li>
<p>        Validate.notEmpty(key);
</p></li>
<p>            return key.startsWith("^") ? root.getElementsByAttributeStarting(key.substring(1)) : root.getElementsByAttribute(key);
</p></li>
<p>                return root.getElementsByAttributeValue(key, <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>("]"));

</p></li>
<p>                return root.getElementsByAttributeValueNot(key, <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>("]"));

</p></li>
<p>                return root.getElementsByAttributeValueStarting(key, <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>("]"));

</p></li>
<p>                return root.getElementsByAttributeValueEnding(key, <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>("]"));

</p></li>
<p>                return root.getElementsByAttributeValueContaining(key, <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>("]"));
            
</p></li>
<p>                return root.getElementsByAttributeValueMatching(key, <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>("]"));
            
</p></li>
<p>        }
</p></li>
</li>
</ul>
<h2>Commit: af580c3</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        } else {
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        } else {
</p></li>
</li>
</ul>
<h2>Commit: 57567c6</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        Validate.notEmpty(key);
</p></li>
<p>                return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByAttributeValueMatching</span>(<span style="color: purple; font-weight: bold;">key</span>, <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>("]"));
            
            else
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        Validate.notEmpty(key);
</p></li>
</li>
</ul>
<h2>Commit: 916d539</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>            return <span style="color: green; font-weight: bold;">matches</span>();
        } else { <span style="color: blue; font-weight: bold;">// unhandled</span>
</p></li>
<p>    <span style="color: blue; font-weight: bold;">// :matches(regex)</span>
    private Elements <span style="color: green; font-weight: bold;">matches</span>() {
        <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consume</span>(&quot;:matches&quot;);
        String <span style="color: purple; font-weight: bold;">regex</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompBalanced</span>(&#x27;(&#x27;, &#x27;)&#x27;); <span style="color: blue; font-weight: bold;">// don&#x27;t unescape, as regex bits will be escaped</span>
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">regex</span>, &quot;:matches(regex) query must not be empty&quot;);
        
        return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsMatchingText</span>(<span style="color: purple; font-weight: bold;">regex</span>);
    }

</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>    private Elements contains() {
</p></li>
</li>
</ul>
<h2>Commit: e6cc4ce</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>            return contains();
</p></li>
<p>        String searchText = <span style="color: purple; font-weight: bold;">TokenQueue</span>.<span style="color: green; font-weight: bold;">unescape</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompBalanced</span>('(',')'));
        Validate.notEmpty(searchText, ":contains(text) query must not be empty");
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>            return contains();
</p></li>
<p>        Validate.notEmpty(searchText, ":contains(text) query must not be empty");
</p></li>
</li>
</ul>
<h2>Commit: cf3676c</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>            return has();
</p></li>
<p>        }
</p></li>
<p>        }
</p></li>
<p>        String subQuery = tq.<span style="color: green; font-weight: bold;">chompBalanced</span>('(',')');
        Validate.notEmpty(subQuery, ":has(el) subselect must not be empty");
</p></li>
<p>    private Elements contains() {
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>            return has();
</p></li>
<p>        }
</p></li>
<p>        }
</p></li>
<p>        Validate.notEmpty(subQuery, ":has(el) subselect must not be empty");
</p></li>
</li>
</ul>
<h2>Commit: 214c568</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>            return <span style="color: green; font-weight: bold;">contains</span>();
        } else { <span style="color: blue; font-weight: bold;">// unhandled</span>
</p></li>
<p>    <span style="color: blue; font-weight: bold;">// pseudo selector :contains(text)</span>
    private Elements <span style="color: green; font-weight: bold;">contains</span>() {
        String <span style="color: purple; font-weight: bold;">searchText</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>(&quot;)&quot;);
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">searchText</span>, &quot;:contains(text) query must not be empty&quot;);
        
        return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsContainingText</span>(<span style="color: purple; font-weight: bold;">searchText</span>);
    }

</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: aec561f</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>            return <span style="color: green; font-weight: bold;">has</span>();
        } else { <span style="color: blue; font-weight: bold;">// unhandled</span>
</p></li>
<p>    }

    <span style="color: blue; font-weight: bold;">// pseudo selector :has(el)</span>
    private Elements <span style="color: green; font-weight: bold;">has</span>() {
        String <span style="color: purple; font-weight: bold;">subQuery</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>(&quot;)&quot;);
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">notEmpty</span>(<span style="color: purple; font-weight: bold;">subQuery</span>, ":has(el) subselect must not be empty");

</p></li>
<p>    }
</p></li>
<p>        }
</p></li>
<p>    <span style="color: blue; font-weight: bold;">// implements :has(el). Finds elements that contain the matched elements</span>
    private static Elements <span style="color: green; font-weight: bold;">filterForParentsOfDescendants</span>(Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">parents</span>, Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">children</span>) {
        Elements <span style="color: purple; font-weight: bold;">filteredParents</span> = new <span style="color: red; font-weight: bold;">Elements</span>();
        for (Element <span style="color: purple; font-weight: bold;">p</span> : <span style="color: purple; font-weight: bold;">parents</span>) {
            for (Element <span style="color: purple; font-weight: bold;">c</span> : <span style="color: purple; font-weight: bold;">children</span>) {
                if (<span style="color: purple; font-weight: bold;">c</span>.<span style="color: green; font-weight: bold;">parents</span>().<span style="color: green; font-weight: bold;">contains</span>(<span style="color: purple; font-weight: bold;">p</span>)) {
                    <span style="color: purple; font-weight: bold;">filteredParents</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">p</span>);
                }
            }
        }
        return <span style="color: purple; font-weight: bold;">filteredParents</span>;
    }
    
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>
</p></li>
<p>    }
</p></li>
<p>            for (Element p : parents) {
</p></li>
<p>                    continue CHILD;
</p></li>
<p>                <span style="color: purple; font-weight: bold;">children</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">c</span>);
        }
</p></li>
</li>
</ul>
<h2>Commit: 5eecccd</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>            return <span style="color: green; font-weight: bold;">indexLessThan</span>();
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;:gt(&quot;)) {
            return <span style="color: green; font-weight: bold;">indexGreaterThan</span>();
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;:eq(&quot;)) {
            return <span style="color: green; font-weight: bold;">indexEquals</span>();
        } else { <span style="color: blue; font-weight: bold;">// unhandled</span>
</p></li>
<p>    <span style="color: blue; font-weight: bold;">// pseudo selectors :lt, :gt, :eq</span>
    private Elements <span style="color: green; font-weight: bold;">indexLessThan</span>() {
        return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByIndexLessThan</span>(<span style="color: green; font-weight: bold;">consumeIndex</span>());
    }
    
    private Elements <span style="color: green; font-weight: bold;">indexGreaterThan</span>() {
        return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByIndexGreaterThan</span>(<span style="color: green; font-weight: bold;">consumeIndex</span>());
    }
    
    private Elements <span style="color: green; font-weight: bold;">indexEquals</span>() {
        return <span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByIndexEquals</span>(<span style="color: green; font-weight: bold;">consumeIndex</span>());
    }

    private int <span style="color: green; font-weight: bold;">consumeIndex</span>() {
        String <span style="color: purple; font-weight: bold;">indexS</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>(&quot;)&quot;).<span style="color: green; font-weight: bold;">trim</span>();
        <span style="color: purple; font-weight: bold;">Validate</span>.<span style="color: green; font-weight: bold;">isTrue</span>(<span style="color: purple; font-weight: bold;">StringUtils</span>.<span style="color: green; font-weight: bold;">isNumeric</span>(<span style="color: purple; font-weight: bold;">indexS</span>), &quot;Index must be numeric&quot;);
        int <span style="color: purple; font-weight: bold;">index</span> = <span style="color: purple; font-weight: bold;">Integer</span>.<span style="color: green; font-weight: bold;">parseInt</span>(<span style="color: purple; font-weight: bold;">indexS</span>);

        return <span style="color: purple; font-weight: bold;">index</span>;
    }

</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
<h2>Commit: 3eb8a67</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchesAny</span>(<span style="color: purple; font-weight: bold;">combinators</span>)) { <span style="color: blue; font-weight: bold;">// if starts with a combinator, use root as elements</span>
            <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">root</span>);
            <span style="color: green; font-weight: bold;">combinator</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consume</span>().<span style="color: green; font-weight: bold;">toString</span>());
        } else {
            <span style="color: green; font-weight: bold;">addElements</span>(<span style="color: green; font-weight: bold;">findElements</span>()); <span style="color: blue; font-weight: bold;">// chomp first element matcher off queue </span>
        }            
               
        while (!tq.isEmpty()) {
</p></li>
<p>            boolean seenWhite = tq.consumeWhitespace();
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        while (!tq.isEmpty()) {
</p></li>
<p>            boolean seenWhite = tq.consumeWhitespace();
</p></li>
</li>
</ul>
<h2>Commit: ec69d09</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        Validate.notEmpty(id);
</p></li>
<p>        Validate.notEmpty(className);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        Validate.notEmpty(id);
</p></li>
<p>        Validate.notEmpty(className);
</p></li>
</li>
</ul>
<h2>Commit: 79c6723</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>                <span style="color: green; font-weight: bold;">combinator</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consume</span>().<span style="color: green; font-weight: bold;">toString</span>());
            } else if (<span style="color: purple; font-weight: bold;">seenWhite</span>) {
                <span style="color: green; font-weight: bold;">combinator</span>(&quot; &quot;);
            } else { <span style="color: blue; font-weight: bold;">// E.class, E#id, E[attr] etc. AND</span>
</p></li>
<p>        <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consumeWhitespace</span>();
        String <span style="color: purple; font-weight: bold;">subQuery</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consumeToAny</span>(<span style="color: purple; font-weight: bold;">combinators</span>); <span style="color: blue; font-weight: bold;">// support multi &gt; childs</span>
        
        Elements <span style="color: purple; font-weight: bold;">output</span>;
        if (<span style="color: purple; font-weight: bold;">combinator</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;&gt;&quot;))
            <span style="color: purple; font-weight: bold;">output</span> = <span style="color: green; font-weight: bold;">filterForChildren</span>(<span style="color: purple; font-weight: bold;">elements</span>, <span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">subQuery</span>, <span style="color: purple; font-weight: bold;">elements</span>));
        else if (<span style="color: purple; font-weight: bold;">combinator</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot; &quot;))
            <span style="color: purple; font-weight: bold;">output</span> = <span style="color: green; font-weight: bold;">filterForDescendants</span>(<span style="color: purple; font-weight: bold;">elements</span>, <span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">subQuery</span>, <span style="color: purple; font-weight: bold;">elements</span>));
        else if (<span style="color: purple; font-weight: bold;">combinator</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;+&quot;))
            <span style="color: purple; font-weight: bold;">output</span> = <span style="color: green; font-weight: bold;">filterForAdjacentSiblings</span>(<span style="color: purple; font-weight: bold;">elements</span>, <span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">subQuery</span>, <span style="color: purple; font-weight: bold;">root</span>));
        else if (<span style="color: purple; font-weight: bold;">combinator</span>.<span style="color: green; font-weight: bold;">equals</span>(&quot;~&quot;))
            <span style="color: purple; font-weight: bold;">output</span> = <span style="color: green; font-weight: bold;">filterForGeneralSiblings</span>(<span style="color: purple; font-weight: bold;">elements</span>, <span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">subQuery</span>, <span style="color: purple; font-weight: bold;">root</span>));
        else
            throw new <span style="color: red; font-weight: bold;">IllegalStateException</span>(&quot;Unknown combinator: &quot; + <span style="color: purple; font-weight: bold;">combinator</span>);
        
        <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">clear</span>(); <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">output</span>);
    }
    
    private Elements findElements() {
</p></li>
<p>                    children.add(c);
</p></li>
<p>    private static Elements <span style="color: green; font-weight: bold;">filterForAdjacentSiblings</span>(Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">elements</span>, Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">candidates</span>) {
        Elements <span style="color: purple; font-weight: bold;">siblings</span> = new <span style="color: red; font-weight: bold;">Elements</span>();
        <span style="color: purple; font-weight: bold;">SIBLING</span>: for (Element <span style="color: purple; font-weight: bold;">c</span>: <span style="color: purple; font-weight: bold;">candidates</span>) {
            for (Element <span style="color: purple; font-weight: bold;">e</span>: <span style="color: purple; font-weight: bold;">elements</span>) {
                if (!<span style="color: purple; font-weight: bold;">e</span>.<span style="color: green; font-weight: bold;">parent</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">c</span>.<span style="color: green; font-weight: bold;">parent</span>()))
                    continue;
                Element <span style="color: purple; font-weight: bold;">previousSib</span> = <span style="color: purple; font-weight: bold;">c</span>.<span style="color: green; font-weight: bold;">previousElementSibling</span>();
                if (<span style="color: purple; font-weight: bold;">previousSib</span> != null &amp;&amp; <span style="color: purple; font-weight: bold;">previousSib</span>.<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">e</span>)) {
                    <span style="color: purple; font-weight: bold;">siblings</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">c</span>);
                    continue <span style="color: purple; font-weight: bold;">SIBLING</span>;
                }
            }
        }
        return <span style="color: purple; font-weight: bold;">siblings</span>;
    }
    
    <span style="color: blue; font-weight: bold;">// preceeding siblings</span>
    private static Elements <span style="color: green; font-weight: bold;">filterForGeneralSiblings</span>(Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">elements</span>, Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">candidates</span>) {
        Elements <span style="color: purple; font-weight: bold;">output</span> = new <span style="color: red; font-weight: bold;">Elements</span>();
        <span style="color: purple; font-weight: bold;">SIBLING</span>: for (Element <span style="color: purple; font-weight: bold;">c</span>: <span style="color: purple; font-weight: bold;">candidates</span>) {
            for (Element <span style="color: purple; font-weight: bold;">e</span>: <span style="color: purple; font-weight: bold;">elements</span>) {
                if (!<span style="color: purple; font-weight: bold;">e</span>.<span style="color: green; font-weight: bold;">parent</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">c</span>.<span style="color: green; font-weight: bold;">parent</span>()))
                    continue;
                int <span style="color: purple; font-weight: bold;">ePos</span> = <span style="color: purple; font-weight: bold;">e</span>.<span style="color: green; font-weight: bold;">elementSiblingIndex</span>();
                int <span style="color: purple; font-weight: bold;">cPos</span> = <span style="color: purple; font-weight: bold;">c</span>.<span style="color: green; font-weight: bold;">elementSiblingIndex</span>();
                if (<span style="color: purple; font-weight: bold;">cPos</span> &gt; <span style="color: purple; font-weight: bold;">ePos</span>) {
                    <span style="color: purple; font-weight: bold;">output</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">c</span>);
                    continue <span style="color: purple; font-weight: bold;">SIBLING</span>;
                }
            }
        }
        return <span style="color: purple; font-weight: bold;">output</span>;
    }
    
    // union of both sets, for e.class type selectors
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>                String <span style="color: purple; font-weight: bold;">subQuery</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>(&quot;&gt;&quot;); <span style="color: blue; font-weight: bold;">// support multi &gt; childs</span>
                Elements <span style="color: purple; font-weight: bold;">candidates</span> = <span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">subQuery</span>, <span style="color: purple; font-weight: bold;">elements</span>);
                Elements <span style="color: purple; font-weight: bold;">children</span> = <span style="color: green; font-weight: bold;">filterForChildren</span>(<span style="color: purple; font-weight: bold;">elements</span>, <span style="color: purple; font-weight: bold;">candidates</span>);
                <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">clear</span>(); <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">children</span>);
            } else if (<span style="color: purple; font-weight: bold;">seenWhite</span>) { <span style="color: blue; font-weight: bold;">// ancestor descendant</span>
                Elements <span style="color: purple; font-weight: bold;">candidates</span> = <span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">remainder</span>(), <span style="color: purple; font-weight: bold;">elements</span>);
                return <span style="color: green; font-weight: bold;">filterForDescendants</span>(<span style="color: purple; font-weight: bold;">elements</span>, <span style="color: purple; font-weight: bold;">candidates</span>);
            } else { <span style="color: blue; font-weight: bold;">// E.class, E#id, E[attr] etc. AND</span>
</p></li>
<p>                    children.add(c);
</p></li>
</li>
</ul>
<h2>Commit: ac57740</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>                Elements <span style="color: purple; font-weight: bold;">candidates</span> = <span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">subQuery</span>, <span style="color: purple; font-weight: bold;">elements</span>);
                Elements <span style="color: purple; font-weight: bold;">children</span> = <span style="color: green; font-weight: bold;">filterForChildren</span>(<span style="color: purple; font-weight: bold;">elements</span>, <span style="color: purple; font-weight: bold;">candidates</span>);
                <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">clear</span>(); <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">children</span>);
            } else if (seenWhite) { // ancestor descendant
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>                return <span style="color: green; font-weight: bold;">filterForChildren</span>(<span style="color: purple; font-weight: bold;">elements</span>, <span style="color: purple; font-weight: bold;">candidates</span>);
            } else if (seenWhite) { // ancestor descendant
</p></li>
</li>
</ul>
<h2>Commit: 7a7419f</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>                return filterForChildren(elements, candidates);
</p></li>
<p>                return filterForDescendants(elements, candidates);
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>                return filterForChildren(elements, candidates);
</p></li>
<p>                return filterForDescendants(elements, candidates);
</p></li>
</li>
</ul>
<h2>Commit: 72fe766</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        while (!<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">isEmpty</span>()) {
            <span style="color: blue; font-weight: bold;">// hierarchy and extras (todo: implement +, ~)</span>
            boolean <span style="color: purple; font-weight: bold;">seenWhite</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consumeWhitespace</span>();
            
            if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;,&quot;)) { <span style="color: blue; font-weight: bold;">// group or</span>
</p></li>
<p>                <span style="color: green; font-weight: bold;">intersectElements</span>(<span style="color: green; font-weight: bold;">filterForSelf</span>(<span style="color: purple; font-weight: bold;">elements</span>, <span style="color: purple; font-weight: bold;">candidates</span>));
            }
</p></li>
<p>    }
    
    private Elements <span style="color: green; font-weight: bold;">findElements</span>() {
        if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;#&quot;)) {
            return <span style="color: green; font-weight: bold;">byId</span>();
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;.&quot;)) {
            return <span style="color: green; font-weight: bold;">byClass</span>();
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchesWord</span>()) {
            return <span style="color: green; font-weight: bold;">byTag</span>();
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;[&quot;)) {
            return <span style="color: green; font-weight: bold;">byAttribute</span>();
        } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;*&quot;)) {
            return <span style="color: green; font-weight: bold;">allElements</span>();
        } else { <span style="color: blue; font-weight: bold;">// unhandled</span>
            throw new <span style="color: red; font-weight: bold;">SelectorParseException</span>(&quot;Could not parse query &quot; + <span style="color: purple; font-weight: bold;">query</span>);
        }
    }
    
    private void <span style="color: green; font-weight: bold;">addElements</span>(Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">add</span>) {
        <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">add</span>);
    }
    
    private void <span style="color: green; font-weight: bold;">intersectElements</span>(Collection&lt;Element&gt; <span style="color: purple; font-weight: bold;">intersect</span>) {
        <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">retainAll</span>(<span style="color: purple; font-weight: bold;">intersect</span>);
    }
</p></li>
<p>        String id = tq.consumeWord();
</p></li>
<p>        if(found != null)
</p></li>
<p>        return <span style="color: purple; font-weight: bold;">byId</span>;
    }
</p></li>
<p>        String className = tq.consumeClassName();
</p></li>
<p>    }
</p></li>
<p>        String tagName = tq.consumeWord();
</p></li>
<p>    }
</p></li>
<p>        String key = tq.consumeToAny("=", "!=", "^=", "$=", "*=", "]"); // eq, not, start, end, contain, (no val)
</p></li>
<p>        } else {
</p></li>
<p>
</p></li>
<p>
</p></li>
<p>
</p></li>
<p>
</p></li>
<p>            
            else
                throw new <span style="color: red; font-weight: bold;">SelectorParseException</span>(&quot;Could not parse attribute query &quot; + <span style="color: purple; font-weight: bold;">query</span>);
        }
</p></li>
<p>        return <span style="color: purple; font-weight: bold;">Collector</span>.<span style="color: green; font-weight: bold;">collect</span>(new <span style="color: red; font-weight: bold;">Evaluator.AllElements</span>(), <span style="color: purple; font-weight: bold;">root</span>);
    }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        if (tq.matchChomp(&quot;#&quot;)) {
            <span style="color: green; font-weight: bold;">byId</span>();
        } else if (tq.matchChomp(&quot;.&quot;)) {
            <span style="color: green; font-weight: bold;">byClass</span>();
        } else if (tq.matchesWord()) {
            <span style="color: green; font-weight: bold;">byTag</span>();
        } else if (tq.matchChomp(&quot;[&quot;)) {
            <span style="color: green; font-weight: bold;">byAttribute</span>();
        } else if (tq.matchChomp(&quot;*&quot;)) {
            <span style="color: green; font-weight: bold;">allElements</span>();
        } else { // unhandled
            throw new SelectorParseException(&quot;Could not parse query &quot; + query);
        }

        <span style="color: blue; font-weight: bold;">// hierarchy (todo: implement +, ~)</span>
        boolean seenWhite = tq.consumeWhitespace();
        if (!<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">isEmpty</span>()) { 
            if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;,&quot;)) { <span style="color: blue; font-weight: bold;">// group or</span>
</p></li>
<p>            } else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;&gt;&quot;)) { <span style="color: blue; font-weight: bold;">// parent &gt; child</span>
</p></li>
<p>                return <span style="color: green; font-weight: bold;">filterForSelf</span>(<span style="color: purple; font-weight: bold;">elements</span>, <span style="color: purple; font-weight: bold;">candidates</span>);
            }
</p></li>
<p>            return new <span style="color: red; font-weight: bold;">Elements</span>(<span style="color: purple; font-weight: bold;">elements</span>);
        }
</p></li>
<p>        String id = tq.consumeWord();
</p></li>
<p>    }
</p></li>
<p>        String className = tq.consumeClassName();
</p></li>
<p>        elements.addAll(<span style="color: purple; font-weight: bold;">found</span>);
    }
</p></li>
<p>        String tagName = tq.consumeWord();
</p></li>
<p>    }
</p></li>
<p>        String key = tq.consumeToAny("=", "!=", "^=", "$=", "*=", "]"); // eq, not, start, end, contain, (no val)
</p></li>
<p>        } else {
</p></li>
<p>
</p></li>
<p>
</p></li>
<p>
</p></li>
<p>
</p></li>
<p>        }
</p></li>
<p>        <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">Collector</span>.<span style="color: green; font-weight: bold;">collect</span>(new <span style="color: red; font-weight: bold;">Evaluator.AllElements</span>(), <span style="color: purple; font-weight: bold;">root</span>));
    }
</p></li>
</li>
</ul>
<h2>Commit: 2202259</h2>
<h3>addition:</h3><ul>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        <span style="color: blue; font-weight: bold;">// no-op; just append uniques</span>
    }

    // direct child descendants
</p></li>
</li>
</ul>
<h2>Commit: 4555f2d</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        elements.addAll(found);
</p></li>
<p>        Validate.notEmpty(key);
</p></li>
<p>        if (tq.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;]&quot;)) {
            elements.addAll(root.<span style="color: green; font-weight: bold;">getElementsByAttribute</span>(key));
        } else {
            if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;=&quot;))
                <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByAttributeValue</span>(<span style="color: purple; font-weight: bold;">key</span>, <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>(&quot;]&quot;)));

            else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;!=&quot;))
                <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByAttributeValueNot</span>(<span style="color: purple; font-weight: bold;">key</span>, <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>(&quot;]&quot;)));

            else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;^=&quot;))
                <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByAttributeValueStarting</span>(<span style="color: purple; font-weight: bold;">key</span>, <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>(&quot;]&quot;)));

            else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;$=&quot;))
                <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByAttributeValueEnding</span>(<span style="color: purple; font-weight: bold;">key</span>, <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>(&quot;]&quot;)));

            else if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;*=&quot;))
                <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsByAttributeValueContaining</span>(<span style="color: purple; font-weight: bold;">key</span>, <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>("]")));
        }
</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>        elements.addAll(found);
</p></li>
<p>        Validate.notEmpty(key);
</p></li>
<p>        if (<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">matchChomp</span>(&quot;=&quot;))
            <span style="color: purple; font-weight: bold;">value</span> = <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">chompTo</span>(&quot;]&quot;);
        else
            <span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">consume</span>(&quot;]&quot;);

        if (<span style="color: purple; font-weight: bold;">value</span> != null)
            <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">root</span>.<span style="color: green; font-weight: bold;">getElementsWithAttributeValue</span>(<span style="color: purple; font-weight: bold;">key</span>, <span style="color: purple; font-weight: bold;">value</span>));
        else {
            elements.addAll(root.<span style="color: green; font-weight: bold;">getElementsWithAttribute</span>(key));
        }
</p></li>
</li>
</ul>
<h2>Commit: 86c1d97</h2>
<h3>addition:</h3><ul>
<li><strong>src/main/java/org/jsoup/select/Selector.java:</strong><br>
<p>            <span style="color: green; font-weight: bold;">allElements</span>();
        } else { <span style="color: blue; font-weight: bold;">// unhandled</span>
</p></li>
<p>                Elements <span style="color: purple; font-weight: bold;">candidateChildren</span> = new <span style="color: red; font-weight: bold;">Elements</span>(<span style="color: green; font-weight: bold;">select</span>(<span style="color: purple; font-weight: bold;">tq</span>.<span style="color: green; font-weight: bold;">remainder</span>(), <span style="color: purple; font-weight: bold;">elements</span>));
                return <span style="color: green; font-weight: bold;">filterForChildren</span>(<span style="color: purple; font-weight: bold;">elements</span>, <span style="color: purple; font-weight: bold;">candidateChildren</span>);
            } else { <span style="color: blue; font-weight: bold;">// ancestor descendant (AND, really)</span>
</p></li>
<p>        <span style="color: purple; font-weight: bold;">elements</span>.<span style="color: green; font-weight: bold;">addAll</span>(<span style="color: purple; font-weight: bold;">Collector</span>.<span style="color: green; font-weight: bold;">collect</span>(new <span style="color: red; font-weight: bold;">Evaluator.AllElements</span>(), <span style="color: purple; font-weight: bold;">root</span>));
    }

    private void groupOr() {
</p></li>
<p>        Elements <span style="color: purple; font-weight: bold;">children</span> = new <span style="color: red; font-weight: bold;">Elements</span>();
        <span style="color: purple; font-weight: bold;">CHILDREN</span>: for (Element <span style="color: purple; font-weight: bold;">c</span> : <span style="color: purple; font-weight: bold;">candidateChildren</span>) {
            for (Element <span style="color: purple; font-weight: bold;">p</span> : <span style="color: purple; font-weight: bold;">parents</span>) {
                if (<span style="color: purple; font-weight: bold;">c</span>.<span style="color: green; font-weight: bold;">parent</span>().<span style="color: green; font-weight: bold;">equals</span>(<span style="color: purple; font-weight: bold;">p</span>)) {
                    <span style="color: purple; font-weight: bold;">children</span>.<span style="color: green; font-weight: bold;">add</span>(<span style="color: purple; font-weight: bold;">c</span>);
                    continue <span style="color: purple; font-weight: bold;">CHILDREN</span>;
                }
            }
        }
        return <span style="color: purple; font-weight: bold;">children</span>;
    }

</p></li>
</li>
</ul>
<h3>deletion:</h3><ul>
</ul>
</body></html>
tidy-up, removed code not covered by tests, added TODOs

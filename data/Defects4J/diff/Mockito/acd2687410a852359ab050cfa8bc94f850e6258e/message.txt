Various bits of refactoring and tidy up on current timeout implementation, to make it easy to add after() shortly

Fixed Issue 153 by using a stack to keep track of first elements at any level.

Incorporated code review from r949

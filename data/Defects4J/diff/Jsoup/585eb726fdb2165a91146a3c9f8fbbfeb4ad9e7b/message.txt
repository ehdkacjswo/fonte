Improve performance when selecting against multiple roots

Caches the parsed query

Fixes #518

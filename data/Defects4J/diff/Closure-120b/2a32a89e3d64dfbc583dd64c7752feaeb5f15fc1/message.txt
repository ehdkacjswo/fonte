Re-arrange type resolution to handle IIFEs better

Also, make sure that everyone using the compiler is fine with the new
warnings this time.
-------------
Created by MOE: http://code.google.com/p/moe-java
MOE_MIGRATED_REVID=45744345

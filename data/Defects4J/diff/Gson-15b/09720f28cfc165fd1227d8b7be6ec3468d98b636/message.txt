Incorporated changes from r307 code review

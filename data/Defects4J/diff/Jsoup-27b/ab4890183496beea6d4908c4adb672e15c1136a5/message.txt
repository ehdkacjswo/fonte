Fix an incorrect case fall-through, and add some not-null validations to prevent warnings.

For #103

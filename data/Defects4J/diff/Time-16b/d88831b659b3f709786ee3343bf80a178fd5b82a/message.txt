Minor tweaks to code from Dave Brosius

If a charset cannot encode, flip to one that can

Fixes #1007

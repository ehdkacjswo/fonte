Simplified and corrected ConstrainableInputStream impl

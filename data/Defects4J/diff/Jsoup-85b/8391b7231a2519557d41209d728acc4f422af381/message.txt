Improved hashcode and equals for Node

Fixes #537

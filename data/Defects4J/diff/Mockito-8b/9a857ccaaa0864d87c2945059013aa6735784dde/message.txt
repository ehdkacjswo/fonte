Improved some synchronized code based on Hynek's suggestions.

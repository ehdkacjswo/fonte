Wrong code generated if mixing types in ternary operator